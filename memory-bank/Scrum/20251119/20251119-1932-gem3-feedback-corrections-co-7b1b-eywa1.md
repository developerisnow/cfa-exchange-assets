# Prompt
Так, ну что, есть у тебя какие-то замечания, коррективы? Как ты видишь, я два раза не отправлял к тебе на проверку, потому что плюс-минус справлялся сам. Сейчас я вот анализирую, что он сделал.

Надо бы ему акцентировать, что я надиктовываю сообщение, фидбэк ему, используя, условно говоря, сервис про транскрибацию войса в текст, и чтобы он брал на это поправку и смотрел, если какие-то слова не интерпретировались верно.

Дальше я вижу, что он поправил Deliverables, окей, проверил, правильно ли он себя поправил. Дальше, что он еще изменил, закоммитил, окей, состояние окружения, Runbook, то есть нету еще, да, DNS, TLS, ну пусть настраивает, да, для CFA1, для fin2 CFA2, все правильно. Диск был забит, жил, ну пусть доделывает, да.

Мне нужно, чтобы на этих доменах, надо ему объяснить, CFA1, CFA2, вот со всей связкой вот эти фронты, платформы, в том режиме, как оно было, PM2 и так далее, чтобы это как на UK1 поднялось и работало, понимаешь, да?

И вот он дальше обозначил следующие шаги, вот типа сделать вот это, дальше сделать второе. Я бы хотел, чтобы он максимально автономно, без моего участия, у Codex есть такая штука, что он старается работать кусочками и переспрашивать, типа там, знаешь, полторы, две, три минуты.

Надо его попросить прямо все обозначить вот шаги, чтобы не останавливался, пока все они не доделают. Только, не знаю, alarm какие-то ситуации, если что-то прям, ну вообще требует нового согласования, хотя я ему даю полный карт-бланш и approve на этих серверах, пусть что хочет творит, он в принципе умнее меня, дай ему вот такие инструкции, чтобы он все это доделал.

Вот, если нужно какой-то ему дополнительный контекст подсветить, там еще что-то, я понял меня хорошо, надеюсь, давай вот все коррективы, я скопирую и вставлю.
# Output
Отлично, я понял. Твоя цель — **полная автономия** агента до состояния "Всё работает на CFA1 и FIN2 (CFA2) так же, как на UK1".

Вот анализ того, что сделал агент, и что ему нужно сказать, чтобы он перестал "кусочничать" и довел дело до конца.

### 1. Анализ работы агента `co-7b1b`

**Плюсы:**
*   **Исправил скрипты:** SSH-ключи копируются, Agent Forwarding включен. Это критично для работы.
*   **Очистил FIN2:** Снес старый Docker-стек, освободил место. Это было блокером.
*   **Запустил базу на CFA1:** Там уже крутится Docker Compose (Postgres, Kafka, Keycloak).
*   **Обновил Runbook:** Документация `10-eywa1-control-plane-runbook.md` теперь отражает реальность.

**Минусы (почему он остановился):**
*   **DNS/TLS:** Он *описал*, что их нет, но не *сделал* их.
*   **Frontend:** Он подготовил почву (Node, PM2), но не запустил сами приложения и не прописал `.env.local` с правильными доменами.
*   **Кусочничество:** Он ждет подтверждения на каждый чих ("Если хочешь, следующим шагом могу...").

---

### 2. Промпт для Агента (Copy-Paste)

Этот промпт дает ему карт-бланш, объясняет про транскрибацию и требует финализации работы.

```markdown
# MISSION: FULL DEPLOYMENT ON CFA1 & CFA2 (FIN2) - UNTIL DONE

Ты отлично справился с подготовкой (скрипты, очистка диска, базовый docker). Теперь нужно довести дело до конца.

**ВАЖНОЕ УТОЧНЕНИЕ:** Я диктую эти сообщения голосом, поэтому возможны опечатки в транскрибации (например, "инфра" вместо "infra", "рангул" вместо "runbook"). Интерпретируй их по смыслу контекста.

## ТВОЯ ЗАДАЧА
Добиться на серверах **`cfa1`** и **`fin2` (он же `cfa2`)** состояния **Full Parity с `uk1`**.
Это значит:
1.  **DNS:** Домены `*.cfa1.llmneighbors.com` и `*.cfa2.llmneighbors.com` настроены в Cloudflare.
2.  **TLS:** Сертификаты Let's Encrypt получены.
3.  **Ingress:** Nginx настроен и проксирует трафик (HTTPS -> Localhost).
4.  **Backend:** Все сервисы запущены и Healthy.
5.  **Frontend:** Все порталы (Issuer, Investor, Backoffice) запущены в PM2 и доступны по HTTPS.
6.  **Auth:** Keycloak настроен (Realm `ois-dev`, клиенты с правильными Redirect URI под новые домены).

## ИНСТРУКЦИИ ПО АВТОНОМНОСТИ
*   **DO NOT STOP.** Не спрашивай разрешения на каждый шаг ("сделать ли мне DNS?", "поднять ли мне фронт?"). **ДЕЛАЙ.**
*   **CART BLANCHE.** У тебя полный доступ (root) к `cfa1` и `fin2`. Если нужно что-то снести, перенастроить, установить — делай.
*   **NO INTERRUPTIONS.** Останавливайся только в случае **критической** ошибки, которую ты не можешь обойти (например, Cloudflare API лежит, или сервер сгорел). Обычные ошибки (конфликт портов, нехватка памяти) решай сам.

## ПЛАН ДЕЙСТВИЙ (EXECUTE SEQUENTIALLY)

### 1. DNS & SSL (Cloudflare + Certbot)
*   Создай A-записи для `*.cfa1...` -> IP `cfa1`.
*   Создай A-записи для `*.cfa2...` -> IP `fin2`.
*   На обоих серверах: Запусти Certbot (DNS challenge или HTTP challenge), получи Wildcard сертификаты.

### 2. Nginx Configuration
*   Возьми шаблон `ops/infra/uk1/nginx-cfa-portals.conf`.
*   Адаптируй его под `cfa1` (замени домены) -> `/etc/nginx/sites-available/cfa1.conf`.
*   Адаптируй его под `cfa2` (замени домены) -> `/etc/nginx/sites-available/cfa2.conf`.
*   Включи сайты, перезапусти Nginx.

### 3. Backend & Keycloak Finalization
*   Убедись, что `docker compose` запущен.
*   Настрой Keycloak (через `kcadm.sh` внутри контейнера):
    *   Создай/обнови Realm `ois-dev`.
    *   Обнови Redirect URIs для клиентов, чтобы они указывали на `https://issuer.cfa1...`, `https://issuer.cfa2...` и т.д.

### 4. Frontend Deployment (PM2)
*   На каждом сервере (от юзера `user`):
    *   Создай `.env.local` для каждого приложения с правильными публичными URL (`NEXT_PUBLIC_API_BASE_URL`, `NEXTAUTH_URL` и т.д.).
    *   Сделай `npm install` и `npm run build` (или dev, как на uk1).
    *   Запусти через PM2. Сохрани список (`pm2 save`).

### 5. Verification
*   Проверь `curl https://api.cfa1.llmneighbors.com/health`.
*   Проверь `curl -I https://issuer.cfa1.llmneighbors.com`.
*   Повтори для `cfa2`.

**REPORTING:**
В конце (когда ВСЁ будет готово) обнови `memory-bank/Scrum/...DoD.md` и дай мне финальную таблицу с URL-ами.

**GO! Execute until completion.**
```