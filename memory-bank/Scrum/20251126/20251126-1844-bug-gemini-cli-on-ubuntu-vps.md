# Prompt 1
````prompt
Слушай, сталкивался ли ты с такой проблемой, что я на Ubuntu сервере запускаю Gemini CLI и он просто тупит? Я его запускаю внутри tmux-сессии. Нет ли каких-то на форумах Reddit и GitHub issue на тему, что вот оно глючит?

Интерфейс нормальный, то есть я его открыл, он запустился. Дальше я пытаюсь в нем что-то делать, и у меня просто происходит какой-то подвисок. Я не понимаю, что дальше мне делать, чтобы он заработал. То есть я начинаю печатать, а оно тупо не печатает, как будто сессия замороженная. Что там происходит, я не понимаю.

Сейчас я попробую на своем macOS еще, для эксперимента, чтобы понять, что же все-таки происходит. Вот, например, открываю новый macOS и пробую просто запустить Gemini. У меня он сейчас долго думает, даже на моем мощном macOS. Там что-то предлагает писать. А, ну, на этом сразу работает. Короче, клавиатура — я могу сразу писать на Mac. А внутри tmux-сессии, получается, не работает.

Сейчас я еще, для чистоты эксперимента, попробую просто подключиться без tmux-сессии к серверу и на этом сервере тоже запустить. То есть, ага, я подключен. Хорошо, вот так стало. Может быть, tmux внутри tmux — проблема. Ну что? Сейчас посмотрим внимательно.

Эту проблему нужно посмотреть со всех сторон, что может влиять, потому что мне очень критично, чтобы это работало как необходимо, иначе я не смогу работать. Мне нужен Gemini именно на сервере. Стоит отметить, что я уже использовал все методы. Ну, не все методы, а как нужно. Он у меня уже авторизированный, это работало. Я что-то не понимаю, что с ним происходит.

Сейчас вот еще раз без tmux. Напоминаю, что подключаюсь — я обычно работаю внутри своего macOS tmux, а внутри этого tmux подключаюсь еще к серверу, и там захожу в tmux. Но сейчас этого не делаю. Я вот сейчас на сервере тоже зашел просто в iTerm в терминале, и у меня не работает. Какой-то бред получается.

Я же там как-то авторизировался раньше. А на сервере, я имею в виду, что это точно отрабатывало. Вот сейчас еще раз запускаю. Или он очень долго думает, инициализируется, или что это происходит? Нужно почитать на форумах, что это может быть, это точно.
````
# Gpt5High

Да, ты не один такой — у Gemini CLI **есть подтверждённый баг**, который выглядит почти 1-в-1 как то, что ты описываешь:

> баннер GEMINI и tips видны, а дальше **нет курсора, ввод не эхоится, как будто сессия замёрзла**.

### 1. Главный подозреваемый — переменные окружения `CI`, `CI_*`, `CONTINUOUS_INTEGRATION`

Официальный troubleshooting прямо описывает это: если в окружении есть `CI`, `CONTINUOUS_INTEGRATION` или **любая переменная с префиксом `CI_`**, Gemini CLI считает, что он запущен в CI и **рубит интерактивный режим**. В итоге:

* баннер рисуется,
* tips видны,
* но интерактивный UI не стартует и ввод не принимается. ([Gemini CLI][1])

На GitHub есть отдельный issue **“Gemini CLI fails to run in interactive mode when a `CI_*` environment variable is set”**. Там ровно так и описано:

> CLI показывает ASCII-арт, но **не переходит в интерактивный режим; ввод не обрабатывается и не отображается**. ([GitHub][2])

Это очень похоже на твоё описание + на скрине видно, что сам бинарь запускается, значит проблема именно в режиме работы, а не в установке.

Почему на macOS ок, а на Ubuntu нет:

* На сервере у тебя почти наверняка в `.bashrc` / `.profile` / каких-то dev-скриптах висят переменные типа
  `CI=1`, `CI_SERVER_URL`, `CI_PROJECT_NAME`, `CI_JOB_ID` и т.п. (часто тянут из GitLab CI и прочих тулов).
* На Mac ты, скорее всего, их не экспортируешь глобально, поэтому там всё работает.

#### Что сделать прямо сейчас

1. **Проверь CI-переменные на сервере** (в обычной сессии, где Gemini глючит):

   ```bash
   env | egrep '^CI($|_)|^CONTINUOUS_INTEGRATION'
   ```

   Если что-то вывелось — это почти точно корень проблемы.

2. **Запусти Gemini без этих переменных** (одноразовый тест):

   ```bash
   env -u CI -u CONTINUOUS_INTEGRATION gemini
   ```

   Если у тебя куча `CI_…` переменных (GitLab-стайл), можно точечно убрать одну-две для теста, например:

   ```bash
   env -u CI -u CONTINUOUS_INTEGRATION -u CI_TOKEN -u CI_PROJECT_NAME gemini
   ```

   Если после этого **курсора видно, ввод печатается** и всё реагирует — значит это именно тот баг.

3. Более жёсткий вариант (чистое окружение, кроме базового):

   ```bash
   env -i PATH="$PATH" HOME="$HOME" TERM="$TERM" SHELL="$SHELL" gemini
   ```

   Здесь мы выбиваем все CI-переменные под ноль, но сохраняем PATH/HOME/TERM/SHELL, чтобы `gemini` нашёлся и корректно рисовал TTY.

4. Если это помогло — нормальное решение:

   * либо **убрать/переименовать CI-переменные** из интерактивных шелл-конфигов (`~/.bashrc`, `~/.zshrc` и т.д.), оставив их только для CI/скриптов;
   * либо завести алиас/функцию для Gemini, которая всегда чистит их:

     ```bash
     ggemini() {
       env -u CI -u CONTINUOUS_INTEGRATION gemini "$@"
     }
     ```

   и пользоваться `ggemini` вместо голого `gemini`.

### 2. tmux-специфичные баги — есть, но у тебя, судя по описанию, не они

На GitHub реально фигурируют проблемы именно с tmux:

* критичный баг, где **запуск Gemini внутри tmux убивает весь tmux-сервер** (issue #13396, помечен как priority/p0). ([GitHub][3])
* проблемы с /ide внутри tmux, некорректные цвета, caret остаётся видимым в неактивном pane и т.п.

Но ты уже проверил:

* внутри tmux → не работает,
* **вне tmux на том же сервере → тоже не работает**,

значит корень явно **не только в tmux**, а в окружении процесса (что как раз совпадает с историей про `CI_*`).

Тем не менее, когда починишь интерактивный режим, имеет смысл:

```bash
echo $TERM
```

* снаружи tmux должно быть что-то вроде `xterm-256color`,
* внутри tmux — `screen-256color` или `tmux-256color` (нормально, Gemini CLI такое понимает; цвета и caret максимум могут чуть странно вести себя, но не ломают ввод). ([Hacker News][4])

### 3. На всякий случай: версия и дебаг

Если CI-переменные ни при чём (вдруг), тогда следующий уровень:

1. **Проверь версию / about** (если удастся хоть раз его завести, даже на Mac):

   ```bash
   gemini /about
   gemini --version
   ```

2. На сервере попробуй запустить с дебагом:

   ```bash
   env -i PATH="$PATH" HOME="$HOME" TERM="$TERM" SHELL="$SHELL" gemini --debug
   ```

   В последних гайдах рекомендуют `--debug` / `--verbose` для детального вывода: там видно, не завис ли он, например, на подключении к MCP-серверу или ещё где-то.

3. Если окажется, что он вообще висит в фазе "`Connecting to MCP servers...`" и т.п., — это уже другая ветка багов (есть свежий issue про “CLI Hangs/Unresponsive at Input Prompt”, где он зомби-состояние ловит на MCP). ([GitHub][5])

---

### TL;DR план действий для тебя

1. На проблемном Ubuntu-сервере выполнить:

   ```bash
   env | egrep '^CI($|_)|^CONTINUOUS_INTEGRATION'
   ```

2. Если что-то есть → попробовать:

   ```bash
   env -u CI -u CONTINUOUS_INTEGRATION gemini
   ```

3. Если так начинает работать:

   * вычищаешь/переименовываешь CI-переменные из интерактивного шелла,
   * или делаешь алиас `ggemini` c `env -u CI …`.

4. Если **даже с чистым окружением** (`env -i … gemini --debug`) он всё равно не реагирует — тогда это, скорее всего, новый баг уровня тех, что сейчас в трекере, и сто́ит:

   * снять лог с `--debug`,
   * открыть issue на `google-gemini/gemini-cli` с описанием: “Ubuntu + ssh + (tmux / без tmux), баннер есть, ввода нет”.

Но по симптомам я бы сперва почти на 100% ставил на **CI/CI_* в окружении**. Попробуй этот шаг — очень вероятно, что после `env -u CI … gemini` всё на сервере оживёт.

[1]: https://geminicli.com/docs/troubleshooting/ "Troubleshooting guide | Gemini CLI"
[2]: https://github.com/google-gemini/gemini-cli/issues/1563 "Gemini CLI fails to run in interactive mode when a `CI_*` environment variable is set · Issue #1563 · google-gemini/gemini-cli · GitHub"
[3]: https://github.com/google-gemini/gemini-cli/issues/13396 "Gemini cli exiting tmux server allways · Issue #13396 · google-gemini/gemini-cli · GitHub"
[4]: https://news.ycombinator.com/item?id=44754492&utm_source=chatgpt.com "Replacing tmux in my dev workflow"
[5]: https://github.com/google-gemini/gemini-cli/issues/13549?utm_source=chatgpt.com "CLI Hangs/Unresponsive at Input Prompt on Windows 11 ..."

# Gemini 3 Web
Судя по скриншоту и твоему описанию, проблема действительно неприятная, но довольно типичная для запуска современных CLI-инструментов (особенно написанных на Node.js, Python или Rust с богатым TUI) на "безголовых" (headless) серверах.

Тот факт, что это **работает на macOS**, но **зависает на Ubuntu Server** (даже без tmux), указывает на две основные вероятные причины: **проблемы с графическим выводом (TERM)** или **блокировка на попытке доступа к системному хранилищу ключей (Keyring)**.

Вот пошаговый план, как это диагностировать и починить.

### 1\. Самая вероятная причина: Keyring / Browser Launch (Проблема авторизации)

Многие современные CLI (включая инструменты от Google) при запуске пытаются проверить токен.

  * **На macOS:** Они обращаются к "Связке ключей" (Keychain), получают токен и работают.
  * **На Ubuntu Server:** Они пытаются обратиться к `gnome-keyring` или `kwallet`, которых на сервере нет. Или, что еще хуже, пытаются открыть браузер для ре-авторизации, но так как GUI нет, процесс просто "виснет" в ожидании ответа от несуществующего браузера.

**Решение:**
Попробуй передать API ключ явно через переменную окружения, чтобы инструмент перестал пытаться лезть в системное хранилище или открывать браузер.
Обычно для Gemini CLI это делается так (проверь документацию конкретно твоего пакета, но стандарт такой):

```bash
export GEMINI_API_KEY="твой_ключ_здесь"
# или
export GOOGLE_API_KEY="твой_ключ_здесь"
```

Попробуй запустить после этого. Если заработает — проблема была в попытке "безопасного" хранения токена.

### 2\. Проблема отрисовки (TERM)

Инструмент на скриншоте использует "богатый" интерфейс (градиенты, ASCII-арт). Библиотеки для отрисовки такого интерфейса (например, `ink` для JS или `ratatui` для Rust) могут сходить с ума, если терминал не поддерживает нужные цвета или режимы.

**Решение:**
Перед запуском принудительно укажи тип терминала, который точно поддерживается везде:

```bash
export TERM=xterm-256color
# Попробуй запустить снова
gemini
```

Если не поможет, попробуй совсем простой режим: `export TERM=xterm`.

### 3\. Проблема после обновления (замечено на скриншоте)

На твоем скриншоте есть строчка:
`> Update successful! The new version will be used on your next run.`

Это очень важная улика. Возможно:

1.  Обновление "сломало" совместимость с Linux (баг в новой версии).
2.  Обновление сбросило конфиг авторизации, и теперь он пытается показать интерактивное окно логина, которое не рендерится.

**Что делать:**

  * **Поискать issue:** Если ты скажешь точное название пакета (как ты его ставил? `npm install -g gemini-chat-cli`? `pip install ...`? `cargo install ...`?), я смогу найти конкретный GitHub Issue. Инструментов с названием "Gemini CLI" сейчас десятки.
  * **Откатить версию:** Если ты ставил через npm, попробуй установить предыдущую версию.

### 4\. Проблема с "зависанием" ввода (Input Buffering)

Если интерфейс нарисовался, но ты печатаешь, а буквы не появляются:
Это значит, что приложение перехватило ввод (Raw Mode), но не обрабатывает события (Event Loop заблокирован). Это часто бывает, если приложение пытается сделать сетевой запрос синхронно при старте.

  * **Проверка сети:** Убедись, что с сервера доступен `generativelanguage.googleapis.com`.
    ```bash
    curl -v https://generativelanguage.googleapis.com
    ```
    (Если висит на IPv6 — отключи IPv6 или настрой gai.conf).

### Резюме и следующий шаг

Скорее всего, CLI ждет ввода пароля или подтверждения в браузере, который не может открыться, либо висит на доступе к Keyring.

**Давай сделаем следующее:**

1.  Попробуй `export TERM=xterm-256color`.
2.  Если не помогло, напиши, **какой именно командой ты устанавливал этот инструмент** (или дай ссылку на репозиторий). По логотипу это похоже на неофициальный клиент (например, на Rust или Node.js), и у них часто бывают специфичные баги с Linux-библиотеками (например, `libssl` или `dbus`).

Я найду точный issue на GitHub под этот репозиторий.