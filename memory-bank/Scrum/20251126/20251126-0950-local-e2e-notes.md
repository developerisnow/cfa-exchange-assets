---
created: 2025-11-26 09:50
updated: 2025-11-26 12:50
type: testing
sphere: exchange
topic: local-e2e
author: Codex CLI (co-76ca)
agentID: codex-cli-co-76ca
partAgentID: [co-76ca]
version: 0.1.0
tags: [playwright, e2e, localhost, keycloak]
---

## Local stack + Playwright smoke status (eywa1)
- Ports: gateway 55000, identity 55001, issuance 55005, registry 55006, settlement 55007, compliance 55008, keycloak 58080, postgres 55440, minio 59000/59001, redis 56379, issuer 3001, investor 3002, backoffice 3003.
- `make up-local` ok (run via `sg docker -c 'make up-local'` until shell re-login picks docker group). Settlement start requires `MIGRATE_ON_STARTUP=false` (pending migrations).
- Swagger smoke (local): `API_BASE_URL=http://localhost:55000 ... playwright test tests/swagger-availability.spec.ts tests/swagger-all-services.spec.ts --workers=1` → 7/7 green.
- Keycloak realm `ois` provisioned via `setup-keycloak.sh`/`kcadm`: clients `portal-issuer|portal-investor|backoffice` (secret=secret), testuser `testuser/testpass123` с ролями issuer/investor/backoffice; sslRequired=none. Прямой grant для issuer/investor аккаунтов всё ещё ругается `Account is not fully set up` → OAuthSignin в NextAuth.
- Playwright suite бьёт в localhost; Keycloak-флоу включён по умолчанию, но на eywa1 сейчас падает с OAuthSignin. Для прогонов используется фолбэк `USE_KEYCLOAK_AUTH=false` (15 passed, 1 skipped investor auth). Скрины: `artifacts/tests/e2e/playwright/20251126-*`.

## Target e2e layout
- Keep smoke suite in `tests/e2e-playwright` for infra/public availability.
- Move app-specific flows under each app: `apps/portal-issuer/tests/e2e-playwright`, `apps/portal-investor/tests/e2e-playwright`, `apps/backoffice/tests/e2e-playwright` with per-app Playwright config/projects.
- Wire `make e2e` to call the smoke suite (swagger) plus per-app subsets against running docker stack (no pm2).
