–î–∞, Playwright —Ç—É—Ç *–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω* ‚Äî –∏–Ω–∞—á–µ —Ç—ã –±—É–¥–µ—à—å –≤–µ—á–Ω–æ –Ω–∞ –≥–ª–∞–∑ –º–µ—Ä–∏—Ç—å, ¬´—Ä–∞–±–æ—Ç–∞–µ—Ç/–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç¬ª. –ù–∏–∂–µ:

1. –∫—Ä–∞—Ç–∫–∏–π –∞—É–¥–∏—Ç —Ç–æ–≥–æ, —á—Ç–æ **—É–∂–µ –µ—Å—Ç—å –ø–æ NX-05/06/07/08**,
2. **–≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç** –¥–ª—è codex‚Äë–∞–≥–µ–Ω—Ç–∞ (–º–æ–∂–µ—à—å –∫–æ–ø–∏–ø–∞—Å—Ç–∏—Ç—å –≤ codex-cli),
3. –ø–æ—è—Å–Ω–µ–Ω–∏—è –ø–æ **NX‚Äë06 ¬´—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ¬ª** –∏ **NX‚Äë07 KYC/User Registry**,
4. —á—Ç–æ —Ç–µ–±–µ –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫—É –ª—É—á—à–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å.

---

## 1. –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å –ø–æ NX‚Äë05/06/07/08 (–ø–æ –∫–æ–Ω—Ç—É—Ä—É, –±–µ–∑ —Ç–≤–æ–µ–≥–æ –∂–∏–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞)

### NX‚Äë05 ‚Äî Issuer Dashboard & Reports

* Backend:

  * `GET /v1/reports/issuances` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ Issuance (`GetIssuerIssuancesReport`), DTO `IssuerIssuancesReportResponse` / `IssuerReportRow` —É–∂–µ –µ—Å—Ç—å.
  * `GET /v1/reports/payouts` –µ—Å—Ç—å –≤ Settlement (`GetPayoutsReport`).
  * –í gateway –¥–æ–±–∞–≤–ª–µ–Ω —Ä–æ—É—Ç `reports-issuances` ‚Üí cluster `issuance`, –∞ –æ–±—â–∏–π `reports` –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ `settlement`.
* CFA1:

  * –î–æ —Ñ–∏–∫—Å–∞ –±—ã–ª 404, –ø–æ—Ç–æ–º –∞–≥–µ–Ω—Ç –æ–±–Ω–æ–≤–∏–ª gateway –æ–±—Ä–∞–∑/–∫–æ–Ω—Ñ–∏–≥ –∏ –Ω–∞ CFA1 `/v1/reports/issuances` —É–∂–µ –¥–∞—ë—Ç **401 (–±–µ–∑ —Ç–æ–∫–µ–Ω–∞)**, –∞ –Ω–µ 404; –≤ —Ç–∞—Å–∫–µ NX‚Äë05 –æ–Ω —ç—Ç–æ –∑–∞–ø–∏—Å–∞–ª –∫–∞–∫:
    `[x] Gateway –º–∞—Ä—à—Ä—É—Ç—ã ... Verified: 2025-11-21-1130 @ cfa1 ‚Üí OK (401 –±–µ–∑ —Ç–æ–∫–µ–Ω–∞; –º–∞—Ä—à—Ä—É—Ç—ã –≤ gateway –æ–±–Ω–æ–≤–ª–µ–Ω—ã)`
  * –ù–æ **—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (200 —Å –∞–≥—Ä–µ–≥–∞—Ç–∞–º–∏) –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã, —á–µ–∫–±–æ–∫—Å –≤—Å—ë –µ—â—ë –ø—É—Å—Ç–æ–π.

### NX‚Äë06 ‚Äî Payout Schedule

* UI:

  * –í `apps/portal-issuer/src/app/issuances/[id]/page.tsx` –¥–æ–±–∞–≤–ª–µ–Ω —Ç–∞–±/—Å–µ–∫—Ü–∏—è *Payout Schedule* –Ω–∞ –æ—Å–Ω–æ–≤–µ `scheduleJson`, read‚Äëonly, —Å —è–≤–Ω–æ–π –ø–æ–º–µ—Ç–∫–æ–π, —á—Ç–æ —ç—Ç–æ powered by `scheduleJson`.
  * –ï—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π `tasks/NX-06-payout-schedule-SPEC-DIFF.md` —Å–æ SPEC DIFF –ø–æ `/v1/issuances/{id}/payouts/schedule` –∏ `PayoutScheduleItem`.
* DoD / CFA1:

  * –í DoD NX‚Äë06 –∏ c2p_tasks —è–≤–Ω–æ –Ω–∞–ø–∏—Å–∞–Ω–æ: —Ç—Ä–µ–±—É–µ—Ç—Å—è —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `GET /v1/issuances/{id}` –Ω–∞ CFA1 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `scheduleJson`; —Å–µ–π—á–∞—Å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ `FAIL 404` –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ GUID.
  * –ù–µ—Ç Playwright‚Äë—Ç–µ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—ã –ø—Ä–æ–≤–µ—Ä—è–ª–∏ –Ω–∞–ª–∏—á–∏–µ —Å–µ–∫—Ü–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.

### NX‚Äë07 ‚Äî Backoffice KYC & User Registry

* Backoffice —Ñ—Ä–æ–Ω—Ç: —É–∂–µ –µ—Å—Ç—å:

  * `/auth/signin` —Å `signIn('keycloak', { callbackUrl: '/kyc' })`.
  * `/kyc` ‚Äî —Å–ø–∏—Å–æ–∫ KYC —Å approve/reject, —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `listKycRequests` / `submitKycDecision` –≤ `apps/backoffice/src/lib/api/compliance.ts`.
  * `/users` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ `listUsers(query)` (User Registry).
* API‚Äë–∫–ª–∏–µ–Ω—Ç:

  * `compliance.ts` —Ö–æ–¥–∏—Ç –≤ `/v1/compliance/kyc`, `/v1/compliance/kyc/{id}/decision`, `/v1/identity/users` –∏ –∏–º–µ–µ—Ç **fallback‚Äë–º–æ–∫–∏**, –µ—Å–ª–∏ –±—ç–∫–µ–Ω–¥ –æ—Ç–¥–∞—ë—Ç –æ—à–∏–±–∫—É/–Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω.
* CFA1 / DoD:

  * –ê–≥–µ–Ω—Ç –Ω–∞ CFA1 –ø—Ä–æ–±–∏–≤–∞–ª `https://api.cfa1.llmneighbors.com/v1/compliance/kyc`, `/v1/identity/users`, `/v1/audit` ‚Äî —Ç–∞–º —Å–µ–π—á–∞—Å 401/404, –∏ –æ–Ω **–∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª —ç—Ç–æ –≤ NX‚Äë07/08 DoD** –∫–∞–∫: –º–∞—Ä—à—Ä—É—Ç—ã –∂–∏–≤—ã/—á–µ—Ä–µ–∑ gateway –Ω–µ –ø—Ä–æ–±—Ä–æ—à–µ–Ω—ã/—Ç—Ä–µ–±—É—é—Ç auth.
  * –ù–∞ –≤–µ—Ç–∫–µ `codex/fix-cfa1-regressions` –æ–Ω –ø–æ–ø—Ä–∞–≤–∏–ª `apps/backoffice/src/lib/auth.ts` (NextAuth secret/–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã) –∏ –¥–æ–±–∞–≤–∏–ª `backoffice-kyc.spec.ts`.
  * –ù–æ —É —Ç–µ–±—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –≤—Å—ë —Ä–∞–≤–Ω–æ 500/‚ÄúError backoffice‚Ä¶‚Äù –ø–æ—Å–ª–µ `Sign in` ‚Üí –∑–Ω–∞—á–∏—Ç –ª–∏–±–æ –±–∏–ª–¥/–¥–µ–ø–ª–æ–π –Ω–µ –¥–æ–≥–Ω–∞–ª–∏ –≤–µ—Ç–∫—É, –ª–∏–±–æ –µ—â—ë –æ–¥–∏–Ω –∫–æ–Ω—Ñ–∏–≥‚Äë–≥–ª—é–∫ (NEXTAUTH_URL, callbackUrl, PM2 env).

### NX‚Äë08 ‚Äî Backoffice Audit & Payouts

* Backoffice:

  * API‚Äë—Å–ª–æ–π: `apps/backoffice/src/lib/api/audit.ts` –∏ `reports.ts`, —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `AuditEvent` –∏ `PayoutReport`, –ø–ª—é—Å –ø—Ä–æ–∫—Å–∏ –≤ `api-client.ts`.
  * UI:

    * `/audit` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, JSON‚Äëpreview, link –Ω–∞ detail.
    * `/audit/[id]` ‚Äî detail view –ø–æ –æ–¥–Ω–æ–º—É —Å–æ–±—ã—Ç–∏—é.
    * `/payouts` ‚Äî –æ—Ç—á—ë—Ç –ø–æ –≤—ã–ø–ª–∞—Ç–∞–º —á–µ—Ä–µ–∑ `getPayoutsReport` + `runSettlement` –∏–∑ `reports.ts`.
* Backend:

  * –í compliance —É–∂–µ –µ—Å—Ç—å `/v1/audit` –∏ `/v1/audit/{id}` –ø–æ outbox‚Äë—Å–æ–æ–±—â–µ–Ω–∏—è–º `ois.audit.logged`.
* CFA1:

  * –ê–≥–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–ª `/v1/audit`, `/v1/audit/111` ‚Üí 401/404, —Å—Ç–∞—Ç—É—Å—ã –≤–Ω—ë—Å –≤ NX‚Äë08 DoD.
  * –ù–∞ —Ç–æ–π –∂–µ –≤–µ—Ç–∫–µ `codex/fix-cfa1-regressions` –¥–æ–±–∞–≤–ª–µ–Ω `backoffice-audit.spec.ts` + —Ñ–∏–∫—Å—ã auth.

**–í—ã–≤–æ–¥:**
–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –≤—Å—ë –¥–ª—è NX‚Äë05‚Äì08 —É–∂–µ –µ—Å—Ç—å, –Ω–æ:

* –Ω–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ **cfa1 —Ä–µ–∞–ª—å–Ω–æ –∫—Ä—É—Ç–∏—Ç—Å—è –Ω–∞ –Ω—É–∂–Ω–æ–º –∫–æ–º–º–∏—Ç–µ** (gateway, backoffice, portal‚Äëissuer/‚Äëinvestor);
* –Ω–µ—Ç **–ø—Ä–æ–≥–Ω–∞–Ω–Ω—ã—Ö e2e** –∏–º–µ–Ω–Ω–æ –ø–æ KYC/Audit/Payouts;
* DoD –∑–∞–ø–æ–ª–Ω–µ–Ω —á–∞—Å—Ç–∏—á–Ω–æ: –µ—Å—Ç—å —Å—Ç–∞—Ç—É—Å—ã ‚Äú401/404‚Äù, –Ω–æ –ø–æ—á—Ç–∏ –Ω–∏–≥–¥–µ –Ω–µ—Ç ‚ÄúVerified: ‚Ä¶ (cfa1, —Ç–µ—Å—Ç X, Playwright spec Y)‚Äù.

–ò –¥–∞, —Ç—ã –ø—Ä–∞–≤ ‚Äî –±–µ–∑ –∂—ë—Å—Ç–∫–æ–≥–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ Playwright –∞–≥–µ–Ω—Ç –±—É–¥–µ—Ç ¬´—á–∏–Ω–∏—Ç—å –Ω–∞ –≥–ª–∞–∑¬ª –∏ –∑–∞–±—ã–≤–∞—Ç—å –∫–æ–º–º–∏—Ç–∏—Ç—å.

---

## 2. –ß—Ç–æ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ—Ç –∞–≥–µ–Ω—Ç–∞ (–ø–æ —Å—É—Ç–∏)

–°—É—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π:

1. **–î–æ–≤–µ—Å—Ç–∏ NX‚Äë05‚Äì08 –¥–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ ‚Äú–∑–µ–ª—ë–Ω–æ–≥–æ‚Äù —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞ cfa1**:

   * —Ç—Ä–∏ –ø–æ—Ä—Ç–∞–ª–∞ (issuer/investor/backoffice) –ª–æ–≥–∏–Ω—è—Ç—Å—è —á–µ—Ä–µ–∑ Keycloak –∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã;
   * –æ—Ç—á—ë—Ç—ã –∏ –¥–∞—à–±–æ—Ä–¥—ã –Ω–µ –ø–∞–¥–∞—é—Ç, –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ª–∏–±–æ —Ä–µ–∞–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã, –ª–∏–±–æ —á–µ—Å—Ç–Ω—ã–µ empty‚Äë/error‚Äëstates;
   * KYC‚Äë—Ñ–ª–æ—É –∏ User Registry –≤ backoffice –Ω–µ –ª–æ–º–∞—é—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É (–º–∏–Ω–∏–º—É–º ‚Äî –º–æ–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è, –º–∞–∫—Å–∏–º—É–º ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ API).
2. **–ù–∞–ø–∏—Å–∞—Ç—å / –¥–æ–ø–∏–ª–∏—Ç—å Playwright‚Äë—Ç–µ—Å—Ç—ã**, –∫–æ—Ç–æ—Ä—ã–µ:

   * –ª–æ–≥–∏–Ω—è—Ç issuer/investor/backoffice;
   * –ø—Ä–æ—Ö–æ–¥—è—Ç:

     * Issuer dashboard + reports;
     * Issuer payout schedule —Ç–∞–±;
     * Backoffice KYC list (–∏ —Ö–æ—Ç—è –±—ã –ø–æ–ø—ã—Ç–∫–∞ approve/ reject ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è UI –Ω–∞ 401/404);
     * Backoffice audit log /audit –∏ /audit/[id].
   * —Å–æ—Ö—Ä–∞–Ω—è—é—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –≤ —Ç–≤–æ–π —Ñ–æ—Ä–º–∞—Ç `YYYYMMDD-HHMM-runId-flow-step.e2e.png`.
3. **–û–±–Ω–æ–≤–ª—è—é—Ç DoD**:

   * –≤ `tasks/NX-05...md`‚Äì`NX-08...md` ‚Äî –∫–∞–∂–¥—ã–π —á–µ–∫–±–æ–∫—Å —Å —Ä–µ–∞–ª—å–Ω—ã–º `Verified: 2025-11-21-.... @ cfa1 ‚Üí OK/FAIL (–ø—Ä–∏—á–∏–Ω–∞)`;
   * –≤ `memory-bank/.../20251121-1610-nx05-08-cfa1-dod-kickoff.md` ‚Äî –∫—Ä–∞—Ç–∫–∏–π —Å–≤–æ–¥: –∫–∞–∫–∏–µ URL, –∫–∞–∫–∏–µ –∫–æ–¥—ã, –∫–∞–∫–∏–µ Playwright‚Äë—Å–ø–µ–∫–∏;
   * –Ω–µ —Å—á–∏—Ç–∞—Ç—å 401 ‚Äú—É—Å–ø–µ—à–Ω–æ–π –±–∏–∑–Ω–µ—Å‚Äë–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π‚Äù, —Ç–æ–ª—å–∫–æ ‚Äú–º–∞—Ä—à—Ä—É—Ç –∂–∏–≤‚Äù.

---

## 3. –ì–æ—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è codex‚Äë–∞–≥–µ–Ω—Ç–∞

–ù–∏–∂–µ ‚Äî —Ç–æ, —á—Ç–æ –º–æ–∂–Ω–æ *–∫–∞–∫ –µ—Å—Ç—å* –∫–∏–¥–∞—Ç—å –≤ codex-cli (GPT‚Äë5 Pro/Deep).
–Ø —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —É—á—ë–ª:

* —Ç–µ–∫—É—â–∏–µ –≤–µ—Ç–∫–∏ (`infra.defis.deploy`, `codex/fix-cfa1-regressions`),
* —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ e2e —Å–ø–µ–∫–∏,
* —Ç–≤–æ–π —Ñ–æ—Ä–º–∞—Ç DoD/Verified.

---

### üîß PROMPT –î–õ–Ø –ê–ì–ï–ù–¢–ê (–∫–æ–ø–∏–ø–∞—Å—Ç)

> You are a Senior Full‚ÄëStack Engineer (.NET + Next.js) and Ops for the OIS‚ÄëCFA monorepo.
> Your mission: **finish NX‚Äë05/06/07/08 for the CFA1 demo**, make sure **issuer/investor/backoffice flows actually work on https://*.cfa1.llmneighbors.com**, and **cover them with Playwright e2e tests**, updating all NX task DoD/checklists accordingly.
>
> **Hard constraints**
>
> 1. **Repo & branches**
>
>    * Work in `repositories/customer-gitlab/ois-cfa`.
>    * Base branch: `infra.defis.deploy` (already has NX‚Äë05‚Äì08 merges + updated tasks/DoD).
>    * If not already on a fix branch, **create or reuse** a dedicated branch (e.g. `codex/fix-cfa1-nx05-08-final` or continue `codex/fix-cfa1-regressions`).
>    * **Never commit directly to `infra.defis.deploy`**.
> 2. **Remote env**
>
>    * CFA1 host alias: `ssh user@cfa1`.
>    * Repo on CFA1: `/srv/cfa/ois-cfa`.
>    * Frontends are run via PM2 (`portal-issuer`, `portal-investor`, `backoffice`).
>    * Use existing runbooks:
>
>      * `docs/deploy/docker-compose-at-vps/10-eywa1-control-plane-runbook.md`
>      * `docs/deploy/docker-compose-at-vps/07-frontends.md` (deployment of portals).
>    * Do **not** reset data on CFA1 (no `docker-compose down -v`). Only rebuild/restart services/frontends as runbooks describe.
> 3. **Security / contracts**
>
>    * Do not dump real passwords into git or tasks. Use existing env files and secrets on CFA1.
>    * Respect existing OpenAPI contracts; if you need new behavior, **extend** but don‚Äôt break existing schemas (trunk/branch/leaves).
> 4. **Git hygiene**
>
>    * Every logical chunk (fix + tests + docs) ‚Üí **single commit** with clear message, e.g.
>      `fix(nx-07): [co-76ca] - backoffice kyc login + e2e`
>      Include `agentID=...` in message body.
>    * Always show `git status -sb` before and after commits.
>
> ---
>
> ## Phase 0 ‚Äì Situational awareness
>
> 1. **Local repo state**
>
>    * `cd repositories/customer-gitlab/ois-cfa`
>    * `git fetch origin`
>    * Switch to / create fix branch:
>
>      * If `codex/fix-cfa1-regressions` exists ‚Üí `git checkout codex/fix-cfa1-regressions`.
>      * Else: `git checkout infra.defis.deploy && git checkout -b codex/fix-cfa1-nx05-08-final`.
>    * `git log -5 --oneline`
> 2. **Read task & DoD docs**
>
>    * `tasks/NX-05-issuer-dashboard-and-reports.md`
>    * `tasks/NX-06-issuer-payout-schedule-spec-and-ui.md`
>    * `tasks/NX-07-backoffice-kyc-and-user-registry.md`
>    * `tasks/NX-08-backoffice-audit-log-ui.md`
>    * `memory-bank/Scrum/20251121/20251121-1610-nx05-08-cfa1-dod-kickoff.md`
>    * Build a small internal checklist with:
>
>      * what must be green on CFA1 UI;
>      * which URLs / endpoints & test names must be referenced in DoD.
> 3. **Check CFA1 baseline**
>
>    * `ssh cfa1 'cd /srv/cfa/ois-cfa && git status -sb && git rev-parse HEAD'`
>    * Ensure commit ~matches your local `infra.defis.deploy` (or intentionally differs after your deploy).
>    * `ssh cfa1 'PM2_HOME=/home/user/.pm2 pm2 list --no-color'` and show `portal-issuer`, `portal-investor`, `backoffice` status.
>    * `ssh cfa1 'curl -sk -I https://api.cfa1.llmneighbors.com/health'`
>
> ---
>
> ## Phase 1 ‚Äì NX‚Äë05: Issuer dashboard & reports (API + UI + e2e)
>
> **Goal:**
> On CFA1, issuer can log in, open `/dashboard` and `/reports`, and see either real aggregated data or a proper ‚Äúno data yet‚Äù state. NX‚Äë05 DoD and CFA1 DoD explicitly state what was checked.
>
> 1. **Backend / gateway verification**
>
>    * Confirm in code:
>
>      * `services/issuance` implements `GET /v1/reports/issuances` (it does, but re‚Äëopen to ensure DTO matches OpenAPI).
>      * `services/settlement` exposes `GET /reports/payouts`.
>      * `apps/api-gateway/appsettings.json` has `reports-issuances` route ‚Üí `issuance` and generic `reports` ‚Üí `settlement`.
>    * On CFA1:
>
>      * `ssh cfa1 'curl -sk -o /tmp/res.json -w "HTTP:%{http_code}\n" https://api.cfa1.llmneighbors.com/v1/reports/issuances && head -c 200 /tmp/res.json'`
>      * Same for `/v1/reports/payouts`.
>      * Record the **HTTP codes and any JSON** in NX‚Äë05 DoD:
>
>        * Gateway route alive: checkbox OK if returns 401/403/200 but **not 404/5xx**.
>        * Business ‚Äúreports return data‚Äù: only OK if you actually see a non‚Äëempty items array for some issuer.
> 2. **Issuer UI**
>
>    * Check `apps/portal-issuer/src/app/dashboard/page.tsx` and `/reports` page for usage of `getIssuerReports` and `/v1/reports/issuances`.
>    * Ensure:
>
>      * no mocks for issuances report on CFA1;
>      * clear empty/error states instead of explosions.
>    * Deploy updated frontends on CFA1 following `07-frontends.md` + `10-eywa1-control-plane-runbook.md`.
>
>      * Rebuild containers or restart PM2 processes as per docs.
> 3. **Playwright for NX‚Äë05**
>
>    * Reuse existing e2e infra in `tests/e2e-playwright` (there‚Äôs already `public-auth.spec.ts`, `issuer` flows and screenshot utils).
>    * Add or adjust a spec (e.g. `issuer-dashboard-reports.spec.ts`) that:
>
>      * logs in issuer on CFA1 (reuse existing auth helper/credentials env);
>      * visits `/dashboard`, asserts that main KPIs area renders;
>      * visits `/reports`, asserts either a non‚Äëempty table or an explicit ‚Äúno reports yet‚Äù placeholder;
>      * saves screenshots `...-issuer-dashboard-success.e2e.png`, `...-issuer-reports-success.e2e.png` via existing helper.
>    * Run:
>
>      ```bash
>      cd tests/e2e-playwright
>      npx playwright test tests/issuer-*.spec.ts
>      ```
>    * If something is flaky, capture output and **don‚Äôt** mark DoD as done blindly.
> 4. **Update docs**
>
>    * In `tasks/NX-05-issuer-dashboard-and-reports.md`:
>
>      * Mark gateway route checkbox as `[x]` with `Verified: YYYY-MM-DD-HHMM @ cfa1 ‚Üí OK (HTTP:...)`.
>      * For API data and tests: either mark `[x]` with the Playwright spec name + screenshot filenames, or leave `[ ]` with ‚ÄúBlocked by ...‚Äù / ‚ÄúNo demo data‚Äù.
>    * In `memory-bank/...20251121-1610-nx05-08-cfa1-dod-kickoff.md`: add a short NX‚Äë05 section: endpoints, HTTP codes, spec name.
>
> ---
>
> ## Phase 2 ‚Äì NX‚Äë06: Payout Schedule (read‚Äëonly) + ‚Äúrealistic‚Äù data
>
> **Goal:**
> Issuer on CFA1 –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å issuance detail, —É–≤–∏–¥–µ—Ç—å **—Ç–∞–± ‚ÄúPayout Schedule‚Äù —Å –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏** (–ø—É—Å—Ç—å –¥–∞–∂–µ –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–º–∏ –Ω–∞ demo data), –∏ NX‚Äë06 DoD –æ—Ç—Ä–∞–∂–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö.
>
> 1. **API / data**
>
>    * Confirm `GET /v1/issuances/{id}` returns `scheduleJson` field (check DTO and mapping in `services/issuance`).
>    * On CFA1:
>
>      * –ù–∞–π—Ç–∏ **—Ä–µ–∞–ª—å–Ω—ã–π issuance id**:
>
>        * –ß–µ—Ä–µ–∑ API (`/v1/issuances?limit=10` –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–∞–∫–æ–π —ç–Ω–¥–ø–æ–π–Ω—Ç), –ª–∏–±–æ
>        * –ß–µ—Ä–µ–∑ –±–∞–∑—É (–∞–∫–∫—É—Ä–∞—Ç–Ω–æ: read‚Äëonly select –≤ Postgres –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ).
>      * `ssh cfa1 'curl -sk -o /tmp/res.json -w "HTTP:%{http_code}\n" "https://api.cfa1.llmneighbors.com/v1/issuances/<real-id>" && head -c 200 /tmp/res.json'`
>      * –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ issuance —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º `scheduleJson`:
>
>        * –î–æ–±–∞–≤—å **–Ω–µ—Ä–∞–∑—Ä—É—à–∞—é—â–∏–π seed-—Å–∫—Ä–∏–ø—Ç** (CLI –∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—é), –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞—ë—Ç demo issuance + schedule, **–∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ API/EF**, –±–µ–∑ –ª–æ–º–∞ —Å—Ö–µ–º.
>        * –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π –∫–æ–º–∞–Ω–¥—É seed –≤ DoD NX‚Äë06 –∏ –≤ runbook CFA1.
> 2. **UI**
>
>    * –£–±–µ–¥–∏—Å—å, —á—Ç–æ payout‚Äë—Å–µ–∫—Ü–∏—è –≤ `apps/portal-issuer/src/app/issuances/[id]/page.tsx` –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —á–∏—Ç–∞–µ—Ç `scheduleJson` –∏ –∫—Ä–∞—Å–∏–≤–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞—Ç—ã/amount/status.
>    * –ö–Ω–æ–ø–∫–∏ CRUD –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —è–≤–Ω–æ `disabled/coming soon`, –±–µ–∑ –ø–æ–ø—ã—Ç–æ–∫ —Å—Ç—É—á–∞—Ç—å—Å—è –≤ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–Ω–¥–ø–æ–π–Ω—Ç—ã.
> 3. **Playwright**
>
>    * –î–æ–±–∞–≤—å e2e, –Ω–∞–ø—Ä–∏–º–µ—Ä `issuer-payout-schedule.spec.ts`:
>
>      * –ª–æ–≥–∏–Ω;
>      * –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ –∏–∑–≤–µ—Å—Ç–Ω–æ–º—É issuance;
>      * –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω–∞ (–∏–ª–∏, –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, —ç—Ç–æ —á–µ—Å—Ç–Ω—ã–π ‚Äúno schedule yet‚Äù).
>    * –ó–∞–ø—É—Å—Ç–∏ —ç—Ç–æ—Ç spec –Ω–∞ CFA1 –∏ –ø—Ä–∏–ª–æ–∂–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã.
> 4. **Docs**
>
>    * –í `tasks/NX-06-issuer-payout-schedule-spec-and-ui.md` –∏ `c2p_tasks` –æ–±–Ω–æ–≤–∏:
>
>      * —á–µ–∫–±–æ–∫—Å API `GET /v1/issuances/{id}` + `scheduleJson` ‚Üí —Å —Ä–µ–∞–ª—å–Ω—ã–º —Å—Ç–∞—Ç—É—Å–æ–º –∏ HTTP –∫–æ–¥–æ–º;
>      * —á–µ–∫–±–æ–∫—Å ‚ÄúSDK/–∫–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç scheduleJson, –Ω–µ —à–ª—ë—Ç CRUD‚Äù ‚Üí `[x]` –∫–∞–∫ —Ç–æ–ª—å–∫–æ —É–±–µ–¥–∏—à—å—Å—è, —á—Ç–æ —Ñ—Ä–æ–Ω—Ç –Ω–∏–∫—É–¥–∞ –ª–∏—à–Ω–µ–≥–æ –Ω–µ —Ö–æ–¥–∏—Ç;
>      * —Å—Ç—Ä–æ–∫—É –ø—Ä–æ Playwright —Ç–µ—Å—Ç—ã: spec name + screenshots.
>
> ---
>
> ## Phase 3 ‚Äì NX‚Äë07/NX‚Äë08 backend alignment (compliance, identity, audit) + backoffice auth
>
> **Goal:**
> Backoffice –Ω–∞ CFA1:
>
> * –ª–æ–≥–∏–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ Keycloak,
>
> * `/kyc`, `/users`, `/audit`, `/audit/[id]`, `/payouts` –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –±–µ–∑ 500,
>
> * –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö API –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–∏ 401/404 ‚Äî –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –Ω–µ –ø–∞–¥–µ–Ω–∏–µ.
>
> 1. **Backoffice Auth**
>
>    * –õ–æ–∫–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—å `apps/backoffice/src/lib/auth.ts` –∏ `/app/api/auth/[...nextauth]/route.ts`:
>
>      * `secret` –Ω–∞—Å—Ç—Ä–æ–µ–Ω;
>      * –ø—Ä–æ–≤–∞–π–¥–µ—Ä `keycloak` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ CFA1 realm/clients;
>      * `trustHost: true` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥ (–¥–ª—è NextAuth 4/5) –Ω–∞ –ø—Ä–æ–¥–µ.
>    * –ù–∞ CFA1:
>
>      * –£–±–µ–¥–∏—Å—å, —á—Ç–æ —É PM2 –ø—Ä–æ—Ü–µ—Å—Å–∞ `backoffice` –µ—Å—Ç—å `NEXTAUTH_SECRET`/`AUTH_SECRET` (agent —É–∂–µ –¥–µ–ª–∞–ª `pm2 restart backoffice --update-env` —Å dev-secret, –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—å).
>      * –ü—Ä–æ–≤–µ—Ä—å `NEXTAUTH_URL`/`BACKOFFICE_PUBLIC_URL` –≤ `.env` –∏ PM2 env, —á—Ç–æ–±—ã –æ–Ω–∏ —Å–æ–≤–ø–∞–¥–∞–ª–∏ —Å `https://backoffice.cfa1.llmneighbors.com`.
>    * –ü–æ—á–∏–Ω–∏ 500 –Ω–∞ `/auth/signin`, –ø—Ä–æ–≤–µ—Ä—è—è:
>
>      * `ssh cfa1 'PM2_HOME=/home/user/.pm2 pm2 logs backoffice --lines 50'` ‚Äî —Å–º–æ—Ç—Ä–∏ stack trace.
> 2. **KYC & Users API**
>
>    * –ö–æ–¥: `apps/backoffice/src/lib/api/compliance.ts`:
>
>      * `listKycRequests`, `submitKycDecision`, `listUsers` –∏—Å–ø–æ–ª—å–∑—É—é—Ç `call<T>` —Å `/v1/compliance/kyc` –∏ `/v1/identity/users`.
>      * –°–µ–π—á–∞—Å —Ç–∞–º fallback‚Äë–º–æ–∫–∏ ‚Äî –∏—Ö **–æ—Å—Ç–∞–≤—å**, –Ω–æ:
>
>        * –ª–æ–≥–∏—Ä—É–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fallback (–Ω–∞–ø—Ä–∏–º–µ—Ä, console.warn –≤ dev);
>        * –≤ DoD —è–≤–Ω–æ –æ–ø–∏—à–∏, —á—Ç–æ –Ω–∞ CFA1 –ø–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è mock layer –∏–∑-–∑–∞ 401/404.
>    * –ù–∞ CFA1 ‚Äî curl:
>
>      ```bash
>      ssh cfa1 'for u in "/v1/compliance/kyc" "/v1/identity/users"; do echo "--- $u"; curl -sk -o /tmp/res.json -w "HTTP:%{http_code}\n" https://api.cfa1.llmneighbors.com${u}; head -c 120 /tmp/res.json; echo; done'
>      ```
>    * –û–±–Ω–æ–≤–∏ NX‚Äë07 DoD:
>
>      * —Ä–∞–∑–¥–µ–ª—å–Ω–æ: ‚ÄúGateway route alive (401)‚Äù –∏ ‚ÄúReal data (200 with items)‚Äù.
> 3. **Audit API & UI**
>
>    * Backend: `services/compliance` –∏–º–µ–µ—Ç `/v1/audit`, `/v1/audit/{id}`, `/v1/audit/export.csv` –ø–æ outbox `ois.audit.logged`.
>    * Gateway: –ø—Ä–æ–≤–µ—Ä—å –≤ `apps/api-gateway/appsettings.json`, —á—Ç–æ `/v1/audit` –ø—Ä–æ–±—Ä–æ—à–µ–Ω –≤ compliance.
>    * –ù–∞ CFA1:
>
>      * curl `/v1/audit` –∏ `/v1/audit/111` (–∏–ª–∏ GUID –∏–∑ –ë–î) –∏ —Ñ–∏–∫—Å–∏—Ä—É–π –∫–æ–¥—ã: 401/404/200.
>    * Backoffice `/audit` –∏ `/audit/[id]`:
>
>      * –£–±–µ–¥–∏—Å—å, —á—Ç–æ UI –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—É—Å—Ç—ã–º–∏/–æ—à–∏–±–æ—á–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏ (–Ω–µ—Ç 500).
>    * –û–±–Ω–æ–≤–∏ NX‚Äë08 DoD –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ: –º–∞—Ä—à—Ä—É—Ç—ã vs —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
>
> ---
>
> ## Phase 4 ‚Äì Playwright e2e for NX‚Äë07 & NX‚Äë08
>
> **Goal:**
> –ò–º–µ—Ç—å e2e —Å–ø–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ:
>
> * –ª–æ–≥–∏–Ω—è—Ç backoffice‚Äë–∞–¥–º–∏–Ω–∞,
>
> * –ø—Ä–æ–≤–µ—Ä—è—é—Ç `/kyc`, `/users`, `/audit`, `/audit/[id]`, `/payouts`,
>
> * –æ—Å—Ç–∞–≤–ª—è—é—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã, –∏ –≤—Å—ë —ç—Ç–æ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ DoD.
>
> 1. **–ü–æ—Å–º–æ—Ç—Ä–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–ø–µ–∫–∏**
>
>    * `tests/e2e-playwright/tests/public-auth.spec.ts`
>    * `tests/e2e-playwright/tests/backoffice-auth.spec.ts`
>    * `tests/e2e-playwright/tests/backoffice-kyc.spec.ts`
>    * `tests/e2e-playwright/tests/backoffice-audit.spec.ts`
>    * `tests/e2e-playwright/tests/utils/flow-screenshot.ts` (—Ñ–æ—Ä–º–∞—Ç –∏–º—ë–Ω –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤).
> 2. **–ü—Ä–∏–≤–µ–¥–∏ —Å–ø–µ–∫–∏ –≤ –ø–æ—Ä—è–¥–æ–∫ –ø–æ–¥ CFA1**
>
>    * –£–±–µ–¥–∏—Å—å, —á—Ç–æ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–∞–∑–æ–≤—ã–µ URL –¥–ª—è CFA1 (—á–µ—Ä–µ–∑ env / config).
>    * –õ–æ–≥–∏–Ω –≤ Keycloak –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —É–∂–µ –æ–ø–∏—Å–∞–Ω–Ω—ã–º–∏ –≤ e2e env (–Ω–µ —Ö–∞—Ä–¥–∫–æ–¥—å –≤ –∫–æ–¥ –Ω–æ–≤—ã–µ –∫—Ä–µ–¥—ã).
>    * **backoffice-kyc.spec.ts**:
>
>      * –ª–æ–≥–∏–Ω;
>      * –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `/kyc`;
>      * –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø–∏—Å–∫–∞ (–¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ mock‚Äë–¥–∞–Ω–Ω—ã–µ –∏–∑ `compliance.ts`) –∏ —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ click ‚ÄúApprove/Reject‚Äù (–µ—Å–ª–∏ 401/404, UI –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É/—Ç–æ—Å—Ç, –Ω–æ –Ω–µ —É–ø–∞—Å—Ç—å).
>    * **backoffice-audit.spec.ts**:
>
>      * –ª–æ–≥–∏–Ω;
>      * –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `/audit`;
>      * –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞/empty state –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω–∞ –∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å `Details` –Ω–µ –ª–æ–º–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É.
> 3. **–ó–∞–ø—É—Å–∫ e2e –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã**
>
>    * `cd tests/e2e-playwright`
>    * `npx playwright test tests/backoffice-*.spec.ts`
>    * –°–æ–±—Ä–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –≤ `artifacts/tests/e2e/playwright/*.e2e.png` –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç—É.
> 4. **Docs**
>
>    * –í NX‚Äë07 –∏ NX‚Äë08 DoD –¥–æ–±–∞–≤—å —Å—Ç—Ä–æ–∫–∏:
>
>      * ‚ÄúPlaywright: backoffice-kyc.spec.ts, backoffice-audit.spec.ts, run @ cfa1 YYYY‚ÄëMM‚ÄëDD‚ÄëHHMM, screenshots: ...‚Äù
>    * –í CFA1 DoD —Ñ–∞–π–ª ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫ ‚Äúe2e (Playwright)‚Äù —Å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ–º –ø—Ä–æ–≥–æ–Ω–æ–≤.
>
> ---
>
> ## Phase 5 ‚Äì Final DoD pass & summary
>
> 1. **–ü—Ä–æ–π–¥–∏ –ø–æ –≤—Å–µ–º —á–µ–∫–ª–∏—Å—Ç–∞–º NX‚Äë05‚Äì08**
>
>    * –ü—Ä–æ—Å—Ç–∞–≤—å `[x]` —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ:
>
>      * –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π HTTP –∫–æ–¥/–æ—Ç–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –ø—Ä–æ–≤–µ—Ä–∏–ª (curl / UI / Playwright);
>      * –∏–ª–∏ –µ—Å—Ç—å –æ—Å–æ–∑–Ω–∞–Ω–Ω–∞—è –ø–æ–º–µ—Ç–∫–∞ ‚ÄúBlocked by X‚Äù –≤–Ω–∏–∑—É –ø—É–Ω–∫—Ç–∞.
>    * –Ø–≤–Ω–æ –ø–æ–¥–ø–∏—à–∏:
>
>      * –æ–∫—Ä—É–∂–µ–Ω–∏–µ: `cfa1.llmneighbors.com`;
>      * –¥–∞—Ç–∞/–≤—Ä–µ–º—è: `YYYY-MM-DD-HHMM`;
>      * –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏: `curl`, `Playwright <spec name>`, `manual UI`.
> 2. **–ö–æ–º–º–∏—Ç –∏ –ø—É—à**
>
>    * –û–¥–∏–Ω —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–º–∏—Ç —Å —Å—É–º–º–∞—Ä–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º:
>
>      * —á—Ç–æ –ø–æ—á–∏–Ω–∏–ª –Ω–∞ CFA1 (auth, routes, UI states);
>      * –∫–∞–∫–∏–µ e2e –¥–æ–±–∞–≤–ª–µ–Ω—ã/–ø–æ—á–∏–Ω–µ–Ω—ã;
>      * –∫–∞–∫–∏–µ DoD –æ–±–Ω–æ–≤–ª–µ–Ω—ã.
>    * `git push origin <your-fix-branch>`
> 3. **–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –≤ –∫–æ–Ω—Å–æ–ª—å**
>
>    * –í –∫–æ–Ω—Ü–µ —Å–µ—Å—Å–∏–∏ –≤—ã–≤–µ–¥–∏ —á—ë—Ç–∫–∏–π TL;DR:
>
>      * –¥–ª—è –∫–∞–∂–¥–æ–≥–æ NX (05/06/07/08):
>
>        * ‚úÖ / ‚ö†Ô∏è / ‚ùå
>        * –∫–ª—é—á–µ–≤—ã–µ URL (API+UI)
>        * –Ω–∞–∑–≤–∞–Ω–∏—è e2e spec‚Äô–æ–≤
>        * —Å—Å—ã–ª–∫–∏ –Ω–∞ DoD‚Äë—Ñ–∞–π–ª—ã (—Å—Ç—Ä–æ–∫–∏/—Ä–∞–∑–¥–µ–ª—ã).
>
> ---

### –ö–æ–Ω–µ—Ü –ø—Ä–æ–º–ø—Ç–∞

---

## 4. –ü—Ä–æ NX‚Äë06: ¬´—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ¬ª –∏ –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞—Ç—å –ø–æ‚Äë–≤–∑—Ä–æ—Å–ª–æ–º—É

–¢–æ, —á—Ç–æ —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å: ¬´–¥–∞—à–±–æ—Ä–¥, –æ—Ç—á—ë—Ç—ã –∏ payout schedule –±–µ–∑ –∫–∞–∫–∏—Ö‚Äë—Ç–æ —Ü–∏—Ñ—Ä ‚Äî —ç—Ç–æ —Å—Ç—Ä–∞–Ω–Ω–æ¬ª, ‚Äî –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–µ—Ñ–ª–µ–∫—Å.

–Ø –±—ã –∑–∞–¥–∞–ª –∞–≥–µ–Ω—Ç—É (–∏ —Å–µ–±–µ) —Ç–∞–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞:

1. **–ü—Ä–æ–¥‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ —Ç—Ä–æ–≥–∞–µ–º**:

   * Issuance —Ö—Ä–∞–Ω–∏—Ç `scheduleJson` (JSONB) ‚Äî —ç—Ç–æ *–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫* –¥–ª—è MVP.
   * SPEC‚ÄëDIFF (NX‚Äë06) –æ–ø–∏—Å—ã–≤–∞–µ—Ç –±—É–¥—É—â–∏–µ CRUD —ç–Ω–¥–ø–æ–π–Ω—Ç—ã `/v1/issuances/{id}/payouts/schedule`, –Ω–æ —Å–µ–π—á–∞—Å UI —á–∏—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é `scheduleJson`.
2. **Demo‚Äë–¥–∞–Ω–Ω—ã–µ = –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π**:

   * –ª–∏–±–æ **seed‚Äë—Å–∫—Ä–∏–ø—Ç** –Ω–∞ backend, –∫–æ—Ç–æ—Ä—ã–π:

     * —Å–æ–∑–¥–∞—ë—Ç 1‚Äì2 demo‚Äëissuance —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º `scheduleJson` (–Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∞—Ç/—Å—É–º–º/—Å—Ç–∞—Ç—É—Å–æ–≤);
     * –ø–æ–º–µ—á–∞–µ—Ç –∏—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º –ø—Ä–∏–∑–Ω–∞–∫–æ–º (—á—Ç–æ–±—ã –∏—Ö –º–æ–∂–Ω–æ –±—ã–ª–æ —á–∏—Å—Ç–∏—Ç—å);
   * –ª–∏–±–æ **CLI‚Äë—É—Ç–∏–ª–∏—Ç–∞** (`dotnet run -- seed-demo`), –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è –ø—É–±–ª–∏—á–Ω—ã–µ API, –Ω–æ –Ω–µ –ª–æ–º–∞—é—â–∞—è —Å—Ö–µ–º—É.
3. **DoD —á–µ—Å—Ç–Ω–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫**:

   * ‚ÄúPayout Schedule –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ demo‚Äë–¥–∞–Ω–Ω—ã–µ, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥–æ–π `dotnet run -- seed-demo`‚Äù;
   * ‚Äú–ù–∞ prod/UK1 seed –Ω–µ –≤–∫–ª—é—á–∞—Ç—å, —Ç–æ–ª—å–∫–æ –Ω–∞ dev/stage‚Äù.

–¢–æ –µ—Å—Ç—å, –∞–≥–µ–Ω—Ç—É –Ω—É–∂–Ω–æ –Ω–µ ¬´–∑–∞–º–æ–∫–∞—Ç—å –≤—Å—ë –≤ UI¬ª, –∞ **—Å–æ–∑–¥–∞—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–π —Å–ø–æ—Å–æ–± –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –ë–î –¥–µ–º–æ‚Äë–¥–∞–Ω–Ω—ã–º–∏**, –∏ –æ–ø–∏—Å–∞—Ç—å –µ–≥–æ –≤ —Ç–∞—Å–∫–µ.

---

## 5. –ü—Ä–æ NX‚Äë07: KYC Flow & User Registry (Keycloak vs Postgres)

–¢–≤–æ–π –≤–æ–ø—Ä–æ—Å: *¬´–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ Postgres –ª–µ–∂–∞—Ç –∏–ª–∏ –≤ Keycloak, –∏–ª–∏ –æ–Ω–∏ –≤–æ–æ–±—â–µ –Ω—É–∂–Ω—ã –≤ Postgres?¬ª* ‚Äî –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —è –±—ã –¥–µ—Ä–∂–∞–ª—Å—è —Ç–∞–∫–æ–π —Å—Ö–µ–º—ã (–∏ —Ç–æ, —á—Ç–æ —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–¥–µ, —Å –Ω–µ–π —Ö–æ—Ä–æ—à–æ —Å—Ç—ã–∫—É–µ—Ç—Å—è):

1. **Keycloak = –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –ø–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**

   * username, –ø–∞—Ä–æ–ª—å, —Ä–æ–ª–∏ realm/client ‚Äî —Ç–∞–º.
   * backoffice/issuer/investor –ø–æ—Ä—Ç–∞–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç Keycloak –∫–∞–∫ OpenID Connect / OAuth2.
2. **User Registry / Identity service = –±–∏–∑–Ω–µ—Å‚Äë—Å–ª–æ–π**

   * `GET /v1/identity/users` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `UserRecord` (id, email, roles, status, createdAt, ‚Ä¶).
   * `id` –∑–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–∏–±–æ:

     * –ø—Ä—è–º–æ–π Keycloak userId (UUID –∏–∑ realm), –ª–∏–±–æ
     * –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π guid, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç —Å—Å—ã–ª–∫—É –Ω–∞ Keycloak userId.
   * –í Postgres —Ç—ã –∫–∞–∫ —Ä–∞–∑ —Ö—Ä–∞–Ω–∏—à—å:

     * —Å–≤—è–∑–∏ —Å KYC/AML,
     * —Å—Ç–∞—Ç—É—Å—ã ‚Äúapproved investor‚Äù, ‚Äúissuer‚Äù, ‚Äúblocked‚Äù,
     * –ª—é–±—ã–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –Ω—É–∂–Ω–æ —Ç–∞—â–∏—Ç—å –≤ IdP.
3. **Backoffice Users page = —Ñ–∞—Å–∞–¥ –Ω–∞–¥ Identity**

   * `/users` –≤ backoffice —Ö–æ–¥–∏—Ç –≤ `/v1/identity/users`;
   * Keycloak –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–≥–∏–Ω–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤, –Ω–æ –Ω–µ –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –±–∏–∑–Ω–µ—Å‚Äë–∞—Ç—Ä–∏–±—É—Ç–æ–≤.

–ê–≥–µ–Ω—Ç—É —Å—Ç–æ–∏—Ç –ø—Ä—è–º–æ –≤ NX‚Äë07 DoD –∑–∞–ø–∏—Å–∞—Ç—å:

> **Design note:** Keycloak is used only as IdP (authn/roles). User Registry (identity service + Postgres) stores business‚Äëlevel user records exposed via `/v1/identity/users`. Backoffice never queries Keycloak directly for listing users.

–ò —Ç–æ–≥–¥–∞ –≤ –±—É–¥—É—â–µ–º –ê–ª–µ–∫—Å–∞–Ω–¥—Ä—É –±—É–¥–µ—Ç –ø—Ä–æ—â–µ —Å–ø–æ–∫–æ–π–Ω–æ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å identity‚Äë—Å–ª–æ–π –±–µ–∑ —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã—Ö –≤–æ–π–Ω.

---

## 6. –ß—Ç–æ —Ç–µ–±–µ –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫—É —Å—Ç–æ–∏—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å

* **–¢—Ä–µ–±–æ–≤–∞—Ç—å e2e –∫–∞–∫ —á–∞—Å—Ç—å DoD**:
  –ï—Å–ª–∏ –Ω–µ—Ç Playwright‚Äë—Å–ø–µ–∫–∞ ‚Äî –ø—É–Ω–∫—Ç DoD –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é ‚Äú–∑–µ–ª—ë–Ω—ã–º‚Äù. –î–∞–∂–µ –µ—Å–ª–∏ –∞–≥–µ–Ω—Ç —Ä—É–∫–∞–º–∏ –ø–æ—Å–º–æ—Ç—Ä–µ–ª UI.
* **–¢—Ä–µ–±–æ–≤–∞—Ç—å —è–≤–Ω—ã—Ö —Å—Å—ã–ª–æ–∫**:

  * –î–ª—è –∫–∞–∂–¥–æ–≥–æ `[x]` –≤ DoD ‚Äî –∫–∞–∫–∞—è –∫–æ–º–∞–Ω–¥–∞ / –∫–∞–∫–æ–π spec / –∫–∞–∫–æ–π URL.
* **–°–ª–µ–¥–∏—Ç—å –∑–∞ –≤–µ—Ç–∫–∞–º–∏**:

  * –í—Å—ë, —á—Ç–æ –∞–≥–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç (–æ—Å–æ–±–µ–Ω–Ω–æ `auth.ts` backoffice) ‚Äî —Ç–æ–ª—å–∫–æ –≤ fix‚Äë–≤–µ—Ç–∫–µ, –ø–æ—Ç–æ–º –≤ MR. –¢–∞–∫–æ–π –≤–µ—Ç–∫–æ–π —É–∂–µ –±—ã–ª `codex/fix-cfa1-regressions` ‚Äî –ª–æ–≥–∏—á–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –Ω–∞ –Ω–µ–π.
* **–í–æ–ø—Ä–æ—Å ‚ÄúError backoffice...‚Äù**:

  * –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø—Ä–æ–≥–æ–Ω–∞ —Å —ç—Ç–∏–º –ø—Ä–æ–º–ø—Ç–æ–º —É —Ç–µ–±—è –≤—Å—ë –µ—â—ë 500 –Ω–∞ `/auth/signin`, —ç—Ç–æ –∫—Ä–∞—Å–Ω—ã–π —Ñ–ª–∞–≥ ‚Äî –º–æ–∂–Ω–æ –∂—ë—Å—Ç–∫–æ –ø–æ–ø—Ä–æ—Å–∏—Ç—å –∞–≥–µ–Ω—Ç–∞:

    * –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å stack trace –∏–∑ PM2 –ª–æ–≥–æ–≤,
    * —Å—Å—ã–ª–∫—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä–æ–∫—É –≤ `auth.ts`,
    * –∏ Playwright‚Äë—Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –æ—à–∏–±–∫—É –ª–æ–∫–∞–ª—å–Ω–æ, –ø—Ä–µ–∂–¥–µ —á–µ–º –ª–µ–∑—Ç—å –Ω–∞ CFA1.

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –º–æ–∂–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ —Ä–∞–∑–ª–æ–∂–∏—Ç—å –∏–º–µ–Ω–Ω–æ **KYC UI/flow –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º** (–∫–∞–∫–∏–µ –ø–æ–ª—è, –∫–∞–∫–∏–µ stat—É—Å—ã, –∫–∞–∫ –ª—É—á—à–µ –≤—ã–≤–µ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ decision timeline), —á—Ç–æ–±—ã —Ç—ã –º–æ–≥ —ç—Ç–æ —É–∂–µ –∫–∞–∫ product/UX —Å–ø–æ–∫–æ–π–Ω–æ –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ—Ç –∞–≥–µ–Ω—Ç–∞.
