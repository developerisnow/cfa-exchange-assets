---
created: 2025-11-11 14:13
updated: 2025-11-11 14:13
type: planning
sphere: [finance, blockchain]
topic: [dod-mvp, ois-cfa]
author: alex-a
agentID: co-3a68
partAgentID: [co-3a68]
version: 1.0.0
tags: [acceptance, checklist, mvp]
---

# DoD — MVP (Primary Issuance Flow)

## Scope (frozen)
- Primary issuance only: issuance → order → wallet update → redeem → payouts.
- AuthN/AuthZ via Keycloak (OIDC), ESIA mocked.
- Bank nominal: sandbox or stub.
- Minimal NFR: logs, metrics, basic alerts.

## Acceptance Checklist
- [ ] API specs up-to-date (OpenAPI)
  - [ ] packages/contracts/openapi-gateway.yaml покрывает все публичные пути
  - [ ] openapi-issuance/registry/settlement/identity/compliance синхронизированы с кодом
  - [ ] SDK TS сгенерирован (packages/sdks/ts)
- [ ] Identity/OIDC
  - [ ] Keycloak realm экспортирован (clients/roles)
  - [ ] ESIA mock-флоу работает (/.well-known, /authorize, /token, /userinfo)
- [ ] Issuance
  - [ ] Создание/публикация/закрытие выпуска (200/201, ошибки по spec)
  - [ ] События пишутся в Outbox
- [ ] Registry (orders/wallets)
  - [ ] Idempotency-Key предотвращает дубликаты
  - [ ] Заказ создаёт событие и обновляет кошелёк
  - [ ] Получение портфеля по investorId
- [ ] Settlement
  - [ ] /v1/settlement/run запускает батч (accepted 202)
  - [ ] /v1/reports/payouts отдаёт сводный отчёт
  - [ ] Интеграция с bank-nominal через стаб/песочницу
- [ ] Compliance
  - [ ] /v1/compliance/kyc/check → KYC_RESULT сохраняется
  - [ ] /v1/compliance/qualification/evaluate возвращает уровень
  - [ ] /v1/complaints и /v1/complaints/{id} работают
- [ ] Frontends (Next.js)
  - [ ] Логин через OIDC, роуты защищены
  - [ ] Основные сценарии UI: создать выпуск (issuer), купить (investor), отчёт (backoffice)
- [ ] Deployment
  - [ ] docker-compose локально: Postgres/Kafka/Keycloak/Minio здоровы
  - [ ] Helm чарты для Fabric собираются (минимальная сеть), деплой chaincode
- [ ] Observability/NFR
  - [ ] Структурные логи (корреляция по request-id)
  - [ ] Метрики (req/sec, p95 latency, error rate) поднимаются
  - [ ] Базовые алерты (5xx, деградация БД)

## Smoke tests (пример)
```bash
# Gateway
curl -s localhost:5000/health

# Issuance
curl -s -X POST localhost:5000/issuances -H 'Authorization: Bearer ...' -d '{"assetId":"...","issuerId":"...","totalAmount":1000,"nominal":100,"issueDate":"2025-01-01","maturityDate":"2025-12-31"}'

# Order (idempotent)
curl -s -X POST localhost:5000/v1/orders -H 'Authorization: Bearer ...' -H 'Idempotency-Key: 11111111-1111-1111-1111-111111111111' -d '{"investorId":"...","issuanceId":"...","amount":100}'

# Wallet
curl -s localhost:5000/v1/wallets/<investorId> -H 'Authorization: Bearer ...'

# Settlement
curl -s -X POST localhost:5000/v1/settlement/run -H 'Authorization: Bearer ...'
```

## Key docs to maintain (min)
- docs/README-ARCH.md — оглавление архитектуры
- docs/architecture/10-HighLevel-Architecture.md — C1–C4 ландшафт
- docs/architecture/11-Sequence-ESIA-OIDC.md — аутентификация
- docs/architecture/12-DataModel.md — сущности/ERD
- docs/security/20-ГОСТ57580-Чеклист.md — NFR/Sec
- packages/contracts/openapi-*.yaml — спецификации
- ops/helm/*, docker-compose.yml — деплой
