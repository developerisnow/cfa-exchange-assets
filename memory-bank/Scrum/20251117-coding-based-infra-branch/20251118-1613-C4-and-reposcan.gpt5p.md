# Prompt
````markdown
You are Oracle, a focused one-shot problem solver. Emphasize direct answers, cite any files referenced, and clearly note when the search tool was used.  You are GPT‑5 Pro acting as a senior system/solution architect and C4 modeller for the `ois-cfa` codebase.  **Goal:** Produce **up‑to‑date, industry‑style C4 diagrams (C1–C4) for `ois-cfa`** + one consolidated RepoScan/"map of the territory" artefact, based on the **current** state of the repo (branch `infra.defis.deploy`) and the latest audits/feedback – not the old 2025‑11‑11 snapshots.  You MUST treat `c2p_ois-cfa.txt` as the primary ground truth for the current repo state. Use older RepoScan JSON (20251111-1325-...shtgn.reposcan.json) only as inspiration for structure, not as source of facts.  I have attached: - `c2p_ois-cfa.txt`: fresh ~4MB code2prompt snapshot of `repositories/customer-gitlab/ois-cfa` on branch `infra.defis.deploy` (code, structure, docs, tasks/NX-*); - `c2p_aggregated-gpt5pro-talks.txt`: aggregated GPT‑5 Pro audits and my feedback (step3/4/5/6) about architecture, Trunk/Branches/Leaves, NX‑00..NX‑08, RepoScan, Agents, CodeMachine; - `c2p_20251118-0905-context-reposcan-agents-structure-and-codemachine.txt`: high-level context for RepoScan/Agents/CodeMachine OS; - `c2p_reposcan.txt`: previous RepoScan experiments (Shotgun-style, SDD) — use only for ideas, not as truth about current code; - `20251117-1518-conversation-AlexA-AleksandrO.md`: conversation with Aleksandr O. about NX‑tasks and his expectations for architecture/C4 clarity; - `20251111-1325-gpt5p-ois-cfa.shtgn.reposcan.json`: older RepoScan JSON for `ois-cfa` (pre‑merge, outdated but useful as a structural reference); - `project.manifest.json`: mono-repo project manifest (submodules, goals, indices); - `AGENTS.md`: mono-repo agent rules (Trunk/Branch/Leaf, manifests, workflows); - `WBS-OIS.md`: WBS for `ois-cfa` with NX‑01..NX‑08 (domain slices); - `repositories/customer-gitlab/ois-cfa/docs/context/PROJECT-CONTEXT.md`: current hand-written context for `ois-cfa`.  **What I want from you in this call:**  ### 1) C4 diagrams (C1–C4) for `ois-cfa` in Mermaid  Produce **four C4-style diagrams** in Mermaid syntax, aligned with current `c2p_ois-cfa.txt` and NX/WBS context:  1. **C1 – System Context**    - Show OIS-CFA as a system, with external actors/systems (Issuer, Investor, Backoffice admin, Bank/Nominal, ESIA, Regulator, etc.).    - Keep it compact but clear enough to paste into docs.  2. **C2 – Containers**    - Show main containers inside `ois-cfa`:      - Frontend portals (issuer/investor/backoffice), API gateway, domain services (identity/issuance/registry/settlement/compliance), supporting infra (Postgres, Kafka, Keycloak, MinIO, Fabric, etc.).    - Use names/roles consistent with `c2p_ois-cfa.txt` and PROJECT-CONTEXT.  3. **C3 – Components for 1–2 key services**    - Pick **two domain areas** most important for NX‑tasks (e.g. issuance + registry, or registry + settlement) and draw C3 for them:      - components inside the service (API, application, domain, integration, persistence);      - key interactions with other services or components.    - Use a separate Mermaid diagram for each service OR one combined C3 if it stays readable.  4. **C4 – Code/Modules (optional but desirable)**    - Provide at least one **C4‑level** view for a concrete area, e.g. `services/issuance` or `apps/api-gateway`:      - classes/modules/namespaces that matter for understanding the flow (without going into every DTO);      - how they map back to components in C3.  Constraints for Mermaid: - Use simple, standard Mermaid diagrams (flowchart or C4‑ish boxes), **no exotic features**. - Diagrams must be ready to paste into Markdown (```mermaid ... ```). - Do NOT blindly reuse old 2025‑11‑11 C4; adjust to the current `infra.defis.deploy` code snapshot.  ### 2) Consolidated RepoScan-style "map of the territory" (single artefact)  I do NOT want piecemeal RepoScan diagrams. I want **one consolidated artefact** that acts as a map for `ois-cfa` as of `infra.defis.deploy`.  Please: - Design and output a **single JSON object** (or JSON-like structure) that you would save as `snapshots/reposcan/ois-cfa/infra.defis.deploy.reposcan.json`, with:   - top-level `meta` (repo id, branch, generated_at, trunk/branch/leaf summary);   - `tree` section (directories/files with minimal attributes: type, tags, level, maybe LOC bucket);   - `logical` section (grouping by domains/services/frontends/ops/tests);   - `anchors` section (paths to key docs: PROJECT-CONTEXT, WBS-OIS, NX tasks, critical docs under `docs/` and `tasks/`). - You can base the structure on your previous RepoScan v1 design, but here I want a **concrete, filled-in example for `ois-cfa`** (not just schema). - It does not need to list every file; you can:   - aggregate at directory level where there are many similar files;   - sample representative files/modules per area. - The goal is: one JSON artefact that Alex & Aleksandr can read and say “да, это понятная карта репозитория на сегодня”, and that agents can later consume.  ### 3) Short commentary for Aleksandr O (in Russian)  At the end, add a short section in Russian (2–4 абзаца), addressed to **Александр О.**, explaining: - что именно показывают эти C4‑диаграммы и RepoScan‑JSON; - чем они лучше старого 2025‑11‑11 репоскан/диаграмм; - как их можно использовать для планирования NX‑тасков, ревью архитектуры и онбординга новых разработчиков.  Style & format: - Answer in Russian, senior‑engineer tone, B2‑English terms OK. - Structure:   - TL;DR (3–5 bullets),   - Section 1: C1–C4 diagrams (each with its own ```mermaid``` block),   - Section 2: RepoScan JSON map (one JSON‑like block),   - Section 3: Commentary for Aleksandr O. - Do NOT restate the contents of attached files; focus on synthesis and final artefacts I can paste into docs.
````

# Output 

* Использовал `file_search` по `c2p_ois-cfa.txt`, PROJECT-CONTEXT, WBS-OIS, aggregated‑talks и старому reposcan.json, но **факты брал из текущего c2p‑снимка ветки `infra.defis.deploy`**.
* Дал **C1–C4 диаграммы** для OIS‑CFA: C1 контекст, C2 контейнеры, C3 по сервисам Issuance/Registry (NX‑03/NX‑04), C4 по коду `services/issuance`.
* Сформировал **единый RepoScan‑JSON** `infra.defis.deploy.reposcan.json` с `meta + tree + logical + anchors + nx_index`, совместимый с T/B/L‑моделью и NX‑тасками.
* Диаграммы и JSON отражают **актуальный UK1/infra.defis.deploy с YARP‑gateway, доменными сервисами, Kafka, Fabric, фронтами** — а не старый срез 2025‑11‑11.
* Это можно прямо вставлять в `docs/context/PROJECT-CONTEXT.md` / `docs/context/TREES-LEAVES-AGENTS-OIS.md` как канон для NX‑03/04/02.

---

# `@repositories/customer-gitlab/ois-cfa/artifacts/AlexA/project-C4.diagram.md`
---

## `@repositories/customer-gitlab/ois-cfa/artifacts/AlexA/project-reposcan.md` + `@repositories/customer-gitlab/ois-cfa/artifacts/AlexA/ois-cfa.reposcan.json`
