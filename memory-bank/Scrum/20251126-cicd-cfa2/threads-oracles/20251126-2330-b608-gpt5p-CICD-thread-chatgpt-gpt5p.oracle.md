---
title: CI/CD –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
source: https://chatgpt.com/c/6926ca94-b608-8332-b217-99ccfaef8d3b
---


# CI/CD –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### You:
<time datetime="2025-11-26T09:38:27.174Z" title="26/11/2025, 12:38:27">12:38</time>

Read all docs but main mention to you that I've had conversation where mentioned success in macos-localhost-running (session `local-p-cfa-w6.p1-20251125-1706.session.txt`) and make a task which currently WIP to run locally on ubuntu-vps-eywa1 `eywa1-p-cfa-w17.p1-20251126-1236.session.txt` and all other may be helpful context
About docs `c2p_ops.txt` it could be —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–µ –∏ overengineering llm-generated –∏ –Ω–µ –æ—Ç—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ (not verified on constraints and main picture with evaluation all nuances and details) –¥—Ä—É–≥–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–º AleksandrO –Ω–æ —Ç—ã –ø—Ä–æ–≤–µ—Ä—å –º–æ–∂–µ—Ç –∏ –æ–∫

–°–º–æ—Ç—Ä–∏, –ø–æ–∫–∞ –¥—Ä—É–≥–æ–π –∞–≥–µ–Ω—Ç –ø—ã–∂–∏—Ç—Å—è —Å —Ç–µ–º, —á—Ç–æ–±—ã –¥–æ–±–∏—Ç—å—Å—è —Ö–æ—Ä–æ—à–µ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ –ª–æ–∫–∞–ª–∫–µ Makeup Local —Å–æ –≤—Å–µ–º–∏ —Ç–∞–º e2e —Ç–µ—Å—Ç–∞–º–∏ –∏ –ø—Ä–æ—á–∏–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏, —è —Ö–æ—á—É –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É CI/CD —Ä–µ—à–µ–Ω–∏—è. –Ø —Ç–µ–±–µ –¥–∞–º —Å–≤–æ–∏ –º—ã—Å–ª–∏ –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ —Ö–æ—á—É —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞–º–æ—Ç–Ω–æ–µ CI/CD —Ä–µ—à–µ–Ω–∏–µ –Ω–∞–∏–ª—É—á—à–∏–º –æ–±—Ä–∞–∑–æ–º.

–ï—Å–ª–∏ —Ç—ã –≤–∏–¥–∏—à—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏ –∏—Ö –≤ —Ç–∞–±–ª–∏—á–Ω–æ–º –≤–∏–¥–µ. –ü–ª—é—Å output must have ‚Äî —ç—Ç–æ Mermaid JS –¥–∏–∞–≥—Ä–∞–º–º—ã. –ü—Ä–∏—á—ë–º –∫–∞–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –Ω—É –ø–æ–¥—É–º–∞–π —Å–∞–º –∫–∞–∫ –ª—É—á—à–µ: Sequence, –Ω–∞–≤–µ—Ä–Ω–æ–µ, –∏ Clone, Subgraph. –ú–æ–∂–µ—Ç –±—ã—Ç—å –µ—â—ë, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ª—É—á—à–µ –ø—Ä–µ–¥–ª–æ–∂–∏—à—å.

–î–∞–ª–µ–µ, —á—Ç–æ –Ω–∞–º –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ. –ù–∞–º –ø–æ —Ñ–∞–∫—Ç—É –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –≥–¥–µ –±—É–¥–µ—Ç –∞–≥–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –±–∏–ª–¥–∏—Ç—å. –£ –º–µ–Ω—è –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π VDS-—Å–µ—Ä–≤–∞–∫, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç, –∫–æ—Ä–æ—á–µ, –±—ã—Å—Ç—Ä–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –±–∏–ª–¥–∏—Ç—å. –ò –∫–∞–∫ –±—É–¥—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫, —á—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã —Ä–∞–Ω–Ω–µ—Ä—ã —Ç–∞–º. –ù—É –∞–≥–µ–Ω—Ç ‚Äî —ç—Ç–æ —Ä–∞–Ω–Ω–µ—Ä—ã, —è –∏–º–µ—é –≤ –≤–∏–¥—É. –î–∞–≤–∞–π –±—É–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –≥—Ä–∞–º–æ—Ç–Ω–æ–µ —Å–ª–æ–≤–æ, —á—Ç–æ–±—ã –Ω–µ –ø—É—Ç–∞—Ç—å—Å—è —Å coding-–∞–≥–µ–Ω—Ç–æ–º. –Ø –∏–º–µ—é –≤ –≤–∏–¥—É GitLab Runner, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –±–∏–ª–¥–∏—Ç—å.

–ò —á—Ç–æ –º—ã –±—É–¥–µ–º –±–∏–ª–¥–∏—Ç—å? –ú—ã –±—É–¥–µ–º –±–∏–ª–¥–∏—Ç—å –±—ç–∫–µ–Ω–¥—ã, –º—ã –±—É–¥–µ–º –±–∏–ª–¥–∏—Ç—å SDK. –ò–ª–∏ —ç—Ç–æ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –¥–∞? –ú—ã –±—É–¥–µ–º –±–∏–ª–¥–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ã. –ú—ã, –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –¥–æ–ª–∂–Ω—ã —ç—Ç–∏ –∏–º–∏–¥–∂–∏, –Ω–∞–≤–µ—Ä–Ω–æ–µ, —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å. –Ø –≤–æ—Ç –¥—É–º–∞–ª, —á—Ç–æ –≤ GitLab Registry, –Ω–æ –°–∞—à–∞ –ø—Ä–µ–¥–ª–æ–∂–∏–ª Portainer. –Ø –Ω–µ –æ—á–µ–Ω—å –∑–Ω–∞–∫–æ–º —Å —ç—Ç–∏–º —Ä–µ—à–µ–Ω–∏–µ–º.

–Ø –≤–æ—Ç –≤–∏–∂—É, —á—Ç–æ —ç—Ç–æ Enterprise-grade Kubernetes, Docker, Podman Management, –¥–∞? –¢–æ –µ—Å—Ç—å —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –∏–º–∏–¥–∂, –≤–µ—Ä–Ω–µ–µ, –Ω–µ –ø—Ä–æ—Å—Ç–æ, —è –¥—É–º–∞—é, —á—Ç–æ —ç—Ç–æ –Ω–µ –∏–º–∏–¥–∂. –≠—Ç–æ –∏–º–µ–Ω–Ω–æ, –ø–æ —Ö–æ–¥—É, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–Ω—è—Ç—Å—è –æ—Ç –∏–º–∏–¥–∂–µ–π. –¢–æ –µ—Å—Ç—å —É –Ω–∞—Å —Ö–æ—Ä–æ—à–æ –±—ã–ª–æ –±—ã –ø–æ –∫–æ–º–º–∏—Ç—É, —á—Ç–æ–±—ã –±–∏–ª–¥–∏–ª—Å—è –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Ö—ç—à—Ç–µ–≥–æ–º.

–Ø –≤–æ—Ç –¥—É–º–∞—é, –∫–∞–∫ —ç—Ç–æ –ª—É—á—à–µ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å. –£ –Ω–∞—Å —Å–µ–π—á–∞—Å, –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –º—ã –¥–µ–ª–∞–µ–º —Ç–æ–ª—å–∫–æ Dev, –≤ –±—É–¥—É—â–µ–º –±—É–¥–µ–º Stage –∏ Prod. –ü–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ Prod —Ç–∞–º –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å, —É—Å–ª–æ–≤–Ω–æ –≥–æ–≤–æ—Ä—è, –ø–æ –∫–Ω–æ–ø–∫–µ. –ú–æ–∂–µ—Ç –±—ã—Ç—å, Stage –ø–æ –≤–µ—Ç–∫–µ Stage, —Ç–µ–≥, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–±–∞—á–∫–∞ –Ω–µ latest, –∞ —Å–æ–±–∞—á–∫—É —Ç–∞–º, –Ω–µ –∑–Ω–∞—é, –∫–∞–∫–æ–π-—Ç–æ. –í–æ—Ç —Ç–∞–∫ –≤–æ—Ç —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å. –û–ø—è—Ç—å-—Ç–∞–∫–∏ —è –º–æ–≥—É –æ—à–∏–±–∞—Ç—å—Å—è, —Ç—ã –º–æ–∂–µ—à—å –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ª—É—á—à–∏–µ —Ä–µ—à–µ–Ω–∏—è.

–Ø —Ö–æ—á—É Best Practices —Å Industry Standard. –ò –≤ —Ç–æ–º —á–∏—Å–ª–µ –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç –∏ –∞–∫—Ü–µ–Ω—Ç, —á—Ç–æ –º–Ω–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –µ—Å–ª–∏ —Ç—ã –≤–∏–¥–∏—à—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –Ω–∞ Approve, —Ç–æ —Ç—ã —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω–æ —ç—Ç–æ –ø—Ä–µ–¥—Å—Ç–∞–≤—å –≤ –≤–∏–¥–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ –≤—Å–µ–º–∏ Pros, Cons –∏ Trade-offs, –¥–∞, —Ç–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏ –¥–ª—è –Ω–∞—à–µ–≥–æ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, —é–∑-–∫–µ–π—Å–∞.

–ò, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, —Ç–∞–º –∏–º–∏–¥–∂–∏ –ø–æ –∫–æ–º–º–∏—Ç—É, —É—Å–ª–æ–≤–Ω–æ –≥–æ–≤–æ—Ä—è, –≤ Dev —Å–±–∏–ª–¥–∏–ª–∏—Å—å –≤ Develop –≤–µ—Ç–∫—É, –¥–∞, –∏, —Ç–∏–ø–∞, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ, –Ω—É, –Ω–µ –Ω—É–∂–Ω–æ, –∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–∏–ª–∏—Å—å, –∫–æ–≥–¥–∞ —É–∂–µ, —Ç–∏–ø–∞, –±–µ—Å—à–æ–≤–Ω–æ –æ–Ω–∞...

–ê, –µ—â—ë, –Ω—É, —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ, —á—Ç–æ, –∑–∞—á–µ–º –º—ã —ç—Ç–æ –≤—Å—ë –¥–µ–ª–∞–µ–º? –ß—Ç–æ–±—ã —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥–∏–ª–∏. –¢–æ –µ—Å—Ç—å, –µ—Å–ª–∏ —É –Ω–∞—Å, –∫–∞–∫ –±—ã, –∫–æ–º–º–∏—Ç —É—Ö–æ–¥–∏—Ç, —Ç–æ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã, –∫–æ—Ä–æ—á–µ, –ø—Ä–æ—Ö–æ–¥–∏—Ç—å, —Ç–æ–≥–¥–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ, –Ω—É, —Ç–æ –µ—Å—Ç—å, –∏–º–∏–¥–∂–∏ —Å–±–∏–ª–¥–∏–ª–∏—Å—å, —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏, –∏ —Ç–æ–≥–¥–∞ –º—ã –Ω–∞ Develop –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∏–º–∏–¥–∂–∏, –¥–∞. –ï—Å–ª–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç, —Ç–æ, –∫–∞–∫ –±—ã, —É–≤–µ–¥–æ–º–ª—è–µ—Ç—Å—è.

–£ –Ω–∞—Å —Å–µ–π—á–∞—Å –±—É–¥–µ—Ç, —è —Ç–µ–±–µ –¥–æ–±–∞–≤–ª—é –ø–æ–∑–∂–µ, Telegram-–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é –≥—Ä—É–ø–ø—É, –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ç–æ–ø–∏–∫ –∫–∏–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. –ù—É, –≤–æ—Ç.

–ê Portainer, –º–Ω–µ –Ω–∞–¥–æ –Ω–µ–º–Ω–æ–∂–∫–æ –ø–æ—è—Å–Ω–∏—Ç—å –µ–≥–æ —Ä–æ–ª—å –∏ –º–µ—Å—Ç–æ. –Ø –≤–æ—Ç –µ—â—ë –ø–æ–∫–∞ –¥–∞–∂–µ —Å–∞–π—Ç –Ω–µ —á–∏—Ç–∞–ª. –ù—É, —è —Ç–∞–º –∑–Ω–∞–∫–æ–º —Å GitHub Registry, —è –∑–Ω–∞–∫–æ–º, —Ç–∞–º, –Ω–µ –∑–Ω–∞—é, —Å GitHub Depot, –¥–∞, —Ç–∞–º, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ. –Ø –∑–Ω–∞–∫–æ–º —Å –¥—Ä—É–≥–∏–º–∏ Depot, —Ç–æ –µ—Å—Ç—å, –∫–∞–∫–∞—è –≤–æ—Ç —Ü–µ–ª—å –µ–≥–æ.

–ê, –µ—â—ë, –º–æ–∂–µ—Ç –±—ã—Ç—å, –Ω–∞ –∞–Ω–∞–ª–æ–≥–∏—è—Ö –Ω–µ –æ–±—ä—è—Å–Ω–∏. –í–æ—Ç —è –Ω–µ–ø–ª–æ—Ö–æ –∑–Ω–∞–∫–æ–º —Å Garden, –µ—Å–ª–∏ —Ç—ã –∑–Ω–∞–µ—à—å, –Ω–æ —ç—Ç–æ —Ç–∞–∫–æ–π, —Ç–∏–ø–∞, —É—Å—Ç–∞—Ä–µ–≤—à–∏–π, –ø–æ—Ö–æ–∂–∏–π –Ω–∞ —Ç–æ, –∞ –º–æ–∂–µ—Ç –±—ã—Ç—å, —è –æ—à–∏–±–∞—é—Å—å, Depot, —Ç–∞–∫–æ–≥–æ Helm-—á–∞—Ä—Ç–æ–≤ –¥–ª—è K8s Preview Inline. –ù—É, —ç—Ç–æ, —Ç–∏–ø–∞, –æ–¥–Ω–æ solution, —Ç–∞–º, —É—Å—Ç–∞—Ä–µ–≤—à–µ–µ, –æ–Ω–æ –±—ã–ª–æ –Ω–∞ –æ–¥–Ω–æ–º –∏–∑ –ø—Ä–æ–µ–∫—Ç–æ–≤, —è –≤–æ—Ç —Ö–æ—Ä–æ—à–æ –≤ –Ω—ë–º –≤–∞—Ä–∏–ª—Å—è, –¥–∞, —Ç–∞–∫ —Ç–∞–º —á–µ—Ä–µ–∑ Helm.

–¢–æ –µ—Å—Ç—å, —É –Ω–∞—Å —Å–µ–π—á–∞—Å, –æ–ø—è—Ç—å-—Ç–∞–∫–∏, –ø–æ–≤—Ç–æ—Ä—é, —É –Ω–∞—Å —Å–∞–º–æ–µ, —Ç–æ—á–Ω–µ–µ, –Ω–µ —Ç–æ, —á—Ç–æ –ø–æ–≤—Ç–æ—Ä—é, –∞ —Å–∞–º–∞—è –≥–ª–∞–≤–Ω–∞—è, –≤–∞–∂–Ω–∞—è –º—ã—Å–ª—å: –º—ã —Å–µ–π—á–∞—Å —á–µ—Ä–µ–∑ Docker –∏ Docker Imaging –¥–µ–ª–∞–µ–º Deploy. –ú—ã –Ω–µ –¥–µ–ª–∞–µ–º —Å–µ–π—á–∞—Å Kubernetes, –¥–∞, —Ö–æ—Ç—å —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ Portainer, –æ–Ω–æ –∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –∏ –¥–ª—è K8s. –¢–æ –µ—Å—Ç—å, –Ω—É, —Ç–∏–ø–∞, –ø—Ä–æ—Å—Ç–æ-—Ç–∞–∫–∏ –≤–∞–∂–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã, –¥–∞, —á—Ç–æ–±—ã –º—ã –≤—Å—ë –¥–µ–ª–∞–µ–º –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ.

–°–µ–π—á–∞—Å –º—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º, –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å, CI –¥–ª—è Dev, –±–µ–∑ Over Engineering, —á—Ç–æ–±—ã –º—ã —Ç–∞–º, –≤ –æ—Å–Ω–æ–≤–Ω–æ–º, –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–∞—Å–æ–≤ –ø–æ–¥–Ω—è—Ç—å.

–í–æ—Ç, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ, —è —Ç–µ–±–µ –¥–∞–ª –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π input, —á—Ç–æ–±—ã —Ç—ã —Å My Lowways Message —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–ª –≤—Å–µ requirements, job to be done, definition of done –∏ kick-off task, –∏ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–ª –¥–≤–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã. –¢–æ –µ—Å—Ç—å, output ‚Äî —ç—Ç–æ –±—É–¥—É—Ç —Å–µ–π—á–∞—Å –µ—â—ë, –ø–æ–º–∏–º–æ –≤–æ—Ç —ç—Ç–∏—Ö –≤—Å–µ—Ö requirements, job to be done, definition of done –∏ kick-off task, —ç—Ç–æ, —Ç–∏–ø–∞, —Å—Ü–µ–Ω–∞—Ä–∏–π. –¢–æ –µ—Å—Ç—å, –≤—ã–±–µ—Ä–∏ —Å–∞–º –Ω–∞–∏–ª—É—á—à–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π, –Ω–æ –º–Ω–µ –æ—Å—Ç–∞–≤—å –≤–æ—Ç —ç—Ç–æ—Ç —Ç–∞–±–ª–∏—á–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç, —á—Ç–æ–±—ã —è –≤–∏–¥–µ–ª, –º–µ–∂–¥—É —á–µ–º –∏ —á–µ–º –º—ã –≤—ã–±–∏—Ä–∞–ª–∏, —á—Ç–æ–±—ã —è –≤–∏–¥–µ–ª —Å—Ö–µ–º—É, –∫–æ—Ç–æ—Ä—É—é, —Ç–∏–ø–∞, –≤–∏–∑—É–∞–ª—å–Ω–æ –≤ Mermaid.js –≤—Å—ë, —Å–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ, —Å –∫–µ–º, —Å–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å, 5-10.

p.s. mentioned names, - https://www.portainer.io/, gitlab, etc

#### ChatGPT:
<time datetime="2025-11-26T10:04:24.326Z" title="26/11/2025, 13:04:24">13:04</time>

–°—Ç–∞—Ä—Ç—É–µ–º üöÄ

–Ø —Å–Ω–∞—á–∞–ª–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É—é —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è / JTBD / DoD / kick‚Äëoff, –ø–æ—Ç–æ–º –¥–∞–º **2 —Å—Ü–µ–Ω–∞—Ä–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã CI/CD** (—Å —Ç–∞–±–ª–∏—Ü–µ–π trade‚Äëoff‚Äô–æ–≤), –≤—ã–±–µ—Ä—É —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –∏ –ø–æ–∫–∞–∂—É **Mermaid‚Äë–¥–∏–∞–≥—Ä–∞–º–º—ã**.

---

## 1. –ö—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (—á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç—å –æ–± –æ–¥–Ω–æ–º –∏ —Ç–æ–º –∂–µ)

- Monorepo `ois-cfa`:
  - `apps/` ‚Äî —Ñ—Ä–æ–Ω—Ç—ã (portal-issuer, investor, backoffice –∏ —Ç.–ø.).
  - `services/` ‚Äî .NET‚Äë—Å–µ—Ä–≤–∏—Å—ã.
  - `packages/` ‚Äî –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã + SDK.
  - `tests/` ‚Äî –±—ç–∫–µ–Ω–¥‚Äë—Ç–µ—Å—Ç—ã, e2e, Playwright –∏ —Ç.–¥. ÓàÄfileciteÓàÇturn0file8ÓàÅ
- –ï—Å—Ç—å **Makefile** —Å —Ü–µ–ª—è–º–∏ `up-local`, `seed`, `validate-specs`, `generate-sdks`, `e2e` –∏ –¥—Ä. ‚Äî –∏—Ö —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –Ω–∞ Mac –∏ –Ω–∞ eywa1. ÓàÄfileciteÓàÇturn1file11ÓàÇturn1file12ÓàÅ
- –ù–∞ Timeweb‚Äëk8s —É–∂–µ –µ—Å—Ç—å:
  - –∫–ª–∞—Å—Ç–µ—Ä, Ingress, GitLab Agent, GitLab Runner (k8s executor, –Ω–æ —Å –ø—Ä–æ–±–ª–µ–º–æ–π —Ç–æ–∫–µ–Ω–∞ 403). ÓàÄfileciteÓàÇturn2file4ÓàÇturn2file7ÓàÇturn3file15ÓàÅ
- –í `ops/gitlab-ci.md` —É–∂–µ –æ–ø–∏—Å–∞–Ω "–∏–¥–µ–∞–ª—å–Ω—ã–π" pipeline: —Å—Ç–∞–¥–∏–∏ **infra ‚Üí build ‚Üí test ‚Üí deploy**, build‚Äëjobs –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤/—Ñ—Ä–æ–Ω—Ç–æ–≤, e2e, k6 –∏ —Ç.–ø. ÓàÄfileciteÓàÇturn3file2ÓàÅ
- Eywa1 —Å–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ **"–ª–æ–∫–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞" –ø–æ–¥ Linux**, –±–µ–∑ pm2 (—Ñ—Ä–æ–Ω—Ç—ã —á–µ—Ä–µ–∑ Docker/compose), —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –ø–æ sudo –∏ docker.sock. ÓàÄfileciteÓàÇturn1file14ÓàÇturn2file11ÓàÇturn3file12ÓàÅ

–¢—ã –ø—Ä–∞–≤: `c2p_ops` –º–µ—Å—Ç–∞–º–∏ –ø–µ—Ä–µ–∏–Ω–∂–µ–Ω–µ—Ä–µ–Ω–æ –ø–æ–¥ full‚Äëenterprise GitOps/ArgoCD, –∏ –º—ã —Å–µ–π—á–∞—Å —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º **—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π Dev‚ÄëCI**, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å –∑–∞ —á–∞—Å‚Äë–¥–≤–∞, –Ω–æ –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –±—É–¥–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç—å –±—É–¥—É—â–µ–º—É GitOps‚Äë–ø–ª–∞–Ω—É.

---

## 2. Requirements / JTBD / DoD / Kick‚Äëoff

### 2.1. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (Dev —Ñ–æ–∫—É—Å)

1. **Runner placement**
   - –ï—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π VDS `eywa1`, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ **–±—ã—Å—Ç—Ä—ã–π dedicated GitLab Runner** –¥–ª—è Dev‚Äë–ø–∞–π–ø–ª–∞–π–Ω–æ–≤.
   - –í–∞—Ä–∏–∞–Ω—Ç —Å runner‚Äô–æ–º –≤–Ω—É—Ç—Ä–∏ k8s (Timeweb) —Ç–æ–∂–µ –µ—Å—Ç—å, –Ω–æ –æ–Ω –Ω–∞–º –Ω—É–∂–µ–Ω —Å–∫–æ—Ä–µ–µ –¥–ª—è Stage/Prod –∏ GitOps, –Ω–µ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞ Dev.

2. **–ß—Ç–æ –±–∏–ª–¥–∏–º**
   - –í—Å–µ backend‚Äë—Å–µ—Ä–≤–∏—Å—ã (`services/**`).
   - –í—Å–µ frontend‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`apps/**`).
   - SDK (–∫–∞–∫ –º–∏–Ω–∏–º—É–º `make generate-sdks` + —É–ø–∞–∫–æ–≤–∫–∞ SDK, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∫–∞–∫ npm/nuget‚Äë–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã).

3. **–§–æ—Ä–º–∞—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤**
   - **Docker‚Äë–æ–±—Ä–∞–∑—ã** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞/—Ñ—Ä–æ–Ω—Ç–∞.
   - –û–±—Ä–∞–∑—ã —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ **GitLab Container Registry** –∫–∞–∫ canonical storage (—ç—Ç–æ industry standard: registry –≤—Å—Ç—Ä–æ–µ–Ω –≤ GitLab, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å CI, —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∞–º–∏ –∏ —Ç.–¥.). ÓàÄciteÓàÇturn0search1ÓàÇturn0search10ÓàÇturn0search12ÓàÅ
   - Portainer, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, ‚Äî —Ç–æ–ª—å–∫–æ –∫–∞–∫ **GUI‚Äë–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–µ–π**, –∞ –Ω–µ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π registry. ÓàÄciteÓàÇturn0search0ÓàÇturn0search2ÓàÇturn0search9ÓàÇturn0search6ÓàÅ

4. **Tagging policy (–æ–±—Ä–∞–∑—ã)**
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ build‚Äô–∞:
     - `service-x:$CI_COMMIT_SHORT_SHA` ‚Äî immutable —Ç–µ–≥.
     - `service-x:dev-$CI_COMMIT_REF_SLUG` ‚Äî "–≤–µ—Ç–æ—á–Ω—ã–π" —Ç–µ–≥.
   - –î–ª—è develop:
     - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–≥ `service-x:develop-latest`.
   - –í –±—É–¥—É—â–µ–º, –¥–ª—è —Ä–µ–ª–∏–∑‚Äë—Ç–µ–≥–æ–≤:
     - `service-x:v1.2.3` + `service-x:prod-latest`.

5. **Environments**
   - –°–µ–π—á–∞—Å —Ç–æ–ª—å–∫–æ **Dev**:
     - —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç —á–µ—Ä–µ–∑ Docker/Compose (–Ω–µ k8s), –Ω–∞ –æ–¥–Ω–æ–º host‚Äô–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∞–º eywa1 –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π dev‚Äë—Å–µ—Ä–≤–µ—Ä).
     - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —É—Å–ø–µ—à–Ω–æ–º—É pipeline `develop` / feature‚Äë–≤–µ—Ç–∫–∏ (–ø–æ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏).
   - –í –±—É–¥—É—â–µ–º:
     - Stage/Prod –≤ k8s —á–µ—Ä–µ–∑ GitOps (GitLab Agent / ArgoCD), –Ω–æ —ç—Ç–æ **–≤—Ç–æ—Ä–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è**, –Ω–µ MVP.

6. **–¢–µ—Å—Ç—ã –∫–∞–∫ gate**
   - –ù–∞ –∫–∞–∂–¥—ã–π commit/MR:
     - `validate-specs` (OpenAPI/AsyncAPI/JSON‚Äëschema). ÓàÄfileciteÓàÇturn1file2ÓàÇturn3file0ÓàÇturn3file3ÓàÅ
     - Unit/integration tests –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ (.NET xUnit, etc). ÓàÄfileciteÓàÇturn3file17ÓàÇturn3file16ÓàÅ
     - Unit tests —Ñ—Ä–æ–Ω—Ç–æ–≤ (npm test).
   - –î–ª—è develop –∏/–∏–ª–∏ merge‚Äërequest:
     - `make e2e` / Playwright‚Äëe2e –ø—Ä–æ—Ç–∏–≤ "dev‚Äë—Å—Ç–µ–Ω–¥–∞" (–ª–∏–±–æ –ª–æ–∫–∞–ª—å–Ω–æ –ø–æ–¥–Ω—è—Ç–æ–≥–æ stack, –ª–∏–±–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ dev‚Äë—Å—Ç–µ–Ω–¥–∞). ÓàÄfileciteÓàÇturn1file11ÓàÇturn2file14ÓàÇturn3file3ÓàÅ
   - **Deploy Dev** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ.

7. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
   - GitLab ‚Üí Telegram:
     - –º–∏–Ω–∏–º—É–º: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ **failed pipeline** –∏ **failed deploy job**.
     - –ø–æ–∑–∂–µ: –æ—Ç–¥–µ–ª—å–Ω—ã–π job –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –∑–∞–¥–∞–Ω–Ω—ã–π Telegram‚Äëtopik.

8. **–ë–µ–∑ Kubernetes –¥–ª—è Dev –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å**
   - Dev‚Äëdeploy –¥–µ–ª–∞–µ–º —á–µ—Ä–µ–∑ **Docker/Compose** (–∏ –≤–æ–∑–º–æ–∂–Ω–æ Portainer GUI –ø–æ–≤–µ—Ä—Ö —ç—Ç–æ–≥–æ).
   - K8s/Helm/GitOps –æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è Stage/Prod, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è Dev‚Äë–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

### 2.2. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Time‚Äëto‚Äëvalue:** MVP CI –¥–ª—è Dev –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥–Ω—è—Ç –∑–∞ 1 —Ä–∞–±–æ—á–∏–π —Å–ª–æ—Ç (–ø–æ—Ä—è–¥–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–∞—Å–æ–≤), –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ArgoCD –∏ —Å–ª–æ–∂–Ω–æ–≥–æ GitOps.
- **Repeatability:** —Ç–µ –∂–µ –∫–æ–º–∞–Ω–¥—ã, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (`make up-local`, `make validate-specs`, `make e2e`), –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏ –≤ CI, —á—Ç–æ–±—ã –Ω–µ –ø–ª–æ–¥–∏—Ç—å "–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏". ÓàÄfileciteÓàÇturn3file12ÓàÇturn3file6ÓàÅ
- **Security / Secrets:** –¥–æ—Å—Ç—É–ø –∫ GitLab Registry, ssh‚Äë–∫–ª—é—á–∏ –Ω–∞ dev‚Äëhost, —Ç–æ–∫–µ–Ω—ã Telegram‚Äë–±–æ—Ç–∞ ‚Äî –≤—Å—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ GitLab CI/CD Variables (masked, protected). ÓàÄfileciteÓàÇturn3file0ÓàÅ
- **Observability:** –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Ç–µ—Å—Ç–æ–≤ (JUnit, coverage, Playwright‚Äë–æ—Ç—á—ë—Ç, k6, –µ—Å–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ) –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ GitLab UI. ÓàÄfileciteÓàÇturn2file6ÓàÇturn3file10ÓàÅ

### 2.3. JTBD (Jobs To Be Done) –∏–º–µ–Ω–Ω–æ –¥–ª—è CI —Å–µ–π—á–∞—Å

–ù–∞–∑–æ–≤—É –∏—Ö C\_J\* —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å —Å—Ç–∞—Ä—ã–º J1..J4:

- **C\_J1 ‚Äì Build & test on commit**
  - –ù–∞ –∫–∞–∂–¥—ã–π commit –≤ feature/develop:
    - —Å–æ–±–∏—Ä–∞—Ç—å –∫–æ–¥ (backend/frontend),
    - –≥–æ–Ω—è—Ç—å spec‚Äë–≤–∞–ª–∏–¥–∞—Ü–∏—é + unit/integration tests,
    - –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å SDK.

- **C\_J2 ‚Äì Package & publish**
  - –ü–æ –∑–µ–ª—ë–Ω—ã–º —Ç–µ—Å—Ç–∞–º:
    - —Å–æ–±–∏—Ä–∞—Ç—å Docker‚Äë–æ–±—Ä–∞–∑—ã –¥–ª—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤/—Ñ—Ä–æ–Ω—Ç–æ–≤,
    - –ø—É—à–∏—Ç—å –≤ GitLab Registry —Å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–π —Å—Ö–µ–º–æ–π —Ç–µ–≥–æ–≤. ÓàÄfileciteÓàÇturn2file18ÓàÇturn3file7ÓàÅ

- **C\_J3 ‚Äì Dev‚Äëdeploy**
  - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω—ã—Ö build+tests:
    - –æ–±–Ω–æ–≤–∏—Ç—å dev‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏–µ (docker compose / Portainer stack) –¥–æ –Ω–æ–≤—ã—Ö —Ç–µ–≥–æ–≤,
    - —Å–¥–µ–ª–∞—Ç—å healthcheck –∏ –∑–∞—Ñ–µ–π–ª–∏—Ç—å job, –µ—Å–ª–∏ dev‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏–µ "—Å–ª–æ–º–∞–Ω–æ".

- **C\_J4 ‚Äì Path to Stage/Prod**
  - –°—Ö–µ–º–∞ —Ç–µ–≥–æ–≤ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ CI –¥–æ–ª–∂–Ω–∞ –±–µ–∑ –±–æ–ª–∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å—Å—è –Ω–∞:
    - main ‚Üí Stage
    - tags vX.Y.Z ‚Üí Prod.

- **C\_J5 ‚Äì Feedback / Alerts**
  - –õ—é–±–æ–π –ø–∞–¥—à–∏–π pipeline –∏–ª–∏ deploy –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–ª–µ—Ç–∞—Ç—å:
    - –ª–∏–±–æ —á–µ—Ä–µ–∑ GitLab‚Äë–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ Telegram,
    - –ª–∏–±–æ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π notification‚Äëjob.

### 2.4. Definition of Done (DoD) –¥–ª—è **"CI Dev v1"**

–°—á–∏—Ç–∞–µ–º, —á—Ç–æ "–ø–µ—Ä–≤—ã–π CI‚Äë–∏—Ç–µ—Ä–∞—Ü–∏—è" –≥–æ—Ç–æ–≤–∞, –∫–æ–≥–¥–∞:

1. –ï—Å—Ç—å —Ä–∞–±–æ—á–∏–π **GitLab Runner**, –¥–æ—Å—Ç—É–ø–Ω—ã–π project‚Äô—É:
   - –ª–∏–±–æ shell/docker‚Äërunner –Ω–∞ `eywa1`,
   - –ª–∏–±–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ—á–∏–Ω–µ–Ω–Ω—ã–π k8s‚Äërunner (–Ω–æ –º—ã —Ç–∞—Ä–≥–µ—Ç–∏–º—Å—è –Ω–∞ eywa1). ÓàÄfileciteÓàÇturn3file4ÓàÇturn3file14ÓàÇturn3file15ÓàÅ

2. –í —Ä–µ–ø–æ –ª–µ–∂–∏—Ç `.gitlab-ci.yml` —Å–æ —Å—Ç–∞–¥–∏—è–º–∏:
   - `spec`, `build`, `test`, `deploy-dev`.

3. –ù–∞ push –≤ `develop`:
   - –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è `validate-specs`, unit/integration tests, basic frontend tests,
   - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è SDK,
   - —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∏ –ø—É—à–∞—Ç—Å—è Docker‚Äë–æ–±—Ä–∞–∑—ã –≤ GitLab Registry,
   - –Ω–∞ Dev‚Äëhost –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è Compose‚Äë—Å—Ç–µ–∫,
   - healthcheck –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 (API gateway + –±–∞–∑–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —Ñ—Ä–æ–Ω—Ç–æ–≤).

4. –ù–∞ **merge request**:
   - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ—Ç –∂–µ –Ω–∞–±–æ—Ä –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ deploy,
   - e2e‚Äëjob –≥–æ–Ω—è–µ—Ç Playwright‚Äë—Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ—Ç–∏–≤ dev‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏—è, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∏–¥–Ω—ã –≤ GitLab (HTML –æ—Ç—á—ë—Ç). ÓàÄfileciteÓàÇturn2file10ÓàÇturn3file10ÓàÅ

5. –ù–µ—É—Å–ø–µ—à–Ω—ã–π pipeline:
   - –±–ª–æ–∫–∏—Ä—É–µ—Ç deploy Dev,
   - —à–ª—ë—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–º–∏–Ω–∏–º—É–º ‚Äî GitLab ‚Üí Telegram).

### 2.5. Kick‚Äëoff –∑–∞–¥–∞—á–∏

–ü–µ—Ä–≤—ã–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —à–∞–≥–∏ (–±–µ–∑ –¥–µ—Ç–∞–ª–µ–π pipeline‚Äô–∞, –æ–Ω–∏ –Ω–∏–∂–µ):

1. **Runner –Ω–∞ eywa1**
   - –†–µ—à–∏—Ç—å: shell vs docker executor.
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å runner –≤ GitLab project `npk/ois-cfa`.
   - –ü–æ–≤–µ—Å–∏—Ç—å —Ç–µ–≥–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä: `eywa1`, `docker`, `dotnet`, `node`.

2. **–°—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–∞ eywa1 —Ä–∞–±–æ—Ç–∞—é—Ç:
     - `make validate-specs`,
     - `make generate-sdks`,
     - `dotnet test` –ø–æ –∫–ª—é—á–µ–≤—ã–º test‚Äë–ø—Ä–æ–µ–∫—Ç–∞–º,
     - `npm test` –≤ apps/\*\*,
     - `make e2e` (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä Playwright‚Äë—Å–ø–µ–∫–æ–≤). ÓàÄfileciteÓàÇturn1file2ÓàÇturn1file12ÓàÇturn3file12ÓàÅ

3. **–ë–∞–∑–æ–≤—ã–π `.gitlab-ci.yml`**
   - –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞–¥–∏–∏ `spec`, `build`, `test`, `deploy-dev`, –∏—Å–ø–æ–ª—å–∑—É—è –∑–∞–≥–æ—Ç–æ–≤–∫–∏ –∏–∑ `ops/gitlab-ci.md` –∏ —à–∞–±–ª–æ–Ω–æ–≤ build‚Äëjobs. ÓàÄfileciteÓàÇturn3file2ÓàÇturn3file7ÓàÅ

4. **Dev‚Äëdeploy —Å–∫—Ä–∏–ø—Ç**
   - –û–ø–∏—Å–∞—Ç—å `ops/scripts/deploy-dev-compose.sh`:
     - `docker compose pull`,
     - `docker compose up -d`,
     - healthcheck.

5. **Secrets –≤ GitLab**
   - –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
     - `CI_REGISTRY_USER`, `CI_REGISTRY_PASSWORD`,
     - ssh‚Äë–∫–ª—é—á –∫ dev‚Äëhost (–µ—Å–ª–∏ deploy –∏–¥—ë—Ç –ø–æ ssh),
     - `TELEGRAM_BOT_TOKEN`, `TELEGRAM_CHAT_ID` (–Ω–∞ –±—É–¥—É—â–µ–µ).

6. **Smoke‚Äëpipeline**
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–≤—ã–π pipeline –Ω–∞ –∫–∞–∫–æ–π‚Äë–Ω–∏–±—É–¥—å test‚Äë–≤–µ—Ç–∫–µ –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:
     - —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –æ–±—Ä–∞–∑—ã,
     - –Ω–µ—Ç –±–ª–æ–∫–µ—Ä–æ–≤ –ø–æ –¥–æ—Å—Ç—É–ø—É –∫ registry,
     - –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è dev‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏–µ.

---

## 3. Portainer vs GitLab Registry (–Ω–∞ –ø–∞–ª—å—Ü–∞—Ö)

### GitLab Container Registry

- –≠—Ç–æ **—Ö—Ä–∞–Ω–∏–ª–∏—â–µ Docker‚Äë–æ–±—Ä–∞–∑–æ–≤**, –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –≤ GitLab:
  - –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ –ø—Ä–æ–µ–∫—Ç—É;
  - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º —á–µ—Ä–µ–∑ GitLab RBAC;
  - —Ç–µ—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GitLab CI (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `CI_REGISTRY`, `CI_REGISTRY_IMAGE`, etc). ÓàÄciteÓàÇturn0search1ÓàÇturn0search10ÓàÇturn0search12ÓàÅ
- Best practice:
  - –±–∏–ª–¥–∏—Ç—å –æ–±—Ä–∞–∑—ã –≤ CI,
  - –ø—É—à–∏—Ç—å –≤ GitLab Registry,
  - –Ω–∞ —Å—Ç–µ–Ω–¥–∞—Ö –¥–µ–ª–∞—Ç—å `docker pull` –∏–º–µ–Ω–Ω–æ –æ—Ç—Ç—É–¥–∞.

### Portainer

- Portainer ‚Äî —ç—Ç–æ **—É–ø—Ä–∞–≤–ª—è–ª–∫–∞/–ø–∞–Ω–µ–ª—å** –Ω–∞–¥ Docker/Swarm/Kubernetes/Podman:
  - –¥–∞—ë—Ç –≤–µ–±‚ÄëGUI –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, —Å—Ç—ç–∫–æ–≤, volumes, networks, –ª–æ–≥–æ–≤, exec‚Äë–≤ –∫–æ–Ω—Å–æ–ª—å, –∏ —Ç.–¥. ÓàÄciteÓàÇturn0search0ÓàÇturn0search2ÓàÇturn0search9ÓàÇturn0search18ÓàÅ
  - —É–º–µ–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –≤–Ω–µ—à–Ω–∏–º registries (–≤ —Ç.—á. GitLab) –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –æ–±—Ä–∞–∑—ã, –Ω–æ —Å–∞–º registry ‚Äî –ª–∏—à—å –∫–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é, –∞ –Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π storage. ÓàÄciteÓàÇturn0search6ÓàÇturn0search13ÓàÅ

### –ò—Ç–æ–≥ –ø–æ —Ä–æ–ª–∏ Portainer

–î–ª—è —Ç–≤–æ–µ–≥–æ –∫–µ–π—Å–∞:

- **Registry** = GitLab Container Registry.
- **Orchestrator/Control Plane**:
  - —Å–µ–π—á–∞—Å –¥–ª—è Dev ‚Äî –ø—Ä–æ—Å—Ç–æ `docker compose` +, –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏, Portainer –∫–∞–∫ GUI –¥–ª—è —ç—Ç–æ–≥–æ compose‚Äë—Å—Ç–µ–∫–∞;
  - –ø–æ–∑–∂–µ –¥–ª—è Stage/Prod ‚Äî Kubernetes + ArgoCD/GitLab Agent (Portainer –º–æ–∂–µ—Ç –∂–∏—Ç—å —Ä—è–¥–æ–º, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω).

---

## 4. –î–≤–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã CI/CD

### 4.1. –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**–°—Ü–µ–Ω–∞—Ä–∏–π 1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π): "Dev‚ÄëCI –Ω–∞ eywa1 + Docker Compose"**

- GitLab Runner —Å—Ç–æ–∏—Ç –Ω–∞ eywa1 (shell –∏–ª–∏ docker executor).
- –ü–∞–π–ø–ª–∞–π–Ω:
  - –±–∏–ª–¥ –∏ —Ç–µ—Å—Ç—ã –ø—Ä—è–º–æ –Ω–∞ eywa1;
  - docker‚Äë–æ–±—Ä–∞–∑—ã –ø—É—à–∞—Ç—Å—è –≤ GitLab Registry;
  - Dev‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏–µ (compose‚Äë—Å—Ç–µ–∫ –Ω–∞ dev‚Äëhost, —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∞–º eywa1) –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ —Ç–µ–≥–∞–º–∏.

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: "K8s‚Äënative GitOps CI/CD"**

- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π k8s‚Äërunner –≤ Timeweb‚Äë–∫–ª–∞—Å—Ç–µ—Ä–µ + GitLab Agent/ArgoCD, –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ –≤ `c2p_ops`: build ‚Üí push –≤ registry ‚Üí update Helm‚Äëvalues/manifests ‚Üí GitOps —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç dev/stage/prod. ÓàÄfileciteÓàÇturn2file6ÓàÇturn2file12ÓàÇturn3file5ÓàÅ

### 4.2. –¢–∞–±–ª–∏—á–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –ê—Å–ø–µ–∫—Ç                                  | –°—Ü–µ–Ω–∞—Ä–∏–π 1: Runner –Ω–∞ eywa1 + Compose                                                                          | –°—Ü–µ–Ω–∞—Ä–∏–π 2: K8s + GitOps                                                              |
| --------------------------------------- | -------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- |
| **–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞**                    | –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å runner –Ω–∞ eywa1, –¥–æ–ø–∏—Å–∞—Ç—å `.gitlab-ci.yml`, —Å–∫—Ä–∏–ø—Ç deploy‚Äëdev.                        | –ú–µ–¥–ª–µ–Ω–Ω–æ: —á–∏–Ω–∏—Ç—å k8s‚Äërunner —Ç–æ–∫–µ–Ω, ArgoCD/Agent, Helm‚Äëcharts, GitOps‚Äë–ø—Ä–∞–≤–∏–ª–∞.         |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å**                           | –ù–∏–∑–∫–∞—è‚Äì—Å—Ä–µ–¥–Ω—è—è; —á–∏—Å—Ç—ã–π Docker/Compose, ssh, –º–∏–Ω–∏–º—É–º k8s‚Äë–º–∞–≥–∏–∏.                                                 | –í—ã—Å–æ–∫–∞—è; –Ω—É–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –≤ –≥–æ–ª–æ–≤–µ GitLab Agent/ArgoCD, namespaces, Helm, sync‚Äë–ø–æ–ª–∏—Ç–∏–∫–∏. |
| **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ–∫—É—â–µ–π Dev‚Äë—Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏** | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ: Dev‚Äë–ª–æ–∫–∞–ª–∫–∞ –∏ Dev‚ÄëCI —Å–º–æ—Ç—Ä—è—Ç –Ω–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ compose‚Äë—Å—Ç–µ–∫ –∏ —Ç–µ –∂–µ Make‚Äë–∫–æ–º–∞–Ω–¥—ã.                 | –°—Ä–µ–¥–Ω–µ–µ: Dev –≤ CI –±—É–¥–µ—Ç —É–∂–µ k8s‚Äë—Å—Ç–µ–Ω–¥–æ–º, –∞ –ª–æ–∫–∞–ª–∫–∞ ‚Äî –ø–æ‚Äë–ø—Ä–µ–∂–Ω–µ–º—É Docker/Compose.      |
| **–ü—É—Ç—å –∫ Stage/Prod k8s**               | –ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—Ç–æ—Ä–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è (–¥–æ–±–∞–≤–∏—Ç—å k8s‚Äëdeploy stage, GitOps –∏ —Ç.–¥.), –Ω–æ build/tag‚Äë—Å—Ç—Ä–∞—Ç–µ–≥–∏—è —É–∂–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞. | –ü—É—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω —Å—Ä–∞–∑—É (dev/stage/prod –∫–∞–∫ —Ä–∞–∑–Ω—ã–µ namespaces/Helm values).                |
| **–ì–∏–±–∫–æ—Å—Ç—å –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤**          | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è: –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –º–µ–Ω—è—Ç—å compose‚Äë—Ñ–∞–π–ª, –ø–æ—Ä—Ç—ã, –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã.                               | –ù–∏–∂–Ω—è—è: –≤—Å—ë —á–µ—Ä–µ–∑ manifests/Helm, –Ω—É–∂–µ–Ω –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–π –ø—Ä–æ—Ü–µ—Å—Å.                        |
| **–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏**                  | –û–¥–∏–Ω host, –ø—Ä–æ—Å—Ç–æ–π —Å—Ç–µ–∫ ‚Äî –ª–µ–≥–∫–æ –æ—Ç–ª–∞–¥–∏—Ç—å, –Ω–æ –Ω—É–∂–Ω–∞ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ—Å—Ç—å —Å —Ä–µ—Å—É—Ä—Å–∞–º–∏ –Ω–∞ eywa1.                          | –ë–æ–ª–µ–µ "–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è" –º–æ–¥–µ–ª—å –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –ø—Ä–æ–¥–∞–∫—à–Ω–∞, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ –¥–µ–±–∞–∂–∏—Ç—å.           |
| **Over‚Äëengineering —Ä–∏—Å–∫ –¥–ª—è Dev‚ÄëMVP**   | –ù–∏–∑–∫–∏–π.                                                                                                        | –í—ã—Å–æ–∫–∏–π (–ø–æ —Å—É—Ç–∏, —ç—Ç–æ —É–∂–µ –ø–æ—á—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π Prod‚Äë—É—Ä–æ–≤–µ–Ω—å).                              |

**–ú–æ–π –≤—ã–±–æ—Ä –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç–∞–¥–∏–∏:**\
üëâ **–°—Ü–µ–Ω–∞—Ä–∏–π 1 ‚Äî Runner –Ω–∞ eywa1 + Docker Compose Dev‚Äëdeploy.**\
–û–Ω –¥–∞—ë—Ç –±—ã—Å—Ç—Ä—ã–π win, –Ω–µ –ª–æ–º–∞–µ—Ç –±—É–¥—É—â–∏–π GitOps‚Äë–ø–ª–∞–Ω –∏ –Ω–∞–ø—Ä—è–º—É—é –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ —Ç–≤–æ–π —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –æ–ø—ã—Ç "–ª–æ–∫–∞–ª–∫–∏ —á–µ—Ä–µ–∑ Docker" –∏ `make up-local`. ÓàÄfileciteÓàÇturn3file12ÓàÇturn3file19ÓàÅ

---

## 5. –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è (Runner –Ω–∞ eywa1 + Compose)

### 5.1. –ì–¥–µ –∂–∏–≤—ë—Ç Runner

- **Host:** `eywa1` (Ubuntu, 8GB, —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–¥ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫).

- **–¢–∏–ø executora:**
  - –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã ‚Äî **shell executor**:
    - jobs –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ shell‚Äë–∫–æ–º–∞–Ω–¥—ã;
    - –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π Docker (—Ç–æ –∂–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, —á—Ç–æ –∏ –ª–æ–∫–∞–ª—å–Ω–æ).
  - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ ‚Äî Docker executor, –Ω–æ —Ç–æ–≥–¥–∞ –ø—Ä–∏–¥—ë—Ç—Å—è –∞–∫–∫—É—Ä–∞—Ç–Ω–µ–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ docker.sock.

- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è runner‚Äô–∞:
  - –≤ GitLab UI ‚Üí Settings ‚Üí CI/CD ‚Üí Runners ‚Üí Registration token,
  - –Ω–∞ `eywa1`: `gitlab-runner register` (url: `https://git.telex.global`, executor: shell, tags: `eywa1,docker,dotnet,node`). ÓàÄfileciteÓàÇturn3file4ÓàÇturn3file14ÓàÅ

### 5.2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `.gitlab-ci.yml` (Dev‚ÄëMVP)

–ù–∞–±—Ä–æ—Å–æ–∫ (–±–µ–∑ –≤—Å–µ—Ö –¥–µ—Ç–∞–ª–µ–π):

```yaml
stages:
  - spec
  - build
  - test
  - deploy-dev

variables:
  DOCKER_DRIVER: overlay2
  IMAGE_TAG: "$CI_COMMIT_SHORT_SHA"
  IMAGE_TAG_LATEST: "dev-$CI_COMMIT_REF_SLUG"

# 1) Spec validation
spec:validate:
  stage: spec
  tags: [eywa1]
  script:
    - make validate-specs
    - make generate-sdks

# 2) Build backend images
build:backend:
  stage: build
  tags: [eywa1]
  script:
    - docker login -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD" "$CI_REGISTRY"
    - ./ops/scripts/build-backend-images.sh "$IMAGE_TAG" "$IMAGE_TAG_LATEST"

# 3) Build frontend images
build:frontend:
  stage: build
  tags: [eywa1]
  script:
    - docker login -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD" "$CI_REGISTRY"
    - ./ops/scripts/build-frontend-images.sh "$IMAGE_TAG" "$IMAGE_TAG_LATEST"

# 4) Tests (unit/integration)
test:backend:
  stage: test
  tags: [eywa1]
  script:
    - make test-backend # –∏–ª–∏ —è–≤–Ω—ã–µ dotnet test –∫–æ–º–∞–Ω–¥—ã
  artifacts:
    reports:
      junit: tests/**/TestResults/*.xml

test:frontend:
  stage: test
  tags: [eywa1]
  script:
    - make test-frontend # npm test –≤ –Ω—É–∂–Ω—ã—Ö apps
  artifacts:
    paths:
      - apps/**/coverage/

# 5) e2e (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è MR/develop)
test:e2e:
  stage: test
  tags: [eywa1]
  script:
    - make e2e
  artifacts:
    paths:
      - tests/e2e-playwright/playwright-report/
  only:
    - develop
    - merge_requests

# 6) Deploy Dev (Compose)
deploy:dev:
  stage: deploy-dev
  tags: [eywa1]
  script:
    - ./ops/scripts/deploy-dev-compose.sh "$IMAGE_TAG" "$IMAGE_TAG_LATEST"
  environment:
    name: dev
    url: http://<dev-host-or-ip>
  when: on_success
  only:
    - develop
```

–ò–¥–µ—è:

- –í—Å–µ build/test –∫—Ä—É—Ç—è—Ç—Å—è –Ω–∞ eywa1 —Å —É–∂–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ (`make`‚Äëtargets + —Å–∫—Ä–∏–ø—Ç—ã).
- `build-*-images.sh` –¥–æ–ª–∂–Ω—ã:
  - –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞/—Ñ—Ä–æ–Ω—Ç–∞:
    - `docker buildx build ... --tag $CI_REGISTRY_IMAGE/service-x:$IMAGE_TAG ... --push` (—à–∞–±–ª–æ–Ω —Å–º. –≤ `c2p_ops` `.build_frontend_template`). ÓàÄfileciteÓàÇturn3file7ÓàÇturn2file19ÓàÅ

### 5.3. Deploy Dev —á–µ—Ä–µ–∑ Docker Compose

–°–∫—Ä–∏–ø—Ç `ops/scripts/deploy-dev-compose.sh` –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫ (–ø—Å–µ–≤–¥–æ):

```bash
#!/usr/bin/env bash
set -euo pipefail

IMAGE_TAG="$1"
IMAGE_TAG_LATEST="$2"

# 1. –û–±–Ω–æ–≤–∏—Ç—å .env –∏–ª–∏ docker-compose.override.yml, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–µ–≥–∏
#   (–ª–∏–±–æ —Ç–µ–≥–∏ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –∏–∑ CI_COMMIT_SHORT_SHA, –∏ compose —É–∂–µ –∑–Ω–∞–µ—Ç —Ñ–æ—Ä–º—É–ª—É)

export COMPOSE_PROFILES=dev

docker compose pull    # —Å—Ç—è–Ω–µ—Ç –Ω–æ–≤—ã–µ —Ç–µ–≥–∏ –∏–∑ GitLab Registry
docker compose up -d   # –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å—ã

# 2. Healthcheck API gateway
for i in {1..30}; do
  if curl -s -o /dev/null -w "%{http_code}" http://localhost:55000/health | grep -q "200"; then
    echo "API gateway is healthy"
    exit 0
  fi
  echo "Waiting for API gateway..."
  sleep 5
done

echo "API gateway healthcheck failed"
exit 1
```

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:

- –µ—Å–ª–∏ stack –Ω–µ –ø–æ–¥–Ω—è–ª—Å—è ‚Äî job `deploy:dev` –ø–∞–¥–∞–µ—Ç, dev‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º;
- –º–æ–∂–Ω–æ –≤ —Ç–æ–º –∂–µ —Å–∫—Ä–∏–ø—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å healthcheck —Ñ—Ä–æ–Ω—Ç–æ–≤ (`/health`, `/` 200 –∏ —Ç.–¥.).

### 5.4. Tagging & environments

–î–ª—è Dev‚Äë–ø–∞–π–ø–ª–∞–π–Ω–∞:

- –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–≥: `service-x:$CI_COMMIT_SHORT_SHA`;
- "—É–¥–æ–±–Ω—ã–π" —Ç–µ–≥: `service-x:dev-$CI_COMMIT_REF_SLUG` –∏/–∏–ª–∏ `service-x:develop-latest` –¥–ª—è –≤–µ—Ç–∫–∏ `develop`. ÓàÄciteÓàÇturn0search10ÓàÇturn0search17ÓàÅ

–î–ª—è –±—É–¥—É—â–µ–≥–æ Stage/Prod:

- –¥–ª—è `main`:
  - —Å—Ç—Ä–æ–∏—Ç—å –æ–±—Ä–∞–∑—ã —Å —Ç–µ–≥–∞–º–∏ `service-x:stage-$CI_COMMIT_SHORT_SHA` –∏ `service-x:stage-latest`.
- –¥–ª—è `v1.2.3`:
  - `service-x:v1.2.3`, `service-x:prod-latest`.
- deploy‚Äëjobs:
  - `deploy:stage` (auto),
  - `deploy:prod` (manual, —Å approval).

### 5.5. –í–∞—Ä–∏–∞–Ω—Ç—ã approval‚Äëflow‚Äô–æ–≤ (Dev/Stage/Prod)

–°–¥–µ–ª–∞—é –∫–æ—Ä–æ—Ç–∫—É—é —Ç–∞–±–ª–∏—á–∫—É:

| –í–∞—Ä–∏–∞–Ω—Ç                                    | Dev                     | Stage                          | Prod                                             | –ü–ª—é—Å—ã                                                        | –ú–∏–Ω—É—Å—ã                                           |
| ------------------------------------------ | ----------------------- | ------------------------------ | ------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------ |
| **A. "Dev auto, Prod manual"**             | –ê–≤—Ç–æ‚Äëdeploy —Å `develop` | –ú–æ–∂–Ω–æ –Ω–µ –¥–µ–ª–∞—Ç—å –Ω–∞ –ø–µ—Ä–≤–æ–º —à–∞–≥–µ | Manual job –Ω–∞ —Ç–µ–≥–∏ `v*`, —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º approval | –ë—ã—Å—Ç—Ä–æ, –ø–æ–Ω—è—Ç–Ω–æ, Dev –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–π                           | Stage –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, Prod –Ω–∞–ø—Ä—è–º—É—é –∏–∑ develop/main |
| **B. "Dev auto, Stage auto, Prod manual"** | –ê–≤—Ç–æ `develop`          | –ê–≤—Ç–æ `main`                    | Manual –Ω–∞ —Ç–µ–≥–∏ `v*`                              | Stage —Å–ª—É–∂–∏—Ç –±—É—Ñ–µ—Ä–æ–º –ø–µ—Ä–µ–¥ Prod                              | –ß—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ, –Ω—É–∂–Ω–æ –µ—â—ë –æ–¥–Ω–æ –æ–∫—Ä—É–∂–µ–Ω–∏–µ           |
| **C. "–í—Å–µ —Ç–æ–ª—å–∫–æ –ø–æ –∫–Ω–æ–ø–∫–µ"**              | Manual job `deploy:dev` | Manual `deploy:stage`          | Manual `deploy:prod`                             | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –º–æ–∂–Ω–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫ —Ä–µ–ª–∏–∑–Ω—ã–º —Ü–µ—Ä–µ–º–æ–Ω–∏—è–º | –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ, –º–∞–ª–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏               |

–î–ª—è —Ç–≤–æ–µ–π —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏ —è –±—ã –ø—Ä–µ–¥–ª–æ–∂–∏–ª:

- **Dev:** –∞–≤—Ç–æ‚Äëdeploy —Å `develop` (–≤–∞—Ä–∏–∞–Ω—Ç A/B).
- **Stage/Prod:** –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å, –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ TODO –≤ `ops/gitlab-ci.md` –∏ –≤–∫–ª—é—á–∏—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∞–∑–µ.

---

## 6. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (K8s + GitOps) ‚Äî –∫–∞–∫ –æ–Ω –≤–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è

–°—É–ø–µ—Ä –∫—Ä–∞—Ç–∫–æ, —á—Ç–æ–±—ã –±—ã–ª–æ –ø–æ–Ω—è—Ç–Ω–æ "–∫ —á–µ–º—É –ø—Ä–∏–¥—ë–º":

- Runner –≤ k8s (–∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ –≤ `ops/gitlab-runner.md`). ÓàÄfileciteÓàÇturn2file7ÓàÇturn3file14ÓàÅ
- Build‚Äëjobs –æ—Å—Ç–∞—é—Ç—Å—è —Ç–µ–º–∏ –∂–µ (Docker‚Äë–æ–±—Ä–∞–∑—ã –≤ GitLab Registry).
- Deploy‚Äëjobs:
  - –ª–∏–±–æ —á–µ—Ä–µ–∑ ArgoCD (`argocd app sync ...`),
  - –ª–∏–±–æ —á–µ—Ä–µ–∑ GitLab Agent (pull‚Äëbased GitOps, –∞–≥–µ–Ω—Ç —Ç—è–Ω–µ—Ç manifests –∏–∑ `ops/gitops/gitlab-agent/manifests`). ÓàÄfileciteÓàÇturn2file6ÓàÇturn2file12ÓàÅ
- Environments:
  - dev/stage/prod –∫–∞–∫ —Ä–∞–∑–Ω—ã–µ namespaces/Helm‚Äëvalues (—É–∂–µ –Ω–∞–º–µ—á–µ–Ω–æ –≤ `c2p_ops`). ÓàÄfileciteÓàÇturn2file6ÓàÇturn3file5ÓàÅ

–≠—Ç–æ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º** —Å —Ç–µ–º, —á—Ç–æ –º—ã –¥–µ–ª–∞–µ–º —Å–µ–π—á–∞—Å, –ø–æ—Ç–æ–º—É —á—Ç–æ:

- —Å—Ö–µ–º–∞ —Ç–µ–≥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –±—É–¥–µ—Ç —Ç–æ–π –∂–µ;
- —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ç–∞–¥–∏–∏ —Ç–µ –∂–µ;
- –ø—Ä–æ—Å—Ç–æ `deploy-dev` –Ω–∞ compose –∑–∞–º–µ–Ω–∏—Ç—Å—è –Ω–∞ "–æ–±–Ω–æ–≤–∏—Ç—å Helm values + GitOps sync" –¥–ª—è k8s‚Äëdev.

---

## 7. Mermaid‚Äë–¥–∏–∞–≥—Ä–∞–º–º—ã

### 7.1. Sequence: Dev‚Äëpipeline (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π)

```mermaid
sequenceDiagram
    participant Dev as Developer
    participant GL as GitLab
    participant R as GitLab Runner (eywa1)
    participant REG as GitLab Registry
    participant DEV as Dev Docker Host (eywa1/host)
    participant TG as Telegram

    Dev->>GL: git push (branch: develop)
    GL->>R: Trigger CI pipeline (.gitlab-ci.yml)
    
    rect rgb(230,230,255)
    R->>R: spec:validate (make validate-specs, generate-sdks)
    R->>R: build:backend/frontend (docker buildx, tags by SHA)
    R->>REG: docker push images
    R->>R: test:backend (dotnet test)
    R->>R: test:frontend (npm test)
    R->>R: test:e2e (make e2e)
    end

    alt All tests passed
      R->>DEV: deploy-dev (docker compose pull & up -d)
      DEV->>R: /health 200 OK
      R->>GL: mark pipeline success
    else Some job failed
      R->>GL: mark pipeline failed
      GL-->>TG: send failure notification
    end
```

### 7.2. Flowchart —Å subgraph‚Äô–∞–º–∏: CI vs Runtime

```mermaid
flowchart LR
  subgraph CI["GitLab CI on eywa1"]
    A[git push / MR] --> B[spec:validate<br/>make validate-specs<br/>make generate-sdks]
    B --> C[build:backend/frontend<br/>docker buildx & push]
    C --> D[test:backend/frontend<br/>dotnet test, npm test]
    D --> E[test:e2e<br/>make e2e]
    E --> F{all green?}
  end

  subgraph Runtime["Runtime Environments"]
    G[Dev Docker Host<br/>docker compose stack]
    H[(GitLab Container Registry)]
  end

  C --> H
  F -- yes --> I[deploy:dev<br/>deploy-dev-compose.sh]
  I --> G
  G --> J[/health 200?/] --> K{OK?}
  K -- yes --> L[Pipeline success]
  K -- no --> M[Fail deploy-dev job]

  F -- no --> M
```

### 7.3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) High‚Äëlevel "Clone/Subgraph" –¥–ª—è –±—É–¥—É—â–µ–≥–æ GitOps

```mermaid
flowchart TD
  subgraph Build["Build & Test (shared)"]
    BT1[validate-specs] --> BT2[build images (Docker)]
    BT2 --> BT3[unit/integration tests]
    BT3 --> BT4[e2e tests]
  end

  subgraph Dev["Scenario 1: Dev via Compose"]
    BT4 --> D1[deploy-dev-compose.sh]
    D1 --> D2[Dev host docker compose]
  end

  subgraph StageProd["Scenario 2: Stage/Prod via GitOps"]
    BT4 --> SP1[update Helm values/manifests]
    SP1 --> SP2[GitOps engine (GitLab Agent/ArgoCD)]
    SP2 --> SP3[Kubernetes cluster namespaces]
  end
```

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –º–æ–∂–µ–º:

- –∫–æ–Ω–∫—Ä–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å `.gitlab-ci.yml` (–ø—Ä—è–º–æ —Å job‚Äô–∞–º–∏ –ø–æ–¥ —Ç–≤–æ–∏ `Makefile`‚Äë—Ü–µ–ª–∏ –∏ —Ç–µ–∫—É—â–∏–µ Dockerfile‚Äô—ã),
- –∏–ª–∏ —Ä–∞–∑–ª–æ–∂–∏—Ç—å kick‚Äëoff –∑–∞–¥–∞—á–∏ –ø–æ —Ä–æ–ª—è–º (DevOps / backend / frontend) –∏ —Å–¥–µ–ª–∞—Ç—å mini‚Äëroadmap "2 –¥–Ω—è —Ä–∞–±–æ—Ç—ã".


#### You:
<time datetime="2025-11-26T10:58:38.246Z" title="26/11/2025, 13:58:38">13:58</time>


–û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —è –ø—Ä–∏–∫—Ä–µ–ø–∏–ª —Ç–µ–±–µ —Ç–µ–∫—É—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç, –≥–¥–µ —è –æ–±—â–∞—é—Å—å –ø–æ –ø–æ–≤–æ–¥—É –ª–æ–∫–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, —Ç–∞–º prompt –∏ output. –í —Ü–µ–ª–æ–º –ø–æ–ª–µ–∑–Ω–æ –µ–≥–æ —Ç–µ–±–µ –ø—Ä–æ—á–∏—Ç–∞—Ç—å, —á—Ç–æ–±—ã —Ç—ã –ø–æ–Ω–∏–º–∞–ª.

–Ø —Ç–µ–±–µ –¥–∞–∂–µ —Å–∫–æ–ø–∏—Ä—É—é —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –∏–∑ –¥—Ä—É–≥–æ–≥–æ —Ç—Ä–µ–¥–∞, –≥–¥–µ —è –µ—â–µ –¥–∞—é –µ–º—É –∫–∞–∫ –ø—Ä–∏–º–µ—Ä –Ω–∞—à —Ç—Ä–µ–¥, —á—Ç–æ–±—ã –æ–Ω —Ç–∞–º –ª–æ–∫–∞–ª—å–Ω–æ —É—á–µ–ª, –∞ —Ç–µ–±–µ –¥–∞—é —Ç–æ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π —Ç—Ä–µ–¥, —á—Ç–æ–±—ã —Ç—ã —É—á–µ–ª –≤—Å–µ ICD. –ö–∞–∫-—Ç–æ —Ç–∞–∫. –ù–∞–¥–µ—é—Å—å, —Å–∏–ª—å–Ω—ã—Ö —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –Ω–µ –±—É–¥–µ—Ç.

–ù—É –∏ –¥–∞–ª—å—à–µ —Å–º–æ—Ç—Ä–∏ –º–æ–∏ –º—ã—Å–ª–∏ –∏ —Å–ª–µ–¥—É–µ—Ç prompt.

```transcript-from-other
–¢–∞–∫, –∫–∞–∫ –≤–∏–¥–∏—à—å, –º—ã –¥–æ–¥–µ–ª–∞–ª–∏, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫–∏–µ-—Ç–æ –º–æ–º–µ–Ω—Ç—ã. –ù–µ —Ö–æ—á–µ—Ç—Å—è –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –¥–æ–¥–µ–ª–∞–Ω–∏–µ —É—Ö–æ–¥–∏—Ç—å. –û—Å—Ç–∞—ë—Ç—Å—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –ø—Ä–µ–∂–Ω–µ–π: —á—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ —É –Ω–∞—Å –±—É–¥–µ—Ç make up local, make —Ç–∞–º –∑–∞—Ä–∞–Ω–µ–µ, –∏ –≤ —ç—Ç–æ—Ç up local –∑–∞—à–∏—Ç—å –≤—Å—ë-–≤—Å—ë.

–Ø –¥—É–º–∞—é, —á—Ç–æ –Ω–µ—Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å email-—Å–µ—Ä–≤–∏—Å local, —á—Ç–æ–±—ã –Ω–æ–≤—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø—Ä–æ—Ö–æ–¥–∏—Ç—å. –≠—Ç–æ —É–∂–µ –∫–∞–∫-—Ç–æ, –Ω–∞–≤–µ—Ä–Ω–æ–µ, –±–æ–ª—å—à–µ –≤–æ–∑–Ω–∏, –∏ –∫–∞–∫–æ–π-—Ç–æ —Ç–∞–º –≥–¥–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, –¥–æ–º–µ–Ω—ã ‚Äî –≤—Å—ë-—Ç–∞–∫–∏ —ç—Ç–æ local. –ù–æ –≤ —Ç–æ –∂–µ –≤—Ä–µ–º—è, –∫–∞–∫ –≤–æ—Ç —Ö–æ—Ä–æ—à–æ —Å–∫–∞–∑–∞–Ω–æ –≤ —Ç—Ä–µ–¥–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –ø–ª–æ–¥–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏, –Ω—É–∂–Ω–æ —Ç–∞–∫ —É—á–µ—Å—Ç—å, —á—Ç–æ–±—ã –¥–µ—Ñ, —É—Å–ª–æ–≤–Ω–æ –≥–æ–≤–æ—Ä—è, –Ω–æ—Ä–º–∞–ª—å–Ω–æ –±—ã–ª–æ. –ü–ª–æ–¥–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ ‚Äî –º–Ω–µ —ç—Ç–∞ –ø—Ä—è–º —Ñ—Ä–∞–∑–∞ –ø–æ–Ω—Ä–∞–≤–∏–ª–∞—Å—å.

2.2 ‚Äî repeatability, –¥–∞. –í–æ—Ç. –ß—Ç–æ –µ—â—ë –¥–æ–±–∞–≤–∏—Ç—å? Observability, G-unit coverage. –í–æ–æ–±—â–µ, –∫—Å—Ç–∞—Ç–∏, —Ç–∞–º –µ—â—ë —á—Ç–æ–±—ã GSDoki –ø–∏—Å–∞–ª–∏—Å—å –ø–æ –∫–∞–∫–∏–º-—Ç–æ ‚Äî —è –∑–∞–±—ã–ª —É–∂–µ, –≥–¥–µ –º—ã —Ö–æ—Ç–µ–ª–∏ –≤ –∫–∞–∫–∏—Ö-—Ç–æ –∫–ª—é—á–µ–≤—ã—Ö –≤–µ—â–∞—Ö, –¥–∞. –ù–æ —ç—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —ç—Ç–æ —Å–µ–π—á–∞—Å –≤–æ–æ–±—â–µ –º—ã—Å–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ. –ú–æ–∂–µ—Ç, —ç—Ç–æ –∑–∞—Ü–µ–ø–∫–∞ —Ç–µ–±—è –Ω–∞ –∫–∞–∫–∏–µ-—Ç–æ –≤–µ—â–∏, –¥–∞, —Å–ø–æ–¥–≤–∏–≥–Ω–µ—Ç.
```
–Ø –≤–æ—Ç –¥–∞–ª—å—à–µ —á–∏—Ç–∞—é —Ç–æ, —á—Ç–æ –Ω–∞–ø–∏—Å–∞–ª –∞–≥–µ–Ω—Ç –ø–æ —Ç—Ä–µ–¥—É CI/CD. –í —Ü–µ–ª–æ–º –º–Ω–µ –º–Ω–æ–≥–æ –Ω—Ä–∞–≤–∏—Ç—Å—è. –ù–µ –º–æ–≥—É —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –≤—Å—ë, –ø–æ—Ç–æ–º—É —á—Ç–æ —è –≤—Å—ë –Ω–µ –≤–ø–∏—Ç–∞–ª –µ—â—ë —Ç–∞–∫ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ö–æ—Ä–æ—à–æ. –ù–æ —É —Ç–µ–±—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–µ—â–∏.
–¢–∞–∫, –∫–∞–∫ –≤–∏–¥–∏—à—å, –º—ã –¥–æ–¥–µ–ª–∞–ª–∏, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫–∏–µ-—Ç–æ –º–æ–º–µ–Ω—Ç—ã. –ù–µ —Ö–æ—á–µ—Ç—Å—è –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –¥–æ–¥–µ–ª–∞–Ω–∏–µ —É—Ö–æ–¥–∏—Ç—å. –û—Å—Ç–∞—ë—Ç—Å—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –ø—Ä–µ–∂–Ω–µ–π: —á—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ —É –Ω–∞—Å –±—É–¥–µ—Ç make up local, make —Ç–∞–º –∑–∞—Ä–∞–Ω–µ–µ, –∏ –≤ —ç—Ç–æ—Ç up local –∑–∞—à–∏—Ç—å –≤—Å—ë-–≤—Å—ë.

–Ø –¥—É–º–∞—é, —á—Ç–æ –Ω–µ—Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å email-—Å–µ—Ä–≤–∏—Å local, —á—Ç–æ–±—ã –Ω–æ–≤—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø—Ä–æ—Ö–æ–¥–∏—Ç—å. –≠—Ç–æ —É–∂–µ –∫–∞–∫-—Ç–æ, –Ω–∞–≤–µ—Ä–Ω–æ–µ, –±–æ–ª—å—à–µ –≤–æ–∑–Ω–∏, –∏ –∫–∞–∫–æ–π-—Ç–æ —Ç–∞–º –≥–¥–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, –¥–æ–º–µ–Ω—ã ‚Äî –≤—Å—ë-—Ç–∞–∫–∏ —ç—Ç–æ local. –ù–æ –≤ —Ç–æ –∂–µ –≤—Ä–µ–º—è, –∫–∞–∫ –≤–æ—Ç —Ö–æ—Ä–æ—à–æ —Å–∫–∞–∑–∞–Ω–æ –≤ —Ç—Ä–µ–¥–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –ø–ª–æ–¥–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏, –Ω—É–∂–Ω–æ —Ç–∞–∫ —É—á–µ—Å—Ç—å, —á—Ç–æ–±—ã –¥–µ—Ñ, —É—Å–ª–æ–≤–Ω–æ –≥–æ–≤–æ—Ä—è, –Ω–æ—Ä–º–∞–ª—å–Ω–æ –±—ã–ª–æ. –ü–ª–æ–¥–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ ‚Äî –º–Ω–µ —ç—Ç–∞ –ø—Ä—è–º —Ñ—Ä–∞–∑–∞ –ø–æ–Ω—Ä–∞–≤–∏–ª–∞—Å—å.

2.2 ‚Äî repeatability, –¥–∞. –í–æ—Ç. –ß—Ç–æ –µ—â—ë –¥–æ–±–∞–≤–∏—Ç—å? Observability, G-unit coverage. –í–æ–æ–±—â–µ, –∫—Å—Ç–∞—Ç–∏, —Ç–∞–º –µ—â—ë —á—Ç–æ–±—ã GSDoki –ø–∏—Å–∞–ª–∏—Å—å –ø–æ –∫–∞–∫–∏–º-—Ç–æ ‚Äî —è –∑–∞–±—ã–ª —É–∂–µ, –≥–¥–µ –º—ã —Ö–æ—Ç–µ–ª–∏ –≤ –∫–∞–∫–∏—Ö-—Ç–æ –∫–ª—é—á–µ–≤—ã—Ö –≤–µ—â–∞—Ö, –¥–∞. –ù–æ —ç—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —ç—Ç–æ —Å–µ–π—á–∞—Å –≤–æ–æ–±—â–µ –º—ã—Å–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ. –ú–æ–∂–µ—Ç, —ç—Ç–æ –∑–∞—Ü–µ–ø–∫–∞ —Ç–µ–±—è –Ω–∞ –∫–∞–∫–∏–µ-—Ç–æ –≤–µ—â–∏, –¥–∞, —Å–ø–æ–¥–≤–∏–≥–Ω–µ—Ç.

–Ø –≤–æ—Ç –¥–∞–ª—å—à–µ —á–∏—Ç–∞—é —Ç–æ, —á—Ç–æ –Ω–∞–ø–∏—Å–∞–ª –∞–≥–µ–Ω—Ç –ø–æ —Ç—Ä–µ–¥—É CI/CD. –í —Ü–µ–ª–æ–º –º–Ω–µ –º–Ω–æ–≥–æ –Ω—Ä–∞–≤–∏—Ç—Å—è. –ù–µ –º–æ–≥—É —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –≤—Å—ë, –ø–æ—Ç–æ–º—É —á—Ç–æ —è –≤—Å—ë –Ω–µ –≤–ø–∏—Ç–∞–ª –µ—â—ë —Ç–∞–∫ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ö–æ—Ä–æ—à–æ. –ù–æ —É —Ç–µ–±—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–µ—â–∏.

<ORACLE_GENERAL_RECOMMENDATIONS>
- –°–ª–µ–¥—É–π –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∫–∞–Ω–≤–µ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É. –ë—É–¥—å –æ–±—ä–µ–∫—Ç–∏–≤–µ–Ω –∏ –Ω–µ–ø—Ä–µ–¥–≤–∑—è—Ç.
- –ù–µ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–π—Å—è –ø–æ–¥ –º–æ–∏ –ø—Ä–æ—à–ª—ã–µ –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç Spec/DoD.
- –ï—Å–ª–∏ –Ω–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç —Å–æ —Å—Ç–∞—Ä—ã–º–∏ ‚Äî —è–≤–Ω–æ —É–∫–∞–∂–∏ –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.
- –ù–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –ø–æ–¥ ¬´—Å–¥–µ–ª–∞—Ç—å –ø–æ–º–µ–Ω—å—à–µ¬ª, –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –ø–æ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ JTBD.
</ORACLE_GENERAL_RECOMMENDATIONS>

First Attentionally read current session and increments, evaluate with a previous DoD, Kickoff tasks by phases and score X-of-100 and estimate final session iteration/step 0...100% completeness and accuracy of a agentID=`uid`, partAgentID=`partUid` model `Codex-Gpt5.1-Max-Highest`


Then based on new insights and undersanding listen me attentively.
–í—ã–¥–µ–ª–∏ –∏–∑ –º–æ–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—Å–µ requirements, corrections, suggestions from my voice instructions and corrections.

<AGENT_AND_ORACLE_SESSION_STATE>
SESSION_STATE (machine-readable):
- branch: $BRANCH
- JTBD:
  - J1: $J1_TITLE
    - status: in_progress
    - DoD:
      - [x] $DoD_1
      - [ ] $DoD_2 e2e (if applicable Playwright scenarios green)
      - [ ] $DoD_3 tasks/NX-05..08-*.md –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- Tests:
  - ...
  - ...
- Blockers:
  - none
</AGENT_AND_ORACLE_SESSION_STATE>

# Common Agentic Problems which should be must take into account in the prompt-copypaste to the Agent.
- [ ] QA. –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É
  - [ ] e2e tests (if applicable to our case)
  - [ ] e2e playwright test (if applicable to our case)
  - [ ] –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ –Ω–∞ mock (if applicable to our case)
  - [ ] –Ω–µ –¥–µ–ª–∞—Ç—å fallback
  - [ ] –æ–±–æ–∑–Ω–∞—á–∞—Ç—å –ø—Ä–∞–≤–¥—É. –ë–ª–æ–∫–µ—Ä—ã –∏–ª–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ—Ç–æ–º—É —á—Ç–æ  ...
- [ ] Git workflow.
  - [ ] commit
    - [ ] increment in one time one commit - not all together. –ü–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞–±—ã–≤–∞–µ—Ç –∫–æ–º–∏—Ç–∏—Ç—å. 
      - [ ] –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∫–æ–º–∏—Ç–∏—Ç—å —Ç–∞–∫ —á—Ç–æ–±—ã –±—ã–ª–æ {code-change} + {code-test} + {test-artefacts/output} + {update-docs-DoD-Kickoff-checkboxes} –≤ –æ–¥–Ω–æ–º –∫–æ–º–º–∏—Ç–µ —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å. –ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–∏–ª service/rout + add e2e test + store playwright-screenshot of success work.

<AGENT_WORKFLOW_CONTRACT>
# Workflow Contract
1. PLAN
   - –°–æ–ø–æ—Å—Ç–∞–≤—å —Ç–µ–∫—É—â–∏–π state —Å JTBD Contract –∏ DoD.
   - –°—Ñ–æ—Ä–º–∏—Ä—É–π –º–∏–Ω–∏-–ø–ª–∞–Ω –Ω–∞ 1‚Äì3 —Ü–∏–∫–ª–∞ –≤–∏–¥–∞:
     {code-change} ‚Üí {tests} ‚Üí {docs/DoD-update} ‚Üí {commit}.

2. EXECUTE
   - –í—ã–ø–æ–ª–Ω–∏ –∫–æ–¥-–∏–∑–º–µ–Ω–µ–Ω–∏—è.
   - –ó–∞–ø—É—Å—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã (unit/integration/smoke/e2e/Playwright).
   - –û–±–Ω–æ–≤–∏ docs/tasks/DoD.

3. AUDIT SELF
   - –Ø–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—å —á–µ–∫-–ª–∏—Å—Ç ¬´Common Agentic Problems¬ª.
   - –û—Ç–º–µ—Ç—å, –∫–∞–∫–∏–µ –ø—É–Ω–∫—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –∞ –∫–∞–∫–∏–µ –Ω–µ—Ç (—Å –ø—Ä–∏—á–∏–Ω–∞–º–∏).

4. CONTINUE OR STOP
   - –ï—Å–ª–∏ DoD –Ω–µ –∑–∞–∫—Ä—ã—Ç –∏ –Ω–µ—Ç –±–ª–æ–∫–µ—Ä–æ–≤ ‚Äî –ø–æ–≤—Ç–æ—Ä–∏ LOOP –±–µ–∑ –æ–±—â–µ–Ω–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.
   - –ï—Å–ª–∏ DoD –∑–∞–∫—Ä—ã—Ç –∏–ª–∏ –Ω–∞–π–¥–µ–Ω –±–ª–æ–∫–µ—Ä ‚Äî –≤–µ—Ä–Ω–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –æ—Ç—á—ë—Ç + —Å–ø–∏—Å–æ–∫ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤.
</AGENT_WORKFLOW_CONTRACT>

<AGENT_TIME_EXECUTION_CONSTRAINTS>
Session Constraints:
- –ú–∏–Ω–∏–º—É–º:
  - [ ] 2 –ø–æ–ª–Ω—ã—Ö WORKFLOW LOOP –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ JTBD
  - [ ] —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (unit/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ) + –æ–¥–∏–Ω e2e/Playwright (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- –ú–∞–∫—Å–∏–º—É–º:
  - [ ] –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è, –∫–æ–≥–¥–∞:
        - [ ] –≤—Å–µ –ø—É–Ω–∫—Ç—ã DoD –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ò–õ–ò
        - [ ] –≤—Å—Ç—Ä–µ—á–µ–Ω –∂—ë—Å—Ç–∫–∏–π –±–ª–æ–∫–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–ª—å–∑—è –æ–±–æ–π—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–µ–π/–∑–∞–≥–ª—É—à–∫–æ–π.
–¢–µ–±–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å —Ä–∞–±–æ—Ç—É —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ:
- ¬´–∏–∑–º–µ–Ω–µ–Ω–∏–π –º–Ω–æ–≥–æ¬ª,
- ¬´–Ω–∞–¥–æ —É—Ç–æ—á–Ω–∏—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω—Ä–∞–≤–∏—Ç—Å—è –ª–∏ —Ç–∞–∫–æ–π UI/—Ç–µ–∫—Å—Ç¬ª.
–í —ç—Ç–∏—Ö —Å–ª—É—á–∞—è—Ö: —Å–¥–µ–ª–∞–π —Ä–∞–∑—É–º–Ω—ã–π –≤—ã–±–æ—Ä, —è–≤–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π –¥–æ–ø—É—â–µ–Ω–∏—è –≤ —Ç–∞—Å–∫–µ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.
</AGENT_TIME_EXECUTION_CONSTRAINTS>

<AGENT_JTBD_CONTRACT>
# JTBD Contract
## Jobs
- J1: –ü–æ—á–∏–Ω–∏—Ç—å  $tasks NX-05..08 –Ω–∞ –≤–µ—Ç–∫–µ $branch
- J2: –û–±–µ—Å–ø–µ—á–∏—Ç—å e2e success path 
- J3: –û–±–Ω–æ–≤–∏—Ç—å $tasks —Å —Ñ–∏–Ω–∞–ª—å–Ω—ã–º DoD
## Definition of Done (DoD)
- [ ] –î–ª—è –∫–∞–∂–¥–æ–≥–æ J* –µ—Å—Ç—å –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω –∫–æ–º–º–∏—Ç —Ñ–æ—Ä–º–∞—Ç–∞:
      {code-change} + {code-test} + {test-artifacts/output} + {update-docs-DoD-Kickoff-checkboxes}
- [ ] –í—Å–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —É—Å–ø–µ—à–Ω–æ —Å—Ç–∞—Ä—Ç—É—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –ü—Ä–æ–≥–Ω–∞–Ω—ã –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã:
      - [ ] unit/integration tests
      - [ ] e2e / Playwright (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- [ ] tasks/NX-05..08-*.md –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å:
      - [ ] —Ä–µ–∞–ª—å–Ω—ã–º–∏ URL
      - [ ] –∫–æ–º–∞–Ω–¥–∞–º–∏ —Ç–µ—Å—Ç–æ–≤
      - [ ] —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (—Å–∫—Ä–∏–Ω—à–æ—Ç—ã, –ª–æ–≥–∏)
</AGENT_JTBD_CONTRACT>

<AGENT_FINAL_SELF_CHECK>
–í –∫–∞–∂–¥—ã–π AGENT_PROMPT –≤–∫–ª—é—á–∞–π –±–ª–æ–∫:
>
> ```markdown
> FINAL SELF-CHECK (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏)
>
> - [ ] QA: –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏ (unit/integration/smoke/e2e/Playwright, –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
> - [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–≥–Ω–∞–Ω—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö/–ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã—Ö –∫ —Ä–µ–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã—Ö
> - [ ] –ü–∞–¥–µ–Ω–∏—è/—Ä–µ–≥—Ä–µ—Å—Å–∏–∏ —è–≤–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã, –Ω–µ—Ç ¬´—Ç–∏—Ö–æ–≥–æ¬ª —Ñ–æ–ª–ª–±—ç–∫–∞
> - [ ] –ß–µ—Å—Ç–Ω–æ –æ–ø–∏—Å–∞–Ω—ã –±–ª–æ–∫–µ—Ä—ã ("–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ ‚Ä¶")
> - [ ] Git: —Å–¥–µ–ª–∞–Ω(—ã) –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π(–µ) commit(—ã) —Ñ–æ—Ä–º–∞—Ç–∞:
>       {code-change} + {code-test} + {test-artifacts/output} + {update-docs-DoD-Kickoff-checkboxes}
> ```
>
> –ê–≥–µ–Ω—Ç –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ —Å—á–∏—Ç–∞—Ç—å —Ä–∞–±–æ—Ç—É –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π, –ø–æ–∫–∞ –Ω–µ –ø—Ä–æ–π–¥—ë—Ç —ç—Ç–æ—Ç —á–µ–∫‚Äë–ª–∏—Å—Ç.
</AGENT_FINAL_SELF_CHECK>


<AGENT_AUTONOMY_CONTRACT>
AUTONOMY & CONTINUITY REQUIREMENTS
- [ ] –†–∞–±–æ—Ç–∞—Ç—å –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è DoD –ø–æ –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º JTBD
- [ ] –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ –ø–µ—Ä–≤—ã—Ö –º–∏–∫—Ä–æ—Ñ–∏–∫—Å–æ–≤
- [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–Ω–∏–º—É–º 1 –ø–æ–ª–Ω—ã–π LOOP {code-change + tests + docs/DoD + commit} –Ω–∞ –∫–∞–∂–¥—ã–π JTBD
- [ ] –ó–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¢–û–õ–¨–ö–û –ø—Ä–∏ –∂—ë—Å—Ç–∫–∏—Ö –±–ª–æ–∫–µ—Ä–∞—Ö
- [ ] –í—Å–µ –¥–æ–ø—É—â–µ–Ω–∏—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤ tasks/ –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–º ASSUMPTIONS –±–ª–æ–∫–µ
Autonomy Level: 3 (max)
Level 0 ‚Äì —Ç–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑, –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.
Level 1 ‚Äì –º–µ–ª–∫–∏–µ –ø—Ä–∞–≤–∫–∏, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –∏ –±–µ–∑ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤.
Level 2 ‚Äì –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ + —Ç–µ—Å—Ç—ã, –Ω–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã/–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.
Level 3 ‚Äì –≤—Å—ë –≤—ã—à–µ + –ø—Ä–∞–≤–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å/–æ–±–Ω–æ–≤–ª—è—Ç—å SPEC DIFF, docs, –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.
</AGENT_AUTONOMY_CONTRACT>

<AGENT_SESSION_STOP_CONDITIONS>
SESSION_STOP_CONDITIONS
–ó–∞–≤–µ—Ä—à–∞—Ç—å —Å–µ—Å—Å–∏—é –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
- [ ] DoD –∑–∞–∫—Ä—ã—Ç (–≤—Å–µ —á–µ–∫‚Äë–±–æ–∫—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã), –ò–õ–ò
- [ ] –ï—Å—Ç—å –∂—ë—Å—Ç–∫–∏–π –±–ª–æ–∫–µ—Ä, —á—ë—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–Ω—ã–π —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ –ø–æ –æ–±—Ö–æ–¥—É.
</AGENT_SESSION_STOP_CONDITIONS>

<ORACLE_OUTPUT_CONTRACT>
# OUTPUT FORMAT
1. REQUIREMENTS_FROM_VOICE
   - explicit_requirements: [...]
   - implicit_requirements: [...]
   - corrections: [...]
   - suggestions: [...]
2. UPDATED_JTBD_CONTRACT
   - jobs: [...]
   - DoD: [...]
   - constraints: [...]
3. AGENT_PROMPT (for Codex-Cli)
   - <<<–≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–ø–∏–ø–∞—Å—Ç–∞ –≤ –∞–≥–µ–Ω—Ç–∞>>>
4. NEXT_STEPS_FOR_HUMAN
   - [ ] —á—Ç–æ —Ç—ã –∫–∞–∫ orchestrator –¥–æ–ª–∂–µ–Ω —Å–¥–µ–ª–∞—Ç—å –¥–æ –∑–∞–ø—É—Å–∫–∞ –∞–≥–µ–Ω—Ç–∞
   - [ ] —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ
   - ${MERMAID_DIAGRAM}
p.s.
${MERMAID_DIAGRAM}=‚úÖ Visual elements (mermaid/tables) when helpful across sections. üìä Mermaid diagrams can span multiple H1 sections when showing process flow. Syntax MUST rules never use `(` `)` and other specsymbols it breaks memaidjs syntax.
</ORACLE_OUTPUT_CONTRACT>

#### ChatGPT:
<time datetime="2025-11-26T11:22:54.214Z" title="26/11/2025, 14:22:54">14:22</time>

0. SESSION\_EVAL

–ü–æ —Ç–µ–∫—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é `eywa1-p-cfa-w17` –∏ –ø—Ä–æ—à–ª–æ–º—É –æ—Ç—á—ë—Ç—É Oracle –ø–æ —ç—Ç–æ–π –∂–µ —Å–µ—Å—Å–∏–∏:ÓàÄfileciteÓàÇturn4file5ÓàÇturn3file18ÓàÅ

**–°—Ä–µ–∑ –ø–æ JTBD J1‚ÄìJ3 –¥–ª—è –∞–≥–µ–Ω—Ç–∞ `Codex-Gpt5.1-Max-Highest` (agentID=`uid`, partAgentID=`partUid`)**

| Job / Phase                                    | –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã–ª–æ –±—ã—Ç—å                                                                                                       | –ß—Ç–æ –ø–æ —Ñ–∞–∫—Ç—É                                                                                                                                                                                                                                                            | –û—Ü–µ–Ω–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
| ---------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------- |
| **Phase0 ‚Äì sync**                              | –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å agentID/partUid, –ø–µ—Ä–µ–π—Ç–∏ –≤ –Ω—É–∂–Ω—ã–π —Ä–µ–ø–æ, –≤—ã—Ä–æ–≤–Ω—è—Ç—å –≤–µ—Ç–∫—É, –æ—Å–º–æ—Ç—Ä–µ—Ç—å Makefile/compose/tests                       | –í—Å—ë —ç—Ç–æ —Å–¥–µ–ª–∞–Ω–æ: —Ä–µ–ø–æ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–Ω—è—Ç—ã, –≤–µ—Ç–∫–∞ `develop`, –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç–µ–∫–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω                                                                                                                                                                                  | **100**           |
| **Phase1 ‚Äì J1 up-local**                       | –û–¥–∏–Ω `make up-local` –Ω–∞ eywa1 –ø–æ–¥–Ω–∏–º–∞–µ—Ç back+front –≤ Docker, health –∏ Swagger –¥–∞—é—Ç 200 –±–µ–∑ –∫–æ—Å—Ç—ã–ª–µ–π                        | `make up-local` —Ä–µ–∞–ª—å–Ω–æ –ø–æ–¥–Ω–∏–º–∞–µ—Ç —Å—Ç–µ–∫, Swagger –∏ health 200, —Ñ—Ä–æ–Ω—Ç—ã –∏ Postgres –Ω–∞ –æ–∂–∏–¥–∞–µ–º—ã—Ö –ø–æ—Ä—Ç–∞—Ö. –ï—Å—Ç—å –∫–æ—Å—Ç—ã–ª—å `MIGRATE_ON_STARTUP=false` –¥–ª—è settlement –∏ –Ω–µ—Ç docker watch —Ä–µ–∂–∏–º–∞; `make seed` –∏ `make e2e` –Ω–µ –≤–ø–∞—è–Ω—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–ª–æ—É.ÓàÄciteÓàÇturn4file5ÓàÇturn4file11ÓàÅ | **\~85 –∏–∑ 100**   |
| **Phase2 ‚Äì J2 validate-specs / generate-sdks** | –ü–æ—á–∏–Ω–∏—Ç—å OpenAPI –æ—à–∏–±–∫–∏, –¥–æ–±–∏—Ç—å—Å—è –∑–µ–ª—ë–Ω—ã—Ö `make validate-specs` –∏ `make generate-sdks` –Ω–∞ eywa1                            | OpenAPI –ø–æ–¥–ø—Ä–∞–≤–ª–µ–Ω, spectral –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫, Java –Ω–∞ `~/.local/java`, `make generate-sdks` —É—Å–ø–µ—à–µ–Ω, TS SDK –æ–±–Ω–æ–≤–ª—ë–Ω.ÓàÄciteÓàÇturn3file18ÓàÇturn4file2ÓàÅ                                                                                                              | **\~100 –∏–∑ 100**  |
| **Phase3 ‚Äì J3 e2e / Playwright**               | `make e2e` –≥–æ–Ω—è–µ—Ç meaningful Playwright —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ—Ç–∏–≤ localhost, key flows –∑–µ–ª—ë–Ω—ã–µ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏–≤–µ–¥–µ–Ω–∞ –∫ –ø–æ—Ä—è–¥–∫—É | Playwright —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, swagger-—Å–ø–µ–∫–∏ –≥–æ–Ω—è—é—Ç—Å—è –∏ —á–∞—Å—Ç—å e2e —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ `make e2e` –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω, `make seed` –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω, Keycloak realm `ois` –∏ SSL‚Äë–ø–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ eywa1 –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—é—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É, –±–∏–∑–Ω–µ—Å‚Äë—Ñ–ª–æ—É —Ç–µ—Å—Ç—ã –∫—Ä–∞—Å–Ω—ã–µ.ÓàÄciteÓàÇturn3file7ÓàÇturn4file3ÓàÅ    | **\~45 –∏–∑ 100**   |

**–ò—Ç–æ–≥–æ –ø–æ —Å–µ—Å—Å–∏–∏ –∞–≥–µ–Ω—Ç–∞ `uid/partUid`:**

- **completeness\_score ‚âà 70 –∏–∑ 100**
  - J1 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã—Ç, –Ω–æ —Å –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–∞–º–∏ –∏ –±–µ–∑ watch‚Äë—Ä–µ–∂–∏–º–∞.
  - J2 –ø–æ DoD –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–º.
  - J3 –≤—ã–ø–æ–ª–Ω–µ–Ω –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞–ø–æ–ª–æ–≤–∏–Ω—É.ÓàÄciteÓàÇturn3file7ÓàÇturn3file18ÓàÅ
- **accuracy\_score ‚âà 90 –∏–∑ 100**
  - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —à–∞–≥–∏ –≤ –ª–æ–≥–∞—Ö –≤ —Ü–µ–ª–æ–º —Å–æ–≤–ø–∞–¥–∞—é—Ç, –Ω–æ –µ—Å—Ç—å –∑–∞–≤—ã—à–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ—Å—Ç—å e2e –∏ –ª–æ–∫–∞–ª–∫–∏ –Ω–∞ eywa1.ÓàÄciteÓàÇturn3file5ÓàÇturn4file2ÓàÅ
- **iteration\_progress\_pct ‚âà 70‚ÄØ%**
  - –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ `make up-local ‚Üí make validate-specs ‚Üí make generate-sdks` –Ω–∞ eywa1 —É–∂–µ –∂–∏–≤–∞—è, –Ω–æ —á–∞—Å—Ç—å ¬´one chain¬ª (`make seed`, `make e2e`, Keycloak, watch‚Äëmode) –Ω–µ –¥–æ–≤–µ–¥–µ–Ω–∞ –¥–æ DoD.ÓàÄciteÓàÇturn4file11ÓàÇturn4file2ÓàÅ

---

## 1. REQUIREMENTS\_FROM\_VOICE

### 1.1 explicit\_requirements

1. **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –ª–æ–∫–∞–ª–∫–∏**
   - –õ–æ–∫–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–µ–º –∂–µ: `make up-local`, –∫–æ—Ç–æ—Ä—ã–π ¬´–∑–∞—à–∏–≤–∞–µ—Ç –≤—Å—ë-–≤—Å—ë¬ª –≤ –ø–æ–¥–Ω—è—Ç–∏–µ —Å—Ç–µ–∫–∞ (infra + services + apps).ÓàÄciteÓàÇturn3file5ÓàÇturn4file5ÓàÅ
2. **–ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å email‚Äë—Å–µ—Ä–≤–∏—Å –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ**
   - –õ–æ–∫–∞–ª—å–Ω–æ **–Ω–µ –Ω—É–∂–Ω–æ** –ø–æ–¥–Ω–∏–º–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π email‚Äë—Å–µ—Ä–≤–∏—Å —Ç–æ–ª—å–∫–æ —Ä–∞–¥–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: —ç—Ç–æ –ª–∏—à–Ω—è—è –≤–æ–∑–Ω—è —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏/–¥–æ–º–µ–Ω–∞–º–∏ –¥–ª—è purely local —Å—Ü–µ–Ω–∞—Ä–∏—è.
3. **–ò–∑–±–µ–∂–∞—Ç—å ‚Äú–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–µ–π‚Äù dev vs local**
   - –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —É–ø—Ä–æ—â–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–µ–∑ email), dev –∏ local –Ω–µ –¥–æ–ª–∂–Ω—ã –∂–∏—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –≤—Å–µ–ª–µ–Ω–Ω—ã—Ö:
     - –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–ª–æ—É –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏;
     - –æ—Ç–ª–∏—á–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —è–≤–Ω–æ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã.
4. **–£—Å–∏–ª–∏—Ç—å –∞–∫—Ü–µ–Ω—Ç –Ω–∞ repeatability**
   - –ü—Ä—è–º–æ–π —Ä–µ—Ñ–µ—Ä–µ–Ω—Å –∫ ¬´2.2 ‚Äî repeatability¬ª: –ª–æ–∫–∞–ª—å–Ω—ã–π –∏ dev —Ñ–ª–æ—É –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–º–∏ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º–∏, –∞ –Ω–µ –Ω–∞–±–æ—Ä–æ–º —Ä—É—á–Ω—ã—Ö —à–∞–º–∞–Ω—Å—Ç–≤.
5. **–ó–∞–∫—Ä–µ–ø–∏—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ Observability**
   - –ù—É–∂–Ω–∞ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –¥–∞–∂–µ –≤ dev/local –∫–æ–Ω—Ç—É—Ä–µ: –ª–æ–≥–∏, –±–∞–∑–æ–≤—ã–µ health/–º–µ—Ç—Ä–∏–∫–∏, –ø–æ–Ω—è—Ç–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–≤–∞–ª–æ–≤ e2e.
6. **–í–≤–µ—Å—Ç–∏ —Ñ–æ–∫—É—Å –Ω–∞ G-unit coverage**
   - –û—Ç –∞–≥–µ–Ω—Ç–∞ –∂–¥—ë—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ e2e, –Ω–æ –∏ –±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å unit/integration coverage (–Ω–∞–∑–≤–∞–Ω–æ –∫–∞–∫ ¬´G-unit coverage¬ª) –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
7. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è GSDoki**
   - –ö–æ–µ-–≥–¥–µ ¬´GSDoki¬ª (–∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è/—à–∞–±–ª–æ–Ω—ã –¥–æ–∫–æ–≤) –ø–æ –∫–ª—é—á–µ–≤—ã–º —à–∞–≥–∞–º: nice-to-have, –∞ –Ω–µ –∂—ë—Å—Ç–∫–∏–π DoD, –Ω–æ –∞–≥–µ–Ω—Ç –º–æ–∂–µ—Ç —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏.

### 1.2 implicit\_requirements

1. **–ù–µ —É—Ö–æ–¥–∏—Ç—å –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥**
   - –ù—É–∂–µ–Ω **—á—ë—Ç–∫–∏–π DoD –∏ —Å—Ç–æ–ø‚Äë–∫—Ä–∏—Ç–µ—Ä–∏–π** –¥–ª—è –ª–æ–∫–∞–ª–∫–∏ –∏ CI, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ ¬´–¥–æ–¥–µ–ª—ã–≤–∞–Ω–∏—è —Ä–∞–¥–∏ –¥–æ–¥–µ–ª—ã–≤–∞–Ω–∏—è¬ª.
2. **One chain –æ—Ç –ª–æ–∫–∞–ª–∫–∏ –¥–æ CI**
   - –õ–æ–≥–∏–∫–∞ –ø—Ä–µ–∂–Ω—è—è: –æ–¥–Ω–∞ —Å–≤—è–∑–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –∫–æ–º–∞–Ω–¥\
     `make up-local ‚Üí make validate-specs ‚Üí make generate-sdks ‚Üí make seed ‚Üí make e2e ‚Üí CI pipeline`,\
     –≥–¥–µ CI –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ.ÓàÄciteÓàÇturn4file2ÓàÇturn5file4ÓàÅ
3. **CI/CD‚Äë–ø–ª–∞–Ω –∞–≥–µ–Ω—Ç–∞ –∏–∑ —Å–æ—Å–µ–¥–Ω–µ–≥–æ —Ç—Ä–µ–¥–∞ —Ç—ã –ø—Ä–∏–Ω–∏–º–∞–µ—à—å ‚Äú–≤ —Ü–µ–ª–æ–º‚Äù, –Ω–æ –Ω–µ –±–µ–∑–¥—É–º–Ω–æ**
   - –ù–æ–≤—ã–π –∞–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–¥–µ–∏ –∏–∑ —É–∂–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–≥–æ CI/CD‚Äë–ø–ª–∞–Ω–∞, –Ω–æ –Ω–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Äî DoD –∏ JTBD —Ç–µ–∫—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏.ÓàÄciteÓàÇturn5file4ÓàÅ
4. **–ï–¥–∏–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–ª—è Mac –∏ eywa1**
   - –î–∞–∂–µ –µ—Å–ª–∏ —Å—Ç–µ–∫ –Ω–∞ Mac –∏ eywa1 –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –∫—Ä–∏—Ç–µ—Ä–∏–∏ ¬´one button¬ª, e2e –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—â–∏–º–∏.

### 1.3 corrections

1. **–õ–æ–∫–∞–ª—å–Ω–∞—è –ø–æ—á—Ç–∞ –±–æ–ª—å—à–µ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞**
   - –ü—Ä–µ–¥—ã–¥—É—â–µ–µ –ø–æ–¥—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ ¬´–¥–∞–≤–∞–π—Ç–µ —ç–º—É–ª–∏—Ä—É–µ–º –≤—Å—ë, –≤–∫–ª—é—á–∞—è email¬ª –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è: email‚Äë—Å–µ—Ä–≤–∏—Å –ª–æ–∫–∞–ª—å–Ω–æ **–Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ MVP**.
2. **‚Äú–ü–ª–æ–¥–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏‚Äù ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–Ω—Ç–∏‚Äë–ø–∞—Ç—Ç–µ—Ä–Ω**
   - –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: dev/stage/prod –∏ –ª–æ–∫–∞–ª–∫–∞ –Ω–µ –¥–æ–ª–∂–Ω—ã —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ —Ä–∞—Å—Ö–æ–¥–∏—Ç—å—Å—è; –ª—é–±—ã–µ –æ—Ç–ª–∏—á–∏—è –æ—Ç dev –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∏ —è–≤–Ω–æ –æ–ø–∏—Å–∞–Ω–Ω—ã–º–∏.
3. **–î–æ–±–∞–≤–∏—Ç—å QA‚Äë–∞–∫—Ü–µ–Ω—Ç—ã –ø–æ–≤–µ—Ä—Ö —É–∂–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ AGENT\_WORKFLOW\_CONTRACT**
   - –ü–æ–≤–µ—Ä—Ö —Ç–µ–∫—É—â–µ–≥–æ Workflow‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –Ω—É–∂–Ω–æ —è–≤–Ω–µ–µ –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å repeatability, observability –∏ coverage –∫–∞–∫ —Ä–µ–∞–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏ –∞–≥–µ–Ω—Ç–∞, –∞ –Ω–µ ¬´–¥–µ–∫–æ—Ä¬ª.ÓàÄciteÓàÇturn4file2ÓàÇturn5file9ÓàÅ

### 1.4 suggestions

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–¥–µ—é ‚Äú–æ–¥–Ω–∞ —Ü–µ–ø–æ—á–∫–∞ –∫–æ–º–∞–Ω–¥‚Äù –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è CI/CD –¥–∏–∑–∞–π–Ω–∞**
   - –í—Å—ë, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç –≤ –ª–æ–∫–∞–ª–∫–µ (`make up-local`, `make validate-specs`, `make generate-sdks`, `make seed`, `make e2e`) –¥–æ–ª–∂–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –æ—Å–Ω–æ–≤–æ–π –¥–ª—è GitLab pipeline.
2. **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∏ coverage –∫–∞–∫ ‚Äú–¥–æ–ø. —Å–ª–æ–π‚Äù, –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏–π MVP**
   - –°–Ω–∞—á–∞–ª–∞ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–π happy‚Äëpath, –ø–æ—Ç–æ–º –Ω–∞—Ä–∞—Å—Ç–∏—Ç—å Observability –∏ coverage, –Ω–æ –Ω–µ –∑–∞–±—ã—Ç—å –ø—Ä–æ –Ω–∏—Ö –≤ DoD.
3. **GSDoki –∫–∞–∫ –ª—ë–≥–∫–∏–π —Å–ø–æ—Å–æ–± —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏**
   - –í –º–µ—Å—Ç–∞—Ö, –≥–¥–µ –º–µ–Ω—è–µ—Ç—Å—è –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç—å (Keycloak, e2e structure, make‚Äë—Ü–µ–ø–æ—á–∫–∞), –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ GSDoki/notes –≤–º–µ—Å—Ç–æ —Ç–æ–ª—Å—Ç—ã—Ö markdown‚Äë–ø—Ä–æ—Å—Ç—ã–Ω–µ–π.

---

## 2. UPDATED\_JTBD\_CONTRACT

–ù–∞ –±–∞–∑–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –Ω–æ–≤—ã—Ö –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –æ–±–Ω–æ–≤–ª—è—é –∫–æ–Ω—Ç—Ä–∞–∫—Ç **–±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ NX‚Äë05..08 –∫–∞–∫ –∫ —Ç–µ–∫—É—â–µ–º—É —Ñ–æ–∫—É—Å—É** (NX –æ—Å—Ç–∞—é—Ç—Å—è downstream):

### 2.1 jobs

- **J1: One-button –ª–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫ –±–µ–∑ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–µ–π**
  - `make up-local` –Ω–∞ Mac –∏ eywa1 –ø–æ–¥–Ω–∏–º–∞–µ—Ç –≤—Å—ë –Ω—É–∂–Ω–æ–µ –¥–ª—è dev/demo (back+front, Keycloak, –ë–î) –≤ Docker.
  - –û—Ç–ª–∏—á–∏—è dev/local –º–∏–Ω–∏–º–∞–ª—å–Ω—ã, email‚Äë—Å–µ—Ä–≤–∏—Å –ª–æ–∫–∞–ª—å–Ω–æ –æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ.
- **J2: –ü–æ–≤—Ç–æ—Ä—è–µ–º—ã–µ —Ç–µ—Å—Ç—ã –∏ –ø–æ–∫—Ä—ã—Ç–∏–µ**
  - –¶–µ–ø–æ—á–∫–∞ `make validate-specs ‚Üí make generate-sdks ‚Üí make seed ‚Üí make e2e` —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ eywa1 –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ.
  - –ï—Å—Ç—å –±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å unit/integration/e2e coverage –ø–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–º —Å–µ—Ä–≤–∏—Å–∞–º (G-unit coverage).
- **J3: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ CI/CD, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–º—É –Ω–∞ —ç—Ç–æ–π —Ü–µ–ø–æ—á–∫–µ**
  - –û–ø—Ä–µ–¥–µ–ª—ë–Ω –∏ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–∫–µ–ª–µ—Ç GitLab pipeline, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–ª–æ—É, –∞ –Ω–µ –∂–∏–≤—ë—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –∂–∏–∑–Ω—å—é.
  - –î–ª—è –∫–ª—é—á–µ–≤—ã—Ö —à–∞–≥–æ–≤ (up-local, e2e, Keycloak, seed) –µ—Å—Ç—å GSDoki/notes –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –¥–ª—è QA.

### 2.2 DoD

**DoD J1 ‚Äì –ª–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫**

- [ ] `make up-local` –Ω–∞ eywa1 –∏ Mac –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫.
- [ ] `docker ps` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∂–∏–≤—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã back+front, Keycloak, Postgres.
- [ ] Health –∏ Swagger –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º —Å–µ—Ä–≤–∏—Å–∞–º –¥–∞—é—Ç 200 **–±–µ–∑ —Å–∫—Ä—ã—Ç—ã—Ö –∫–æ—Å—Ç—ã–ª–µ–π**, –∏–ª–∏ –∫–æ—Å—Ç—ã–ª–∏ —á–µ—Å—Ç–Ω–æ –æ–ø–∏—Å–∞–Ω—ã.ÓàÄciteÓàÇturn4file5ÓàÇturn4file11ÓàÅ
- [ ] –û—Ç–ª–∏—á–∏—è dev/local (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ email‚Äë—Å–µ—Ä–≤–∏—Å–∞) —è–≤–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (docs/tasks/DoD).

**DoD J2 ‚Äì repeatability –∏ coverage**

- [ ] `make validate-specs` –∏ `make generate-sdks` –∑–µ–ª—ë–Ω—ã–µ –Ω–∞ eywa1.
- [ ] `make seed` –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–µ–∑ –ø–∞–¥–µ–Ω–∏–π –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ e2e‚Äë—Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.ÓàÄciteÓàÇturn4file11ÓàÅ
- [ ] `make e2e` –≥–æ–Ω—è–µ—Ç –º–∏–Ω–∏–º—É–º: swagger‚Äëavailability, issuer dashboard, backoffice KYC –ø—Ä–æ—Ç–∏–≤ **localhost**, –∞ –Ω–µ cfa1.ÓàÄciteÓàÇturn4file8ÓàÇturn4file16ÓàÅ
- [ ] –ï—Å—Ç—å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∏–Ω–∏–º—É–º unit/integration coverage –ø–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–º —Å–µ—Ä–≤–∏—Å–∞–º –∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ü–µ–ª–µ–≤–æ–π KPI (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ –º–µ–Ω–µ–µ N —Ç–µ—Å—Ç–æ–≤ –∏–ª–∏ smoke‚Äë–Ω–∞–±–æ—Ä).

**DoD J3 ‚Äì –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ CI/CD**

- [ ] –ï—Å—Ç—å –æ–ø–∏—Å–∞–Ω–Ω—ã–π –∏ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π `.gitlab-ci.yml` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π pipeline, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ —Ü–µ–ª–∏ `make *`, —á—Ç–æ –∏ –ª–æ–∫–∞–ª—å–Ω–æ.ÓàÄciteÓàÇturn5file5ÓàÇturn5file8ÓàÅ
- [ ] –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã GitLab job‚Äô—ã –¥–ª—è spec‚Äëlint, unit/integration –∏ Playwright.
- [ ] GSDoki/mini‚Äëdocs –æ–ø–∏—Å—ã–≤–∞—é—Ç:
  - –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ;
  - –∫–∞–∫–∏–µ –æ—Ç–ª–∏—á–∏—è dev/local;
  - —á—Ç–æ –∏–º–µ–Ω–Ω–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å GitLab pipeline.

### 2.3 constraints

- **–ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π email‚Äë—Å–µ—Ä–≤–∏—Å –≤ —ç—Ç—É –∏—Ç–µ—Ä–∞—Ü–∏—é**
  - –ü–æ—á—Ç–∞ –≤ local ‚Äî –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ç—É—Ä–∞; –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è, –±—É–¥–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π JTBD.
- **–ù–µ –ø–ª–æ–¥–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏**
  - dev, eywa1 –∏ Mac‚Äë–ª–æ–∫–∞–ª–∫–∞ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –æ–¥–Ω—É –ª–æ–≥–∏—á–µ—Å–∫—É—é —Ü–µ–ø–æ—á–∫—É –∫–æ–º–∞–Ω–¥ –∏ –±–ª–∏–∑–∫–∏–µ env; –ª—é–±—ã–µ –æ—Ç–ª–∏—á–∏—è ‚Äî –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è.
- **AGENT\_WORKFLOW\_CONTRACT –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**
  - `{code-change} ‚Üí {tests} ‚Üí {docs/DoD-update} ‚Üí {commit}`, –º–∏–Ω–∏–º—É–º 2 —Ü–∏–∫–ª–∞ –∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–æ–≥–æ–Ω e2e, –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ.
- **–ê–≤—Ç–æ–Ω–æ–º–∏—è Level 3**
  - –ú–æ–∂–Ω–æ —Ç—Ä–æ–≥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, Makefile, CI‚Äë–∫–æ–Ω—Ñ–∏–≥–∏ –∏ –ª—ë–≥–∫–∏–µ docs; –Ω–µ–ª—å–∑—è –º–æ–ª—á–∞ –º–µ–Ω—è—Ç—å –±–∏–∑–Ω–µ—Å‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã.ÓàÄciteÓàÇturn5file18ÓàÇturn5file10ÓàÅ

---

## 3. AGENT\_PROMPT (for Codex-Cli)

### <<<–≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–ø–∏–ø–∞—Å—Ç–∞ –≤ –∞–≥–µ–Ω—Ç–∞>>>

````text
You are "Codex-Gpt5.1-Max-Highest", a Senior .NET plus Next.js plus Playwright plus DevOps engineer and my "digital twin" for the OIS-CFA monorepo.

You are running as a Codex CLI agent on host eywa1, Ubuntu, 8 GB RAM, user "user".
Treat this host as a local developer machine, not as production.

agentID: uid
partAgentID: partUid   # last 4 chars of agentID, used only for tagging logs and commits.

REPO AND CONTEXT

- Repo root on this host:

  cd /home/user/__Repositories/yury-customer/prj_Cifra-rwa-exachange-assets/repositories/customer-gitlab/ois-cfa

- Monorepo layout:
  - apps  portal-issuer, portal-investor, backoffice, api-gateway
  - services  .NET backend services
  - packages  contracts, SDKs
  - tests  backend tests and Playwright tests
  - docker-compose*.yml, top-level Makefile

GLOBAL GOALS FOR THIS SESSION

- J1  One-button local stack on eywa1 and Mac via make up-local without parallel realities.
- J2  Repeatable spec, SDK, seed and e2e chain with basic unit and integration coverage.
- J3  Prepare a GitLab CI skeleton that reuses the same make targets and flows as local.

Do not work on NX-05..08 backend business methods in this session. You may read their task docs as context only.

0. GLOBAL RULES

- Autonomy level 3
  - Work in short loops without asking the user, unless you hit a hard blocker  no creds, no docker access, no sudo.
  - You are allowed to refactor tests, Makefile targets and CI configs, and to create or update small SPEC DIFF and docs.
  - You are not allowed to rebase or rewrite main branches develop, develop2, codex/fix-cfa1-regressions or silently change business contracts.

- Workflow loop  AGENT_WORKFLOW_CONTRACT

  {code-change} ‚Üí {tests} ‚Üí {docs/DoD-update} ‚Üí {commit}

  For this session you must do at least two full loops for the main JTBD and run at least one e2e or Playwright test if applicable.

- Every meaningful change must include
  - Code changes  backend or frontend or configs or Makefile.
  - Tests  unit or integration or e2e updated or added.
  - Docs  tasks or small notes or GSDoki updated to reflect reality.
  - One focused commit bundling everything.

- Spec-first
  - OpenAPI and AsyncAPI in packages/contracts are canonical.
  - Fix specs so that make validate-specs and make generate-sdks pass.
  - If you must change semantics, add a short SPEC DIFF note instead of silently changing contracts.

- No pm2 on eywa1
  - Do not use pm2 here. Frontends on eywa1 must run inside Docker via compose.
  - pm2 is allowed only on Mac, which is out of scope for this session.

- No local email service in this iteration
  - Do not add or wire a local email service just to support new registration flows.
  - If some flows depend on email, mark them as partially supported on local and document it.

- No parallel realities
  - Make dev and local flows as close as possible.
  - Any difference  such as missing email or different URL  must be clearly documented as an exception.

- Hard constraints on this host
  - Assume no sudo for docker or system packages. If something requires sudo, treat it as a blocking infra issue and document it instead of hacking around.

1. JTBD FOR THIS SESSION

J1  One-button local stack

- Target state
  - make up-local on eywa1 starts all required backend containers and frontend portals via docker compose.
  - Health and Swagger for key services return 200 without hidden hacks, or hacks like MIGRATE_ON_STARTUP false are clearly documented as temporary.
  - Differences between dev and local  for example email not running locally  are recorded in a single DoD or note.

J2  Repeatability and coverage

- Target state
  - make validate-specs and make generate-sdks are green on eywa1.
  - make seed runs successfully and is used in e2e flows.
  - make e2e runs a minimal but meaningful subset of Playwright tests against localhost  swagger availability, issuer dashboard, backoffice kyc.
  - There is a minimal but real unit and integration test coverage for critical services  for example issuance or registry or identity.

J3  CI and docs preparation

- Target state
  - A skeleton GitLab CI config is drafted that calls the same make targets as local.
  - There are short GSDoki or notes that describe how to run local flow and which differences exist between dev and local.
  - Steps and commands for tests are recorded so that human and CI can reuse them.

2. PHASED PLAN  DO NOT SKIP PHASES

Phase0  Identify and sync

- Run status and confirm agentID and partAgentID.
- From repo root:
  - git fetch origin
  - git checkout develop
  - git pull --ff-only
  - git status -sb
- Ensure working tree is clean or that you fully understand existing changes.
- Quickly inspect:
  - Makefile  targets up-local, seed, validate-specs, generate-sdks, e2e
  - docker-compose.yml and docker-compose.services.yml and docker-compose.apps.yml and .env
  - tests and e2e Playwright directories
- Note any clear differences between Mac local and eywa1 ports, env and missing services.

Phase1  J1  make up-local

- Loop1  Docker connectivity
  - Run docker ps and docker compose version or docker-compose version.
  - If you get permission denied to docker.sock, treat this as a hard blocker. Document the exact error, required fix and the fact that you cannot fix it without sudo.
- Loop2  Wire make up-local
  - Inspect Makefile target up-local and related compose files.
  - Ensure:
    - backend services start in a dev friendly mode with Swagger where needed;
    - optional services do not break the entire compose run.
  - For frontends, ensure docker-compose.apps.yml defines containers for portal-issuer, portal-investor, backoffice with dev friendly commands where possible.
  - Do not introduce pm2 into these flows.
- Loop3  Verify ports and health
  - Run make up-local.
  - If it fails, capture docker compose ps and logs for failing services.
  - If it succeeds, check docker ps and curl health and Swagger endpoints.
  - Document any temporary hacks  for example MIGRATE_ON_STARTUP false for settlement.

Phase2  J2  validate-specs, generate-sdks, seed, e2e chain

- Loop1  Specs and SDKs
  - Run make validate-specs until it exits with zero.
  - Fix OpenAPI or AsyncAPI issues as needed, keeping semantics honest.
  - Then run make generate-sdks using user level Java, without docker based workarounds.
- Loop2  Seed
  - Inspect make seed target.
  - Make it work on eywa1, using the running local stack from make up-local.
  - Verify that seeded data makes key flows usable in Playwright.
- Loop3  Minimal e2e chain
  - Ensure Playwright is installed  npx playwright install if needed.
  - From tests or e2e folder, run a single swagger availability spec against localhost gateway.
  - Then wire make e2e so that from repo root it runs a minimal subset of specs against localhost, not cfa1.
  - Fix or document failures honestly.

Phase3  J3  prepare CI and docs

- Identify the minimal GitLab CI jobs that should exactly mirror:
  - make validate-specs
  - make generate-sdks
  - make seed
  - make e2e
- Draft or update .gitlab-ci.yml or a separate ci stub file with these jobs, using GitLab runner on a dedicated VDS when available.
- Add short notes or GSDoki that describe:
  - local command chain people should run;
  - which differences exist between local and dev;
  - how CI is supposed to call the same chain.

3. COMMON AGENTIC PROBLEMS  ALWAYS SELF CHECK

- QA
  - Do not rely only on eyeballing. Run real tests on real or close to real data when applicable.
  - Prefer running e2e or Playwright where they exist instead of mocks.
  - Do not introduce silent fallbacks after failures.

- Git workflow
  - Commit small, focused changes.
  - Try to keep each commit as {code-change} plus {code-test} plus {test-artifacts or output} plus {docs or DoD update}.
  - Do not accumulate a huge pile of uncommitted changes.

4. SESSION CONSTRAINTS

- Minimum
  - At least two full workflow loops for the main JTBD.
  - At least one test run  unit or integration or e2e  if applicable.
- Maximum
  - Stop only when:
    - DoD for J1 and J2 is reached and J3 has at least a drafted CI skeleton, or
    - you hit a hard blocker that cannot be bypassed by local simulation or stub.

5. FINAL SELF-CHECK  DO NOT SKIP

Use this block literally at the end of your session:

```markdown
FINAL SELF-CHECK (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏)

- [ ] QA: –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏ (unit/integration/smoke/e2e/Playwright, –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–≥–Ω–∞–Ω—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö/–ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã—Ö –∫ —Ä–µ–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü–∞–¥–µ–Ω–∏—è/—Ä–µ–≥—Ä–µ—Å—Å–∏–∏ —è–≤–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã, –Ω–µ—Ç ¬´—Ç–∏—Ö–æ–≥–æ¬ª —Ñ–æ–ª–ª–±—ç–∫–∞
- [ ] –ß–µ—Å—Ç–Ω–æ –æ–ø–∏—Å–∞–Ω—ã –±–ª–æ–∫–µ—Ä—ã ("–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ ‚Ä¶")
- [ ] Git: —Å–¥–µ–ª–∞–Ω(—ã) –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π(–µ) commit(—ã) —Ñ–æ—Ä–º–∞—Ç–∞:
      {code-change} + {code-test} + {test-artifacts/output} + {update-docs-DoD-Kickoff-checkboxes}
````

You are not allowed to consider the work done until you pass this checklist or clearly document a hard blocker.

````

---

## 4. NEXT_STEPS_FOR_HUMAN

### 4.1 –î–æ –∑–∞–ø—É—Å–∫–∞ –∞–≥–µ–Ω—Ç–∞

- [ ] **–°—Ä–µ–∑–∞—Ç—å –∫–æ–Ω—Ç—É—Ä –∑–∞–¥–∞—á–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—É—Å–∫–∞**  
  - –ß—ë—Ç–∫–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –∞–≥–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ eywa1 –∏ —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ J1‚ÄìJ3, **–±–µ–∑** backend‚Äë—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ NX‚Äë05..08.  
- [ ] **–ü–æ–ª–æ–∂–∏—Ç—å AGENT_PROMPT –≤ —Ä–µ–ø–æ**  
  - –ù–∞–ø—Ä–∏–º–µ—Ä: `memory-bank/AGENT-PROMPTS/2025-11-26-eywa1-local-repeatable-ci.txt`.  
- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ eywa1 –∏ docker**  
  - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `user` –≤ –≥—Ä—É–ø–ø–µ docker, –∏–ª–∏ —Ö–æ—Ç—è –±—ã –∑–∞—Ä–∞–Ω–µ–µ –ø–æ–Ω—è—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.  
- [ ] **–£—Ç–æ—á–Ω–∏—Ç—å, –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å GSDoki/notes**  
  - –í—ã–±—Ä–∞—Ç—å –æ–¥–Ω–æ –º–µ—Å—Ç–æ: –Ω–∞–ø—Ä–∏–º–µ—Ä `docs/dev/local-env-notes.md` –∏–ª–∏ –ø–∞–ø–∫—É `memory-bank/Local/`.  
- [ ] **–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ up-local**  
  - –†–∞–∑–æ–≤–æ —Ä—É–∫–∞–º–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `make up-local` –Ω–∞ eywa1 –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏ –∫–∞–∫ baseline –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å —Ä–∞–±–æ—Ç–æ–π –∞–≥–µ–Ω—Ç–∞.  

### 4.2 –ü–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–∞

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ü–µ–ø–æ—á–∫–∞ `make up-local ‚Üí make validate-specs ‚Üí make generate-sdks ‚Üí make seed ‚Üí make e2e` –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–∞ eywa1.  
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ—Ç–ª–∏—á–∏—è dev/local –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –∞ –Ω–µ —Ä–∞–∑–º–∞–∑–∞–Ω—ã –ø–æ –ª–æ–≥–∞–º.  
- [ ] –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, —á—Ç–æ –∞–≥–µ–Ω—Ç –ø–æ–ª–æ–∂–∏–ª –≤ `.gitlab-ci.yml` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Ñ–∞–π–ª, –∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—ã–µ GitLab runner‚Äô—ã.  
- [ ] –ü—Ä–æ–π—Ç–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω UI‚Äë—Ñ–ª–æ—É —Ä—É–∫–∞–º–∏ (issuer –∏–ª–∏ backoffice –Ω–∞ eywa1) –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ e2e.  

### 4.3 ${MERMAID_DIAGRAM}

```mermaid
flowchart LR
  human_start[human plan] --> phase0_sync[phase0 sync 100]
  phase0_sync --> phase1_up_local[phase1 up local 85]
  phase1_up_local --> phase2_chain[phase2 specs sdks seed 100]
  phase2_chain --> phase3_e2e_ci[phase3 e2e and ci 45]
  phase3_e2e_ci --> human_review[human review and next session]
````


#### You:
<time datetime="2025-11-26T14:31:14.065Z" title="26/11/2025, 17:31:14">17:31</time>

–ø—Ä–æ—á–∏—Ç–∞–π –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ {localhost-agent-thread-oracle}.json attached both file and {localhost-output-cli-agent}.txt –±–æ–ª—å—à–µ –¥–∞–π —Ñ–æ–∫—É—Å–∞
–î–∞–≤–∞–π –Ω–æ–≤–æ–º—É –∞–≥–µ–Ω—Ç—É –∑–∞–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∞—Ç—å c –Ω—É–ª—è –ø–æ —à–∞–≥–∞–º –ø–æ jobs, –Ω–∞–¥–æ —á—Ç–æ–±—ã –º—ã –ø–æ–¥–Ω–∏–º–∞–ª–∏ —Å –Ω—É–ª—è –Ω–∞ –Ω–æ–≤–æ–º —á–∏—Å—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ —Å–Ω–∞—á–∞–ª dev –ø–æ ci, —è –ø—É—à—É –æ–Ω–æ –±–∏–ª–¥–∏—Ç - –±–µ–∑ —Ç–µ—Å—Ç–æ–≤, –ø–æ—Ç–æ–º —Ç–µ—Å—Ç—ã –∏ —Ç–∞–∫ –≤—Å–µ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ 

#### ChatGPT:
<time datetime="2025-11-26T14:47:16.627Z" title="26/11/2025, 17:47:16">17:47</time>

–°–æ–±–µ—Ä—É —ç—Ç–æ –≤ —Ñ–æ—Ä–º–∞—Ç ORACLE, –∞ –ø–æ—Ç–æ–º –¥–∞–º –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ CI‚Äë–∞–≥–µ–Ω—Ç–∞.

---

## 1. REQUIREMENTS\_FROM\_VOICE

### 1.1 explicit\_requirements

- –ù—É–∂–µ–Ω **–Ω–æ–≤—ã–π –∞–≥–µ–Ω—Ç –¥–ª—è CI/CD**, –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ—Ç localhost‚Äë–∞–≥–µ–Ω—Ç–∞. –ï–≥–æ –∑–∞–¥–∞—á–∞ ‚Äî **—Å –Ω—É–ª—è —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å Dev‚Äë—Å—Ç–µ–Ω–¥ —á–µ—Ä–µ–∑ GitLab CI** –Ω–∞ –Ω–æ–≤–æ–º —á–∏—Å—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ.
- –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ CI:
  - —è –ø—É—à—É –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Üí
  - GitLab pipeline –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è ‚Üí
  - **—Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑—ã** (backend + front) –∏ –¥–µ–ø–ª–æ–∏—Ç Dev‚Äë—Å—Ç–µ–Ω–¥ ‚Üí
  - **–±–µ–∑ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –ø–µ—Ä–≤–æ–º —à–∞–≥–µ**.
- –î–∞–ª–µ–µ ‚Äî **—ç–≤–æ–ª—é—Ü–∏—è pipeline –ø–æ —à–∞–≥–∞–º**:
  1. –®–∞–≥ 1: —Ç–æ–ª—å–∫–æ build + deploy Dev.
  2. –®–∞–≥ 2: –¥–æ–±–∞–≤–∏—Ç—å –±—ã—Å—Ç—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (lint/spec‚Äëvalidate, unit).
  3. –®–∞–≥ 3: –¥–æ–±–∞–≤–∏—Ç—å e2e / Playwright.
- –ù–æ–≤—ã–π CI –¥–æ–ª–∂–µ–Ω **–æ–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ —Ç–µ –∂–µ –∫–æ–º–∞–Ω–¥—ã**, —á—Ç–æ –∏ localhost‚Äë–æ—Ä–∞–∫—É–ª: `make up-local`, `make validate-specs`, `make generate-sdks`, `make e2e` –∏ —Ç.–ø., –∞ –Ω–µ –∏–∑–æ–±—Ä–µ—Ç–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å. ÓàÄfileciteÓàÇturn2file3ÓàÇturn2file18ÓàÅ
- –î–µ–ø–ª–æ–π Dev —Å–µ–π—á–∞—Å –¥–µ–ª–∞–µ–º **—á–µ—Ä–µ–∑ Docker –∏ docker-compose**, –±–µ–∑ Kubernetes/GitOps –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ. ÓàÄfileciteÓàÇturn2file12ÓàÇturn2file4ÓàÅ
- CI‚Äë–ø–∞–π–ø–ª–∞–π–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **GitLab CI** (.gitlab-ci.yml), —Ä–∞–±–æ—Ç–∞—Ç—å —Å GitLab Runner (–Ω–∞ VDS –∏–ª–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ ‚Äî –Ω–æ Runner –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å online). ÓàÄfileciteÓàÇturn2file4ÓàÅ

### 1.2 implicit\_requirements

- **–ü–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å**: CI‚Äë—Å–∫—Ä–∏–ø—Ç—ã ‚âà localhost‚Äë–∫–æ–º–∞–Ω–¥—ã. –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –ª–æ–∫–∞–ª—å–Ω–æ (eywa1 / dev‚Äë–º–∞—à–∏–Ω–∞), –∏ –≤ GitLab Runner. ÓàÄfileciteÓàÇturn2file3ÓàÇturn2file16ÓàÅ
- **–ù–µ –ø–ª–æ–¥–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏**:
  - –°–ø–µ–∫–∏, Makefile, Docker compose ‚Äî –æ–±—â–∏–µ;
  - CI –Ω–µ –¥–æ–ª–∂–µ–Ω –≤–≤–æ–¥–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ ‚ÄúCI‚Äë—Ç–æ–ª—å–∫–æ‚Äù –ø—É—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ. ÓàÄfileciteÓàÇturn2file3ÓàÇturn2file12ÓàÅ
- **Email/self‚Äëregistration** –≤ —ç—Ç–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –Ω–µ —Ç—è–Ω–µ–º –≤ Dev CI; —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–ø–æ—Å. CI Dev‚Äë—Å—Ç–µ–Ω–¥–∞ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∂–µ –∑–∞–≤–µ–¥—ë–Ω–Ω—ã—Ö —Ç–µ—Å—Ç‚Äë–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—á–µ—Ä–µ–∑ Keycloak/seed). ÓàÄfileciteÓàÇturn2file3ÓàÇturn2file11ÓàÅ
- **Observability –∏ coverage** (G‚Äëunit, –æ—Ç—á—ë—Ç—ã GSDoki) –ª–æ–≥–∏—á–Ω–µ–µ –≤–µ—à–∞—Ç—å –Ω–∞ CI‚Äë–∞–≥–µ–Ω—Ç–∞, –Ω–æ **–Ω–µ –≤ —Å–∞–º–æ–º –ø–µ—Ä–≤–æ–º skeleton** ‚Äî –ø—Ä–æ—Å—Ç–æ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å, —á—Ç–æ pipeline –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å. ÓàÄfileciteÓàÇturn2file11ÓàÇturn2file12ÓàÅ
- CI –¥–æ–ª–∂–µ–Ω —É—á–∏—Ç—ã–≤–∞—Ç—å —É–∂–µ —Å–¥–µ–ª–∞–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É localhost‚Äë–∞–≥–µ–Ω—Ç–∞:
  - Make targets (`up-local`, `validate-specs`, `generate-sdks`, `e2e`) –∏ docker‚Äëcompose —Ñ–∞–π–ª—ã —É–∂–µ –µ—Å—Ç—å –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ eywa1. ÓàÄfileciteÓàÇturn2file5ÓàÇturn2file17ÓàÅ
  - CI skeleton –¥–æ–ª–∂–µ–Ω **–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** –∏—Ö, –∞ –Ω–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–∑–æ–±—Ä–µ—Ç–∞—Ç—å. ÓàÄfileciteÓàÇturn2file18ÓàÅ

### 1.3 corrections

- **–†–∞–∑–¥–µ–ª–∏—Ç—å —Ä–æ–ª–∏ –∞–≥–µ–Ω—Ç–æ–≤**:
  - localhost‚Äë–∞–≥–µ–Ω—Ç —É–∂–µ –¥–æ–≤—ë–ª `make up-local` + specs + –±–∞–∑–æ–≤—ã–π `make e2e` –¥–æ \~80% –∏ –µ–≥–æ –ª–æ–≥–∏—á–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å;
  - CI/CD‚Äë–∞–≥–µ–Ω—Ç ‚Äî **–¥—Ä—É–≥–∞—è JTBD**, –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ç—é–Ω–∏–Ω–≥–∞ –ª–æ–∫–∞–ª–∫–∏. ÓàÄfileciteÓàÇturn2file14ÓàÇturn2file18ÓàÅ
- –†–∞–Ω–µ–µ CI‚Äë–ø–ª–∞–Ω—ã —Ç—è–≥–æ—Ç–µ–ª–∏ –∫ GitOps/K8s, –Ω–æ —Å–µ–π—á–∞—Å –∞–∫—Ü–µ–Ω—Ç: **Dev‚Äë—Å—Ç–µ–Ω–¥ —á–µ—Ä–µ–∑ Docker Compose** –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ ‚Üí –ø–æ—Ç–æ–º —É–∂–µ –¥—É–º–∞—Ç—å –ø—Ä–æ k8s. ÓàÄfileciteÓàÇturn2file4ÓàÇturn2file12ÓàÅ
- –ù–µ–ª—å–∑—è —Å—á–∏—Ç–∞—Ç—å CI ‚Äú–≥–æ—Ç–æ–≤—ã–º‚Äù, –ø–æ–∫–∞ –æ–Ω –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (`make up-local`, `make validate-specs`, `make e2e`) –∏ –Ω–µ –¥–∞—ë—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–æ–≤. ÓàÄfileciteÓàÇturn2file18ÓàÅ

### 1.4 suggestions

- –î–µ–ª–∏—Ç—å CI‚Äë—Ä–∞–±–æ—Ç—É —Å–ª–æ—è–º–∏:
  - Layer A ‚Äì **Environment**: Dev‚Äë—Å–µ—Ä–≤–µ—Ä, Runner, Docker, –±–∞–∑–æ–≤—ã–π deploy.
  - Layer B ‚Äì **Tests**: lint/spec, unit/integration, e2e.
  - Layer C ‚Äì **Business**: NX‚Äë05..08, –æ—Ç—á—ë—Ç—ã, –¥–µ–º–æ‚Äë–¥–∞–Ω–Ω—ã–µ —É–∂–µ –Ω–∞ Stage/Prod. ÓàÄfileciteÓàÇturn2file12ÓàÇturn1file14ÓàÅ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ `ops/scripts` –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è CI‚Äëjobs (build, validate, k8s‚Äëhealthcheck –ø–æ–∑–∂–µ). ÓàÄfileciteÓàÇturn2file12ÓàÇturn2file18ÓàÅ
- –•–≤–∞—Ç–∏—Ç –ø–ª–æ–¥–∏—Ç—å –Ω–æ–≤—ã–µ markdown‚Äë–º–æ–Ω–æ–ª–∏—Ç—ã ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å CI‚Äë–ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —è–∫–æ—Ä—è—Ö (`docs/deploy/localhost/README.md`, `c2p_ops`, `tasks/NX-*`). ÓàÄfileciteÓàÇturn2file12ÓàÇturn2file4ÓàÅ

---

## 2. UPDATED\_JTBD\_CONTRACT (–¥–ª—è –Ω–æ–≤–æ–≥–æ CI‚Äë–∞–≥–µ–Ω—Ç–∞)

### 2.1 jobs

**–†–æ–ª—å –∞–≥–µ–Ω—Ç–∞:** `cicd-ops-agent` (GitLab CI Dev pipeline).

–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º –≤–µ—Ç–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã: `feature/ci-dev-pipeline-skeleton` –æ—Ç `develop`.

#### J0 ‚Äî Baseline –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ

- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:
  - —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `ois-cfa` –∫–ª–æ–Ω–∏—Ä—É–µ—Ç—Å—è –∏ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ;
  - –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã `make up-local`, `make validate-specs`, `make generate-sdks`, `make e2e` –ø–æ–Ω—è—Ç–Ω—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ ‚Äúreference —Å—Ü–µ–Ω–∞—Ä–∏–∏‚Äù. ÓàÄfileciteÓàÇturn2file5ÓàÇturn2file17ÓàÅ

#### J1 ‚Äî CI skeleton Dev: build + deploy –±–µ–∑ —Ç–µ—Å—Ç–æ–≤

- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å **GitLab Runner** –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ (–∏–ª–∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω —É–∂–µ Online). ÓàÄfileciteÓàÇturn2file4ÓàÅ
- –°–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π `.gitlab-ci.yml`, –∫–æ—Ç–æ—Ä—ã–π:
  - —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ push –≤ `develop` –∏ `feature/*`;
  - –∏–º–µ–µ—Ç stages: `build`, `deploy-dev`;
  - job `build_dev`:
    - —Å–æ–±–∏—Ä–∞–µ—Ç Docker‚Äë–æ–±—Ä–∞–∑—ã backend‚Äë—Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Ñ—Ä–æ–Ω—Ç–æ–≤ (—á–µ—Ä–µ–∑ `docker compose build` –∏–ª–∏ `make ci-build-dev`);
    - —Ç–µ–≥–∏—Ä—É–µ—Ç –æ–±—Ä–∞–∑—ã `:dev-<CI_COMMIT_SHORT_SHA>`;
    - –ø—É—à–∏—Ç –≤ GitLab Container Registry.
  - job `deploy_dev`:
    - –Ω–∞ Dev‚Äë—Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker compose pull` –∏ `docker compose up -d` –¥–ª—è Dev‚Äë—Å—Ç–µ–∫–∞ (–æ—Ç–¥–µ–ª—å–Ω—ã–π compose —Ñ–∞–π–ª –∏–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å `dev-ci`);
    - –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã.

#### J2 ‚Äî CI tests base: validate + fast tests

- –†–∞—Å—à–∏—Ä–∏—Ç—å `.gitlab-ci.yml`:
  - –¥–æ–±–∞–≤–∏—Ç—å stage `test`;
  - job `spec_validate`:
    - –∑–∞–ø—É—Å–∫–∞–µ—Ç `make validate-specs` –∏ `make generate-sdks`;
  - job `unit_tests`:
    - –∑–∞–ø—É—Å–∫–∞–µ—Ç –±—ã—Å—Ç—Ä—ã–π –Ω–∞–±–æ—Ä unit/integration —Ç–µ—Å—Ç–æ–≤ (dotnet test, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ JS tests) –±–µ–∑ Playwright.
- –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫: `spec_validate` –∏ `unit_tests` —Ä–∞–±–æ—Ç–∞—é—Ç **–¥–æ** `build_dev`, –±–ª–æ–∫–∏—Ä—É—è –±–∏–ª–¥ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

#### J3 ‚Äî CI e2e smoke (–ø–æ–∑–∂–µ, –º–æ–∂–Ω–æ —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ –Ω–µ –¥–µ–ª–∞—Ç—å —Å—Ä–∞–∑—É)

- –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏:
  - stage `e2e`;
  - job `e2e_smoke`:
    - –ø–æ—Å–ª–µ `deploy_dev` –∑–∞–ø—É—Å–∫–∞–µ—Ç `make e2e` –≤ —Ä–µ–∂–∏–º–µ —Å–º–æ—É–∫ (Swagger + 1‚Äì2 issuer/backoffice —Å—Ü–µ–Ω–∞—Ä–∏—è) —Å `USE_KEYCLOAK_AUTH=true` –∏–ª–∏ fallback. ÓàÄfileciteÓàÇturn2file15ÓàÇturn2file14ÓàÅ

### 2.2 DoD (–¥–ª—è —ç—Ç–æ–≥–æ –∞–≥–µ–Ω—Ç–∞)

- **J0:**
  - –µ—Å—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π —Ä–∞–∑–¥–µ–ª –≤ `docs/deploy/localhost/README.md` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–π doc —Å –ø–µ—Ä–µ—á–Ω–µ–º reference‚Äë–∫–æ–º–∞–Ω–¥ –¥–ª—è localhost –∏ –±—É–¥—É—â–µ–≥–æ CI;
  - –ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫–∏–µ Make‚Äë—Ü–µ–ª–∏ –∏ compose —Ñ–∞–π–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ CI. ÓàÄfileciteÓàÇturn2file18ÓàÇturn2file5ÓàÅ
- **J1:**
  - `.gitlab-ci.yml` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏;
  - —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —É—Å–ø–µ—à–Ω—ã–π pipeline –Ω–∞ `feature/ci-dev-pipeline-skeleton`, –∫–æ—Ç–æ—Ä—ã–π:
    - —Å–æ–±—Ä–∞–ª Docker‚Äë–æ–±—Ä–∞–∑—ã;
    - –∑–∞–ø—É—à–∏–ª –∏—Ö –≤ registry;
    - –ø–æ–¥–Ω—è–ª Dev‚Äë—Å—Ç–µ–Ω–¥ —á–µ—Ä–µ–∑ docker‚Äëcompose –Ω–∞ Dev‚Äë—Å–µ—Ä–≤–µ—Ä–µ.
- **J2:**
  - `spec_validate` –∏ `unit_tests` –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ jobs;
  - –ø–∞–¥–∞—é—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ö –∏–ª–∏ unit‚Äë—Ç–µ—Å—Ç–∞—Ö;
  - –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ—Ä—è–¥–æ–∫ stages (`test` ‚Üí `build` ‚Üí `deploy-dev`).
- **J3 (–ø–æ–∫–∞ –∫–∞–∫ –ø–ª–∞–Ω):**
  - —Ö–æ—Ç—è –±—ã –æ–ø–∏—Å–∞–Ω —Ü–µ–ª–µ–≤–æ–π –≤–∏–¥ e2e stage –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ `docs/tests/ci-e2e-plan.md` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–º.

### 2.3 constraints

- CI —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ **GitLab CI**, –±–µ–∑ GitHub Actions.
- –ù–∞ —ç—Ç–æ–º —à–∞–≥–µ **–Ω–∏–∫–∞–∫–æ–≥–æ Kubernetes/GitOps** –¥–µ–ø–ª–æ—è ‚Äî —Ç–æ–ª—å–∫–æ Docker –∏ docker-compose (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥) –Ω–∞ Dev‚Äë—Å–µ—Ä–≤–µ—Ä–µ. ÓàÄfileciteÓàÇturn2file4ÓàÇturn2file12ÓàÅ
- –ù–µ –ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤–Ω–µ—à–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –ø—Ä–æ–µ–∫—Ç—ã –Ω–∞ Dev‚Äë—Å–µ—Ä–≤–µ—Ä–µ (–µ—Å–ª–∏ —ç—Ç–æ —Ç–æ—Ç –∂–µ eywa1 / –¥—Ä—É–≥–æ–π VDS). ÓàÄfileciteÓàÇturn2file16ÓàÇturn2file17ÓàÅ
- **–ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pm2** –Ω–∞ Dev‚Äë—Å–µ—Ä–≤–µ—Ä–µ ‚Äî —Ç–æ–ª—å–∫–æ Docker. ÓàÄfileciteÓàÇturn2file5ÓàÅ
- CI‚Äëjobs –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã –ª–æ–∫–∞–ª—å–Ω–æ: —à–∞–≥–∏ pipeline ‚âà shell‚Äë–∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.

---

## 3. AGENT\_PROMPT (–≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è Codex‚ÄëCLI)

–ù–∏–∂–µ ‚Äî –ø—Ä–æ–º–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∫–∞–∫ –µ—Å—Ç—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–º—É –∞–≥–µ–Ω—Ç—É (`cicd-ops-agent`).

---

–¢—ã ‚Äî **Senior DevOps / CI/CD engineer** –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ **OIS‚ÄëCFA**.

**–†–æ–ª—å:** `cicd-ops-agent`\
**–¶–µ–ª—å:** —Å –Ω—É–ª—è –ø–æ–¥–Ω—è—Ç—å **Dev‚ÄëCI‚Äëpipeline** –Ω–∞ GitLab, –∫–æ—Ç–æ—Ä—ã–π:

1. –ù–∞ push –≤ `develop` –∏–ª–∏ `feature/*`:
   - —Å–æ–±–∏—Ä–∞–µ—Ç Docker‚Äë–æ–±—Ä–∞–∑—ã backend –∏ frontend —Å–µ—Ä–≤–∏—Å–æ–≤;
   - –ø—É—à–∏—Ç –∏—Ö –≤ GitLab Container Registry;
   - –ø–æ–¥–Ω–∏–º–∞–µ—Ç Dev‚Äë—Å—Ç–µ–Ω–¥ –Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ docker‚Äëcompose.
2. –ù–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ –¥–æ–±–∞–≤–ª—è–µ—Ç fast tests (validate-specs, unit).
3. –í –±—É–¥—É—â–µ–º ‚Äî e2e / Playwright stage (—Å–µ–π—á–∞—Å —Ç–æ–ª—å–∫–æ —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å).

### 0. –ö–æ–Ω—Ç–µ–∫—Å—Ç

- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: GitLab `npk/ois-cfa` (–º–æ–Ω–æ—Ä–µ–ø–æ: `apps/`, `services/`, `packages/`, `tests/`, `docker-compose*.yml`, `Makefile`). ÓàÄfileciteÓàÇturn2file5ÓàÇturn2file17ÓàÅ
- –õ–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫ —É–∂–µ –ø—Ä–∏–≤–æ–¥–∏–ª—Å—è –≤ –ø–æ—Ä—è–¥–æ–∫ –Ω–∞ eywa1: –µ—Å—Ç—å `make up-local`, `make validate-specs`, `make generate-sdks`, `make e2e`. –≠—Ç–∏ –∫–æ–º–∞–Ω–¥—ã ‚Äî **reference** –¥–ª—è CI. ÓàÄfileciteÓàÇturn2file5ÓàÇturn2file15ÓàÅ
- GitLab Runner –≤ k8s —É–∂–µ –µ—Å—Ç—å, –Ω–æ —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –±—ã–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã; —Å–µ–π—á–∞—Å –º—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º Dev‚Äë—Å–µ—Ä–≤–µ—Ä –∫–∞–∫ host –¥–ª—è Runner. ÓàÄfileciteÓàÇturn2file4ÓàÅ

### 1. JTBD –¥–ª—è —Ç–µ–±—è

–ò—Å–ø–æ–ª—å–∑—É–π —Ç–∞–∫–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç:

- **J0 ‚Äî Baseline:**
  - –ü–æ–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ make‚Äë—Ü–µ–ª–∏ –∏ docker‚Äëcompose —Ñ–∞–π–ª—ã, –æ–ø–∏—Å–∞—Ç—å –∏—Ö –∫–∞–∫ reference –¥–ª—è CI.
- **J1 ‚Äî CI skeleton Dev (build + deploy –±–µ–∑ —Ç–µ—Å—Ç–æ–≤):**
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å GitLab Runner –Ω–∞ Dev‚Äë—Å–µ—Ä–≤–µ—Ä–µ.
  - –î–æ–±–∞–≤–∏—Ç—å `.gitlab-ci.yml` —Å stages `build`, `deploy-dev`.
  - –î–æ–±–∏—Ç—å—Å—è –æ–¥–Ω–æ–≥–æ –∑–µ–ª—ë–Ω–æ–≥–æ pipeline, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–±—Ä–∞–ª –æ–±—Ä–∞–∑—ã –∏ –ø–æ–¥–Ω—è–ª Dev‚Äë—Å—Ç–µ–Ω–¥.
- **J2 ‚Äî CI tests base:**
  - –î–æ–±–∞–≤–∏—Ç—å stage `test` —Å jobs `spec_validate` –∏ `unit_tests`.
  - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç build –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.
- **J3 ‚Äî –ü–ª–∞–Ω e2e stage:**
  - –û–ø–∏—Å–∞—Ç—å –±—É–¥—É—â–∏–π stage `e2e` –∏ –∫–∞–∫ –æ–Ω –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å `make e2e` –ø—Ä–æ—Ç–∏–≤ Dev‚Äë—Å—Ç–µ–Ω–¥–∞.

### 2. Workflow Contract

–†–∞–±–æ—Ç–∞–π –≤ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ü–∏–∫–ª–∞—Ö:

1. **PLAN**
   - –°–æ–ø–æ—Å—Ç–∞–≤—å —Ç–µ–∫—É—â–∏–π state —Å JTBD/DoD.
   - –°—Ñ–æ—Ä–º–∏—Ä—É–π –º–∏–Ω–∏‚Äë–ø–ª–∞–Ω –Ω–∞ 1‚Äì2 —Ü–∏–∫–ª–∞:
     - `{pipeline-change} ‚Üí {run pipeline or dry-run locally} ‚Üí {docs/notes} ‚Üí {commit}`.

2. **EXECUTE**
   - –í–Ω–æ—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤:
     - `.gitlab-ci.yml`,
     - Makefile (–Ω–æ–≤—ã–µ —Ü–µ–ª–∏ `ci-*`, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ),
     - docker‚Äëcompose —Ñ–∞–π–ª—ã –¥–ª—è Dev‚Äë—Å—Ç–µ–Ω–¥–∞, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `docker-compose.dev-ci.yml`.
   - –õ–æ–∫–∞–ª—å–Ω–æ –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≥–æ–Ω—è–π –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤ CI.

3. **AUDIT SELF**
   - –Ø–≤–Ω–æ —Ñ–∏–∫—Å–∏—Ä—É–π:
     - –∫–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞–ª;
     - –≤—ã–≤–æ–¥ `git diff --stat`;
     - —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞, –ª–æ–≥ –æ—à–∏–±–∫–∏).

4. **CONTINUE OR STOP**
   - –ï—Å–ª–∏ DoD –ø–æ J0/J1 –µ—â—ë –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω –∏ –Ω–µ—Ç –∂—ë—Å—Ç–∫–∏—Ö –±–ª–æ–∫–µ—Ä–æ–≤ ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞–µ—à—å –±–µ–∑ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
   - –ï—Å–ª–∏ —É–ø—ë—Ä—Å—è –≤ –±–ª–æ–∫–µ—Ä (–Ω–µ—Ç Docker, –Ω–µ—Ç GitLab —Ç–æ–∫–µ–Ω–∞ –∏ —Ç.–ø.) ‚Äî —á–µ—Å—Ç–Ω–æ —Ñ–∏–∫—Å–∏—Ä—É–µ—à—å –±–ª–æ–∫–µ—Ä –≤ –≤—ã–≤–æ–¥–µ.

### 3. –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω

#### Phase 0 ‚Äî –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

1. –ü–µ—Ä–µ–π–¥–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–ø—É—Ç—å –º–æ–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `pwd`, –Ω–æ –æ–∂–∏–¥–∞–µ–º—ã–π —à–∞–±–ª–æ–Ω):

   ```bash
   cd ~/__Repositories/.../ois-cfa
   git fetch origin
   git checkout develop
   git pull --ff-only
   ```

2. –°–æ–∑–¥–∞–π —Ñ–∏—á–µ‚Äë–≤–µ—Ç–∫—É:

   ```bash
   git checkout -b feature/ci-dev-pipeline-skeleton
   ```

3. –ë—ã—Å—Ç—Ä–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∏:

   - `Makefile` ‚Äî —Ü–µ–ª–∏ `up-local`, `validate-specs`, `generate-sdks`, `e2e`, –ª—é–±—ã–µ `docker-*` —Ü–µ–ª–∏.
   - `docker-compose.yml`, `docker-compose.services.yml`, `docker-compose.apps.yml`.
   - `ops/scripts/*` –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –≥–æ—Ç–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è build/deploy.

4. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π –≤ —Å–≤–æ—ë–º –ø–ª–∞–Ω‚Äë–±–ª–æ–∫–µ, –∫–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã —Å—á–∏—Ç–∞–µ—à—å reference –¥–ª—è CI.

#### Phase 1 ‚Äî J1: CI skeleton Dev (build + deploy –±–µ–∑ —Ç–µ—Å—Ç–æ–≤)

1. **GitLab Runner**

   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞ Dev‚Äë—Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ Docker:

     ```bash
     docker ps
     docker compose version || docker-compose version
     ```

   - –ï—Å–ª–∏ Runner –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:
     - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å gitlab-runner (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–∞; –∏–Ω–∞—á–µ –æ–ø–∏—Å–∞—Ç—å –±–ª–æ–∫–µ—Ä);
     - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å Runner —Å GitLab (–ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è registration token –∏–∑ UI).

2. **.gitlab-ci.yml: –ø–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è**

   - –î–æ–±–∞–≤—å –≤ –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ `.gitlab-ci.yml` —Å:

     - stages: `test`, `build`, `deploy-dev` (stage `test` –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –Ω–∞ –ø–µ—Ä–≤–æ–º —à–∞–≥–µ).

     - job `build_dev`:
       - `only`/`rules` –Ω–∞ `develop`, `feature/*`;
       - –≤ `script`:
         - –ª–æ–≥–∏–Ω –≤ registry (`docker login` —Å `CI_REGISTRY_USER`, `CI_REGISTRY_PASSWORD`);
         - `docker compose -f docker-compose.services.yml build` –∏–ª–∏ –≤—ã–∑–æ–≤ `make ci-build-dev` (—Å–æ–∑–¥–∞–π —Ç–∞–∫—É—é —Ü–µ–ª—å, –µ—Å–ª–∏ –µ—ë –µ—â—ë –Ω–µ—Ç).
       - –∞—Ä—Ç–µ—Ñ–∞–∫—Ç: —Å–ø–∏—Å–æ–∫ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤/–ª–æ–≥–æ–≤.

     - job `deploy_dev`:
       - `needs: ["build_dev"]`;
       - `script`:
         - `docker compose -f docker-compose.services.yml pull`;
         - `docker compose -f docker-compose.services.yml up -d`;
       - environment: `name: dev`, `url` —Å –±–∞–∑–æ–≤—ã–º –∞–¥—Ä–µ—Å–æ–º Dev‚ÄëAPI.

3. –ó–∞–ø—É—Å—Ç–∏ pipeline –Ω–∞ —Ñ–∏—á–µ‚Äë–≤–µ—Ç–∫–µ –∏ –¥–æ–±–µ–π—Å—è –æ–¥–Ω–æ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `build_dev` –∏ `deploy_dev`.

#### Phase 2 ‚Äî J2: –¥–æ–±–∞–≤–∏—Ç—å test stage (validate + fast tests)

1. –í `.gitlab-ci.yml`:

   - –î–æ–±–∞–≤—å job `spec_validate`:

     ```yaml
     spec_validate:
       stage: test
       script:
         - make validate-specs
         - make generate-sdks
     ```

   - –î–æ–±–∞–≤—å job `unit_tests` (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä):

     ```yaml
     unit_tests:
       stage: test
       script:
         - make test-unit || dotnet test
     ```

   - –ù–∞—Å—Ç—Ä–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ç–∞–∫, —á—Ç–æ–±—ã `build_dev` –∑–∞–≤–∏—Å–µ–ª –æ—Ç `spec_validate` –∏ `unit_tests` (—á–µ—Ä–µ–∑ `needs` –∏–ª–∏ –ø–æ—Ä—è–¥–æ–∫ stages).

2. –ü—Ä–æ–≥–æ–Ω—è–π pipeline –∏ —É–±–µ–¥–∏—Å—å, —á—Ç–æ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ö/—Ç–µ—Å—Ç–∞—Ö build –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è.

#### Phase 3 ‚Äî –ü–ª–∞–Ω –¥–ª—è e2e stage

1. –ù–µ —Ä–µ–∞–ª–∏–∑—É—è –ø–æ–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é, –æ–ø–∏—à–∏ –≤ –Ω–æ–≤–æ–º —Ñ–∞–π–ª–µ `docs/tests/ci-e2e-plan.md`:

   - –∫–∞–∫–∏–µ Playwright —Å—Ü–µ–Ω–∞—Ä–∏–∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ e2e smoke;
   - –∫–∞–∫–∏–µ env‚Äë–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Dev‚Äë—Å—Ç–µ–Ω–¥—É;
   - –∫–∞–∫ –≤—ã–∑—ã–≤–∞—Ç—å `make e2e` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ e2e‚Äë–∫–æ–º–∞–Ω–¥—ã.

2. –ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –¥–æ–±–∞–≤—å –ø—É—Å—Ç–æ–π job `e2e_smoke` (—Å `when: manual` –∏ `echo TODO`), –Ω–æ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.

### 4. Git‚Äë–ø—Ä–∞–≤–∏–ª–∞

- –ö–∞–∂–¥—ã–π —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–≤–µ—Ä—à–∞–π –∫–æ–º–º–∏—Ç–æ–º –≤–∏–¥–∞:

  - –∏–∑–º–µ–Ω–µ–Ω–∏—è `.gitlab-ci.yml`
  - –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî Makefile / docker-compose
  - –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π doc (`README`, `ci-e2e-plan.md`)
  - –ª–æ–≥/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –∫–∞–∫ —Ç—ã –ø—Ä–æ–≤–µ—Ä–∏–ª.

- –ü—Ä–∏–º–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π:

  - `ci(dev): add build and deploy pipeline skeleton`
  - `ci(test): add validate-specs and unit tests stages`

### 5. FINAL SELF-CHECK (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –æ—Ç–≤–µ—Ç–æ–º –∞–≥–µ–Ω—Ç–∞)

```markdown
FINAL SELF-CHECK

- [ ] CI pipeline –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ —Ñ–∏—á–µ-–≤–µ—Ç–∫–µ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç build_dev + deploy_dev –±–µ–∑ —Ç–µ—Å—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã jobs spec_validate –∏ unit_tests, –æ–Ω–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç build –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- [ ] –í—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∏–ª–∏ –Ω–æ–≤—ã–º make-—Ü–µ–ª—è–º, –æ–ø–∏—Å–∞–Ω—ã –≤ docs
- [ ] –ù–µ—Ç –Ω–µ–æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –±–ª–æ–∫–µ—Ä–æ–≤ (GitLab Runner, Docker, —Ç–æ–∫–µ–Ω—ã)
- [ ] –°–¥–µ–ª–∞–Ω—ã –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã: {pipeline-change} + {docs} (+ {dry-run output –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏})
```

---

## 4. NEXT\_STEPS\_FOR\_HUMAN

### 4.1 –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å —Ç–µ–±–µ –¥–æ –∑–∞–ø—É—Å–∫–∞ –Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞

- [ ] –†–µ—à–∏—Ç—å, –∫–∞–∫–æ–π —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç Dev‚ÄëCI‚Äë—Ö–æ—Å—Ç–æ–º
  - –ª–∏–±–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π eywa1,
  - –ª–∏–±–æ –Ω–æ–≤—ã–π VDS; –Ω–∞ –Ω—ë–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å Docker –∏ –¥–æ—Å—Ç—É–ø –∫ GitLab.
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —É —Ç–µ–±—è –µ—Å—Ç—å:
  - –¥–æ—Å—Ç—É–ø –≤ GitLab CI/CD settings –ø—Ä–æ–µ–∫—Ç–∞ `ois-cfa` (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è runner token, registry credentials);
  - SSH‚Äë–¥–æ—Å—Ç—É–ø –∫ Dev‚Äë—Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –∞–≥–µ–Ω—Ç–∞.
- [ ] –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äî —Å–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É `feature/ci-dev-pipeline-skeleton` –∑–∞—Ä–∞–Ω–µ–µ.

### 4.2 –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–∞

- [ ] –í GitLab:
  - pipeline –Ω–∞ —Ñ–∏—á–µ‚Äë–≤–µ—Ç–∫–µ –∑–µ–ª—ë–Ω—ã–π;
  - –≤–∏–¥–Ω–æ jobs `build_dev` –∏ `deploy_dev` (–∏ –ø–æ–∑–∂–µ `spec_validate`, `unit_tests`).
- [ ] –ù–∞ Dev‚Äë—Å–µ—Ä–≤–µ—Ä–µ:
  - `docker ps` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç Dev‚Äë—Å—Ç–µ–∫ OIS‚ÄëCFA;
  - –±–∞–∑–æ–≤—ã–µ health‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ Swagger –æ—Ç–¥–∞—é—Ç 200.
- [ ] –í —Ä–µ–ø–æ:
  - `.gitlab-ci.yml` —á–∏—Ç–∞–µ–º—ã–π, –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥;
  - docs –æ–±–Ω–æ–≤–ª–µ–Ω—ã (–∫–æ—Ä–æ—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É).

### 4.3 Mermaid –¥–∏–∞–≥—Ä–∞–º–º–∞ CI‚Äë–ø–æ—Ç–æ–∫–∞

```mermaid
flowchart TD
  DevPush[Developer push] --> CI_Pipeline[GitLab pipeline]
  CI_Pipeline --> CI_Test[Test stage plan]
  CI_Test --> CI_Build[Build dev images]
  CI_Build --> CI_Deploy[Deploy dev stack]
  CI_Deploy --> DevSmoke[Manual smoke checks]
  CI_Deploy --> CI_E2E[Future e2e stage]
```

–ï—Å–ª–∏ –æ–∫, —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ —Å –±–ª–æ–∫–æ–º AGENT\_PROMPT –∏–∑ —Å–µ–∫—Ü–∏–∏ 3.


#### You:
<time datetime="2025-11-26T19:03:42.001Z" title="26/11/2025, 22:03:42">22:03</time>

1) oracle discussion 20251126-1805-aistudio-gem3.oracle.md –ø—Ä–æ—á–∏—Ç–∞–π –º–æ–∏ ````prompt $content ```` and outputs, —è –Ω–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω outputs 5,6 –º—ã –ø–æ—Ö–æ–∂–µ –∏–¥–µ–º –Ω–µ —Ç—É–¥–∞, –Ω–∞–º –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–∞–∫ —á—Ç–æ–±—ã –±–∏–ª–¥–∏–ª–∏—Å—å images —á–µ—Ä–µ–∑ vds1 –∏ –¥–µ–ª–∞–ª—Å—è docker pull –∏—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ —Ç–∞–º –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ cfa2; –ø—Ä–∏—á–µ–º —è –ø—Ä–æ—Å–∏–ª –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ —Å–Ω–∞—á–∞–ª–∞ —É–±–µ–¥–∏—Ç—Å—è —á—Ç–æ runner –ø–æ –∫–æ–º–º–∏—Ç—É –≤ –≤–µ—Ç–∫—É "—á—Ç–æ-—Ç–æ" –±–∏–ª–¥–∏—Ç –Ω–∞ vds1 –¥–µ–ø–ª–æ–∏—Ç –Ω–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ —Ç–æ–π –≤–µ—Ç–∫–∏ –∫–æ–º–º–∏—Ç–∞ –Ω–∞ cfa2; –ø–æ—Ç–æ–º —É–∂–µ –¥–∞–ª—å—à–µ –¥–≤–∏–≥–∞—Ç—å—Å—è —á—Ç–æ–±—ã –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ —ç—Ç–æ –±—ã–ª–æ —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É —á—Ç–æ–±—ã fronts(issuer,investor,backoffice) —Ä–∞–±–æ—Ç–∞–ª–∏ —á–µ—Ä–µ–∑ keycloak –∏ —Å backend - –≥—Ä–∞–º–æ—Ç–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ö–æ–∂–µ –Ω—É–∂–µ–Ω –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ –≤—Å–µ–º–∏ –¥–µ—Ç–∞–ª—è–º–∏ –∞ –ª—É—á—à–µ —á–µ—Ç–∫–∞—è –ø–æ–¥—Ä–æ–±–Ω–∞—è mermaidjs sequence (–∏ c4 deploy)+ table cheatsheet —Å –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–æ–π —á—Ç–æ –∏ –∫–∞–∫ 
2) –ø—Ä–æ—á–∏—Ç–∞–π –∞–≥–µ–Ω—Ç–∞ eywa1-p-cfa-w19.p1-20251126-2157.session.txt —á—Ç–æ –µ—Å—Ç—å —Å–µ–π—á–∞—Å
3) –∫–æ–≥–¥–∞ –±—É–¥–µ—à—å –ø—Ä–æ—Å–∏—Ç—å –¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –º–æ–∂–Ω–æ –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å –º–æ–ª –≤–æ—Ç —Ç—É—Ç –±—ã–ª–æ —Ç–∞–∫ cfa (uk1), cfa1 (cfa1 server) domain using cloudflare cli –≤—Å–µ –∞—Ç–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ - –∏–ª–∏ –º–æ–∂–µ—Ç —Ç—å—Ñ—É –Ω–∞ —ç—Ç–∏ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –∏ —Å–¥–µ–ª–∞—Ç—å –ø–æ —à–∞–≥–∞–º –ø–æ phases —Å –æ—Ç—Å–º–æ—Ç—Ä–æ–º –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ 

#### ChatGPT:
<time datetime="2025-11-26T19:17:33.211Z" title="26/11/2025, 22:17:33">22:17</time>

–°–µ–π—á–∞—Å —É –Ω–∞—Å, –ø–æ —Å—É—Ç–∏, —É–∂–µ –ø–æ—á—Ç–∏ –µ—Å—Ç—å —Ç–æ—Ç –ø—Ä–æ—Å—Ç–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã —Ö–æ—á–µ—à—å:\
**vds1 –∫–∞–∫ builder, GitLab Registry –∫–∞–∫ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –æ–±—Ä–∞–∑–æ–≤, cfa2 –∫–∞–∫ –ø—Ä–æ—Å—Ç–∞—è docker‚Äë–º–∞—à–∏–Ω–∞, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç pull –∏ up.** –ù—É–∂–Ω–æ —ç—Ç–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –¥–æ–æ—Ñ–æ—Ä–º–∏—Ç—å –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤ –ø–æ–Ω—è—Ç–Ω—ã–π –ø–ª–∞–Ω.

–Ø —Ä–∞–∑–æ–±—Ä–∞–ª:

- oracle‚Äë–¥–æ–∫ 20251126‚Äë1805 –∏ –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–≤—Ç–æ‚Äë–∞–≥–µ–Ω—Ç–∞ —Å auto‚Äësetup‚Äëci.sh, runner‚Äë—Ç–æ–∫–µ–Ω–∞–º–∏ –∏ —Ç.–¥. ÓàÄfileciteÓàÇturn2file14ÓàÇturn1file4ÓàÅ
- –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–µ—Å—Å–∏—é `eywa1-p-cfa-w19...`, –≥–¥–µ —É–∂–µ –µ—Å—Ç—å:
  - `bootstrap-cfa2.sh`: Docker + compose –Ω–∞ cfa2, `/srv/cfa` –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `user` —Å sudo;
  - `ci-bootstrap-cfa2.sh` –∏ `ci-setup-runner-vds1.sh`;
  - –≤–µ—Ç–∫–∞ `infra-ci-setup` —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º `.gitlab-ci.yml`, –≥–¥–µ `build-api-gateway` –Ω–∞ —Ç–µ–≥ `vds1` —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑ –∏ –ø—É—à–∏—Ç –≤ GitLab Registry, –∞ `deploy-cfa2` —á–µ—Ä–µ–∑ SSH –∏–¥—ë—Ç –Ω–∞ `cfa2` –∏ –¥–µ–ª–∞–µ—Ç `docker login` + `docker compose pull && docker compose up -d`. ÓàÄfileciteÓàÇturn2file9ÓàÇturn2file5ÓàÇturn2file4ÓàÅ

–ü–æ–Ω–∏–º–∞—é —Ç–≤–æ–π –¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç: –∞–≥–µ–Ω—Ç —É—à—ë–ª –≤ **full‚Äëautomation‚Äëoverkill** (auto‚Äësetup, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è compose –∏ .env), –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ–≥–æ –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è.

–î–∞–≤–∞–π –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º **–ø—Ä–æ—Å—Ç–æ–π CI/CD –ø–ª–∞–Ω** –∏ —Å—Ä–∞–∑—É –Ω–∞—Ä–∏—Å—É–µ–º:

- –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø–æ —à–∞–≥–∞–º,
- mermaid sequence + C4 deploy,
- —Ç–∞–±–ª–∏—Ü—É‚Äë—à–ø–∞—Ä–≥–∞–ª–∫—É,
- –∏ –ª—ë–≥–∫–∏–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –±–µ–∑ –ª–∏—à–Ω–µ–π –º–∞–≥–∏–∏.

---

## 1. –ß—Ç–æ –º—ã —Ö–æ—Ç–∏–º –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ

**–¶–µ–ª—å Dev‚Äë—Ü–∏–∫–ª–∞ –Ω–∞ cfa2:**

1. –Ø –ø—É—à—É –≤ –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–µ—Ç–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä `develop` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é `dev-cfa2`).
2. GitLab:
   - –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω –Ω–∞ —Ä–∞–Ω–Ω–µ—Ä–µ –Ω–∞ **vds1**;
   - –±–∏–ª–¥–∏—Ç Docker‚Äë–æ–±—Ä–∞–∑—ã –±—ç–∫–æ–≤ (–∏ –ø–æ–∑–∂–µ —Ñ—Ä–æ–Ω—Ç–æ–≤);
   - –ø—É—à–∏—Ç –∏—Ö –≤ GitLab Registry.
3. –ü–æ –∫–Ω–æ–ø–∫–µ `deploy-cfa2`:
   - job –Ω–∞ vds1 –ø–æ SSH –ª–æ–≥–∏–Ω–∏—Ç—Å—è –Ω–∞ `cfa2`;
   - –¥–µ–ª–∞–µ—Ç `docker login` + `docker compose pull` + `docker compose up -d` –≤ `/srv/cfa`;
   - —Å–µ—Ä–≤–∏—Å—ã –Ω–∞ `cfa2` —Ä–µ–∞–ª—å–Ω–æ —Å—Ç–∞—Ä—Ç—É—é—Ç, health 200.
4. –î–∞–ª—å—à–µ –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ:
   - —Å–Ω–∞—á–∞–ª–∞ **—Ç–æ–ª—å–∫–æ build+deploy –±–µ–∑ —Ç–µ—Å—Ç–æ–≤**,
   - –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–ª—è–µ–º **tests** –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π stage, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–π—Ç–∏—Ç deploy,
   - –ø–æ—Ç–æ–º —É–∂–µ **—Ñ—Ä–æ–Ω—Ç—ã (issuer, investor, backoffice) —á–µ—Ä–µ–∑ Keycloak**.

–í–∞–∂–Ω–æ:

- **UK1 –Ω–µ —Ç—Ä–æ–≥–∞–µ–º**, –æ–Ω –æ—Å—Ç–∞—ë—Ç—Å—è —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–º. ÓàÄfileciteÓàÇturn2file6ÓàÅ
- –î–ª—è cfa2 –¥–æ–º–µ–Ω—ã –∏ Cloudflare/telex ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (runbook), –Ω–æ **–ø–µ—Ä–≤—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é Dev –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–æ IP –∏ –ø–æ—Ä—Ç–∞–º**, –±–µ–∑ TLS. ÓàÄfileciteÓàÇturn2file1ÓàÇturn2file2ÓàÅ

---

## 2. –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ —Ñ–∞–∫—Ç—É

–°—É–º–º–∞—Ä–Ω–æ –ø–æ `eywa1-p-cfa-w19...` –∏ `c2p_deploy`:

- **cfa2**:
  - –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `user` —Å sudo NOPASSWD; SSH –ø–æ –∫–ª—é—á–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç; `/srv/cfa` —Å–æ–∑–¥–∞–Ω–æ. ÓàÄfileciteÓàÇturn2file3ÓàÅ
  - Docker –∏ Docker Compose plugin —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, `docker compose version` –¥–∞—ë—Ç v2.29.7. ÓàÄfileciteÓàÇturn2file4ÓàÇturn2file9ÓàÅ
  - —É–∂–µ –∫—Ä—É—Ç–∏—Ç—Å—è Portainer –∫–∞–∫ UI, –Ω–æ –æ–Ω –Ω–∞–º –Ω–µ –Ω—É–∂–µ–Ω –∫–∞–∫ registry; –ø—Ä–æ—Å—Ç–æ —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. ÓàÄfileciteÓàÇturn2file9ÓàÅ

- **vds1**:
  - Docker –∏ gitlab‚Äërunner —Å—Ç–æ—è—Ç, runner –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ GitLab —á–µ—Ä–µ–∑ API (auto‚Äësetup‚Äëci). ÓàÄfileciteÓàÇturn2file10ÓàÅ

- **—Ä–µ–ø–æ `ois-cfa`, –≤–µ—Ç–∫–∞ `infra-ci-setup`**:
  - –¥–æ–±–∞–≤–ª–µ–Ω `ops/scripts/ci-bootstrap-cfa2.sh` –∏ `ops/scripts/ci-setup-runner-vds1.sh`;

  - `.gitlab-ci.yml` –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –ø–æ–¥ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π pipeline:

    - `build-api-gateway`:
      - `image: docker:24.0`, —Å–µ—Ä–≤–∏—Å `docker:24.0-dind`, —Ç–µ–≥–∏ `vds1`,
      - `docker build` –æ–±—Ä–∞–∑ `api-gateway` –∏ –ø—É—à –≤ `$CI_REGISTRY_IMAGE/api-gateway:$CI_COMMIT_SHA` –ø–ª—é—Å `latest` –¥–ª—è default‚Äëbranch. ÓàÄfileciteÓàÇturn2file5ÓàÇturn2file18ÓàÅ

    - `deploy-cfa2`:
      - —Ç–µ–≥–∏ `vds1`,
      - –≤ `before_script` ‚Äî ssh‚Äëagent + `SSH_PRIVATE_KEY`, `ssh-keyscan cfa2`,
      - –≤ `script` ‚Äî SSH –Ω–∞ `cfa2`, `docker login`, `cd /srv/cfa && docker compose pull && docker compose up -d`.
        ÓàÄfileciteÓàÇturn2file5ÓàÇturn2file4ÓàÅ

  - –ø–æ–∑–∂–µ job –±—ã–ª —Ä–∞—Å—à–∏—Ä–µ–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ `.env` –∏ `docker-compose.yml` –Ω–∞ `cfa2` –∏–∑ CI —Å–∫—Ä–∏–ø—Ç–∞ (cat > /srv/cfa/.env << EOF –∏ —Ç.–ø.). ÓàÄfileciteÓàÇturn1file2ÓàÇturn2file11ÓàÅ

–¢–æ –µ—Å—Ç—å **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π end‚Äëto‚Äëend —É–∂–µ –ø–æ—á—Ç–∏ –µ—Å—Ç—å**, –Ω–æ:

- compose –∏ env –≥–µ–Ω–µ—Ä—è—Ç—Å—è ‚Äú–Ω–∞ –ª–µ—Ç—É‚Äù –∏–∑ CI ‚Üí —Ä–∏—Å–∫ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–µ–π;
- –±–∏–ª–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ `api-gateway`, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏ —Ñ—Ä–æ–Ω—Ç—ã –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã;
- —Ç–µ—Å—Ç–æ–≤—ã–π stage –ø–æ–∫–∞ –≤—ã–∫–∏–Ω—É—Ç.

---

## 3. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω (Dev –Ω–∞ cfa2)

### 3.1 –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã

| –®–∞–≥ | –¶–µ–ª—å                                                                   | Trigger                                | –ß—Ç–æ –±–∏–ª–¥–∏–º                                                                                    | –ß—Ç–æ –¥–µ–ø–ª–æ–∏–º                                               | Tests                             |
| --- | ---------------------------------------------------------------------- | -------------------------------------- | --------------------------------------------------------------------------------------------- | --------------------------------------------------------- | --------------------------------- |
| 0   | –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É: Docker+Runner+SSH+`/srv/cfa`                       | –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ                             | –Ω–∏—á–µ–≥–æ                                                                                        | –Ω–∏—á–µ–≥–æ                                                    | —Ä—É—á–Ω—ã–µ curl                       |
| 1   | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π Dev pipeline: build backend images + —Ä—É—á–Ω–æ–π deploy –Ω–∞ cfa2 | push –≤ `dev-cfa2` (–∏–ª–∏ `develop`)      | gateway + –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å                                                                         | docker compose –¥–ª—è backend –±–µ–∑ —Ñ—Ä–æ–Ω—Ç–æ–≤                    | –Ω–µ—Ç                               |
| 2   | –ü–æ–ª–Ω—ã–π backend Dev: –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ .NET —Å–µ—Ä–≤–∏—Å—ã                          | —Ç–æ—Ç –∂–µ                                 | gateway + identity + issuance + registry + settlement + compliance                            | —Ç–æ—Ç –∂–µ compose –Ω–æ —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º —Å–µ—Ä–≤–∏—Å–æ–≤               | –Ω–µ—Ç                               |
| 3   | Front+Keycloak: Dev‚Äë–ø–æ—Ä—Ç–∞–ª—ã —á–µ—Ä–µ–∑ Keycloak                             | —Ç–æ—Ç –∂–µ                                 | —Ñ—Ä–æ–Ω—Ç—ã (issuer, investor, backoffice) + –≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω—ã–µ ob—Ä–∞–∑—ã –¥–ª—è Keycloak‚Äërealm –∏–ª–∏ init | compose –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ—Ä—Ç–∞–ª—ã –∏ Keycloak, env –Ω–∞ Keycloak URL | smoke e2e –ø–æ –≤—Ö–æ–¥—É                |
| 4   | Tests stage: unit/integration/e2e –ø–µ—Ä–µ–¥ deploy                         | push –Ω–∞ dev‚Äë–≤–µ—Ç–∫—É, deploy —á–µ—Ä–µ–∑ manual | –∫–∞–∫ –≤ 2‚Äì3                                                                                     | –∫–∞–∫ –≤ 3                                                   | –¥–∞, –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω green –ø–µ—Ä–µ–¥ deploy |

---

## 4. –í–∞—Ä–∏–∞–Ω—Ç—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ deploy –∏ –≤—ã–±–æ—Ä

### 4.1 –°—Ü–µ–Ω–∞—Ä–∏–∏

| –°—Ü–µ–Ω–∞—Ä–∏–π                                                            | Build                | Deploy                                                              | Pros                                                                                                                   | Cons                                                                                        | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è            |
| ------------------------------------------------------------------- | -------------------- | ------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- | ----------------------- |
| A. Runner –Ω–∞ vds1, deploy —á–µ—Ä–µ–∑ SSH –Ω–∞ cfa2                         | vds1 docker executor | job `deploy-cfa2` –ø–æ SSH –∑–∞–ø—É—Å–∫–∞–µ—Ç `docker compose pull/up` –Ω–∞ cfa2 | –ü—Ä–æ—Å—Ç–∞—è –º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å, —É–∂–µ –ø–æ—á—Ç–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ; —á—ë—Ç–∫–∏–π —Ä–∞–∑–¥–µ–ª builder vs target; –æ–¥–Ω–∞ —Ç–æ—á–∫–∞ –±–∏–ª–¥–∞ –¥–ª—è –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π | SSH –∏ compose –Ω–∞–¥–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å; —Å–µ–∫—Ä–µ—Ç—ã —á–µ—Ä–µ–∑ GitLab Variables                 | **–í—ã–±—Ä–∞–Ω** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π |
| B. Runner –Ω–∞ —Å–∞–º–æ–º cfa2, build+run –ª–æ–∫–∞–ª—å–Ω–æ                         | cfa2 docker executor | —Ç–æ—Ç –∂–µ runner –¥–µ–ª–∞–µ—Ç `docker build` –∏ `docker compose up`           | –Ω–µ—Ç SSH, –º–µ–Ω—å—à–µ ‚Äú–ø—Ä—ã–∂–∫–æ–≤‚Äù                                                                                              | –∂–µ—Å—Ç–∫–æ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –æ–¥–Ω–æ–º—É —Ö–æ—Å—Ç—É; —Ç—è–∂–µ–ª—ã–π build –Ω–∞ prod‚Äëhost; —Å–ª–æ–∂–Ω–µ–µ –ø–æ—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è | –ù–µ –±–µ—Ä—ë–º                |
| C. –¢–æ–ª—å–∫–æ shared‚Äërunners GitLab, deploy —á–µ—Ä–µ–∑ remote docker context | shared               | `docker context` –∏–ª–∏ remote API –Ω–∞ cfa2                             | –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ vds1                                                                                                    | —Å–ª–æ–∂–Ω–µ–µ –≤ –æ—Ç–ª–∞–¥–∫–µ; –ø–æ—Ä—Ç –∏ –¥–æ—Å—Ç—É–ø –∫ docker API –Ω–∞—Ä—É–∂—É ‚Üí –ª–∏—à–Ω–∏–µ —Ä–∏—Å–∫–∏                         | –ù–µ –±–µ—Ä—ë–º                |

–£ –Ω–∞—Å –ø–æ —Ñ–∞–∫—Ç—É —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π **A** (runner –Ω–∞ vds1 + SSH –Ω–∞ cfa2) ‚Äî –Ω—É–∂–Ω–æ –µ–≥–æ **—É–ø—Ä–æ—Å—Ç–∏—Ç—å –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å**. ÓàÄfileciteÓàÇturn2file13ÓàÇturn2file5ÓàÅ

---

## 5. –ö–∞–∫ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –≤—ã–≥–ª—è–¥–µ—Ç—å (target design)

### 5.1 .gitlab-ci.yml –¥–ª—è Dev (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π —Å–∫–µ–ª–µ—Ç)

–ò–¥–µ—è:

- **Stages**: `build`, `deploy` (–ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏–º `test`).
- Jobs –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –¥–ª—è `dev-cfa2` (–∏–ª–∏ `develop`), —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å –¥—Ä—É–≥–∏–º –≥—Ä–∞–Ω–∏—Ü–∞–º.
- `deploy-cfa2` ‚Äî `when: manual`, —á—Ç–æ–±—ã –≤–Ω–∞—á–∞–ª–µ —Ç—ã —Ä—É–∫–∞–º–∏ –Ω–∞–∂–∏–º–∞–ª –∫–Ω–æ–ø–∫—É.

–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–±–µ–∑ –≤—Å–µ—Ö –¥–µ—Ç–∞–ª–µ–π, –Ω–æ —Å –Ω—É–∂–Ω–æ–π —Ñ–æ—Ä–º–æ–π):

```yaml
stages:
  - build
  - deploy

variables:
  DOCKER_HOST: tcp://docker:2375
  DOCKER_DRIVER: overlay2

.build_backend_template:
  stage: build
  tags: [vds1]
  image: docker:24.0
  services:
    - docker:24.0-dind
  script:
    - docker info
    - docker login -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD" "$CI_REGISTRY"
    - >
      docker build
      -t "$CI_REGISTRY_IMAGE/$IMAGE_NAME:$CI_COMMIT_SHORT_SHA"
      -f "$DOCKERFILE_PATH"
      "$BUILD_CONTEXT"
    - docker push "$CI_REGISTRY_IMAGE/$IMAGE_NAME:$CI_COMMIT_SHORT_SHA"
    - |
      if [ "$CI_COMMIT_BRANCH" = "dev-cfa2" ]; then
        docker tag "$CI_REGISTRY_IMAGE/$IMAGE_NAME:$CI_COMMIT_SHORT_SHA" \
          "$CI_REGISTRY_IMAGE/$IMAGE_NAME:dev"
        docker push "$CI_REGISTRY_IMAGE/$IMAGE_NAME:dev"
      fi
  rules:
    - if: '$CI_COMMIT_BRANCH == "dev-cfa2"'

build:gateway:
  extends: .build_backend_template
  variables:
    IMAGE_NAME: api-gateway
    DOCKERFILE_PATH: apps/api-gateway/Dockerfile
    BUILD_CONTEXT: apps/api-gateway

# –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏–º build:identity, build:issuance, registry, settlement, compliance, —Ñ—Ä–æ–Ω—Ç—ã‚Ä¶

deploy:cfa2:
  stage: deploy
  tags: [vds1]
  image: alpine:3.19
  needs:
    - build:gateway
  before_script:
    - apk add --no-cache openssh-client bash
    - eval "$(ssh-agent -s)"
    - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
    - mkdir -p ~/.ssh
    - ssh-keyscan -H cfa2 >> ~/.ssh/known_hosts
  script:
    - ssh user@cfa2 "docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY"
    - ssh user@cfa2 "cd /srv/cfa && docker compose pull && docker compose up -d"
  rules:
    - if: '$CI_COMMIT_BRANCH == "dev-cfa2"'
  when: manual
  environment:
    name: cfa2-dev
```

–≠—Ç–æ –æ—á–µ–Ω—å –±–ª–∏–∑–∫–æ –∫ —Ç–æ–º—É, —á—Ç–æ —É–∂–µ —Å–µ–π—á–∞—Å –≤ `infra-ci-setup` –ø–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫ –∞–≥–µ–Ω—Ç–∞, –ø—Ä–æ—Å—Ç–æ:

- —è–≤–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–ª–∏ –≤–µ—Ç–∫—É;
- –¥–æ–±–∞–≤–∏–ª–∏ tag `dev`;
- –æ—Å—Ç–∞–≤–∏–ª–∏ compose –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ `cfa2`, –∞ –Ω–µ –≥–µ–Ω–µ—Ä–∏–º –µ–≥–æ –≤ CI.

### 5.2 –ì–¥–µ –¥–æ–ª–∂–µ–Ω –ª–µ–∂–∞—Ç—å docker-compose –¥–ª—è cfa2

–í–º–µ—Å—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ compose:

1. –í —Ä–µ–ø–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä `deploy/docker-compose-at-vps/cfa2/docker-compose.yml`) ‚Äî –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å UK1 runbook‚Äô–∞–º–∏. ÓàÄfileciteÓàÇturn2file6ÓàÇturn2file7ÓàÅ
2. –ù–∞ `cfa2`:

   - –æ–¥–∏–Ω —Ä–∞–∑ –∫–æ–ø–∏—Ä—É–µ–º:

     ```bash
     ssh user@cfa2 "mkdir -p /srv/cfa"
     scp deploy/docker-compose-at-vps/cfa2/docker-compose.yml user@cfa2:/srv/cfa/docker-compose.yml
     scp deploy/docker-compose-at-vps/cfa2/.env.dev user@cfa2:/srv/cfa/.env
     ```

   - –¥–∞–ª—å—à–µ CI‚Äëjob —Ç–æ–ª—å–∫–æ –¥–µ–ª–∞–µ—Ç `docker compose pull/up` –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤.

–¢–∞–∫ –º—ã **–Ω–µ –ø–ª–æ–¥–∏–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏**, –≤—Å—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ compose –∏ env –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –≤–º–µ—Å—Ç–µ —Å –∫–æ–¥–æ–º.

---

## 6. Mermaid diagrams

### 6.1 Sequence: Dev push ‚Üí vds1 ‚Üí Registry ‚Üí cfa2

```mermaid
sequenceDiagram
  participant Dev as Developer
  participant GL as GitLab
  participant R1 as Runner_vds1
  participant REG as GitLab_Registry
  participant CFA as Host_cfa2

  Dev->>GL: git push branch dev-cfa2
  GL->>R1: start pipeline build stage
  R1->>R1: docker build backend images
  R1->>REG: push images tag CI_COMMIT_SHORT_SHA and dev
  R1-->>GL: build stage success

  Dev->>GL: manual start job deploy cfa2
  GL->>R1: run deploy cfa2 on vds1
  R1->>CFA: ssh user at cfa2 docker login
  R1->>CFA: ssh user at cfa2 docker compose pull
  R1->>CFA: ssh user at cfa2 docker compose up d
  CFA-->>Dev: gateway and swagger health 200
```

### 6.2 C4‚Äëstyle deploy –¥–ª—è Dev –Ω–∞ cfa2

```mermaid
flowchart LR
  Dev[Developer laptop] --> GL[GitLab project ois cfa]

  subgraph GitLabCloud
    GL --> REG[GitLab container registry]
  end

  subgraph VDS1Builder
    R1[GitLab runner vds1 docker executor]
  end

  subgraph CFA2Dev
    Host[Host cfa2 srv cfa]
    GW[api gateway container]
    ID[identity service container]
    IS[issuance service container]
    RG[registry service container]
    ST[settlement service container]
    CO[compliance service container]
    KC[Keycloak container]
    UI1[portal issuer]
    UI2[portal investor]
    UI3[backoffice]
  end

  GL --> R1
  R1 --> REG
  REG --> Host

  Host --> GW
  Host --> ID
  Host --> IS
  Host --> RG
  Host --> ST
  Host --> CO
  Host --> KC
  Host --> UI1
  Host --> UI2
  Host --> UI3

  UI1 --> KC
  UI2 --> KC
  UI3 --> KC

  UI1 --> GW
  UI2 --> GW
  UI3 --> GW
```

---

## 7. –¢–∞–±–ª–∏—Ü–∞‚Äë—à–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ —Ä–æ–ª—è–º –∏ –∫–æ–º–∞–Ω–¥–∞–º

### 7.1 –ö—Ç–æ –∑–∞ —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç

| –°—É—â–Ω–æ—Å—Ç—å                      | –†–æ–ª—å                                           | –ü—Ä–∏–º–µ—Ä—ã –¥–µ–π—Å—Ç–≤–∏–π                                                                                                        |
| ----------------------------- | ---------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| GitLab project `npk/ois-cfa`  | Source of truth –¥–ª—è –∫–æ–¥–∞, compose –∏ CI         | –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º `.gitlab-ci.yml`, `deploy/docker-compose-at-vps/cfa2/*`                                                     |
| Runner –Ω–∞ vds1 —Å —Ç–µ–≥–æ–º `vds1` | Build –∏ deploy –∞–≥–µ–Ω—Ç                           | –í—ã–ø–æ–ª–Ω—è–µ—Ç `docker build` –∏ SSH –Ω–∞ `cfa2`                                                                                |
| GitLab Registry               | –•—Ä–∞–Ω–∏—Ç –æ–±—Ä–∞–∑—ã `api-gateway`, —Å–µ—Ä–≤–∏—Å–æ–≤, —Ñ—Ä–æ–Ω—Ç–æ–≤ | –¢–µ–≥–∏ `CI_COMMIT_SHORT_SHA`, `dev`, –ø–æ–∑–∂–µ `stage`, `prod`                                                                |
| cfa2                          | Dev‚Äë—Ö–æ—Å—Ç, —Ç–æ–ª—å–∫–æ `docker compose pull/up`      | `cd /srv/cfa && docker compose ps`, `logs`, `curl /health`                                                              |
| Cloudflare –¥–ª—è cfa2           | DNS –∏ TLS                                      | –ß–µ—Ä–µ–∑ `cloudflare-dns-upsert.sh` –∏ `.env.cfa2.telex`, –Ω–æ –ø–æ–∑–∂–µ, –ø–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ Dev ÓàÄfileciteÓàÇturn2file2ÓàÇturn2file15ÓàÅ |

### 7.2 –ß–∞—Å—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ì–¥–µ   | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å             | –ö–æ–º–∞–Ω–¥–∞                                               |
| ----- | ------------------------- | ----------------------------------------------------- |
| eywa1 | –ü—Ä–æ–≤–µ—Ä–∫–∞ runner‚Äô–∞         | `ssh root@vds1 "gitlab-runner list"`                  |
| eywa1 | –ó–∞–ø—É—Å–∫ deploy job –≤—Ä—É—á–Ω—É—é | –í GitLab UI ‚Üí Pipeline ‚Üí `deploy:cfa2`                |
| cfa2  | –í–µ—Ä—Å–∏–∏ docker –∏ compose   | `docker --version && docker compose version`          |
| cfa2  | –ß—Ç–æ –∑–∞–ø—É—â–µ–Ω–æ              | `docker compose -f /srv/cfa/docker-compose.yml ps`    |
| cfa2  | –õ–æ–≥–∏ gateway              | `docker logs -f api-gateway` –∏–ª–∏ –∏–º—è —Å–µ—Ä–≤–∏—Å–∞          |
| cfa2  | Health gateway            | `curl -i http://localhost:58081/health` (–ø–æ—Ä—Ç –ø–æ env) |

---

## 8. –õ—ë–≥–∫–∏–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ (–±–µ–∑ –æ–≤–µ—Ä–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞)

–ï—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å —Å–Ω–æ–≤–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Codex‚Äë–∞–≥–µ–Ω—Ç–∞, –≤–æ—Ç **—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π AGENT\_PROMPT**, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ä–∞–±–æ—Ç—É, –∞ –Ω–µ –∏–∑–æ–±—Ä–µ—Ç–∞–µ—Ç auto‚Äësetup –∑–∞–Ω–æ–≤–æ:

```markdown
ROLE: Senior DevOps engineer
LOCATION: eywa1 control plane
TARGETS: vds1 as GitLab runner, cfa2 as dev host
REPO PATH: /home/user/__Repositories/yury-customer/prj_Cifra-rwa-exachange-assets/repositories/customer-gitlab/ois-cfa

CONTEXT:
- cfa2 already has user with sudo and Docker plus Docker Compose, directory /srv/cfa exists.
- vds1 already has gitlab-runner registered and tag vds1 is available.
- Branch infra-ci-setup contains minimal CI with build-api-gateway and deploy-cfa2 via SSH.
- We want a SIMPLE dev pipeline: push -> build images on vds1 -> manual deploy to cfa2 with docker compose pull/up.
- No auto-setup of runners or tokens. No regeneration of docker-compose on cfa2 from CI; compose files should live in repo.

JTBD:
1. Stabilize dev pipeline for cfa2 (backend only, no tests).
2. Prepare compose and env for cfa2 in repo, not generated from CI.
3. Extend build matrix to include all backend services.
4. Document commands and URLs for manual checks.

CONSTRAINTS:
- Do not touch UK1 or cfa1 configs.
- Do not create or rotate runner tokens via API; assume runner on vds1 already exists.
- Use GitLab Registry as the only image registry.
- Keep deploy job manual (when: manual) in this iteration.

PHASES:

PHASE 0: Sync and inspection
- Checkout branch infra-ci-setup (or create dev-cfa2 branch from it).
- Read:
  - c2p_deploy.txt
  - deploy/docker-compose-at-vps/*
  - .gitlab-ci.yml
- Summarize current CI and docker-compose layout.

PHASE 1: Compose and env for cfa2 in repo
- Create deploy/docker-compose-at-vps/cfa2/docker-compose.yml and .env.dev
  - Include api-gateway and minimal set of backend services.
  - Use images from CI_REGISTRY_IMAGE with tag dev.
- Copy these files to /srv/cfa on cfa2 once (via ssh+scp).
- Verify: ssh user@cfa2 "cd /srv/cfa && docker compose up -d" works manually.

PHASE 2: CI build for backend images
- Update .gitlab-ci.yml:
  - Add build jobs for identity, issuance, registry, settlement, compliance using a shared template.
  - Tag images with CI_COMMIT_SHORT_SHA and dev for branch dev-cfa2.
- Make sure build jobs run only on branch dev-cfa2 (rules).

PHASE 3: CI deploy to cfa2
- Keep deploy:cfa2:
  - runs on tag vds1.
  - uses SSH_PRIVATE_KEY variable for user@cfa2.
  - runs docker login and docker compose pull/up in /srv/cfa.
- Ensure deploy job:
  - depends on all backend build jobs.
  - has when: manual and rules: only for branch dev-cfa2.
- Verify end-to-end:
  - Push test commit to dev-cfa2.
  - Wait for build jobs to finish green.
  - Click deploy:cfa2.
  - On cfa2, check docker compose ps and curl health on gateway and services.

DELIVERABLES:
- Updated .gitlab-ci.yml with build matrix and deploy job.
- deploy/docker-compose-at-vps/cfa2/docker-compose.yml and .env.dev committed.
- Short markdown note in docs/deploy or memory-bank with:
  - commands to run,
  - branch name,
  - cfa2 IP and ports for gateway and swagger,
  - checklist for manual verification.
```

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å –µ—â—ë –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π:

- —Ä–∞—Å–ø–∏—Å–∞—Ç—å **–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π `docker-compose.yml` –¥–ª—è cfa2 dev** (—Ç–æ–ª—å–∫–æ –±—ç–∫–∏ + keycloak, –±–µ–∑ —Ñ—Ä–æ–Ω—Ç–æ–≤),
- –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π —à–∞–≥ —É–∂–µ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–æ–≤ + Keycloak‚Äërealm, –∫–æ–≥–¥–∞ Dev‚Äë–±—ç–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ –∫—Ä—É—Ç—è—Ç—Å—è –Ω–∞ cfa2.


#### You:
<time datetime="2025-11-26T20:25:09.308Z" title="26/11/2025, 23:25:09">23:25</time>

–¢—ã —Å–¥–µ–ª–∞–ª –≤—Å–µ —á–µ—Ç–∫–æ!
–ò –∞–≥–µ–Ω—Ç —á—Ç–æ-—Ç–æ –¥–æ–¥–µ–ª–∞–ª —è –≤–∏–∂—É pipeline:build,deploy –Ω–æ –ø–æ–∫–∞ —Ç–æ–∫ –±–µ–∫–µ–Ω–¥–∞ –∏ —Ç–∞–º –∞–≥–µ–Ω—Ç —É–ø–µ—Ä—Å—è –≤ ssh key –º–æ–∂–µ—Ç –º–µ–ª–æ—á—å –º–æ–∂–µ—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≥–ª—É–±–∂–µ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –∏–ª–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–µ–µ –∏ –¥–æ–ª–±–∏—Ç—Å—è –≤ —Å—Ç–µ–Ω—É –∏–ª–∏ –ø–æ –¥—Ä—É–≥–æ–º—É –Ω–∏–∫–∞–∫?)
–•–æ—Ç—è —Å—Ç–æ–ø –∑–∞–∫–æ–Ω—á–∏–ª –∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –Ω–∞–¥–æ —ç—Ç–æ –ø–æ–ø—Ä–∞–≤–∏—Ç—å
```
[20:20] user@eywa-ubuntu-8gb-hel1-2 ois-cfa (dev-cfa2) $ ssh user@cfa2 "cd /srv/cfa && docker compose ps"
time="2025-11-26T20:20:41Z" level=warning msg="/srv/cfa/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
NAME      IMAGE     COMMAND   SERVICE   CREATED   STATUS    PORTS
[20:20] user@eywa-ubuntu-8gb-hel1-2 ois-cfa (dev-cfa2) $

```
–Ω–∏—Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∏–æ–¥–∏–Ω swagger http://92.51.38.126:58083/swagger

#BUT!
–Ω–æ —Ç–∞ –µ—â–µ –º–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –≤ JTBD, DoD, Kickoff tasks by Phases –∏ —á—Ç–æ–±—ã –∞–≥–µ–Ω—Ç –≤ Loop –¥–µ–ª–∞–ª –∞–≤—Ç–æ–Ω–æ–º–Ω–æ –∏ –ø—Ä–æ–≤–µ—Ä—è–ª –∏ –¥–æ–¥–µ–ª—ã–≤–∞–ª - —è –º–æ–≥—É –∏–ª–∏ –¥–∞–∂–µ –ª—É—á—à–µ –¥–∞—Ç—å –Ω–æ–≤–æ–º—É –∞–≥–µ–Ω—Ç—É —Å –Ω—É–ª—è –Ω–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –±—ã—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–º –∏ —Ç–æ—á–Ω—ã–º –¥–∞—Ç—å —Ç–∞–∫–æ–π comprehensive prompt + comprehensive context —á—Ç–æ–±—ã –∞–≥–µ–Ω—Ç –≤—Å–µ –ø—Ä–æ—á–∏—Ç–∞–ª –≤—Å–µ –≤—Å–µ –Ω—É–∂–Ω—ã–µ –¥–æ–∫–∏ –∏ —É–º–µ–ª –Ω–∞–π—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –¥–µ–ª–∞–ª –∏–∑ –≥–ª—É–±–æ–∫–æ vision –∏ –Ω–µ—É—à–µ–ª –≤–Ω–∏—Ç—É–¥–∞!

1) –º—ã –±–∏–ª–¥–∏–º –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–æ –∫–æ–º–∏—Ç—É –≤—Å–µ 8  services backend + frontend (investor,issuer,backoffice) –∞ –º–æ–∂–µ–º –¥–µ–ª–∞—Ç—å detect —Ç–æ–ª—å–∫–æ —Ç–µ —á–µ–π –∫–æ–¥ –∏–∑–º–µ–Ω–∏–ª—Å—è –∏ –∏—Ö? –≤–µ–¥—å —ç—Ç–æ –∫–∞–∂–µ—Ç—Å—è –æ—á–µ–≤–∏–¥–Ω—ã–º, –ø–æ—á–µ–º—É —Ç–∞–∫ —Å—Ä–∞–∑—É –Ω–µ —Å–¥–µ–ª–∞—Ç—å?
2) –¥–∞–ª—å—à–µ –µ—Å—Ç—å –∂–µ –µ—â–µ sdk —á–µ —Å –Ω–∏–º–∏ –∫–∞–∫ —ç—Ç–æ –±—É–¥–µ—Ç images –∏–ª–∏ –∫–∞–∫ –¥–æ–ª–∂–Ω–æ –±–∏–ª–¥—Ç—Å—è? —ç—Ç–æ —Ç–æ–ª—å–∫–æ –∫ gateway –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è –∏–ª–∏ —á—Ç–æ –≥–¥–µ –∫–æ–≥–¥–∞?)
```
ois-cfa (develop) ‚ùØ tree -d packages -L 3                                                                                                                           23:05:27
packages
‚îú‚îÄ‚îÄ contracts
‚îÇ   ‚îî‚îÄ‚îÄ schemas
‚îú‚îÄ‚îÄ domain
‚îÇ   ‚îî‚îÄ‚îÄ domain.Tests
‚îú‚îÄ‚îÄ dotnet-clients
‚îÇ   ‚îú‚îÄ‚îÄ gateway
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ docs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ src
‚îÇ   ‚îî‚îÄ‚îÄ identity
‚îÇ       ‚îú‚îÄ‚îÄ api
‚îÇ       ‚îú‚îÄ‚îÄ docs
‚îÇ       ‚îî‚îÄ‚îÄ src
‚îú‚îÄ‚îÄ sdks
‚îÇ   ‚îú‚îÄ‚îÄ ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dist
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ node_modules
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ src
‚îÇ   ‚îî‚îÄ‚îÄ typescript-gateway
‚îÇ       ‚îú‚îÄ‚îÄ apis
‚îÇ       ‚îú‚îÄ‚îÄ docs
‚îÇ       ‚îî‚îÄ‚îÄ models
‚îî‚îÄ‚îÄ types
    ‚îî‚îÄ‚îÄ ts
        ‚îú‚îÄ‚îÄ scripts
        ‚îî‚îÄ‚îÄ src

26 directories
ois-cfa (develop) ‚ùØ 
```
3) –Ω—É–∂–Ω–æ –≤—Å–µ —Ç–∞–∫–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å `c2p_deploy.txt`, `c2p_uk1.txt` –∫–æ–Ω—Ñ–∏–≥–∏ –µ—Å—Ç—å –ª–∏ —á—Ç–æ —Ç–∞–º –ø–æ–ª–µ–∑–Ω–æ–µ?
3.1) uk1 (—Ç–∞–º –∞–≥–µ–Ω—Ç –Ω–∞ –¥–æ–º–µ–Ω–µ https://investor.cfa.llmneighbors.com/ –¥–æ–±–∏–ª—Å—è —á—Ç–æ –∏ –ø–æ—á—Ç–∞ –¥–∞–∂–µ postfix —Ä–∞–±–æ—Ç–∞–ª–∞ –∏ –¥–æ—Ö–æ–¥–∏–ª–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —Ç–ø - –Ω–æ —Ç–∞–º –±–µ–∑ –¥–æ–∫–µ—Ä–æ–≤ –∏ –≤ —Ü–µ–ª–æ–º –∞–±—ã –∫–∞–∫ –∏ —Å—Ç–∞—Ä—ã–π –ø–∏–∑–¥–µ—Ü –∫–æ–¥ )
3.2) cfa1 ( https://investor.cfa1.llmneighbors.com/ –∏ –ø—Ä–æ—á–∏–µ –¥–æ–º–µ–Ω—ã —Ç—É—Ç –∫–æ–Ω–µ—á–Ω–æ –±—ã–ª–∏ –±–∞–≥–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–Ω –±—ã–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å https –∏ –Ω–µ –¥–æ—à–ª–∏ –¥–æ postfix –Ω–æ –≤—Å–µ –∂–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—Ç–∞–ª–æ –∏ –æ—Ç–¥–µ–ª—å–Ω–æ –≤ keycloak admin –º–æ–∂–Ω–æ –ø–æ–ª–∞–∑–∏—Ç—å —Ç–∞–º –ø—Ä–æ—Å—Ç–æ —Å keycloak api –Ω—É–∂–Ω–æ –±—ã–ª–æ –¥–æ–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Ö–æ–¥—É –≤—Å–µ —Å next frontends - —Ç—É—Ç —Ç–æ–∂–µ –±–µ–∫–µ–Ω–¥ –∏ –∫–ª–∏–µ–Ω—Ç—ã –∫–∞–∂–∏—Å—å –±–µ–∑ –¥–æ–∫–µ—Ä–æ–≤ –∞ —Ñ—Ä–æ–Ω—Ç—ã pm2)
–ù–∞–¥–æ –ø–µ—Ä–µ–Ω—è—Ç—å –æ–ø—ã—Ç –∏ –≤—Å–µ —Ç–∞–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—å –∏ –æ–±—â–∏–π –¥–æ–∫ –∏ —Å—Ö–µ–º—ã —á—Ç–æ –µ—Å—Ç—å –µ—â–µ –∫–∞–∫ –∫—Ä—É—Ç–∏—Ç—Å—è —Ç–∞–º nginx –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Å—Ç—Ä–æ–µ —Å ssl lets encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ –∏–ª–∏ –∫–∞–∫ —Ç–∞–º? —É –Ω–∞—Å –∂–µ –µ—â–µ cloudflare cli –∞–≥–µ–Ω—Ç—É –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –æ–Ω –Ω–∞—Å—Ç—Ä–æ–∏—Ç –≤—Å–µ –Ω–∞ `*.telex.global`  docs/deploy/MULTI_ACCOUNT_SETUP.md  –∏–ª–∏ –∫–∞–∫ —Ç–∞–º –Ω–∞–∑–æ–≤–µ–º
–≤—Å–µ –Ω—É–∂–Ω–æ –¥–æ–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –¥–æ–¥–µ–ª–∞—Ç—å –∏ –Ω–µ –ø–ª–æ–¥–∏—Ç—å –∫—É—á—É –¥–æ–∫–æ–≤ - –ø–µ—Ä–µ—à–µ—Ä—Å—Ç–∏—Ç—å —á—Ç–æ–±—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –±—ã–ª–∏ - –∏ –∫–æ–º–∏—Ç–∏—Ç—å 
–î–∞–≤–∞–π —Ç–∞–∫–æ–π –ø—Ä–æ–º–ø—Ç –Ω–∞–ø–∏—à–∏ —á—Ç–æ–±—ã –æ–Ω –≤—Å—é –Ω–æ—á—å —Ö–æ—Ç—å —Ä–∞–±–æ—Ç–∞–ª –ø–æ–∫–∞ –Ω–µ–¥–æ–¥–µ–ª–∞–µ—Ç —Ç–æ–∫ –≥–ª–∞–≤–Ω–æ–µ —á—Ç–æ–±—ã –∫–æ–º–∏—Ç–∏–ª –∏ –¥–µ–ª–∞–ª –≤—Å–µ observable, iterative senior level; –µ—â–µ –≤–∞–∂–Ω–æ –Ω–æ–≤—ã–π –∏–ª–∏ —Å—Ç–∞—Ä—ã–π –∞–≥–µ–Ω—Ç —Å compact –ø—É—Å—Ç—å —É –Ω–µ–≥–æ 51% (–º–æ–∂–Ω–æ –µ–º—É summary –Ω–∞–ø–∏—Å–∞—Ç—å codex-cli —É–≤–µ–ª–∏—á–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–±—É–¥–µ—Ç –ª–∏—à–Ω–µ–µ —Ç–æ–∫ —Å–∫–∞–∑–∞—Ç—å —á—Ç–æ–±—ã –≤ –¥–æ–∫–∞—Ö –ø—Ä–æ–ø–∏—Å–∞–ª –∏ –∑–∞–∫–æ–º–∏—Ç–∏–ª –µ—â–µ –Ω–∞ –≤—Å—è–∫ —Å–ª—É—á–∞–π) –æ—Å—Ç–∞–ª–æ—Å—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á—Ç–æ –Ω–µ–º–∞–ª–æ –∫–æ–Ω–µ—á–Ω–æ


#### ChatGPT:
<time datetime="2025-11-26T20:38:20.604Z" title="26/11/2025, 23:38:20">23:38</time>

–û–∫, –¥–∞–≤–∞–π –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –∏ —Å—Ä–∞–∑—É –¥–∞–º —Ç–µ–±–µ –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞.

–°–µ–π—á–∞—Å —á—Ç–æ –µ—Å—Ç—å –ø–æ —Ñ–∞–∫—Ç—É:

- –ü–∞–π–ø–ª–∞–π–Ω `build / deploy` —É–∂–µ –µ—Å—Ç—å –Ω–∞ –≤–µ—Ç–∫–µ `infra-ci-setup`, –±–∏–ª–¥–∏—Ç –∫–∞–∫ –º–∏–Ω–∏–º—É–º `api-gateway` –Ω–∞ `vds1` –∏ –¥–µ–ø–ª–æ–∏—Ç –Ω–∞ `cfa2` —á–µ—Ä–µ–∑ SSH –∏ `docker compose pull && docker compose up -d`.ÓàÄfileciteÓàÇturn1file10ÓàÇturn1file15ÓàÅ
- –ù–∞ `cfa2` Docker –∏ Compose —Å—Ç–æ—è—Ç, `/srv/cfa` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –ª–∏–±–æ `docker-compose.yml` –Ω–µ—Ç, –ª–∏–±–æ –æ–Ω ¬´–ø—É—Å—Ç–æ–π¬ª ‚Äì `docker compose ps` –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å–æ–≤.ÓàÄfileciteÓàÇturn1file10ÓàÇturn1file17ÓàÅ
- –í `c2p_deploy.txt` –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è:
  - docker-compose –∏ `.env` –¥–ª—è `cfa2` –¥–æ–ª–∂–Ω—ã –∂–∏—Ç—å **–≤ —Ä–µ–ø–æ**,
  - Cloudflare / DNS / TLS –¥–µ–ª–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ `.env.cfa1`, `.env.cfa2.telex`, —Å–∫—Ä–∏–ø—Ç `cloudflare-dns-upsert.sh` –∏ runbook‚Äô–∏, –∞ –Ω–µ –º–∞–≥–∏–µ–π –∏–∑ CI.ÓàÄfileciteÓàÇturn1file11ÓàÇturn1file16ÓàÅ
- –î–ª—è UK1 –µ—Å—Ç—å Nginx-–∫–æ–Ω—Ñ–∏–≥ –∏ keycloak-proxy, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —ç—Ç–∞–ª–æ–Ω –¥–ª—è —Å—Ö–µ–º—ã ingress, –Ω–æ –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å —Ä—É–∫–∞–º–∏ (uk1 –∏ cfa1 –Ω–µ —Ç—Ä–æ–≥–∞–µ–º).ÓàÄfileciteÓàÇturn1file6ÓàÇturn1file16ÓàÅ

–ò —Ç–≤–æ–∏ –Ω–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

1. CI –¥–æ–ª–∂–µ–Ω –±–∏–ª–¥–∏—Ç—å **–≤—Å–µ –Ω—É–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏ —Ñ—Ä–æ–Ω—Ç—ã**, –Ω–æ —É–º–Ω–æ:
   - —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è: –≤—Å—ë –¥–ª—è –≤–µ—Ç–∫–∏ `dev-cfa2` (–∏–ª–∏ –∫–∞–∫ –º—ã –µ—ë –Ω–∞–∑–æ–≤—ë–º), –±–µ–∑ —Ç–µ—Å—Ç–æ–≤;
   - –ø–æ—Ç–æ–º ‚Äì –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –±–∏–ª–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (–ø–æ –ø—É—Ç—è–º).
2. –ù—É–∂–µ–Ω –ø–æ–Ω—è—Ç–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è SDK:
   - TypeScript SDK + dotnet-–∫–ª–∏–µ–Ω—Ç—ã ‚Äì —ç—Ç–æ **–Ω–µ docker-–æ–±—Ä–∞–∑—ã**, –∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ job‚Äô—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ `make generate-sdks` / `npm build`, —Ç—Ä–∏–≥–≥–µ—Ä—è—â–∏–µ—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `packages/contracts/**`, `packages/sdks/**`, `packages/types/**`.ÓàÄfileciteÓàÇturn0file14ÓàÇturn0file17ÓàÅ
3. –û–ø—ã—Ç uk1/cfa1 –Ω—É–∂–Ω–æ **–ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –¥–æ–∫–∏ –∏ —Å—Ö–µ–º—É**, –Ω–æ –Ω–µ –ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–µ–Ω–¥—ã:
   - Cloudflare multi-account (`llmneighbors.com` vs `telex.global`), `.env.cfa1` / `.env.cfa2.telex`, helper-—Å–∫—Ä–∏–ø—Ç `cloudflare-dns-upsert.sh`.ÓàÄfileciteÓàÇturn1file1ÓàÇturn1file16ÓàÅ
   - Nginx-—à–∞–±–ª–æ–Ω `nginx-cfa-portals.conf` –∫–∞–∫ —ç—Ç–∞–ª–æ–Ω –¥–ª—è —Å—Ö–µ–º—ã –ø–æ—Ä—Ç–∞–ª—ã + API + Keycloak –∑–∞ –æ–¥–Ω–∏–º ingress.ÓàÄfileciteÓàÇturn1file6ÓàÅ
4. –ù–æ–≤—ã–π –∞–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ —Ñ–∞–∑–∞–º, –ø–æ JTBD/DoD, –¥–µ–ª–∞—Ç—å –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã, –Ω–µ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏–≤–∞—Ç—å compose –Ω–∞ `cfa2` –≤ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ, –∞ –±—Ä–∞—Ç—å –µ–≥–æ –∏–∑ —Ä–µ–ø–æ.ÓàÄfileciteÓàÇturn1file0ÓàÇturn1file4ÓàÅ

---

## 1. JTBD –∏ DoD –¥–ª—è –Ω–æ–≤–æ–≥–æ CI/CD –∞–≥–µ–Ω—Ç–∞

**–§–æ–∫—É—Å:** `dev` –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–∞ `cfa2`, CI –Ω–∞ GitLab, –±–∏–ª–¥ –Ω–∞ `vds1`, registry GitLab.

### Jobs

- **J1. –ü–æ—á–∏–Ω–∏—Ç—å –∏ —É–ø—Ä–æ—Å—Ç–∏—Ç—å dev-–ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è cfa2 (backend-only, –±–µ–∑ —Ç–µ—Å—Ç–æ–≤).**
  - Docker images –¥–ª—è: `api-gateway`, `identity`, `issuance`, `registry`, `settlement`, `compliance` (+ –ø–æ –∂–µ–ª–∞–Ω–∏—é `fabric-gateway`, `bank-nominal`).ÓàÄfileciteÓàÇturn0file12ÓàÇturn0file14ÓàÅ
  - docker-compose –∏ `.env` –¥–ª—è `cfa2` –∂–∏–≤—É—Ç –≤ —Ä–µ–ø–æ (`deploy/docker-compose-at-vps/cfa2/**`) –∏ –æ–¥–∏–Ω —Ä–∞–∑ —Å–∏–Ω–∫–∞—é—Ç—Å—è –Ω–∞ `/srv/cfa` (—Å–∫—Ä–∏–ø—Ç –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞).ÓàÄfileciteÓàÇturn1file0ÓàÇturn1file3ÓàÅ
  - –ü–∞–π–ø–ª–∞–π–Ω: `push ‚Üí build images on vds1 ‚Üí manual deploy-cfa2 ‚Üí docker compose pull/up ‚Üí —Å–µ—Ä–≤–∏—Å—ã –ø–æ–¥–Ω—è–ª–∏—Å—å (Swagger –∂–∏–≤)`.

- **J2. –†–∞—Å—à–∏—Ä–∏—Ç—å –ø–∞–π–ø–ª–∞–π–Ω: —Ñ—Ä–æ–Ω—Ç—ã issuer/investor/backoffice —á–µ—Ä–µ–∑ gateway+Keycloak.**
  - –û–±—Ä–∞–∑—ã/–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è `portal-issuer`, `portal-investor`, `backoffice` (Next.js).ÓàÄfileciteÓàÇturn0file14ÓàÅ
  - Env –∏ –ø–æ—Ä—Ç—ã —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã —Å uk1-–∫–æ–Ω—Ñ–∏–≥–æ–º (Keycloak proxy + Nginx —Å—Ö–µ–º–∞), –Ω–æ –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ uk1.ÓàÄfileciteÓàÇturn1file6ÓàÅ

- **J3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–±–æ—Ä–∫—É: path-based build matrix.**
  - Build jobs –∏–º–µ—é—Ç `rules:changes` –ø–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º, —á—Ç–æ–±—ã –Ω–µ –≥–æ–Ω—è—Ç—å –≤–µ—Å—å –∑–æ–æ–ø–∞—Ä–∫ –Ω–∞ –∫–∞–∂–¥—ã–π –∫–æ–º–º–∏—Ç.ÓàÄfileciteÓàÇturn0file14ÓàÅ

- **J4. –û—Ñ–æ—Ä–º–∏—Ç—å SDK-–ø–∞–π–ø–ª–∞–π–Ω.**
  - –û—Ç–¥–µ–ª—å–Ω—ã–π stage `specs/sdk`:
    - `make validate-specs` + `make generate-sdks` –¥–ª—è TypeScript –∏ dotnet –∫–ª–∏–µ–Ω—Ç–æ–≤.ÓàÄfileciteÓàÇturn0file16ÓàÇturn0file17ÓàÅ
    - Job‚Äô—ã —Ç—Ä–∏–≥–≥–µ—Ä—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤/SDK.

- **J5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ deploy-—Ä—É—Ç–∏–Ω:**
  - –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –¥–æ–∫–∏ –≤ `docs/deploy` –∏/–∏–ª–∏ `docs/ops`:

    - `docs/deploy/MULTI_ACCOUNT_SETUP.md` ‚Äì –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ multi-account Cloudflare –∏–∑ `c2p_deploy.txt`.ÓàÄfileciteÓàÇturn1file11ÓàÇturn1file18ÓàÅ
    - –¢–∞–±–ª–∏—Ü–∞ `Service ‚Üí URL ‚Üí Health ‚Üí Notes` –¥–ª—è `uk1`, `cfa1`, `cfa2`.ÓàÄfileciteÓàÇturn1file16ÓàÅ
    - –ö—Ä–∞—Ç–∫–∏–π runbook –¥–ª—è `cfa2`: –∫–∞–∫ —Ä—É–∫–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ –¥–µ—Ä–Ω—É—Ç—å `deploy-cfa2`, –∫–∞–∫–∏–µ Swagger/–ø–æ—Ä—Ç–∞–ª—ã –¥–æ–ª–∂–Ω—ã –æ—Ç–≤–µ—á–∞—Ç—å.

### Definition of Done (–ø–æ —ç—Ç–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏)

- [ ] –í–µ—Ç–∫–∞ `dev-cfa2` (–∏–ª–∏ `infra-ci-setup` ‚Üí `dev-cfa2`) —Å —Ä–∞–±–æ—á–∏–º CI:
  - [ ] Jobs build-<service> –¥–ª—è –≤—Å–µ—Ö –Ω—É–∂–Ω—ã—Ö –±—ç–∫–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç –∏ –ø—É—à–∞—Ç –æ–±—Ä–∞–∑—ã –≤ GitLab Registry.
  - [ ] Job deploy-cfa2 —Ä—É–∫–∞–º–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑ UI –∏ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –≤—Å–µ backend —Å–µ—Ä–≤–∏—Å—ã –Ω–∞ `cfa2` (Swagger –¥–æ—Å—Ç—É–ø–µ–Ω).
- [ ] docker-compose –¥–ª—è `cfa2` –ª–µ–∂–∏—Ç –≤ —Ä–µ–ø–æ –≤ `deploy/docker-compose-at-vps/cfa2/docker-compose.yml`, –∞ –Ω–∞ `cfa2` —Ç–æ–ª—å–∫–æ —Å–∏–Ω–∫–∞–µ—Ç—Å—è (–±–µ–∑ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑ CI).ÓàÄfileciteÓàÇturn1file0ÓàÇturn1file17ÓàÅ
- [ ] –§—Ä–æ–Ω—Ç—ã issuer/investor/backoffice –¥–µ–ø–ª–æ—è—Ç—Å—è –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ gateway (–ø–æ–∫–∞ –º–æ–∂–Ω–æ IP+–ø–æ—Ä—Ç, –¥–æ–º–µ–Ω—ã —á–µ—Ä–µ–∑ Cloudflare ‚Äì –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ñ–∞–∑–∞).
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω path-based build (–º–∏–Ω–∏–º—É–º –ø–æ backend —Å–µ—Ä–≤–∏—Å–∞–º).
- [ ] –ï—Å—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `docs/deploy/...` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:
  - [ ] –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –ø–∞–π–ø–ª–∞–π–Ω;
  - [ ] –∫–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏;
  - [ ] –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Cloudflare-helpers –¥–ª—è `cfa2/telex.global`.ÓàÄfileciteÓàÇturn1file1ÓàÇturn1file11ÓàÅ

---

## 2. –¢–∞–±–ª–∏—á–∫–∞: —á—Ç–æ –±–∏–ª–¥–∏–º –∏ –∫–æ–≥–¥–∞

–ß–µ—Ä–µ–∑ —ç—Ç—É —Ç–∞–±–ª–∏—Ü—É –∞–≥–µ–Ω—Ç—É –ø—Ä–æ—â–µ –±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `rules:changes`.

| Component          | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è                           | –¢–∏–ø –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞      | CI job stage | –ö–æ–≥–¥–∞ –±–∏–ª–¥–∏—Ç—å (changes)                                                 |
| ------------------ | ------------------------------------ | ------------------ | ------------ | ----------------------------------------------------------------------- |
| api-gateway        | `apps/api-gateway`                   | Docker image       | build        | `apps/api-gateway/**`, `packages/contracts/**`                          |
| identity           | `services/identity`                  | Docker image       | build        | `services/identity/**`, `packages/domain/**`, `packages/contracts/**`   |
| issuance           | `services/issuance`                  | Docker image       | build        | `services/issuance/**`, `packages/domain/**`, `packages/contracts/**`   |
| registry           | `services/registry`                  | Docker image       | build        | `services/registry/**`, `packages/domain/**`, `packages/contracts/**`   |
| settlement         | `services/settlement`                | Docker image       | build        | `services/settlement/**`, `packages/domain/**`, `packages/contracts/**` |
| compliance         | `services/compliance`                | Docker image       | build        | `services/compliance/**`, `packages/domain/**`, `packages/contracts/**` |
| fabric-gateway     | `services/fabric-gateway`            | Docker image       | build        | `services/fabric-gateway/**`                                            |
| bank-nominal       | `services/integrations/bank-nominal` | Docker image       | build        | `services/integrations/bank-nominal/**`                                 |
| portal-issuer      | `apps/portal-issuer`                 | Docker container   | build        | `apps/portal-issuer/**`, `apps/shared-ui/**`, `packages/sdks/**`        |
| portal-investor    | `apps/portal-investor`               | Docker container   | build        | `apps/portal-investor/**`, `apps/shared-ui/**`, `packages/sdks/**`      |
| backoffice         | `apps/backoffice`                    | Docker container   | build        | `apps/backoffice/**`, `apps/shared-ui/**`, `packages/sdks/**`           |
| TS SDK             | `packages/sdks/ts`                   | npm package / dist | sdk          | `packages/contracts/**`, `packages/sdks/ts/**`, `packages/types/**`     |
| TS gateway SDK     | `packages/sdks/typescript-gateway`   | npm package / dist | sdk          | `packages/contracts/**`, `packages/sdks/typescript-gateway/**`          |
| dotnet gateway SDK | `packages/dotnet-clients/gateway`    | nuget / dll        | sdk          | `packages/contracts/**`, `packages/dotnet-clients/gateway/**`           |

---

## 3. –ù–æ–≤—ã–π AGENT\_PROMPT –¥–ª—è Codex CLI

–ù–∏–∂–µ ‚Äî —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–æ—á—Ç–∏ —Ü–µ–ª–∏–∫–æ–º –∫–æ–ø–∏–ø–∞—Å—Ç–∏—Ç—å –≤ `codex --yolo` –Ω–∞ `eywa1`. –Ø –∑–∞—Ç–æ—á–∏–ª –µ–≥–æ –ø–æ–¥ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –≤–µ—Ç–∫—É `infra-ci-setup`, –Ω–æ –∞–≥–µ–Ω—Ç—É –º–æ–∂–Ω–æ —è–≤–Ω–æ —Å–∫–∞–∑–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å `dev-cfa2` –ø–æ–≤–µ—Ä—Ö –Ω–µ—ë.

```markdown
ROLE: You are a Senior DevOps Engineer and my "CI/CD digital twin".

LOCATION:
- Control plane: eywa1 (this session).
- Build node: vds1 (GitLab runner, tag vds1).
- Dev target: cfa2 (Docker host for dev environment).

REPO:
- /home/user/__Repositories/yury-customer/prj_Cifra-rwa-exachange-assets/repositories/customer-gitlab/ois-cfa

CLUSTERS / HOSTS:
- GitLab: git.telex.global (project npk/ois-cfa).
- Registry: GitLab Container Registry for npk/ois-cfa.
- cfa2: 92.51.38.126, user "user" with sudo, Docker + Compose installed, /srv/cfa exists.
- vds1: 167.235.11.150, gitlab-runner already installed and registered (tag vds1).

HARD CONSTRAINTS:
- Do NOT touch UK1 or cfa1 configs. They are reference-only.
- Docker and docker-compose are ALREADY installed on cfa2, /srv/cfa ALREADY exists.
- GitLab runner on vds1 ALREADY exists; do not create new runners or tokens.
- Cloudflare and TLS are managed by env files and helper scripts, NOT by CI.
- docker-compose and .env for cfa2 must live in the repo and be synced to /srv/cfa, NOT generated inline on every deploy.

MUST READ BEFORE ANY EDIT:
- docs/deploy/** (especially MULTI_ACCOUNT_SETUP.md when it exists).
- c2p_deploy.txt
- c2p_uk1.txt
- ops/gitlab-ci.md or similar CI docs (if present).
- architecture/ois-cfa.reposcan.json (to understand services/apps structure).
- tasks/NX-05..NX-08-*.md (only to understand UX/flows, not to implement features).

---

## JTBD for this session

J1. Stabilize a simple dev pipeline for cfa2 for ALL backend services (no tests yet).
J2. Add frontends (issuer, investor, backoffice) to the same pipeline and docker-compose for cfa2.
J3. Introduce path-based build rules so only changed services/frontends/SDKs rebuild.
J4. Wire SDK generation (TS + dotnet) as separate jobs triggered only by contract/SDK changes.
J5. Update deploy documentation and cheatsheets so humans and other agents can repeat and extend this.

---

## Definition of Done (DoD) for this session

- A dedicated branch (e.g. dev-cfa2) exists and has:
  - CI stages: [build, deploy, sdk] (tests can be added later).
  - Build jobs for: api-gateway, identity, issuance, registry, settlement, compliance, optional fabric-gateway, bank-nominal.
  - Deploy job deploy-cfa2 that:
    - runs on tag vds1,
    - logs into GitLab registry,
    - runs docker compose pull/up in /srv/cfa on cfa2 WITHOUT recreating docker-compose.yml/.env.
- docker-compose and .env for cfa2:
  - live in repo under deploy/docker-compose-at-vps/cfa2/,
  - are copied once to /srv/cfa on cfa2 using a small helper script or documented one-time command.
- Frontends (portal-issuer, portal-investor, backoffice) are added to docker-compose for cfa2 and build jobs exist for their images.
- Path-based rules: each build job has rules:changes pointing to its relevant directories (services/*, apps/*, packages/*).
- There is a short doc update in docs/deploy/ and/or docs/ops describing:
  - the pipeline stages and jobs,
  - deployment flow to cfa2,
  - basic URLs and health endpoints on cfa2,
  - Cloudflare helper usage for cfa2 (telex.global) referencing c2p_deploy.txt.

---

## Workflow Contract

Always follow loop:

  {code-change} ‚Üí {tests or at least docker build/compose dry-run} ‚Üí {docs/DoD-update} ‚Üí {git commit}

Every meaningful change must include:
- code/config change (.gitlab-ci.yml, deploy/docker-compose-at-vps/cfa2, ops/scripts/**),
- small verification (docker compose config, curl /health, GitLab pipeline status),
- docs update (docs/deploy/** or c2p_deploy.txt if relevant),
- a single focused commit.

Autonomy level: 3 (full).
Ask the user ONLY if you hit a hard blocker (no access, broken SSH, etc.).

---

## PHASES

### PHASE 0 ‚Äì Sync and context

1. Ensure you are in ois-cfa repo on eywa1:
   - git status -sb
   - git branch -a

2. Switch to branch infra-ci-setup or create dev-cfa2 from it:
   - git checkout infra-ci-setup
   - git checkout -b dev-cfa2  # if not yet

3. Read and summarize (in your own scratchpad, but also in a doc if useful):
   - c2p_deploy.txt (Cloudflare multi-account, cfa1/cfa2 envs).
   - c2p_uk1.txt (nginx + keycloak proxy layout for cfa.llmneighbors.com).
   - architecture/ois-cfa.reposcan.json (services/apps/packages layout).
   - docs/deploy/** (especially any cfa1/uk1 runbooks).

Do NOT change anything yet. Only after you understand the current CI and deploy model.

---

### PHASE 1 ‚Äì Backend compose and deploy for cfa2

Goal: make deploy-cfa2 bring up all backend services with static compose files stored in repo.

1. Compose in repo:
   - Create directory deploy/docker-compose-at-vps/cfa2/.
   - Add:
     - deploy/docker-compose-at-vps/cfa2/docker-compose.yml
     - deploy/docker-compose-at-vps/cfa2/.env.example (or .env.cfa2.template)
   - Base them on existing docker-compose.yml and docker-compose.services.yml, but keep it minimal:
     - postgres
     - keycloak
     - api-gateway
     - identity
     - issuance
     - registry
     - settlement
     - compliance
     - optional: redis, kafka, minio if needed by services

   Environment:
     - use CI_REGISTRY_IMAGE and TAG env for images (e.g. REGISTRY_IMAGE, TAG) so deploy job can set them.
     - map ports so swagger is reachable:
       - gateway: 58081
       - identity: 58082
       - issuance: 58083
       - registry: 58084
       - settlement: 58085
       - compliance: 58086
       (or reuse what is already defined in project docs).

2. Sync to cfa2:
   - Create a small helper script ops/scripts/sync-compose-cfa2.sh that:
     - scp .env + docker-compose.yml from deploy/docker-compose-at-vps/cfa2 to user@cfa2:/srv/cfa/.
   - Run it once manually from eywa1 to ensure /srv/cfa/.env and /srv/cfa/docker-compose.yml exist.
   - Verify manually:
     - ssh user@cfa2 "cd /srv/cfa && docker compose config"
     - ssh user@cfa2 "cd /srv/cfa && docker compose ps"  # may be empty before first up

3. Fix deploy-cfa2 job in .gitlab-ci.yml:
   - It MUST:
     - use image docker:24 (or similar) with docker:24-dind service.
     - login to GitLab registry.
     - ssh to user@cfa2.
     - export REGISTRY_IMAGE and TAG (e.g. CI_REGISTRY_IMAGE and CI_COMMIT_SHORT_SHA or environment-specific tag such as dev).
     - run:
       - cd /srv/cfa
       - docker compose pull
       - docker compose up -d
     - NOT re-create .env or docker-compose.yml over SSH.

4. Verification:
   - Push dev-cfa2 branch.
   - Start pipeline and run build jobs + manual deploy-cfa2.
   - After deploy:
     - ssh user@cfa2 "cd /srv/cfa && docker compose ps"
     - curl "http://92.51.38.126:58081/swagger/index.html" and equivalent for other services.

Document all ports and URLs in a short markdown under docs/deploy/ or docs/ops.

---

### PHASE 2 ‚Äì Frontend containers for cfa2

Goal: add portal-issuer, portal-investor, backoffice to cfa2 compose and CI build.

1. Identify frontend dockerfiles or patterns:
   - apps/portal-issuer
   - apps/portal-investor
   - apps/backoffice

   Check if there are existing Dockerfiles or patterns for Next.js apps.

2. Extend deploy/docker-compose-at-vps/cfa2/docker-compose.yml:
   - Add services:
     - portal-issuer
     - portal-investor
     - backoffice
   - Use env compatible with UK1 nginx template:
     - ports: 3001, 3002, 3003 (host ports on cfa2).
   - Make sure API_BASE_URL and KEYCLOAK_URL point to gateway and keycloak running on cfa2.
   - For now, you can expose them directly on IP:port; domains will be attached later via Cloudflare and nginx.

3. CI build jobs:
   - Add build-portal-issuer, build-portal-investor, build-backoffice jobs.
   - Use Node 20 + npm ci + next build or docker builds with Next.js base image.
   - Push images to GitLab registry with tags:
     - $CI_REGISTRY_IMAGE/portal-issuer:$CI_COMMIT_SHORT_SHA
   - Make deploy-cfa2 depend on these jobs.

4. Verification:
   - Run pipeline on dev-cfa2.
   - After deploy, check:
     - curl http://92.51.38.126:3001 (HTML)
     - curl http://92.51.38.126:3002
     - curl http://92.51.38.126:3003

---

### PHASE 3 ‚Äì Path-based build matrix

Goal: build only what changed.

1. Use the table from the human message (Services vs Paths) and architecture/ois-cfa.reposcan.json to configure rules:changes for build jobs.
   - Example for build-issuance:

     rules:
       - if: '$CI_COMMIT_BRANCH == "dev-cfa2"'
         changes:
           - "services/issuance/**"
           - "packages/domain/**"
           - "packages/contracts/**"

   - Repeat for:
     - identity, registry, settlement, compliance, api-gateway.
     - frontends: portal-issuer, portal-investor, backoffice.
     - SDK jobs: packages/sdks/**, packages/contracts/**, packages/types/**.

2. Keep deploy-cfa2 always available on dev-cfa2, but it should have needs: only on jobs that might produce images for current commit.

3. Document the mapping in docs/deploy/CI-BUILD-MATRIX.md or similar.

---

### PHASE 4 ‚Äì SDK jobs (TS + dotnet)

Goal: bring `make validate-specs` and `make generate-sdks` into CI with proper triggers.

1. Add stage "sdk" before "build" or after "build" depending on Makefile; usually before.

2. Add job validate-specs:
   - runs:
     - make validate-specs
   - rules:
     - changes:
       - "packages/contracts/**"
       - "packages/types/**"

3. Add job generate-sdks:
   - runs:
     - make generate-sdks
   - rules:
     - changes:
       - "packages/contracts/**"
       - "packages/sdks/**"
       - "packages/types/**"
   - Optionally produce artifacts (compressed dist/ or nuget packages) but do not publish yet.

4. Make build jobs depend on validate-specs (and optionally generate-sdks) so broken contracts or SDK generation will fail early.

5. Document:
   - how to run same commands locally,
   - where artifacts are stored.

---

### PHASE 5 ‚Äì Docs and Cloudflare linkage (no automation here)

Goal: reflect the new reality in docs and tie it to existing c2p_deploy / uk1 docs.

1. Update docs/deploy/MULTI_ACCOUNT_SETUP.md (or create it) using c2p_deploy.txt:
   - Show env examples:
     - .env.cfa1 (llmneighbors.com)
     - .env.cfa2.telex (telex.global)
   - Show how to use ops/scripts/cloudflare-dns-upsert.sh to upsert auth|issuer|investor|backoffice|api for cfa2.
   - Emphasize that these scripts are run manually from eywa1, not in CI.

2. Add table for all environments (uk1, cfa1, cfa2):
   - Service ‚Üí URL ‚Üí Health endpoint ‚Üí Notes.
   - Use c2p_uk1.txt nginx config as reference for uk1 hostnames.

3. Add a short docs/deploy/cfa2.md:
   - How to trigger dev pipeline.
   - How to verify backend Swagger and frontends.
   - How to update compose on cfa2 if structure changes (use sync-compose-cfa2.sh).

---

## FINAL SELF-CHECK (agent MUST run before ending)

- [ ] CI pipeline for dev-cfa2 passes build jobs for backends and frontends.
- [ ] Manual deploy-cfa2 successfully starts containers on cfa2 and Swagger/frontends are reachable.
- [ ] docker-compose and .env for cfa2 live in repo and are not overwritten dynamically by deploy job.
- [ ] Path-based rules are configured and documented.
- [ ] SDK jobs (validate-specs, generate-sdks) run and succeed when contracts or SDKs change.
- [ ] docs/deploy/** and c2p_deploy.txt / c2p_uk1.txt are updated to reflect new state.
- [ ] At least one commit with message like:
      "chore(ci): stabilize dev pipeline for cfa2 + compose from repo"
      that includes code changes + minimal tests/checks + docs updates.

If any of these cannot be completed due to hard blockers (missing access, broken runner, etc.), the agent must explicitly describe:
- what is blocked,
- why it is blocked,
- and what a human operator must do next.

```

---

## 4. Mermaid —Å—Ö–µ–º—ã

### 4.1 CI/CD –ø–æ—Ç–æ–∫ dev-cfa2

```mermaid
sequenceDiagram
    actor Dev as Dev
    participant GitLab as GitLab
    participant Runner as GitLab runner vds1
    participant Registry as GitLab registry
    participant CFA2 as cfa2 host

    Dev->>GitLab: git push dev-cfa2
    GitLab->>Runner: start build jobs
    Runner->>Registry: build and push images
    Dev->>GitLab: manual start deploy-cfa2
    GitLab->>Runner: run deploy-cfa2
    Runner->>CFA2: ssh user@cfa2
    Runner->>CFA2: docker compose pull
    Runner->>CFA2: docker compose up -d
    Dev->>CFA2: curl swagger and portals
```

### 4.2 Deploy view –¥–ª—è cfa2

```mermaid
graph TD
    Dev[Developer laptop] --> GitLab[GitLab ois cfa project]
    GitLab --> Runner[Runner vds1 tag vds1]
    Runner --> Registry[GitLab container registry]
    Runner --> CFA2[cfa2 dev host srv cfa]
    CFA2 --> Services[Backend services api gateway identity issuance registry settlement compliance]
    CFA2 --> Portals[Portals issuer investor backoffice]
    CFA2 --> Keycloak[Keycloak auth]
```

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —è –º–æ–≥—É –µ—â—ë –æ—Ç–¥–µ–ª—å–Ω–æ –≤—ã—Ç–∞—â–∏—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π **summary-–ø–∞–∫–µ—Ç** (1‚Äì2 –∞–±–∑–∞—Ü–∞) –¥–ª—è compact-–∞–≥–µ–Ω—Ç–∞, —á—Ç–æ–±—ã –æ–Ω –≤ –Ω–∞—á–∞–ª–µ –∑–∞–ø–∏—Å–∞–ª –µ–≥–æ –≤ docs –∏ –¥–∞–ª—å—à–µ –≤–µ–∑–¥–µ –Ω–∞ –Ω–µ–≥–æ —Å—Å—ã–ª–∞–ª—Å—è.
