---
title: DevOps structure review
source: https://chatgpt.com/c/6927d58d-5b6c-832c-921d-50c44ff9ef18
---

# DevOps structure review

#### You:
<time datetime="2025-11-27T04:37:31.541Z" title="27/11/2025, 07:37:31">07:37</time>

1. You must read attentionally docs
- [ ] 1.1. ORACLE `20251126-2330-CICD-thread-chatgpt-gpt5p.oracle.json.json` CICD thread discussion, advising, tasks for Codex Cli Agents
- [ ] 1.2. eywa1-p-cfa-w19.p1-20251127-0710.session.txt - Codex Cli
- [ ] 1.3. eywa1-p-cfa-w21.p1-20251127-0711.session.txt - –ø–æ—Ç–æ–º –ø—Ä–æ–¥–æ–ª–∂–∏–ª

2. –ü—Ä–æ–±–ª–µ–º—ã 
2.1. –ø—Ä–æ—Å—Ç–æ –ª–∏—à—å –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø—Ä–æ–º–ø—Ç–æ–º –∏ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –∏—Ö –∫—Ä–∞—Ç–Ω–æ –±–æ–ª—å—à–µ –ø—Ä–æ–±–ª–µ–º
```
1.1 –Ø –∑–∞–ø—É—Å—Ç–∏–ª, –Ω–æ –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é - —ç—Ç–æ dev –∏ –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —à–∞–≥–∏ —É—Å–ø–µ—Ö - —Å–¥–µ–ª–∞–π
  1.2. –¢–∞–∫–∂–µ —è –≤–∏–∂—É –≤ https://git.telex.global/npk/ois-cfa/-/pipelines ‚Ññ251  —á—Ç–æ —Ç–∞–º –±–∏–ª–¥ –±—ã–ª —Å—Ç–∞—Ä—ã—Ö 8 images –±–µ–∑ –Ω–æ–≤—ã—Ö –æ –∫–æ—Ç–æ—Ä—ã—Ö —Ç—ã —É–ø–æ–º—è–Ω—É–ª,–¥–æ–ª–∂–Ω—ã –∂–µ –±—ã—Ç—å –≤—Å–µ back,fronts
  1.2. Deploy –æ–ø—è—Ç—å –Ω–µ –ø—Ä–æ—à–µ–ª  https://git.telex.global/npk/ois-cfa/-/jobs/2700  —Ç–∞–º –≤—Å–µ —Ç–∞–∫–∂–µ –ø–∞–¥–∞–µ—Ç –æ—à–∏–±–∫–∞ `Error loading key "/tmp/ci_ssh_key": error in libcrypto`
  2. do
  3.1.
  deploy.txt —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –∞–≥–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –∏–∑ /home/user/__Repositories/yury-customer/prj_Cifra-rwa-exachange-assets/repositories/customer-gitlab/ois-cfa
  ```txt
  deploy
  ‚îú‚îÄ‚îÄ 20251113-cloudflare-ingress.md
  ‚îú‚îÄ‚îÄ API-DOCS-SWAGGER-ASYNCAPI.md
  ‚îú‚îÄ‚îÄ MULTI_ACCOUNT_SETUP.md
  ‚îú‚îÄ‚îÄ docker-compose-at-vps
  ‚îÇ   ‚îú‚îÄ‚îÄ 00-overview.md
  ‚îÇ   ‚îú‚îÄ‚îÄ 01-prereqs-and-host-prep.md
  ‚îÇ   ‚îú‚îÄ‚îÄ 02-env-and-compose.md
  ‚îÇ   ‚îú‚îÄ‚îÄ 03-infra.md
  ‚îÇ   ‚îú‚îÄ‚îÄ 04-services.md
  ‚îÇ   ‚îú‚îÄ‚îÄ 05-gateway.md
  ‚îÇ   ‚îú‚îÄ‚îÄ 06-keycloak.md
  ‚îÇ   ‚îú‚îÄ‚îÄ 07-frontends-dev-on-vps.md
  ‚îÇ   ‚îú‚îÄ‚îÄ 07-frontends.md
  ‚îÇ   ‚îú‚îÄ‚îÄ 08-smoke-tests.md
  ‚îÇ   ‚îú‚îÄ‚îÄ 09-troubleshooting.md
  ‚îÇ   ‚îî‚îÄ‚îÄ 10-eywa1-control-plane-runbook.md
  ‚îî‚îÄ‚îÄ localhost
      ‚îú‚îÄ‚îÄ FRONTEND-STARTUP.md
      ‚îú‚îÄ‚îÄ KEYCLOAK-SETUP.md
      ‚îî‚îÄ‚îÄ README.md

  ```
  —Ç–∞–∫ —á—Ç–æ –±–µ—Ä–∏ –æ—Ç—Ç—É–¥–∞, –∞ uk1 —Ç–∞–º 2 —Ñ–∞–π–ª–∞ /Users/user/__Repositories/prj_Cifra-rwa-exachange-assets/repositories/customer-gitlab/ois-cfa/ops/infra/uk1/*
  3.2. –≤ —Ü–µ–ª–æ–º —á—Ç–æ –∑–∞ –±–∞—Ä–¥–∞–∫ —Ç—ã –º–Ω–µ —É—Å—Ç—Ä–æ–∏–ª —Å —Ñ–∞–π–ª–∞–º–∏, –≤—Å–µ —á—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è docker –¥–æ–æ–ª–∂–Ω–æ –ª–µ–∂–∞—Ç—å –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ {PATH:OIS-CFA}:/Users/user/__Repositories/prj_Cifra-rwa-exachange-assets/repositories/customer-gitlab/ois-cfa/*
  3.2.1. docker files  `./ops/docker/*` –∞ –Ω–µ –≤ `docs/deploy/**`
  3.2.2. .env –∏ –ø—Ä–æ—á–µ–µ –≤ `./ops/gitlab/cfa2/*` –µ—Å–ª–∏ —ç—Ç–æ –∫ cfa2 - –ø–æ–∫–∞ —á—Ç–æ –¥–∞–ª—å—à–µ –±–µ–∑ –ø–æ–¥–ø–∞–ø–æ–∫
  4. –ß—Ç–æ –∑–∞ –¥–∏—á—å —Ç—ã —Ç–≤–æ—Ä–∏—à—å —Å —Ñ–∞–π–ª–∏–∫–∞–º–∏ –∑–∞—á–µ–º —Ç–∞–º 2 .gitlab-ci ?
  ``
  [03:05] user@eywa-ubuntu-8gb-hel1-2 ois-cfa (dev-cfa2) $ pwd
  /home/user/__Repositories/yury-customer/prj_Cifra-rwa-exachange-assets/repositories/customer-gitlab/ois-cfa
  [03:13] user@eywa-ubuntu-8gb-hel1-2 ois-cfa (dev-cfa2) $ wc -l .gitlab
  .gitlab/        .gitlab-ci.yml
  [03:13] user@eywa-ubuntu-8gb-hel1-2 ois-cfa (dev-cfa2) $ wc -l .gitlab/
  agents/         .gitlab-ci.yml
  [03:13] user@eywa-ubuntu-8gb-hel1-2 ois-cfa (dev-cfa2) $ wc -l .gitlab/.gitlab-ci.yml
  79 .gitlab/.gitlab-ci.yml
  [03:19] user@eywa-ubuntu-8gb-hel1-2 ois-cfa (dev-cfa2) $ wc -l .gitlab-ci.yml
  317 .gitlab-ci.yml
  ``
  –¥–µ–ª–æ –≤ —Ç–æ–º —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å AleksandrO —ç—Ç–æ –∫–∞–∫ –±—ã –¢–µ—Ö–î–∏—Ä –ø—Ä–æ–µ–∫—Ç–∞ –æ–Ω —Ç–∏–ø–æ –∑–∞–¥–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –Ω–æ —Ç–∞–∫–æ–µ –æ—â—É—â–µ–Ω–∏–µ –Ω–µ–¥–æ–¥—É–º—ã–≤–∞–µ—Ç –¥–æ –∫–æ–Ω—Ü–∞ –∏ –∑–∞ —Å–æ–±–æ–π –Ω–µ –∑–∞–º–µ—á–∞–µ—Ç —á—Ç–æ –ø–æ–ª—å–∑—ã –æ—Ç —Ç–∞–∫–æ–π –Ω–µ–¥–æ–¥–µ–ª–∞–Ω–Ω–æ–π –∏ –Ω–µ–¥–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ä–∞–±–æ—ã—Ç –Ω–æ–ª—å —á—Ç–æ –æ–Ω —Ç–∞–º –≤ cursor-ai-ide
  –Ω–∞–¥–µ–ª–∞–ª —ç—Ç–æ —Ç–æ–ª—å–∫–æ –º–Ω–æ–∂–∏—Ç—å –∫–æ–ª-–≤–æ —Ñ–∞–π–ª–æ–≤ —Å–≥–µ–Ω–µ—Ä–µ–Ω–Ω—ã—Ö –Ω–µ–π—Ä–æ–Ω–∫–æ–π - —Ç–∞–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –º–Ω–æ–∂–∏—Ç—å –º—É—Å–æ—Ä –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å - –∏ —á—Ç–æ —Ç—É—Ç –¥–µ–ª–∞—Ç—å? –Ω—É –Ω–µ —É–¥–∞–ª—è—Ç—å –∂–µ –µ–≥–æ —Ñ–∞–π–ª - –æ–Ω —Å–∫–∞–∂–µ—Ç —á—Ç–æ —Ç–∞–º —á—Ç–æ-—Ç–æ –∑–∞–¥—É–º—ã–≤–∞–ª –∏ —Ç–ø - –∏ —Å–ø–æ—Ä–∏—Ç—å –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ —ç—Ç–æ –≤–æ–æ–±—â–µ –æ–Ω –¥–µ–ª–∞–ª –¥–ª—è
  –±—É–¥—É—â–µ–≥–æ k8s, –∞ —É –Ω–∞—Å –∏–¥–µ—è —á—Ç–æ prod:k8s, stage –ø–æ–∫–∞ –Ω–µ —Ä–µ—à–∏–ª–∏ –∞ —Ç–µ–∫—É—â–∏–π dev –¥–µ–ª–∞–µ–º –∫–∞–∫ –¥–µ–ª–∞–µ–º –≤ docker-compose/docker; –∫–æ—Ä–æ—á–µ —á–µ –¥–µ–ª–∞—Ç—å?–Ω—É –æ—á–µ–≤–∏–¥–Ω–æ –∂–µ –Ω—É–∂–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç—å senior level –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Å—Ç–æ –≤—Å–µ –∫–ª–∞—Å—Ç—å –≤ `.gitlab/{gitlab-ci.dev.yml,gitlab-
  ci.k8s.yml}`, —Ç–æ –µ–≥–æ –¥–æ–±—Ä–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ gitlab-ci.k8s.yml –∏ –æ—Ç—Å—Ç–∞—Ç—å –∞ –Ω–∞—à–µ –∏–∑ –∫–æ—Ä–Ω—è –≤ –ø–∞–ø–∫—É –∏ —Ç–ø - —É—á–µ—Å—Ç—å —á—Ç–æ–±—ã –≤–µ–∑–¥–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –æ—Ç—Ä–∞–∑–∏—Ç—å —á—Ç–æ –∏ –∫–∞–∫ !–∞—Ö –¥–∞ –µ—Å–ª–∏ gitlab by default wants only `.gitlab-ci.yml` –Ω—É —Ç–æ–≥–¥–∞ —Å–¥–µ–ª–∞—Ç—å –±–µ–∑ `dev` –∞ —Ç–æ—Ç –ø–æ–∫–∞
  –±—É–¥–µ—Ç –±–µ–∫–∞–ø–Ω—ã–π –∞ –µ—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—Ç —Ç–æ —Ç–∞–∫

  –¢—ã –ø–æ–Ω—è–ª –ª–æ–≥–∏–∫—É –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã –±–∞—Ä–¥–∞–∫ —Å–¥–µ–ª–∞–ª –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö —Å–µ–π—á–∞—Å ?
---

‚Ä∫ - —Ç—ã –æ—Å—Ç–∞–≤–∏–ª –¥—É–±–ª—å –≤ –∫–æ—Ä–Ω–µ .gitlab-ci.yml
  - —Ç—ã –Ω–µ —Å–¥–µ–ª–∞–ª git push - you must to do it always
  - –≥–¥–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ ssh_private_key –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ gitlab? private_key –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–∫–æ–º—É —Å–µ—Ä–≤–µ—Ä—É cfa2,vds1 –∏–ª–∏ –∫—É–¥–∞? –∏ –æ—Ç–∫—É–¥–∞ –∫—É–¥–∞ –Ω—É–∂–Ω–∞ —è—Å–Ω–æ—Å—Ç—å, –æ–Ω–∞ –æ–ø–∏—Å–∞–Ω–∞ –≥–¥–µ-—Ç–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —á–µ—Ç–∫–æ?
```
—ç—Ç–æ—Ç —Ö–∞–æ—Å –Ω–∞–¥–æ –ø—Ä–∏–≤–æ–¥–∏—Ç—å –≤ –ø–æ—Ä—è–¥–æ–∫

3. –†–µ—à–µ–Ω–∏—è
–Ø –ø–æ–∫–∞ –Ω–µ–∑–Ω–∞—é —Ç–æ—á–Ω–æ –∏ —Ö–æ—á—É –ø–æ—Å–æ–≤–µ—Ç–æ–≤–∞—Ç—å—Å—è, —Ö–æ—Ç—è –µ—Å—Ç—å —è–≤–Ω–æ –≤–∏–¥–∏–º—ã–µ –º–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã , –Ω–∞–ø–∏—à—É –ª–∏—à—å –º—ã—Å–ª–∏ –∏ –≤–æ–ø—Ä–æ—Å—ã
- –∫–∞–∫ –≤–∏–¥–∏—à—å —Ö–æ—Ç—å –∏ –º–µ—Ç–æ–¥–∏–∫–∞ Role and JTBD -> DoD -> Kickoff with Phases in Loops with Autonomy —Ö–æ—Ä–æ—à–∞, –Ω–æ –≤—Å–µ –∂–µ –ø–æ –º–æ–∏–º –ø—Ä–æ–º–ø—Ç–∞–º –Ω–µ –¥–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–º–ø—Ç–∞ - –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å Markdown files –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç SSOT —á—Ç–æ–±—ã –Ω–µ –Ω–∞—Ä—É—à–∞—Ç—å DRY –∏ –ª—é–±–æ–π –∞–≥–µ–Ω—Ç –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–ª state/status –∏ —á—Ç–æ–±—ã —è –≤—Å–µ–≥–¥–∞ –≤–∏–¥–µ–ª –∏ —ç—Ç–æ –±—ã–ª–æ –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–æ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞–ª —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ 
- —Ç–∞–∫–∂–µ –Ω—É–∂–Ω–æ —Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞—Ç—å tree, —è –Ω–µ–∑–Ω–∞—é –ø–æ –∫–∞–∫–∏–º –ø—Ä–∏—á–∏–Ω–∞–º –Ω–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞—Ç–≤–æ—Ä–∏–ª –ø–æ–ª–Ω—ã–π –±–∞—Ä–¥–∞–∫ –≤ —Ñ–∞–π–ª–∞—Ö –∏ –ø–∞–ø–∫–∞—Ö –∏ —ç—Ç–æ –≤–∞–∂–Ω–æ –∏ —Å—Ç–æ–∏—Ç –Ω–∞–≤–µ—Ä–Ω–æ–µ —É–∫–∞–∑—ã–≤–∞—Ç—å, –º–æ—è –∏–¥–µ—è –¥–µ–ª–∞—Ç—å Epics->Stories –≤–µ–¥—å –≤—Å–µ –º–æ–∂–Ω–æ –Ω–∞ —ç—Ç–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å, –Ω–æ –Ω–µ –ø–∏—Å–∞—Ç—å —Å –Ω—É–ª—è –∏—Ö –æ—Ç —Ç–æ—á–∫–∏ –≥–¥–µ –º—ã —Å–µ–π—á–∞—Å –∞ —è —Ö–æ—á—É —Å —Ç–æ–±–æ–π —É—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ —á—Ç–æ–±—ã —Ç—ã –ø—Ä–æ–ø–∏—Å–∞–ª —Å —É—á–µ—Ç–æ–º —á—Ç–æ —É–∂–µ –ø—Ä–æ–¥–µ–ª–∞–Ω–æ
- —Ç—ã –≤ `20251126-2330-CICD-thread-chatgpt-gpt5p.oracle.json.json...messageID=df1a3ab7-9b48-44ef-b910-010e7c6736ec` –≤—Å–µ —Ö–æ—Ä–æ—à–æ –ø—Ä–æ–ø–∏—Å–∞–ª –Ω–æ –≤ –¥—Ä—É–≥–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ. –í—Å–µ –æ—Ç–ª–∏—á–Ω–æ –ø–æ–Ω—è–ª —á—Ç–æ —è —Ö–æ—Ç–µ–ª —Ö–æ—á—É! (—á–∏—Ç–∞–π –º–æ–∏ –ø—Ä–æ–º–ø—Ç—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ json ) —Ç—É—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ messageID=f9fb6c6a-0fe0-417e-9130-d767cfa224b3 —Ç–æ–∂–µ –æ–∫
- —Ç—ã –ø–æ—á–∏—Ç–∞–π –≤—Å–µ —á—Ç–æ —è –ø–∏—Å–∞–ª `"author": {                        "role": "user",....`
- –¥–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º –Ω–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —Ç–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç, –º—ã —Å–µ–π—á–∞—Å –¥–µ–ª–∞–µ–º DevOps epic(s) –∏ —Ç—É—Ç —É –º–µ–Ω—è —Å–æ–º–Ω–µ–Ω–∏—è —á—Ç–æ —Å—Ç–æ–∏—Ç –¥–µ–ª–∞—Ç—å `epic->feature->story` –Ω–æ –∏ tasks —Ç–æ–∂–µ –Ω–µ –æ—á–µ–Ω—å —É–≤–µ—Ä–µ–Ω –≤–æ—Ç —è —Ç–µ–±–µ —Å–∫–∏–Ω—É–ª framework sdd-deksden –æ–¥–∏–Ω –∏–∑ –≥–¥–µ –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è —á—Ç–æ –ø–æ–Ω—è—Ç–Ω–æ –º–Ω–µ —Å–¥–µ–ª–∞–Ω–æ –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ risk –∏ –≤—Å—è —Ö—É–π–Ω—è –∫–æ–≥–¥–∞ –ø–∏–ª–∏–º —Å—Ç–∞—Ä—Ç–∞–ø –≤ —É—Å–ª–æ–≤–∏—è—Ö –≥–æ—Ä—è—â–∏—Ö —Å—Ä–æ–∫–æ–≤ –∑–∞—á–µ–º –ø—Ä—ã–≥–∞—Ç—å –ø–æ –±–æ–ª—å—à–∏–º –¥–æ–∫–∞–º –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –≤—Å–µ—Ö –Ω–æ –≤–æ—Ç –ø—Ä–æ—Å—Ç–æ —è—Å–Ω—ã–π —á–µ—Ç–∫–∏–π –∏ —Å mermaid doc –±—É–¥–µ—Ç –ø–æ–ª–µ–∑–µ–Ω (—á—Ç–æ –º–Ω–µ –Ω—Ä–∞–≤–∏–ª–æ—Å—å –∏ —á—Ç–æ —è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª —è –ø—Ä–∏–∫—Ä–µ–ø–∏–ª  20251126-aggregate-system-prompt-oracle.md)
- –µ—â–µ —Ä–∞–∑ –ø–æ–¥—á–µ—Ä–∫–Ω—É –∫–ª—é—á–µ–≤–æ–µ –Ω–µ –ø—Ä–æ–º–ø—Ç –Ω–∞–ø–∏—Å–∞—Ç—å –∞–≥–µ–Ω—Ç—É –∏ —á—Ç–æ–±—ã –æ–Ω —Å–¥–µ–ª–∞–ª –∞ –Ω–∞–≤–µ—Ä–Ω–æ–µ –ø—Ä–æ–º–ø—Ç+–¥–æ–∫ –∏ –≤ –¥–æ–∫–µ —è —É—Å–ª–æ–≤–Ω–æ –¥–µ–ª–∞—é –∫–æ–ø–∏–ø–∞—Å—Ç —Ä—É–∫–∞–º–∏ –∏ –æ–Ω —Å–æ–±–ª—é–¥–∞–µ—Ç
- –µ—â–µ –Ω—É–∂–Ω–æ –ø–æ–¥—É–º–∞—Ç—å –≤ —Ü–µ–ª–æ–º —Ç—ã –≤–∏–¥–∏—à—å scope of my current ops tasks, –º–æ–∂–µ—Ç –µ—Å—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å AGENTS.md –º–Ω–µ –∞ —Ç–æ —Å—Ç–∞—Ä—ã–π –¥–µ–ª–∞–ª –ª–∏—à–Ω–µ–µ –∏ –∞–≥–µ–Ω—Ç –≤—Å–µ —Ä–∞–≤–Ω–æ –Ω–∞—Ä—É—à–∞–ª loop, –ø–æ—Ä—Ç–∏–ª –ø–æ—Ä—è–¥–æ–∫ –º–Ω–æ–∂–∏–ª —Ö–∞–æ—Å –∏ —Ç.–ø.

- –Ω–æ –≤ —Ü–µ–ª–æ–º —á–µ —è —Ö–æ—á—É –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å —á—Ç–æ–±—ã —Ç—ã –º–æ–∏ —Ö–æ—Ç–µ–ª–∫–∏ –æ—Å–æ–∑–Ω–∞–ª –∏ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ–≥–ª–∞—à–∞—Ç—å—Å—è 
<ORACLE_GENERAL_RECOMMENDATIONS>
- –°–ª–µ–¥—É–π –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∫–∞–Ω–≤–µ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É. –ë—É–¥—å –æ–±—ä–µ–∫—Ç–∏–≤–µ–Ω –∏ –Ω–µ–ø—Ä–µ–¥–≤–∑—è—Ç.
- –ù–µ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–π—Å—è –ø–æ–¥ –º–æ–∏ –ø—Ä–æ—à–ª—ã–µ –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç Spec/DoD.
- –ï—Å–ª–∏ –Ω–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç —Å–æ —Å—Ç–∞—Ä—ã–º–∏ ‚Äî —è–≤–Ω–æ —É–∫–∞–∂–∏ –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.
- –ù–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –ø–æ–¥ ¬´—Å–¥–µ–ª–∞—Ç—å –ø–æ–º–µ–Ω—å—à–µ¬ª, –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –ø–æ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ JTBD.
</ORACLE_GENERAL_RECOMMENDATIONS>
- –∏ —á—Ç–æ–±—ã –º—ã –µ—Å–ª–∏ —É—Ç–≤–µ—Ä–∂–¥–∞–µ–º –ø–æ–¥—Ö–æ–¥ Epics/Stories —É —Ç–µ–±—è –µ—Å—Ç—å –≤—Å–µ –ª–æ–≥–∞—Ö —á—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –≤—Å–µ —ç—Ç–∏ Epics Stories —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –∏ —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —á—Ç–æ–±—ã —Å —ç—Ç–æ–π —Ç–æ—á–∫–∏ —ç—Ç–∏–º –∏–ª–∏ –¥—Ä—É–≥–∏–º –∞–≥–µ–Ω—Ç–æ–º —Å–∫–∞–∑–∞—Ç—å –≤–æ—Ç —Ñ–∞–π–ª—ã –∑–∞–∫—Ä—ã–≤–∞–π —á–µ–∫–±–æ–∫—Å—ã –∏ —Ç–∞–º –≤—Å–µ –ø—Ä–æ—à–∏—Ç–æ –∏ –≤—Å–µ loops —á—Ç–æ–±—ã –æ–Ω –ø—Ä–æ–≤–µ—Ä—è–ª –∏ –∂–¥–∞–ª –ø–æ–∫–∞ —ç—Ç–æ—Ç gitlab pipeline –ø—Ä–æ–π–¥–µ—Ç –ø–æ–∫–∞ —Ç–∞–º —Å–¥–µ–ª–∞–µ—Ç—Å—è build –Ω–µ 8 –∞ –≤—Å–µ—Ö (+frontend,postgres, containers, –∏ —á—Ç–æ swagger –æ—Ç–≤–µ—á–∞—é—Ç –ø–æ—Ç–æ–º –¥–∞–ª—å—à–µ —Ç–µ—Å—Ç–∏—Ç –Ω—É —á—Ç–æ–±—ã –Ω–æ—Ä–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–ª–æ 

#### ChatGPT:
<time datetime="2025-11-27T04:50:25.371Z" title="27/11/2025, 07:50:25">07:50</time>

TL;DR

- –î–∞, —è –ø—Ä–æ—á–∏—Ç–∞–ª —Ç–≤–æ–∏ ORACLE‚Äë–¥–æ–∫–∏, CICD‚Äë—Ç—Ä–µ–¥ –∏ —Å–µ—Å—Å–∏–∏ eywa1 (w19/w21) ‚Äî –≤ –∫–∞—Ä—Ç–∏–Ω–µ —Å—Ö–æ–¥—è—Ç—Å—è: —Å–µ–π—á–∞—Å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å dev‚Äëcfa2 ‚âà –æ–ø–∏—Å–∞–Ω–Ω–∞—è –≤ c2p\_ois-cfa, –Ω–æ –¥–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤ –∏ CI layout –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤ –∫–∞—à–µ. ÓàÄfileciteÓàÇturn1file3ÓàÇturn1file5ÓàÇturn1file6ÓàÅ
- –Ø –∑–∞—Ñ–∏–∫—Å–∏—Ä—É—é **target‚Äë—Å—Ç—Ä—É–∫—Ç—É—Ä—É**: –≥–¥–µ –ª–µ–∂–∞—Ç docker‚Äë—Ñ–∞–π–ª—ã –∏ .env, –∫–∞–∫ –¥–æ–ª–∂–Ω–æ –≤—ã–≥–ª—è–¥–µ—Ç—å `.gitlab-ci.yml` vs `.gitlab/gitlab-ci.*.yml`, –∏ —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Å `SSH_PRIVATE_KEY` (–¥–ª—è –∫–æ–≥–æ –∫–ª—é—á, –≥–¥–µ –æ–ø–∏—Å–∞—Ç—å). ÓàÄfileciteÓàÇturn1file3ÓàÇturn1file11ÓàÅ
- –ü—Ä–µ–¥–ª–æ–∂—É **DevOps Epic + Features/Stories + AGENTS.md skeleton**, —á—Ç–æ–±—ã –¥–∞–ª—å—à–µ –∞–≥–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–ª –ø–æ SSOT‚Äëmarkdown‚Äô–∞–º, –∞ –Ω–µ –ø–æ —Ä–∞–Ω–¥–æ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–∞–º, –∏ —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ ¬´–¥–∞–≤–∞—Ç—å –µ–º—É —Ñ–∞–π–ª –∏ –∑–∞–∫—Ä—ã–≤–∞—Ç—å —á–µ–∫–±–æ–∫—Å—ã¬ª.

---

## 1. –ß—Ç–æ —è —Å–µ–π—á–∞—Å –≤–∏–∂—É –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é

### 1.1. Dev‚Äëcfa2 / CI / compose

–ò–∑ w21‚Äë—Å–µ—Å—Å–∏–∏ –∏ ORACLE‚Äë–ø–ª–∞–Ω–∞:

- –í–µ—Ç–∫–∞ `dev-cfa2` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–∞ –Ω–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω CI —Å **stages `sdk ‚Üí build ‚Üí deploy`**, path‚Äëbased rules –∏ job `deploy-cfa2`, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ–¥–∏—Ç –ø–æ SSH –Ω–∞ `cfa2` –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç `docker compose pull && docker compose up -d`. ÓàÄfileciteÓàÇturn1file5ÓàÇturn1file14ÓàÅ
- –î–ª—è cfa2 —É–∂–µ –µ—Å—Ç—å compose+env, –ø–æ—Ä—Ç—ã, —Ñ—Ä–æ–Ω—Ç—ã (3001/3002/3003), helper‚Äë—Å–∫—Ä–∏–ø—Ç `sync-compose-cfa2.sh`, –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (`cfa2.md`, `cfa2-dev-runbook.md`, `CI-BUILD-MATRIX.md`). ÓàÄfileciteÓàÇturn1file3ÓàÇturn1file5ÓàÇturn1file15ÓàÅ
- –í c2p\_ois-cfa —Ü–µ–ª–µ–≤–æ–π –¥–∏–∑–∞–π–Ω –∑–∞–ø–∏—Å–∞–Ω —É–∂–µ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ:
  - compose: `ops/docker/cfa2/docker-compose.yml`
  - env‚Äô—ã: `ops/gitlab/cfa2/.env.cfa2` + `.env.example`
  - sync: `./ops/scripts/sync-compose-cfa2.sh user@92.51.38.126 /srv/cfa`
  - `SSH_PRIVATE_KEY` ‚Äî –∫–ª—é—á –∏–º–µ–Ω–Ω–æ –¥–ª—è `user@92.51.38.126 (cfa2)`. ÓàÄfileciteÓàÇturn1file3ÓàÅ

–¢.–µ. **–ø–æ —Å–º—ã—Å–ª—É** —É —Ç–µ–±—è —É–∂–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π target‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç, –Ω–æ —Ä–µ–∞–ª—å–Ω–æ–µ –¥–µ—Ä–µ–≤–æ —Ä–µ–ø—ã –µ—â—ë —á–∞—Å—Ç–∏—á–Ω–æ –∂–∏–≤—ë—Ç –≤ —Å—Ç–∞—Ä–æ–π —Å—Ö–µ–º–µ (`deploy/docker-compose-at-vps/...` –∏ —Ç.–ø.), –ø–ª—é—Å –Ω–µ –≤—Å—ë –¥–æ–ø—É—à–µ–Ω–æ.

### 1.2. –ë–∞—Ä–¥–∞–∫ —Å `.gitlab-ci*`

–ò–∑ –ª–æ–≥–æ–≤ –∞–≥–µ–Ω—Ç–∞:

- –ë—ã–ª —Å—Ç–∞—Ä—ã–π —Ç—è–∂—ë–ª—ã–π `.gitlab-ci.yml` –ø–æ–¥ ArgoCD/agents/k8s. ÓàÄfileciteÓàÇturn1file11ÓàÅ
- –í `dev-cfa2` –µ–≥–æ –ø–µ—Ä–µ–ø–∏—Å–∞–ª–∏ –ø–æ–¥ simple dev pipeline –∏ –¥–∞–ª–µ–µ –æ–ø–∏—Å–∞–ª–∏ layout:
  - root `.gitlab-ci.yml` **include‚Äô–∏—Ç** `.gitlab/gitlab-ci.dev.yml` (docker/compose‚Äë–ø–æ—Ç–æ–∫ –¥–ª—è cfa2);
  - `.gitlab/gitlab-ci.k8s.yml` –ª–µ–∂–∏—Ç –∫–∞–∫ –∑–∞–≥–æ—Ç–æ–≤–∫–∞ –ø–æ–¥ –±—É–¥—É—â–∏–π k8s/kaniko –∏ **–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞**. ÓàÄfileciteÓàÇturn1file6ÓàÅ

–¢—ã —Å–µ–π—á–∞—Å –≤–∏–¥–∏—à—å:

```bash
wc -l .gitlab-ci.yml        # 317
wc -l .gitlab/.gitlab-ci.yml # 79
```

–¢–æ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–æ:

- 1 –±–æ–ª—å—à–æ–π root‚Äëpipeline (—Å—Ç–∞—Ä—ã–π/—Å–º–µ—à–∞–Ω–Ω—ã–π),
- 1 –µ—â—ë –æ–¥–∏–Ω `.gitlab-ci` –≤–Ω—É—Ç—Ä–∏ `.gitlab/` (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ k8s‚Äë–∑–∞–≥–æ—Ç–æ–≤–∫–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞, –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç).

–ê –≤ –¥–æ–∫–µ —É–∂–µ –Ω–∞–ø–∏—Å–∞–Ω–æ –ø—Ä–æ `gitlab-ci.dev.yml` / `gitlab-ci.k8s.yml`, –Ω–æ —Å–∞–º–∏ —Ñ–∞–π–ª—ã –µ—â—ë –Ω–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ —ç—Ç–æ–º—É –≤–∏–¥—É (–∏ –≤–µ—Ç–∫–∞ –≤–ø–µ—Ä–µ–¥–∏ origin, push –Ω–µ —Å–¥–µ–ª–∞–Ω). ÓàÄfileciteÓàÇturn1file6ÓàÅ

### 1.3. SSH key / –æ—à–∏–±–∫–∞ `error in libcrypto`

–í GitLab job‚Äô–µ —Ç—ã –≤–∏–¥–∏—à—å:

```text
Error loading key "/tmp/ci_ssh_key": error in libcrypto
```

–¢–∏–ø–∏—á–Ω—ã–π –∫–µ–π—Å:

- –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `SSH_PRIVATE_KEY` –∑–∞–ª–∏–ª–∏ –Ω–µ —Ç–æ:
  - –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π –∫–ª—é—á,
  - –Ω–µ OpenSSH‚Äë—Ñ–æ—Ä–º–∞—Ç,
  - –ª–∏—à–Ω–∏–µ `\r`, base64, –∏–ª–∏ –≤–æ–æ–±—â–µ –ø—É–±–ª–∏—á–Ω—É—é —á–∞—Å—Ç—å.

–ü–æ c2p\_ois-cfa: `SSH_PRIVATE_KEY` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **—Å—Ç—Ä–æ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è `user@cfa2`**, –≤ –æ–±—ã—á–Ω–æ–º OpenSSH —Ñ–æ—Ä–º–∞—Ç–µ (`-----BEGIN OPENSSH PRIVATE KEY----- ...`). ÓàÄfileciteÓàÇturn1file3ÓàÅ

–°–∫—Ä–∏–ø—Ç –≤ CI (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ) –¥–µ–ª–∞–µ—Ç:

```bash
echo "$SSH_PRIVATE_KEY" > /tmp/ci_ssh_key
chmod 600 /tmp/ci_ssh_key
ssh -i /tmp/ci_ssh_key user@cfa2 ...
```

–ï—Å–ª–∏ key –±–∏—Ç—ã–π, `ssh` –ø–∞–¥–∞–µ—Ç —Å `error in libcrypto`.

---

## 2. –†–∞–∑–±–æ—Ä —Ç–≤–æ–∏—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–µ—Ç–µ–Ω–∑–∏–π

### 2.1. ¬´–Ø –∑–∞–ø—É—Å—Ç–∏–ª, –Ω–æ –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é ‚Äî –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏¬ª

–ü–æ –ª–æ–≥–∞–º –∞–≥–µ–Ω—Ç–∞:

- –í –Ω–∞—á–∞–ª—å–Ω–æ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ deploy –±—ã–ª **manual**, —á—Ç–æ–±—ã –Ω–µ –Ω–∞—Å—Ç—Ä–µ–ª—è—Ç—å –ø–æ cfa2. –ü–æ—Ç–æ–º –∞–≥–µ–Ω—Ç —Å–∞–º –∂–µ –µ–≥–æ –ø–æ–º–µ–Ω—è–ª –Ω–∞ **auto deploy** –¥–ª—è `dev-cfa2` –∏ –æ–ø–∏—Å–∞–ª —ç—Ç–æ –≤ –∫–æ–º–º–∏—Ç–µ. ÓàÄfileciteÓàÇturn1file5ÓàÇturn1file6ÓàÅ

–ß—Ç–æ —Å–µ–π—á–∞—Å –ª–æ–≥–∏—á–Ω–æ –¥–ª—è dev:

- `dev-cfa2`: **–∞–≤—Ç–æ deploy** –ø–æ—Å–ª–µ –∑–µ–ª—ë–Ω—ã—Ö build‚Äô–æ–≤ ‚Äî –Ω–æ—Ä–º (–¥–≤–∏–≥–∞—Ç—å –±—ã—Å—Ç—Ä–æ).
- prod/k8s: –ø–æ—Ç–æ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π pipeline, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ manual/approval‚Äëbased.

### 2.2. ¬´–í pipeline #251 –±–∏–ª–¥–∏–ª–∏—Å—å —Å—Ç–∞—Ä—ã–µ 8 images –±–µ–∑ —Ñ—Ä–æ–Ω—Ç–æ–≤¬ª

–≠—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ:

- –ü–æ–∫–∞ **–Ω–µ –¥–æ–ø—É—à–µ–Ω** `dev-cfa2` —Å –Ω–æ–≤—ã–º `.gitlab-ci` / `gitlab-ci.dev.yml`, GitLab –≥–æ–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–π pipeline —Å 6 –±—ç–∫–µ–Ω–¥–∞–º–∏ + 2 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏ –∏ –±–µ–∑ —Ñ—Ä–æ–Ω—Ç–æ–≤. ÓàÄfileciteÓàÇturn1file11ÓàÇturn1file15ÓàÅ
- –í –Ω–æ–≤–æ–π –º–∞—Ç—Ä–∏—Ü–µ —É–∂–µ –µ—Å—Ç—å backend + front (issuer/investor/backoffice) + sdk stage. ÓàÄfileciteÓàÇturn1file5ÓàÇturn1file15ÓàÅ

–¢–æ –µ—Å—Ç—å —Ç—É—Ç root‚Äë–ø—Ä–∏—á–∏–Ω–∞ –Ω–µ ¬´–∞–≥–µ–Ω—Ç —Ç—É–ø–æ–π¬ª, –∞ **–≤–µ—Ç–∫–∞ –Ω–µ –ø—Ä–∏–ª–µ—Ç–µ–ª–∞ –≤ GitLab**.

### 2.3. ¬´deploy.txt ‚Üí –±–µ—Ä–∏ –æ—Ç—Ç—É–¥–∞, uk1 ‚Üí ops/infra/uk1¬ª

–û–∫–µ–π, –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª–æ:

- –í—Å—ë, —á—Ç–æ **–ø—Ä–æ –¥–µ–ø–ª–æ–π/ops –Ω–∞ –ø—Ä–æ–¥/uk1/cfa1/cfa2** ‚Äî –æ–ø–∏—Å—ã–≤–∞–µ–º –≤ `docs/deploy/**` –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö `c2p_*` —Ñ–∞–π–ª–∞—Ö –∫–∞–∫ runbooks/cheatsheets. ÓàÄfileciteÓàÇturn1file3ÓàÇturn1file15ÓàÅ
- –°–∞–º–∏ **—Ä–∞–±–æ—á–∏–µ —Ñ–∞–π–ª—ã** (compose, env, —Å–∫—Ä–∏–ø—Ç—ã, terraform) ‚Äî –ª–µ–∂–∞—Ç –≤ `ops/**`, –∞ –Ω–µ –≤ `docs/`.

### 2.4. ¬´Docker‚Äë—Ñ–∞–π–ª—ã –∏ .env –¥–æ–ª–∂–Ω—ã –ª–µ–∂–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ¬ª

–¢—ã –ø—Ä—è–º–æ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–ª target:

- `./ops/docker/*` ‚Äî –í–°–ï docker‚Äëcompose / Dockerfile‚Äë–æ–±–≤—è–∑–∫–∞ –¥–ª—è –æ–∫—Ä—É–∂–µ–Ω–∏–π (localhost, cfa2, –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç–æ–º stage/prod).
- `./ops/gitlab/cfa2/*` ‚Äî `.env.cfa2`, `.env.example` –∏ –≤—Å—ë, —á—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ CI/CD –¥–ª—è cfa2.

c2p\_ois-cfa –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ (docker‚Äëcompose.yml –≤ `ops/docker/cfa2`, env‚Äô—ã –≤ `ops/gitlab/cfa2`). ÓàÄfileciteÓàÇturn1file3ÓàÅ

–ü—Ä–æ–±–ª–µ–º–∞: –∞–≥–µ–Ω—Ç —Å–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–Ω—ë—Å cfa2‚Äëcompose –≤ `deploy/docker-compose-at-vps/cfa2`, –ø–æ—Ç–æ–º –≤ –¥–æ–∫–µ –ø–µ—Ä–µ–ø–∏—Å–∞–ª, —á—Ç–æ source of truth —É–∂–µ `ops/docker/cfa2` / `ops/gitlab/cfa2`, –Ω–æ —Å–∞–º–∏ —Ñ–∞–π–ª—ã, —Å—É–¥—è –ø–æ –ª–æ–≥–∞–º, –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞ –¥–æ–µ—Ö–∞–ª–∏. ÓàÄfileciteÓàÇturn1file5ÓàÇturn1file6ÓàÅ

### 2.5. ¬´–î–≤–∞ .gitlab-ci, k8s vs dev¬ª

–¢–≤–æ—è –ª–æ–≥–∏–∫–∞:

- k8s‚Äëpipeline (–Ω–∞–¥–µ–ª–∞–Ω–Ω—ã–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–º –≤ Cursor) ‚Äî —ç—Ç–æ **–±—É–¥—É—â–µ–µ prod/stage**, —Å–µ–π—á–∞—Å –º–µ—à–∞–µ—Ç –∏ –ø–ª–æ–¥–∏—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.
- dev‚Äëpipeline –¥–ª—è cfa2 ‚Äî docker/compose, –±–µ–∑ ArgoCD –∏ GitLab Agent.

Target, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–∏—Å–∞–Ω –≤ –¥–æ–∫–∞—Ö:

- root `.gitlab-ci.yml` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π **–æ—Ächestrator**, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç `include: .gitlab/gitlab-ci.dev.yml`. ÓàÄfileciteÓàÇturn1file6ÓàÅ
- `.gitlab/gitlab-ci.dev.yml` ‚Äî —Ç–µ–∫—É—â–∏–π dev‚Äëpipeline (sdk/build/deploy –Ω–∞ cfa2).
- `.gitlab/gitlab-ci.k8s.yml` ‚Äî –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Å–ª–æ–∂–µ–Ω–Ω—ã–π k8s‚Äëpipeline –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞, **–Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–º–æ–∂–Ω–æ include‚Äô–∏—Ç—å –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≤–µ—Ç–∫–µ/—Ç–µ–≥–µ).

–°–µ–π—á–∞—Å –º–µ—à–∞–µ—Ç —Ä–æ–≤–Ω–æ —Ç–æ, —á—Ç–æ:

- –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–π `.gitlab/.gitlab-ci.yml`,
- –∏ root `.gitlab-ci.yml` –≤—Å—ë –µ—â—ë –±–æ–ª—å—à–æ–π (317 —Å—Ç—Ä–æ–∫) => —Å–º–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–π.

---

## 3. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π target‚Äëlayout (repo + CI + keys)

### 3.1. –î–µ—Ä–µ–≤–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (DevOps‚Äë—á–∞—Å—Ç—å)

**–¶–µ–ª—å** ‚Äî –æ–¥–∏–Ω SSOT –¥–ª—è infra/devops, –±–µ–∑ –¥—É–±–ª–µ–π:

```txt
ois-cfa/
  .gitlab-ci.yml                # –º–∞–ª–µ–Ω—å–∫–∏–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
  .gitlab/
    gitlab-ci.dev.yml           # docker/compose dev pipeline (cfa2)
    gitlab-ci.k8s.yml           # k8s pipeline (–ê–ª–µ–∫—Å–∞–Ω–¥—Ä, –Ω–µ –≤–∫–ª—é—á–µ–Ω)

  ops/
    docker/
      localhost/
        docker-compose.yml
        ...
      cfa2/
        docker-compose.yml      # SSOT –¥–ª—è /srv/cfa/docker-compose.yml
        README.md               # –∫—Ä–∞—Ç–∫–æ: –∫–∞–∫/–∑–∞—á–µ–º
    gitlab/
      cfa2/
        .env.cfa2               # —Ä–µ–∞–ª—å–Ω—ã–π dev env
        .env.example            # —à–∞–±–ª–æ–Ω
        README.md               # —á—Ç–æ –∑–∞ env, –∫–∞–∫–∏–µ var –Ω—É–∂–Ω—ã –≤ CI
    scripts/
      bootstrap-cfa2.sh
      ci-bootstrap-cfa2.sh
      ci-setup-runner-vds1.sh
      sync-compose-cfa2.sh
      cloudflare-dns-upsert.sh
      ...

  docs/
    deploy/
      cfa2.md                   # –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å: —á—Ç–æ —Ç–∞–∫–æ–µ cfa2
      cfa2-dev-runbook.md       # –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏ –¥–µ–ø–ª–æ—è/–ø—Ä–æ–≤–µ—Ä–∫–∏
      CI-BUILD-MATRIX.md        # rules:changes + mapping —Å–µ—Ä–≤–∏—Å–æ–≤
      MULTI_ACCOUNT_SETUP.md    # Cloudflare / env matrix
      20251113-cloudflare-ingress.md
      ...
```

–≠—Ç–æ —Å–æ–≥–ª–∞—Å—É–µ—Ç—Å—è –∏ —Å —Ç–≤–æ–∏–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏, –∏ —Å —É–∂–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–º c2p\_ois-cfa. ÓàÄfileciteÓàÇturn1file3ÓàÇturn1file15ÓàÅ

**–ü–µ—Ä–µ–µ–∑–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã –¥–æ–≤–µ—Å—Ç–∏ –¥–æ target:**

1. –í—Å—ë, —á—Ç–æ —Å–µ–π—á–∞—Å –ª–µ–∂–∏—Ç –≤ `deploy/docker-compose-at-vps/cfa2`, –ø–µ—Ä–µ–µ–∑–∂–∞–µ—Ç –≤ `ops/docker/cfa2`.
2. .env‚Äô—ã, –∫–æ—Ç–æ—Ä—ã–µ –∞–≥–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª –≤ `deploy/...`, –ø–µ—Ä–µ–µ–∑–∂–∞—é—Ç –≤ `ops/gitlab/cfa2/`.
3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (`cfa2.md`, runbook, CI‚Äëmatrix) —É–∂–µ –ø–æ—á—Ç–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∞ ‚Äî —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø—É—Ç–∏ –≤ —Ç–µ–∫—Å—Ç–∞—Ö –¥–æ final‚Äë–≤–∞—Ä–∏–∞–Ω—Ç–∞ (ops/docker, ops/gitlab). ÓàÄfileciteÓàÇturn1file6ÓàÇturn1file15ÓàÅ

### 3.2. CI layout (dev vs k8s)

**Root `.gitlab-ci.yml` (–∏–¥–µ—è):**

```yaml
stages:
  - sdk
  - build
  - deploy

include:
  - local: .gitlab/gitlab-ci.dev.yml
# k8s-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
#  - local: .gitlab/gitlab-ci.k8s.yml
#    rules:
#      - if: '$CI_COMMIT_BRANCH == "infra/k8s"'
```

**`.gitlab/gitlab-ci.dev.yml`:**

- —É–∂–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç:
  - stage `sdk`: `validate-specs`, `generate-sdks`; ÓàÄfileciteÓàÇturn1file14ÓàÇturn1file15ÓàÅ
  - stage `build`: –±—ç–∫–∏ + —Ñ—Ä–æ–Ω—Ç—ã, —Å `rules:changes` –ø–æ services/apps/packages; ÓàÄfileciteÓàÇturn1file5ÓàÇturn1file15ÓàÅ
  - stage `deploy`: `deploy-cfa2` –Ω–∞ `vds1`, SSH –Ω–∞ `cfa2`, `docker compose pull && up -d` –≤ `/srv/cfa`. ÓàÄfileciteÓàÇturn1file11ÓàÇturn1file15ÓàÅ

–¢—É—Ç –ø–æ —Å—É—Ç–∏ –Ω–∞–¥–æ:

- —Ñ–∏–∑–∏—á–µ—Å–∫–∏ **–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å** —Å—Ç–∞—Ä—ã–π `.gitlab/.gitlab-ci.yml` –≤ `.gitlab/gitlab-ci.k8s.yml`;
- —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ dev‚Äëpipeline –ª–µ–∂–∏—Ç –∏–º–µ–Ω–Ω–æ –≤ `.gitlab/gitlab-ci.dev.yml` –∏ root‚Äë—Ñ–∞–π–ª ‚Äî —Ç–æ–ª—å–∫–æ `include`.

### 3.3. SSH key, GitLab Variables –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ c2p\_ois-cfa —É–∂–µ –ø—Ä–æ–ø–∏—Å–∞–Ω–æ: ÓàÄfileciteÓàÇturn1file3ÓàÅ

- **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è:**
  - `SSH_PRIVATE_KEY` (protected, masked, type: variable).
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
  - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è `user@92.51.38.126` (cfa2) —Å –¥–æ—Å—Ç—É–ø–æ–º –≤ `/srv/cfa`.
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥–µ–ø–ª–æ–µ:**

```bash
before_script:
  - 'which ssh-agent || (apk add --no-cache openssh-client)'
  - eval "$(ssh-agent -s)"
  - mkdir -p ~/.ssh
  - echo "$SSH_PRIVATE_KEY" > /tmp/ci_ssh_key
  - chmod 600 /tmp/ci_ssh_key
  - ssh-add /tmp/ci_ssh_key
  - ssh -o StrictHostKeyChecking=no user@cfa2 "echo ok"
```

–ß—Ç–æ–±—ã **–Ω–µ –ª–æ–≤–∏—Ç—å `error in libcrypto`**:

1. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ `eywa1`:

   ```bash
   ssh-keygen -t ed25519 -f ~/.ssh/ci_cfa2_ed25519 -C "gitlab-ci-cfa2"
   ```

2. –ü—É–±–ª–∏—á–Ω—É—é —á–∞—Å—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –≤ `~user/.ssh/authorized_keys` –Ω–∞ `cfa2`.

3. –ü—Ä–∏–≤–∞—Ç–Ω—É—é —á–∞—Å—Ç—å —Ü–µ–ª–∏–∫–æ–º (–∫–∞–∫ –µ—Å—Ç—å, —Å BEGIN/END) ‚Äî –≤ GitLab CI/CD ‚Üí `SSH_PRIVATE_KEY`.

4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞—Ö (`docs/deploy/cfa2-dev-runbook.md` –∏–ª–∏ c2p\_ois-cfa) —ç—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–æ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–º —è–∑—ã–∫–æ–º.

---

## 4. DevOps Epic / Features / Stories (–∫–∞–∫ SSOT)

–ò—Å—Ö–æ–¥—è –∏–∑ SDD‚Äë—à–∞–±–ª–æ–Ω–æ–≤ (epic/feature/story) –∏ —Ç–≤–æ–µ–≥–æ ORACLE‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –ª—É—á—à–µ **–æ–¥–∏–Ω DevOps‚Äë—ç–ø–∏–∫**, —Ä–∞–∑–±–∏—Ç—ã–π –Ω–∞ 3‚Äì4 —Ñ–∏—á–∏. ÓàÄfileciteÓàÇturn0file5ÓàÇturn0file6ÓàÅ

### 4.1. Epic —Å–∫–µ–ª–µ—Ç

**–§–∞–π–ª:** `memory-bank/specs/epics/EPIC-DEVOPS-CFA2-CICD.md`

–ö–æ—Ä–æ—Ç–∫–∏–π –Ω–∞–±—Ä–æ—Å–æ–∫ (–ø–æ —Ç–≤–æ–µ–º—É —à–∞–±–ª–æ–Ω—É):

```markdown
---
version: "1.0.0"
last_edited: "2025-11-27 10:00"
created: "2025-11-27 10:00"
status: "active"
type: "epic"
category: "devops"
tags: [epic, devops, cfa2, cicd]
epic_id: "EPIC-DEVOPS-CFA2-CICD"
---

# EPIC-DEVOPS-CFA2-CICD: Stable dev pipeline for cfa2

## üéØ –¶–µ–ª—å —ç–ø–∏–∫–∞
–°—Ç–∞–±–∏–ª—å–Ω—ã–π, –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã–π dev‚Äëpipeline –¥–ª—è cfa2 (docker/compose), –∫–æ—Ç–æ—Ä—ã–π —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –±—ç–∫–µ–Ω–¥—ã/—Ñ—Ä–æ–Ω—Ç—ã, –¥–µ–ø–ª–æ–∏—Ç –Ω–∞ cfa2 –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω —Ç–∞–∫, —á—Ç–æ–±—ã –ª—é–±–æ–π –∞–≥–µ–Ω—Ç/—á–µ–ª–æ–≤–µ–∫ –º–æ–≥ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å.

## üìä –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
- –°–µ–π—á–∞—Å: –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è .gitlab-ci, –ø–ª–∞–≤–∞—é—â–∏–µ –ø—É—Ç–∏ docker/env, –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–π SSH key flow.
- –•–æ—Ç–∏–º: –æ–¥–∏–Ω SSOT –¥–ª—è CI/CD, docker‚Äëlayout –∏ runbook‚Äô–æ–≤, –±–µ–∑ overengineering –ø–æ–¥ k8s –¥–æ prod‚Äë—ç—Ç–∞–ø–∞.
```

–ò –¥–∞–ª—å—à–µ –ø–æ —à–∞–±–ª–æ–Ω—É: scope IN/OUT, –º–µ—Ç—Ä–∏–∫–∏ (–≤—Ä–µ–º—è –∑–µ–ª—ë–Ω–æ–≥–æ pipeline, % —É—Å–ø–µ—à–Ω—ã—Ö deploy‚Äëjob‚Äô–æ–≤, MTTR –ø–æ cfa2 –∏ —Ç.–ø.). ÓàÄfileciteÓàÇturn0file5ÓàÅ

### 4.2. Features –≤–Ω—É—Ç—Ä–∏ —ç–ø–∏–∫–∞ (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä)

1. **FEAT-DEVOPS-CFA2-PIPELINE-DEV**
   - CI stages: sdk/build/deploy –¥–ª—è –≤—Å–µ—Ö –±—ç–∫–æ–≤ –∏ —Ñ—Ä–æ–Ω—Ç–æ–≤.
   - Stable deploy –Ω–∞ cfa2.

2. **FEAT-DEVOPS-CFA2-STRUCTURE-CLEANUP**
   - –ü—Ä–∏–≤–µ—Å—Ç–∏ repo‚Äë–¥–µ—Ä–µ–≤–æ –∫ `ops/docker` + `ops/gitlab` + –µ–¥–∏–Ω—ã–π `.gitlab-ci` layout.

3. **FEAT-DEVOPS-CFA2-K8S-SANDBOX** (future)
   - –í—ã–¥–µ–ª–∏—Ç—å k8s‚Äëpipeline –≤ `.gitlab/gitlab-ci.k8s.yml`, –æ–ø–∏—Å–∞—Ç—å –µ–≥–æ –∫–∞–∫ –∑–∞–≥–æ—Ç–æ–≤–∫—É (prod/stage).

4. **FEAT-DEVOPS-AGENTS-SPEC**
   - `AGENTS.md` + Oracle‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–ª—è DevOps‚Äë–∞–≥–µ–Ω—Ç–∞ –∏ Localhost‚Äë–∞–≥–µ–Ω—Ç–∞, —á—Ç–æ–±—ã Codex –≤—Å–µ–≥–¥–∞ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. ÓàÄfileciteÓàÇturn1file14ÓàÇturn1file16ÓàÅ

–ö–∞–∂–¥–∞—è —Ñ–∏—á–∞ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π markdown –ø–æ —Ç–≤–æ–µ–º—É feature‚Äë—à–∞–±–ª–æ–Ω—É (feature‚Äëtemplate). ÓàÄfileciteÓàÇturn0file5ÓàÅ

### 4.3. Stories (–ø—Ä–∏–º–µ—Ä–Ω–æ)

–î–ª—è FEAT-DEVOPS-CFA2-PIPELINE-DEV:

- STORY-DEVOPS-001: ¬´–ö–∞–∫ DevOps, —è —Ö–æ—á—É, —á—Ç–æ–±—ã –≤—Å–µ –±—ç–∫–µ–Ω–¥—ã –∏ —Ñ—Ä–æ–Ω—Ç—ã —Å–æ–±–∏—Ä–∞–ª–∏—Å—å –≤ –æ–¥–Ω–æ–º pipeline, —á—Ç–æ–±—ã dev‚Äë–≤–µ—Ç–∫–∞ –¥–∞–≤–∞–ª–∞ –ø–æ–ª–Ω—ã–π docker‚Äë—Å—Ç–µ–∫ –Ω–∞ cfa2¬ª.
- STORY-DEVOPS-002: ¬´–ö–∞–∫ DevOps, —è —Ö–æ—á—É, —á—Ç–æ–±—ã deploy‚Äëjob –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å—Ç–∞—Ç–∏—á–Ω—ã–π compose+env –∏–∑ —Ä–µ–ø–æ –∏ –Ω–µ –≥–µ–Ω–µ—Ä–∏–ª —Ñ–∞–π–ª—ã –Ω–∞ –ª–µ—Ç—É¬ª.
- STORY-DEVOPS-003: ¬´–ö–∞–∫ DevOps, —è —Ö–æ—á—É –≤–∏–¥–µ—Ç—å CI‚Äë–º–∞—Ç—Ä–∏—Ü—É (rules:changes vs —Å–µ—Ä–≤–∏—Å—ã), —á—Ç–æ–±—ã –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ rebuild‚Äô–∏—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ X¬ª.

–î–ª—è FEAT-DEVOPS-CFA2-STRUCTURE-CLEANUP:

- STORY-DEVOPS-010: ¬´–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ compose/env cfa2 –≤ ops/docker/ops/gitlab, –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã¬ª.
- STORY-DEVOPS-011: ¬´–ù–∞–≤–µ—Å—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –≤ `.gitlab` (dev vs k8s, includes, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)¬ª.

---

## 5. AGENTS.md skeleton –ø–æ–¥ DevOps/CI

–ò–¥–µ—è ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π, –Ω–æ —á—ë—Ç–∫–∏–π —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ: `AGENTS.md`:

```markdown
# AGENTS

## DevOps / CI Agent (Codex CLI)

- ROLE: "Senior DevOps Engineer / CI-CD twin"
- REPO: ois-cfa
- PRIMARY BRANCHES:
  - dev-cfa2 (docker/compose dev pipeline)
- SCOPE:
  - ops/docker/**
  - ops/gitlab/**
  - .gitlab-ci.yml, .gitlab/gitlab-ci.*.yml
  - docs/deploy/**
- JTBD:
  - J1: Stabilize dev pipeline for cfa2 (all backends/frontends). ÓàÄfileciteÓàÇturn1file14ÓàÅ
  - J2: Keep docker/compose layout in sync with docs (ops/docker + ops/gitlab).
  - J3: Maintain CI-BUILD-MATRIX.md and deploy runbooks –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏.

- WORKFLOW CONTRACT:
  - –í—Å–µ–≥–¥–∞ {code-change} ‚Üí {tests/build} ‚Üí {docs/DoD-update} ‚Üí {commit}.
  - –ú–∏–Ω–∏–º—É–º 2 —Ü–∏–∫–ª–∞ –∑–∞ —Å–µ—Å—Å–∏—é, —Å–º. ORACLE 1.1.0. ÓàÄfileciteÓàÇturn0file6ÓàÅ
```

–¢–∞–º –∂–µ –º–æ–∂–Ω–æ –∫–æ—Ä–æ—Ç–∫–æ —Å–æ—Å–ª–∞—Ç—å—Å—è –Ω–∞ —Ç–≤–æ–π ORACLE‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç (AGENT\_WORKFLOW\_CONTRACT, AUTONOMY, FINAL SELF-CHECK) –±–µ–∑ –∫–æ–ø–∏–ø–∞—Å—Ç–∞ ‚Äî –∫–∞–∫ canonical ref.

---

## 6. –û—Ç–≤–µ—Ç—ã –Ω–∞ —Ç–≤–æ–∏ –ø—Ä—è–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

> –¢—ã –ø–æ–Ω—è–ª –ª–æ–≥–∏–∫—É –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã –±–∞—Ä–¥–∞–∫ —Å–¥–µ–ª–∞–ª –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö —Å–µ–π—á–∞—Å?

–î–∞, —Å—É—Ç—å –±–∞—Ä–¥–∞–∫–∞:

1. **–î–µ—Ä–µ–≤–æ**: —á–∞—Å—Ç—å compose/env —É–µ—Ö–∞–ª–∞ –≤ `deploy/...`, —á–∞—Å—Ç—å –æ–ø–∏—Å–∞–Ω–∞ –∫–∞–∫ `ops/...`; –¥–æ–∫–∏ –∏ —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.
2. **CI**: –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∂–∏–≤—É—Ç —Å—Ç–∞—Ä—ã–π –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π `.gitlab-ci.yml`, –Ω–æ–≤—ã–π dev‚Äëpipeline –∏ –Ω–µ–¥–æ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π k8s‚Äëpipeline.
3. **SSH key**: —Å–º—ã—Å–ª (`user@cfa2`) –æ–ø–∏—Å–∞–Ω –≤ c2p\_ois-cfa, –Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º GitLab, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –ª–µ–∂–∏—Ç –ª–∏–±–æ –±–∏—Ç—ã–π –∫–ª—é—á, –ª–∏–±–æ —ç—Ç–æ –Ω–µ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ —Ç–∞–º, –≥–¥–µ —Ç—ã –µ–≥–æ –æ–∂–∏–¥–∞–µ—à—å. ÓàÄfileciteÓàÇturn1file3ÓàÇturn1file5ÓàÇturn1file6ÓàÅ

> –≥–¥–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ ssh\_private\_key –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ gitlab? private\_key –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–∫–æ–º—É —Å–µ—Ä–≤–µ—Ä—É cfa2,vds1 –∏–ª–∏ –∫—É–¥–∞?

- **–í GitLab**: Settings ‚Üí CI/CD ‚Üí Variables ‚Üí `SSH_PRIVATE_KEY`.
- **–°–µ—Ä–≤–µ—Ä**: `user@92.51.38.126` (cfa2).
- **Runner vds1** –∫–ª—é—á–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç, –æ–Ω —Ç–æ–ª—å–∫–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç job –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç –∫–ª—é—á, —á—Ç–æ–±—ã –ø–æ SSH –ø–æ–ø–∞—Å—Ç—å –Ω–∞ cfa2. ÓàÄfileciteÓàÇturn1file3ÓàÇturn1file9ÓàÅ

---

## 7. –†–µ–∑—é–º–µ –≤ —Ç–∞–±–ª–∏—Ü–µ

| –¢–æ—á–∫–∞             | –°–µ–π—á–∞—Å                                                                                       | Target                                                                                           | –ß—Ç–æ –¥–µ–ª–∞—Ç—å                                                                        |
| ----------------- | -------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------- |
| Docker/compose    | cfa2 compose/env —á–∞—Å—Ç–∏—á–Ω–æ –≤ `deploy/docker-compose-at-vps/cfa2`, —á–∞—Å—Ç–∏—á–Ω–æ –≤ –¥–æ–∫–∞—Ö            | –í—Å—ë –¥–ª—è cfa2 –≤ `ops/docker/cfa2` + `ops/gitlab/cfa2`                                             | –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª—ã, –æ–±–Ω–æ–≤–∏—Ç—å `cfa2.md` –∏ runbook                                   |
| CI layout         | root `.gitlab-ci.yml` –±–æ–ª—å—à–æ–π; `.gitlab/.gitlab-ci.yml` –µ—â—ë –∂–∏–≤—ë—Ç; include‚Äë—Å—Ö–µ–º–∞ –Ω–µ –¥–æ–≤–µ–¥–µ–Ω–∞ | root `.gitlab-ci.yml` = include `.gitlab/gitlab-ci.dev.yml`; k8s –∫–∞–∫ `.gitlab/gitlab-ci.k8s.yml` | –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã, –ø–æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–π `.gitlab/.gitlab-ci.yml`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å include |
| SSH key           | Job –ø–∞–¥–∞–µ—Ç —Å `error in libcrypto`; –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–ª—é—á–∞ –Ω–µ–æ—á–µ–≤–∏–¥–Ω–æ                               | `SSH_PRIVATE_KEY` = OpenSSH‚Äë–∫–ª—é—á –¥–ª—è `user@cfa2`, –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ runbook‚Äô–∞—Ö                  | –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–ª—é—á, –ø–µ—Ä–µ–ª–æ–∂–∏—Ç—å –≤ GitLab, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–∫–∏                             |
| Pipeline coverage | –°—Ç–∞—Ä—ã–µ pipeline‚Äô—ã –±–µ–∑ —Ñ—Ä–æ–Ω—Ç–æ–≤/–Ω–æ–≤–æ–≥–æ layout                                                  | dev‚Äëpipeline —Å sdk/build(front+back)/deploy, path‚Äërules, deploy –Ω–∞ cfa2                          | –î–æ–ø—É—à–∏—Ç—å `dev-cfa2`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å CI-BUILD-MATRIX –∏ jobs                             |
| Spec/SSOT         | –ú–∏–∫—Å –ø—Ä–æ–º–ø—Ç–æ–≤, JSON‚Äë–ª–æ–≥–æ–≤ –∏ –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö md                                        | EPIC + FEAT + STORY md, AGENTS.md –∫–∞–∫ –≤—Ö–æ–¥ –¥–ª—è Codex                                             | –ó–∞–≤–µ—Å—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –ø–æ SDD‚Äë—à–∞–±–ª–æ–Ω–∞–º                                     |

---

## 8. Next actions (–¥–ª—è —Ç–µ–±—è / –¥–ª—è –∞–≥–µ–Ω—Ç–∞)

**–î–ª—è —Ç–µ–±—è (Human / Orchestrator):**

1. –ù–∞ `eywa1` –≤ `ois-cfa`:

   ```bash
   git checkout dev-cfa2
   git status -sb
   ```

2. –î–æ–≤–µ—Å—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ target (–±–µ–∑ –∞–≥–µ–Ω—Ç–∞):
   - –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å cfa2 compose/env ‚Üí `ops/docker/cfa2` –∏ `ops/gitlab/cfa2`.
   - –û–±–Ω–æ–≤–∏—Ç—å –ø—É—Ç–∏ –≤ `docs/deploy/cfa2*.md` –∏ –≤ c2p\_ois-cfa (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ).

3. –í GitLab:

   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å/–ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å `SSH_PRIVATE_KEY` –ø–æ —Å—Ö–µ–º–µ –≤—ã—à–µ.
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ runner –Ω–∞ vds1 –∂–∏–≤ –∏ —Å —Ç–µ–≥–æ–º `vds1`. ÓàÄfileciteÓàÇturn1file9ÓàÅ

4. –ü—Ä–∏–≤–µ—Å—Ç–∏ `.gitlab/` –∫ —Å—Ö–µ–º–µ:

   - —Å—Ç–∞—Ä—ã–π `.gitlab/.gitlab-ci.yml` ‚Üí `.gitlab/gitlab-ci.k8s.yml`;
   - dev‚Äëpipeline ‚Üí `.gitlab/gitlab-ci.dev.yml`;
   - root `.gitlab-ci.yml` ‚Üí —á–∏—Å—Ç—ã–π include.

5. –°–¥–µ–ª–∞—Ç—å `git commit` (–æ–¥–∏–Ω —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π) –∏ `git push origin dev-cfa2`, —á—Ç–æ–±—ã GitLab –≤–æ–æ–±—â–µ —É–≤–∏–¥–µ–ª –Ω–æ–≤—ã–π –º–∏—Ä.

6. –°–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏–º—É–º:

   - `memory-bank/specs/epics/EPIC-DEVOPS-CFA2-CICD.md` (—Å–∫–µ–ª–µ—Ç –≤—ã—à–µ);
   - `AGENTS.md` —Å DevOps‚Äë–∞–≥–µ–Ω—Ç–æ–º.

**–î–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ Codex‚Äë–∞–≥–µ–Ω—Ç–∞ (–ø–æ—Å–ª–µ —ç—Ç–∏—Ö —à–∞–≥–æ–≤):**

- –°—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å —Å —á—ë—Ç–∫–æ–≥–æ JTBD:

  - J1: –¥–µ—Ä–∂–∞—Ç—å dev‚Äëpipeline –¥–ª—è cfa2 –∑–µ–ª—ë–Ω—ã–º –∏ –ø–æ–ª–Ω—ã–º (back+front).
  - J2: —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å—é `ops/docker + ops/gitlab + docs/deploy`.
  - J3: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å CI‚Äë–º–∞—Ç—Ä–∏—Ü—É –∏ runbook‚Äô–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏.

- –†–∞–±–æ—Ç–∞—Ç—å —Å—Ç—Ä–æ–≥–æ –ø–æ —Ç–≤–æ–µ–º—É ORACLE‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç—É:\
  `{code-change} ‚Üí {tests/build} ‚Üí {docs/DoD} ‚Üí {commit}` –º–∏–Ω–∏–º—É–º 2 —Ü–∏–∫–ª–∞, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫–µ—Ä—ã, –±–µ–∑ —Ç–∏—Ö–∏—Ö —Ñ–æ–ª–ª–±—ç–∫–æ–≤. ÓàÄfileciteÓàÇturn1file16ÓàÅ

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –º–æ–≥—É —É–∂–µ **—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π `AGENTS.md` –∏ EPIC/FEAT/STORY md‚Äë—Ç–µ–∫—Å—Ç—ã**, –≥–æ—Ç–æ–≤—ã–µ –∫ –∫–æ–ø–∏–ø–∞—Å—Ç–µ –≤ —Ä–µ–ø–æ ‚Äî —Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö —ç—Ç–∏—Ö –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–µ–π.


#### You:
<time datetime="2025-11-27T04:56:58.657Z" title="27/11/2025, 07:56:58">07:56</time>




–ö–∞–∫ –Ω–∞—Å—á–µ—Ç –≤–æ–æ–±—â–µ —Å–¥–µ–ª–∞—Ç—å –∫–∞–∫–æ–π-—Ç–æ JSON, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–∞—Ä—Å–∏—Ç—å—Å—è –ø—Ä–∏ –ø—Ä–µ—Ö—É–∫–∞—Ö –∏ –Ω–µ –¥–∞–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–∞–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª —ç–∫—Å—Ç–µ–Ω—à–Ω –≤ –Ω–µ–Ω—É–∂–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ —Ä–∞–∑ –≤–æ—Ç —ç—Ç–∏ –≤–µ—â–∏? –í–µ—à–∞—Ç—å —Ç–∞–º –Ω–∞ —Ö–∞—Å–∫–∏, –Ω–∞ –ø—Ä–æ–∫–æ–º–º–∏—Ç—ã, –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫-—Ç–æ –µ—â–µ –ø–æ—É–º–Ω–µ–µ —Å–¥–µ–ª–∞—Ç—å. –ü–æ–¥—É–º–∞–ª–∏, –∫–∞–∫–∏–µ –ª—É—á—à–µ —Ç–∞–∫–∏–µ –≤–µ—â–∏, –Ω—É —Ç–∏–ø–∞ –±–æ–ª–µ–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ.

–¢–∞–º –∏ –ø—Ä–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Ç—ã –º–Ω–æ–≥–æ –ø—Ä–æ—á–∏—Ç–∞–ª, —è —Ö–æ—Ç–µ–ª –±—ã, —á—Ç–æ–±—ã —Ç—ã –≥–ª—É–±–∂–µ –∏–∑—É—á–∏–ª –ø–ª–æ–¥–æ–≤—É—é –±–∞–∑—É.

–ß—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è YAML —Ç–µ–≥–æ–≤, —è —Å—á–∏—Ç–∞—é –∏–∑–±—ã—Ç–æ—á–Ω—ã–º —Å—Ç–æ–ª—å–∫–æ —Ç–µ–≥–æ–≤. –•–æ—Ç—è –≤–æ—Ç —Å–µ–π—á–∞—Å —Å–º–æ—Ç—Ä—é category devops, –Ω–∞–≤–µ—Ä–Ω–æ–µ –Ω–µ category, –∞ –Ω—É —Ç–∏–ø–∞ —è –Ω–µ –∑–Ω–∞—é, –Ω—É –∏—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–æ—Ä–æ—á–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: devops, backend, frontend. –¢–∏–ø–∞, –∞ —Ç–µ–≥–∏ —Ç–∞–º –Ω–µ –≤–æ—Ç —ç—Ç–∏ –±–µ–∑–¥—É–º–Ω—ã–µ –Ω—É–∂–Ω–æ. Epic, devops, –µ—Å–ª–∏ –æ–Ω–æ —É–∂–µ –∏ —Ç–∞–∫ –µ—Å—Ç—å. –í–æ—Ç cfa2 –Ω–æ—Ä–º–∞–ª—å–Ω–æ, cacd –Ω–æ—Ä–º–∞–ª—å–Ω–æ, —Ç–∞–º —É—Å–ª–æ–≤–Ω–æ –≥–æ–≤–æ—Ä—è .net, –≤–æ—Ç –∫–∞–∫–∏–µ-—Ç–æ —Ç–∞–∫–∏–µ –∫–ª—é—á–µ–≤—ã–µ –≤–µ—â–∏. Epic ID —Ç–æ–∂–µ —Å–ª–∏—à–∫–æ–º. Epic devops cfa3 cacd. –ù—É, –¥–æ–ø—É—Å—Ç–∏–º, –æ–∫–µ–π.

–•–æ—Ç–µ–ª–æ—Å—å –±—ã –µ—â–µ –∫–∞–∫–æ–≥–æ-—Ç–æ... –ù—É–∂–Ω–∞ –ª–∏ –Ω–∞–º —Ä–∞–∑ –∏–ª–∏ –Ω–µ—Ç, —ç—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ. –ù—É –¥–∞, –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å. –§–∏—á–∏ –≤–Ω—É—Ç—Ä–∏ —ç–ø–∏–∫–∞, –Ω—É —Ç—ã –¥—É—Ä–∞–∫ –∏–ª–∏ –Ω–µ –¥—É—Ä–∞–∫, —è –∂–µ —Ç–µ–±–µ —Å–∫–∞–∑–∞–ª, —á—Ç–æ –º–Ω–æ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å. –•–æ—Ç—è, –Ω–µ –∑–Ω–∞—é, –Ω—É —Å–µ–π—á–∞—Å –ø–æ–¥—É–º–∞–π, —Ç–∞–º –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ —Ç—ã —Å—á–∏—Ç–∞–µ—à—å, —á—Ç–æ –º—ã –≤–æ—Ç —Å–µ–π—á–∞—Å, –Ω–∞–º –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ–¥–µ–ª–∞—Ç—å –≤–æ—Ç —ç—Ç–æ –≤—Å–µ, –∞ —Ç—ã —Ç—É—Ç —Å–¥–µ–ª–∞–ª overengineering. –ù—É–∂–Ω–æ —Å —ç—Ç–æ–π —Ç–æ—á–∫–∏.

–ò –∫–∞–∫–æ–π K8s, –º—ã –µ–≥–æ –≤–æ–æ–±—â–µ –Ω–µ —Ç—Ä–æ–≥–∞–µ–º. –¢—ã –∫–∞–∫ –±—É–¥—Ç–æ –Ω–µ–≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–ª –º–æ—é —Å–µ—Å—Å–∏—é, —Ç–∞–º –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, –ø–æ—Ä—Ç—ã. –ü–µ—Ä–µ–ø—Ä–æ—á–∏—Ç–∞–π –≤—Å–µ –º–æ–∏ –ø–æ—Ä—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Å–µ—Å—Å–∏–∏ cacd, –¥–∂–µ–π—Å–æ–Ω–æ–≤—Å–∫–æ–π. –¢—ã –≤–æ–æ–±—â–µ –∏—Ö –Ω–µ —É—á–µ–ª, –Ω–µ –≤–∑—è–ª –µ–≥–æ –≤–Ω–∏–º–∞–Ω–∏–µ.

–ò –∫–æ–≥–¥–∞ —Ä–∞—Å–ø–∏—Å—ã–≤–∞–µ—à—å –µ—â–µ —Å—Ç–∞—Ä–µ, —Ç–∞–º —Ç–∏–ø–∞ –Ω–µ –Ω—É–∂–Ω–æ –≤—Å—è–∫–∏–π —Ä–∏—Å–∫ –∏ –ø—Ä–æ—á–µ–µ. –ù—É, –≤ –æ–±—â–µ–º, —è –∫–∞–∫ –±—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–µ–¥–æ–≤–æ–ª–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º. –¢—ã –Ω–µ –Ω–∞–ø—Ä–∞–≤–∏–ª –µ–≥–æ –Ω–∞ –∫–∞–∫–∏–µ job to be done –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–¥–µ–ª–∞–Ω—ã, –∫–∞–∫–∏–µ definition of done —É —ç—Ç–∏—Ö jobs, –∏ –∫–∞–∫–∏–µ kick-off tasks. –ù—É —Ç–æ –µ—Å—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã, —á—Ç–æ —Ç—ã –≤—ã–¥–∞–ª, –æ—á–µ–Ω—å —Å–ª–∞–±–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ. –î–∞–≤–∞–π –ø–æ–ø—Ä–æ–±—É–π, —Å–¥–µ–ª–∞–π –ª—É—á—à–µ.

–ï—â–µ —Ä–∞–∑ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–æ–∏ –ø—Ä–æ–º—Ç—ã, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å–µ—Å—Å–∏—é, –ø—Ä–æ–º—Ç—ã –ø–æ —Å–µ—Å—Å–∏–∏.

–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ? –Ø –∂–µ —Ç–µ–±—è –ø–æ–ø—Ä–æ—Å–∏–ª, —á—Ç–æ–±—ã –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –≤—Å–µ—Ö —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤. –¢—ã —Ç–∏–ø–∞ –Ω–∞–ø–∏—Å–∞–ª, –Ω–æ —Ç—ã –Ω–µ –ø—Ä–æ–ø–∏—Å–∞–ª –µ—â–µ –ø–æ –ø–æ–≤–æ–¥—É —ç–ø–∏–∫–æ–≤, —á—Ç–æ —Ç–∞–º –≤ –∏—Ç–æ–≥–µ –µ—Å—Ç—å, —á—Ç–æ —Å—Ç–æ–∏—Ç —É–±—Ä–∞—Ç—å. –¢—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –≤–æ–æ–±—â–µ –≤—Å—é –∫–æ–¥–æ–≤—É—é –±–∞–∑—É, –∫–æ—Ç–æ—Ä—É—é —è –ø—Ä–∏–∫—Ä–µ–ø–∏–ª?

#### ChatGPT:
<time datetime="2025-11-27T05:04:00.376Z" title="27/11/2025, 08:04:00">08:04</time>

TL;DR

- –î–∞, –∏–¥–µ—è —Å JSON‚Äëguardrails –ø–æ–¥ pre‚Äëhooks –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è: –æ–¥–∏–Ω SSOT cfa2‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ + —Ñ–∞–π–ª–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞, –æ–±—â–∏–π –∏ –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤, –∏ –¥–ª—è git‚Äë—Ö—É–∫–æ–≤.
- –Ø –≤—ã—Ç–∞—â–∏–ª –∏–∑ —Ç–≤–æ–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —è–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è/–ø—Ä–∞–≤–∫–∏ –∏ —Å–≤–µ—Ä–∏–ª —Å —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º dev‚Äëcfa2 (compose, –ø–æ—Ä—Ç—ã, CI, SSH key, docs) –ø–æ –ª–æ–≥–∞–º –∏ c2p.ÓàÄfileciteÓàÇturn2file11ÓàÇturn2file12ÓàÇturn2file3ÓàÅ
- –ù–∏–∂–µ ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç `repo-guardrails.cfa2.json`, –ø—Ä–∏–º–µ—Ä pre‚Äëcommit —Å–∫—Ä–∏–ø—Ç–∞, –∏ —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Å—Ö–µ–º–∞ frontmatter (category/tags) –±–µ–∑ –æ–≤–µ—Ä–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞.

---

## 1. –ß—Ç–æ —Ç—ã –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª (–∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ/—Ç–µ–∫—Å—Ç–∞)

### 1.1 Hard requirements

**Scope / –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

- –°–µ–π—á–∞—Å **–≤–æ–æ–±—â–µ –Ω–µ —Ç—Ä–æ–≥–∞–µ–º K8s**: –Ω–∏–∫–∞–∫–æ–≥–æ k8s/agent/Helm –≤ —Ç–µ–∫—É—â–µ–º DevOps‚Äë—ç–ø–∏–∫—É; —Ç–æ–ª—å–∫–æ dev‚Äëpipeline –¥–ª—è **cfa2 –Ω–∞ Docker Compose**.
- –ò—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –ø–æ cfa2: compose + env –≤ —Ä–µ–ø–æ, —Å–∏–Ω–∫ –≤ `/srv/cfa` –Ω–∞ `cfa2 (92.51.38.126)`; CI –Ω–∏—á–µ–≥–æ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ç –Ω–∞ –ª–µ—Ç—É.ÓàÄfileciteÓàÇturn2file11ÓàÇturn2file12ÓàÅ
- UK1/cfa1 ‚Äî **read‚Äëonly reference**, –Ω–µ –ª–µ–∑–µ–º.ÓàÄfileciteÓàÇturn2file12ÓàÅ

**–§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (DevOps)**

- –í—Å—ë, —á—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è Docker, –¥–æ–ª–∂–Ω–æ –ª–µ–∂–∞—Ç—å **–≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ**, –∞ –Ω–µ —Ä–∞–∑–º–∞–∑–∞–Ω–æ –ø–æ –¥–æ–∫–∞–º:
  - `ops/docker/**` ‚Äî docker‚Äëcompose –∏ –ø—Ä–æ—á–µ–µ Docker‚Äë–∂–µ–ª–µ–∑–æ (–≤ —Ç–æ–º —á–∏—Å–ª–µ `ops/docker/cfa2/docker-compose.yml`).ÓàÄfileciteÓàÇturn2file2ÓàÇturn2file11ÓàÅ
  - `ops/gitlab/cfa2/**` ‚Äî `.env.cfa2`, `.env.example` –∏ –ø—Ä–æ—á–∏–µ GitLab/CI‚Äëspecific env.ÓàÄfileciteÓàÇturn2file2ÓàÇturn2file11ÓàÅ
  - `docs/deploy/**` ‚Äî —Ç–æ–ª—å–∫–æ runbook‚Äô–∏ / –æ–ø–∏—Å–∞–Ω–∏—è, **–Ω–∏–∫–∞–∫–∏—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö compose/env –≤–Ω—É—Ç—Ä–∏ docs**.
- `.gitlab-ci`:
  - –û–¥–∏–Ω –æ—Å–Ω–æ–≤–Ω–æ–π `.gitlab-ci.yml` –≤ –∫–æ—Ä–Ω–µ.
  - K8s‚Äë—à–∞–±–ª–æ–Ω –∂–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ (`.gitlab/gitlab-ci.k8s.yml`), –∏ **–Ω–µ –¥–æ–ª–∂–µ–Ω —Å–ª—É—á–∞–π–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è** –≤ dev‚Äë–∫–æ–Ω—Ç–µ–∫—Å—Ç–µ. –°–µ–π—á–∞—Å —ç—Ç–æ —É–∂–µ —Ç–∞–∫: include —Ç–æ–ª—å–∫–æ `.gitlab/gitlab-ci.dev.yml`.ÓàÄfileciteÓàÇturn2file5ÓàÇturn2file6ÓàÅ

**–ü–æ—Ä—Ç—ã / –æ–∫—Ä—É–∂–µ–Ω–∏–µ cfa2**

- –ü–æ—Ä—Ç—ã cfa2 –∂—ë—Å—Ç–∫–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –∏ –¥–æ–ª–∂–Ω—ã —Å–æ–±–ª—é–¥–∞—Ç—å—Å—è –∏ –≤ compose, –∏ –≤ –¥–æ–∫–µ:ÓàÄfileciteÓàÇturn2file11ÓàÅ
  - gateway 58081, identity 58082, issuance 58083, registry 58084, settlement 58085, compliance 58086
  - keycloak 58080, postgres 55432, redis 56379, minio 59000/59001
  - —Ñ—Ä–æ–Ω—Ç—ã: issuer 3001, investor 3002, backoffice 3003
- –ü—Ä–æ–≤—ë—Ä–∫–∞ –ø–æ—Å–ª–µ deploy ‚Äî swagger+frontends –ø–æ —ç—Ç–∏–º –ø–æ—Ä—Ç–∞–º, –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å —Å–≤–æ—ë.ÓàÄfileciteÓàÇturn2file11ÓàÅ

**–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ / YAML frontmatter**

- `category` ‚Äî **–º–∞–ª–µ–Ω—å–∫–∏–π enum**, –∞ –Ω–µ –∑–æ–æ–ø–∞—Ä–∫:
  - `devops`, `backend`, `frontend` (–≤–æ–∑–º–æ–∂–Ω–æ –µ—â—ë –æ–¥–∏–Ω‚Äë–¥–≤–∞ –±–∏–∑–Ω–µ—Å–æ–≤—ã—Ö, –Ω–æ –Ω–µ 20).
- `tags` ‚Äî —Ç–æ–ª—å–∫–æ –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ:
  - env (`cfa2`, `uk1`, `cfa1`), concern (`cicd`, `docker`, `cloudflare`, `keycloak`), tech (`dotnet`, `nextjs`, `postgres`) –∏ —Ç.–ø.
  - **–ù–µ** –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –æ—á–µ–≤–∏–¥–Ω–æ–µ (`epic`, `devops`) –µ—Å–ª–∏ —É–∂–µ –ø–æ–Ω—è—Ç–Ω—ã `type` –∏ `category`.
  - –ù–µ –ø–ª–æ–¥–∏—Ç—å `epic devops cfa3 cacd` —Ä–∞–¥–∏ —Ç–µ–≥–∞.

**SDD / Epics / Stories**

- –°–µ–π—á–∞—Å —Ç–µ–±–µ –Ω—É–∂–µ–Ω **–Ω–µ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π SDD**, –∞ –±–æ–µ–≤–æ–π DevOps‚Äë—ç–ø–∏–∫:
  - –º–∏–Ω–∏–º—É–º —ç–ø–∏–∫–æ–≤/—Ñ–∏—á/—Å—Ç–æ—Ä–µ–π, —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã **–¥–æ–≤–µ—Å—Ç–∏ dev‚Äëcfa2 pipeline –∏ compose –¥–æ DoD**;
  - –Ω–∏–∫–∞–∫–∏—Ö RAID‚Äë—Ç–∞–±–ª–∏—Ü –∏ –ø—Ä–æ—á–µ–≥–æ ¬´—Ä–∏—Å–∫–∏, RAID, –º–∞—Ç—Ä–∏—Ü–∞‚Ä¶¬ª –≤ –∫–∞–∂–¥–æ–π story;
  - —Ñ–æ–∫—É—Å: **JTBD ‚Üí DoD ‚Üí Kickoff‚Äëtasks**.
- –≠–ø–∏–∫–∏/—Ñ–∏—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–≤—è–∑–∞–Ω—ã —Å **–∫–æ–Ω–µ—á–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏**: compose, `.gitlab-ci.yml`, runbooks, —Å–∫—Ä–∏–ø—Ç—ã –∏ —Ç.–¥., –∞ –Ω–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ ¬´DevOps initiative¬ª.

**–ö–∞—á–µ—Å—Ç–≤–æ –∞–≥–µ–Ω—Ç–∞**

- –ê–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ JTBD‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç—É (—Ç–∏–ø–∞ —Ç–æ–≥–æ, —á—Ç–æ —É —Ç–µ–±—è –≤ ORACLE 1.1.0), —Å loop‚Äô–æ–º `{code-change ‚Üí tests ‚Üí docs/DoD ‚Üí commit}` –∏ self‚Äëcheck –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º.ÓàÄfileciteÓàÇturn0file6ÓàÅ
- –¢—ã –æ–∂–∏–¥–∞–µ—à—å, —á—Ç–æ —è **—Ä–µ–∞–ª—å–Ω–æ** –ø—Ä–æ—á–∏—Ç–∞—é:
  - CICD‚Äëoracle,
  - c2p\_ois-cfa (–≤–∫–ª—é—á–∞—è dev‚Äëcfa2 runbook, –ø–æ—Ä—Ç—ã, SSH key, —Ñ–∞–π–ª—ã –Ω–∞ cfa2),ÓàÄfileciteÓàÇturn2file11ÓàÇturn2file3ÓàÅ
  - —Å–µ—Å—Å–∏–∏ w19/w21, –≥–¥–µ –∞–≥–µ–Ω—Ç —É–∂–µ –ø—Ä–∞–≤–∏–ª dev‚Äëcfa2.ÓàÄfileciteÓàÇturn2file12ÓàÇturn2file7ÓàÅ

### 1.2 –ö–æ—Ä—Ä–µ–∫—Ü–∏–∏ –∫ –ø—Ä–æ—à–ª–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É

- –Ø –ø–µ—Ä–µ—É—Å–ª–æ–∂–Ω–∏–ª SDD: —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —ç–ø–∏–∫–æ–≤/—Ñ–∏—á, –Ω–µ–Ω—É–∂–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –ø—Ä–æ —Ä–∏—Å–∫–∏, k8s –∏ —Ç.–ø. ‚Äî **–Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—É—â–µ–º—É JTBD (–∑–∞–∫—Ä—ã—Ç—å dev‚Äëcfa2)**.
- –í —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ–ø–∏—Å—å—è—Ö –Ω–µ –±—ã–ª–æ —è–≤–Ω–æ–π —Å–≤—è–∑–∫–∏: **–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ jobs to be done ‚Üí –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π DoD ‚Üí –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ Kickoff‚Äëtasks**.
- –Ø —Ä–∞–∑–º—ã—Ç–æ –æ—Ç–Ω—ë—Å—Å—è –∫ k8s –∏ –±—É–¥—É—â–µ–º—É –ø—Ä–æ–¥‚Äë–∫–æ–Ω—Ç–µ–∫—Å—Ç—É, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ—Ç—Ä–µ–∑–∞—Ç—å –µ–≥–æ —Å–µ–π—á–∞—Å.
- –¢—ã –ø—Ä–∞–≤: –±–µ–∑ –∂—ë—Å—Ç–∫–æ–≥–æ JSON/guardrails –∞–≥–µ–Ω—Ç—ã —Ä–∞–∑—ä–µ–∑–∂–∞—é—Ç—Å—è –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ (compose –≤ docs, –¥—É–±–ª–∏ .gitlab-ci –∏ —Ç.–ø.). –ß–∞—Å—Ç–∏—á–Ω–æ —ç—Ç–æ —É–∂–µ –ø–æ–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä—É–∫–∞–º–∏/–∞–≥–µ–Ω—Ç–æ–º, –Ω–æ –Ω–∞–¥–æ **–∑–∞–∫—Ä–µ–ø–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º –∏ pre‚Äëhooks**.ÓàÄfileciteÓàÇturn2file7ÓàÇturn2file5ÓàÅ

### 1.3 Suggestions/–∏–¥–µ–∏ –æ—Ç —Ç–µ–±—è

- –°–¥–µ–ª–∞—Ç—å **JSON‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç**, –∫–æ—Ç–æ—Ä—ã–π:
  - —á–∏—Ç–∞–µ—Ç—Å—è pre‚Äëcommit/Husky‚Äë—Ö—É–∫–æ–º ‚Üí –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã/–ø—É—Ç–∏/—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è;
  - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ prompt‚Äô–∞—Ö –∞–≥–µ–Ω—Ç–æ–≤ –∫–∞–∫ machine‚Äëreadable policy.
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å frontmatter (category/tags) –∏ –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ —Ç–æ–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –ù–æ—Ä–º–∞–ª—å–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å **AGENTS/ORACLE‚Äë–¥–æ–∫**, –≥–¥–µ —ç—Ç–æ—Ç JSON –∏ JTBD/DoD ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã (SSOT), –∞ –Ω–µ —Ä–∞—Å–∫–∏–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã.

---

## 2. –û—Ç–≤–µ—Ç –Ω–∞ ¬´—Ç—ã –≤–æ–æ–±—â–µ –∫–æ–¥ —á–∏—Ç–∞–ª?¬ª

–ß–µ—Å—Ç–Ω–æ:

- –Ø **–Ω–µ –±–µ–≥–∞—é –ø–æ –∂–∏–≤–æ–º—É —Ä–µ–ø–æ** –∫–∞–∫ Codex –Ω–∞ eywa1, —É –º–µ–Ω—è —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–Ω–∞–ø—à–æ—Ç—ã.
- –ù–æ —è –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–ª:

  - c2p\_ois-cfa.txt ‚Äî —Ç–∞–º:
    - —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ cfa2‚Äë–¥–µ–ø–ª–æ—è (files, ports, SSH\_PRIVATE\_KEY, –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å),ÓàÄfileciteÓàÇturn2file11ÓàÅ
    - –∫—É—Å–∫–∏ –∫–æ–¥–∞ (—Å–∫—Ä–∏–ø—Ç—ã, .NET‚Äë—Å–µ—Ä–≤–∏—Å—ã) ‚Äî –≤–∏–∂—É —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –¥–æ–∫–∏.ÓàÄfileciteÓàÇturn1file6ÓàÅ
  - eywa1‚Äëw21 session ‚Äî –∫–∞–∫ –∞–≥–µ–Ω—Ç —Ä–µ–∞–ª—å–Ω–æ –º–µ–Ω—è–ª:
    - –ø—É—Ç–∏ compose/env (`ops/docker/cfa2`, `ops/gitlab/cfa2`),
    - `sync-compose-cfa2.sh`,
    - `.gitlab-ci.yml` + `.gitlab/gitlab-ci.dev.yml`/`.gitlab-ci.k8s.yml`,
    - runbook‚Äô–∏ `cfa2-dev-runbook.md`, `cfa2.md`, `CI-BUILD-MATRIX.md`, `MULTI_ACCOUNT_SETUP.md`.ÓàÄfileciteÓàÇturn2file2ÓàÇturn2file4ÓàÇturn2file10ÓàÇturn2file1ÓàÅ
  - CICD‚Äëoracle JSON ‚Äî —Ç–≤–æ–π –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø–æ dev‚Äëcfa2 (compose –≤ —Ä–µ–ø–æ, deploy job, ssh‚Äë–∫–ª—é—á, runner vds1 –∏ —Ç.–ø.).ÓàÄfileciteÓàÇturn2file15ÓàÅ
  - SDD‚Äë—à–∞–±–ª–æ–Ω—ã epics/features/stories ‚Äî –æ–Ω–∏ —Ä–µ–∞–ª—å–Ω–æ —Ç—è–∂—ë–ª—ã–µ –¥–ª—è —Ç–≤–æ–µ–≥–æ —Ç–µ–∫—É—â–µ–≥–æ DevOps‚Äëusecase.ÓàÄfileciteÓàÇturn0file5ÓàÅ

–í—ã–≤–æ–¥: —è –≤–∏–∂—É **–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ**, —á—Ç–æ–±—ã —Ö–æ—Ä–æ—à–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏ guardrails –ø–æ dev‚Äëcfa2, –Ω–æ, –∫–æ–Ω–µ—á–Ω–æ, –Ω–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ ¬´–∫–∞–∂–¥—ã–π .cs —Ñ–∞–π–ª¬ª.

---

## 3. JSON‚Äëguardrails: —Ñ–æ—Ä–º–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–∫–∞—Ä–º–ª–∏–≤–∞–µ–º –∏ pre‚Äëhook'—É, –∏ –∞–≥–µ–Ω—Ç—É

### 3.1 –ì–¥–µ –∏ –∫–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å

–ü—Ä–µ–¥–ª–∞–≥–∞—é:

- –§–∞–π–ª: `ops/agents/repo-guardrails.cfa2.json`
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
  - **Section A:** scope + hard constraints –∏ –ø–æ—Ä—Ç—ã;
  - **Section B:** —Ñ–∞–π–ª–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è pre‚Äëcommit;
  - **Section C (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ):** frontmatter contract (category/tags) –¥–ª—è DevOps‚Äë–¥–æ–∫–æ–≤.

–ü—Ä–∏–º–µ—Ä **–º–∏–Ω–∏–º–∞–ª—å–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ** JSON (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ c2p):ÓàÄfileciteÓàÇturn2file11ÓàÇturn2file12ÓàÅ

```json
{
  "version": "0.1.0",
  "scope": "ois-cfa/dev-cfa2",
  "hardConstraints": {
    "touchUK1": false,
    "touchCfa1": false,
    "tlsManagedInScriptsNotCI": true,
    "composeSourceOfTruth": "ops/docker/cfa2/docker-compose.yml",
    "envDir": "ops/gitlab/cfa2",
    "runtimeHost": "92.51.38.126",
    "runtimeDir": "/srv/cfa",
    "deployBranch": "dev-cfa2",
    "deployJob": "deploy-cfa2"
  },
  "ports": {
    "gateway": 58081,
    "identity": 58082,
    "issuance": 58083,
    "registry": 58084,
    "settlement": 58085,
    "compliance": 58086,
    "keycloak": 58080,
    "postgres": 55432,
    "redis": 56379,
    "minio": 59000,
    "minioConsole": 59001,
    "portalIssuer": 3001,
    "portalInvestor": 3002,
    "backoffice": 3003
  },
  "paths": {
    "dockerRoot": "ops/docker",
    "dockerCfa2": "ops/docker/cfa2",
    "gitlabCfa2": "ops/gitlab/cfa2",
    "docsDeploy": "docs/deploy",
    "rootCi": ".gitlab-ci.yml",
    "devCiInclude": ".gitlab/gitlab-ci.dev.yml",
    "k8sCiTemplate": ".gitlab/gitlab-ci.k8s.yml"
  },
  "precommitRules": [
    {
      "id": "no-docker-compose-in-docs",
      "type": "forbidPath",
      "pattern": "docs/deploy/",
      "extensions": [".yml", ".yaml"],
      "message": "Docker compose files must live under ops/docker/**, not under docs/deploy/**."
    },
    {
      "id": "env-files-location",
      "type": "forbidPath",
      "pattern": "",
      "filenames": [".env.cfa2", ".env.example"],
      "allowedDir": "ops/gitlab/cfa2",
      "message": "cfa2 env files must live in ops/gitlab/cfa2/."
    },
    {
      "id": "single-root-ci",
      "type": "uniqueFile",
      "filename": ".gitlab-ci.yml",
      "maxCount": 1,
      "message": "Only one .gitlab-ci.yml is allowed at repo root. Use .gitlab/gitlab-ci.k8s.yml for k8s templates."
    },
    {
      "id": "forbid-k8s-jobs-in-dev-ci",
      "type": "forbidContent",
      "file": ".gitlab/gitlab-ci.dev.yml",
      "forbiddenSubstrings": ["kubectl", "kubernetes", "k8s", "gitlab-agent"],
      "message": "Dev CI config must not contain k8s/agent logic."
    }
  ],
  "frontmatter": {
    "category": {
      "enum": ["devops", "backend", "frontend"]
    },
    "tags": {
      "whitelist": [
        "cfa2", "cfa1", "uk1",
        "cicd", "docker", "gitlab", "cloudflare", "keycloak",
        "dotnet", "nextjs", "postgres"
      ],
      "maxPerDoc": 6
    }
  }
}
```

–≠—Ç–æ –º–æ–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –∫–∞–∫ **SSOT**: –∏ –∞–≥–µ–Ω—Ç —á–∏—Ç–∞–µ—Ç, –∏ pre‚Äëhook.

---

## 4. –ü—Ä–∏–º–µ—Ä pre‚Äëcommit / Husky‚Äë—Ö—É–∫–∞ –Ω–∞ —ç—Ç–æ–º JSON

–ù–∏–∂–µ ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ–π Node‚Äë—Å–∫—Ä–∏–ø—Ç –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–π:

- —á–∏—Ç–∞–µ—Ç `ops/agents/repo-guardrails.cfa2.json`,
- —Å–º–æ—Ç—Ä–∏—Ç `git diff --cached --name-only`,
- –ø—Ä–∏–º–µ–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª:

–§–∞–π–ª `ops/scripts/precommit-guardrails.cfa2.mjs`:

```js
#!/usr/bin/env node
import { execSync } from "node:child_process";
import fs from "node:fs";
import path from "node:path";

const configPath = "ops/agents/repo-guardrails.cfa2.json";

function loadConfig() {
  const raw = fs.readFileSync(configPath, "utf8");
  return JSON.parse(raw);
}

function getChangedFiles() {
  const out = execSync("git diff --cached --name-only", { encoding: "utf8" });
  return out.split("\n").map(f => f.trim()).filter(Boolean);
}

function runPrecommitRules(cfg, files) {
  const violations = [];

  const rules = cfg.precommitRules || [];

  for (const file of files) {
    const ext = path.extname(file);

    for (const rule of rules) {
      if (rule.type === "forbidPath") {
        const inPattern =
          (!rule.pattern || file.startsWith(rule.pattern)) &&
          (!rule.extensions || rule.extensions.includes(ext));

        if (inPattern) {
          if (rule.allowedDir) {
            const dir = path.dirname(file);
            if (!dir.startsWith(rule.allowedDir)) {
              violations.push({ rule: rule.id, file, message: rule.message });
            }
          } else {
            violations.push({ rule: rule.id, file, message: rule.message });
          }
        }
      }

      if (rule.type === "uniqueFile" && path.basename(file) === rule.filename) {
        // –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∞–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ ‚Äî –ø—Ä–æ—â–µ —á–µ—Ä–µ–∑ git ls-files
        const count = execSync(
          `git ls-files ${rule.filename} | wc -l`,
          { encoding: "utf8" }
        ).trim();
        if (parseInt(count, 10) > (rule.maxCount || 1)) {
          violations.push({
            rule: rule.id,
            file,
            message: rule.message + ` (found ${count})`
          });
        }
      }

      if (rule.type === "forbidContent" && file === rule.file) {
        const content = fs.readFileSync(file, "utf8");
        for (const sub of rule.forbiddenSubstrings || []) {
          if (content.includes(sub)) {
            violations.push({
              rule: rule.id,
              file,
              message: `${rule.message} (found: "${sub}")`
            });
          }
        }
      }
    }
  }

  return violations;
}

function main() {
  if (!fs.existsSync(configPath)) {
    process.exit(0);
  }

  const cfg = loadConfig();
  const files = getChangedFiles();
  const violations = runPrecommitRules(cfg, files);

  if (violations.length > 0) {
    console.error("\n[GUARDRAILS] Some changes violate repo-guardrails.cfa2.json:\n");
    for (const v of violations) {
      console.error(`- [${v.rule}] ${v.file}: ${v.message}`);
    }
    console.error("\nFix issues or update guardrails config if this change is really intended.\n");
    process.exit(1);
  }

  process.exit(0);
}

main();
```

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ Husky (–µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å Node/–ø–∞–∫–µ—Ç—ã):

```bash
npx husky add .husky/pre-commit "node ops/scripts/precommit-guardrails.cfa2.mjs"
```

–¢–∞–∫–æ–π pre‚Äëhook:

- –Ω–µ –¥–∞—ë—Ç —Ç–∞—â–∏—Ç—å `docker-compose.yml` –≤ `docs/deploy/**`;
- –Ω–µ –¥–∞—ë—Ç `.env.cfa2` –≤–∞–ª—è—Ç—å—Å—è –≤–Ω–µ `ops/gitlab/cfa2`;
- –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ `k8s`‚Äë–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –Ω–µ —É–µ–¥—É—Ç –≤ `gitlab-ci.dev.yml`;
- –Ω–µ –¥–∞—ë—Ç –ø–ª–æ–¥–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ `.gitlab-ci.yml`.

### 4.1 –ö–∞–∫ —ç—Ç–æ –∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ prompt‚Äô–∞—Ö –∞–≥–µ–Ω—Ç–æ–≤

–í prompt –¥–ª—è Codex‚Äë–∞–≥–µ–Ω—Ç–∞:

- –≤—Å—Ç–∞–≤–ª—è–µ—à—å **—Å–∂–∞—Ç—ã–π** –≤–∏–¥ —ç—Ç–æ–≥–æ JSON (–∏–ª–∏ –¥–∞—ë—à—å –ø—É—Ç—å –∏ –ø—Ä–æ—Å–∏—à—å –µ–≥–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤–Ω–∞—á–∞–ª–µ —Å–µ—Å—Å–∏–∏, –µ—Å–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É–º–µ–µ—Ç);
- —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—à—å –ø—Ä–∞–≤–∏–ª–æ: ‚Äú–õ—é–±–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–∞–¥ —Ñ–∞–π–ª–∞–º–∏/–ø–æ—Ä—Ç–∞–º–∏/CI, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç `hardConstraints` –∏–ª–∏ `precommitRules`, **–∑–∞–ø—Ä–µ—â–µ–Ω–∞**; –µ—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî —Å–Ω–∞—á–∞–ª–∞ –æ–±–Ω–æ–≤–∏ JSON –∏ —Å–ø—Ä–æ—Å–∏ —É —á–µ–ª–æ–≤–µ–∫–∞‚Äù.

---

## 5. –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π frontmatter –¥–ª—è DevOps‚Äë–¥–æ–∫–æ–≤

–ß—Ç–æ–±—ã –Ω–µ –ø–ª–æ–¥–∏—Ç—å —Ç–µ–≥–æ–≤, –ø—Ä–µ–¥–ª–∞–≥–∞—é **–ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç** –¥–ª—è DevOps‚Äë—á–∞—Å—Ç–∏ (runbooks, CI‚Äë–¥–æ–∫–∏) ‚Äî –∏–º–µ–Ω–Ω–æ –µ–≥–æ –º–æ–∂–µ—Ç –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ pre‚Äëcommit.

### 5.1 –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–º–∞—Ç—Ç–µ—Ä

–î–ª—è DevOps‚Äërunbook‚Äô–æ–≤ –≤—Ä–æ–¥–µ `docs/deploy/cfa2.md`, `cfa2-dev-runbook.md`, `CI-BUILD-MATRIX.md`:ÓàÄfileciteÓàÇturn2file10ÓàÇturn2file1ÓàÅ

```yaml
---
created: 2025-11-26 21:35
updated: 2025-11-27 00:25
type: runbook
category: devops
tags: [cfa2, cicd, docker, gitlab]
author: alex
version: 0.2.0
---
```

–ö–æ–Ω—Ç—Ä–∞–∫—Ç:

- `category` ‚àà `{devops, backend, frontend}`
- `tags` ‚Äî –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ `frontmatter.tags.whitelist` –∏–∑ JSON (—Å–º. –≤—ã—à–µ), ‚â§ 6 —à—Ç;
- –Ω–∏–∫–∞–∫–∏—Ö `epic`, `story`, `devops` –≤ tags ‚Äî —ç—Ç–æ —É–∂–µ –≤–∏–¥–Ω–æ –∏–∑ `type`/`category`.

–î–ª—è **DevOps‚Äë—ç–ø–∏–∫–∞** (–æ—Ç–¥–µ–ª—å–Ω—ã–π MD, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω):

```yaml
---
version: "0.1.0"
status: "active"
type: "epic"
category: "devops"
epic_id: "EPIC-DEVOPS-CFA2-CICD"
tags: [cfa2, cicd, docker, gitlab]
---
# EPIC-DEVOPS-CFA2-CICD: dev pipeline + deploy for cfa2

## JTBD
- J1: –°—Ç–∞–±–∏–ª—å–Ω—ã–π dev‚Äëpipeline (build –≤—Å–µ—Ö back+front –¥–ª—è cfa2).
- J2: –ê–≤—Ç–æ–¥–µ–ø–ª–æ–π –Ω–∞ cfa2 (`deploy-cfa2`) c compose –∏–∑ —Ä–µ–ø–æ.
- J3: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è + runbooks –ø–æ cfa2 (–∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å).

## DoD
- [ ] dev-cfa2 pipeline –∑–µ–ª—ë–Ω—ã–π (build + deploy-cfa2).
- [ ] `ops/docker/cfa2/docker-compose.yml` + `ops/gitlab/cfa2/.env.cfa2` —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ `/srv/cfa` —Å–∫—Ä–∏–ø—Ç–æ–º.
- [ ] Swagger –ø–æ 58081..58086 –∏ —Ñ—Ä–æ–Ω—Ç—ã –ø–æ 3001/2/3 –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ deploy.
- [ ] docs/deploy/{cfa2.md,cfa2-dev-runbook.md,CI-BUILD-MATRIX.md} –∞–∫—Ç—É–∞–ª—å–Ω—ã.
```

–≠—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã —Å–≤—è–∑–∞—Ç—å JTBD ‚Üî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã.

---

## 6. –ú–∏–Ω–∏‚Äë–¥–∏–∞–≥—Ä–∞–º–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å guardrails

```mermaid
flowchart LR
    A[Dev pushes to dev-cfa2] --> B[pre-commit<br/>guardrails.cfa2.json]
    B -->|OK| C[GitLab CI<br/>sdk ‚Üí build ‚Üí deploy-cfa2]
    B -->|Violation| V[Fix or update guardrails]

    C --> D[SSH to cfa2 (92.51.38.126)]
    D --> E[/srv/cfa<br/>docker compose pull/up]
    E --> F[Swagger 58081..58086<br/>UI 3001/2/3]

    subgraph Repo
      B
      G[ops/docker/cfa2/docker-compose.yml]
      H[ops/gitlab/cfa2/.env.cfa2]
      I[docs/deploy/cfa2-dev-runbook.md]
    end
```

---

## 7. –¢–∞–±–ª–∏—Ü–∞: –∫–∞–∫–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –Ω—É–∂–Ω—ã / —á—Ç–æ –æ–Ω–∏ –¥–µ–ª–∞—é—Ç

| –ê—Ä—Ç–µ—Ñ–∞–∫—Ç                                       | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                               | –°—Ç–∞—Ç—É—Å —Å–µ–π—á–∞—Å (–ø–æ –ª–æ–≥–∞–º)                                                    |
| ---------------------------------------------- | -------------------------------------------------------- | --------------------------------------------------------------------------- |
| `ops/agents/repo-guardrails.cfa2.json`         | SSOT‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç: scope, –ø–æ—Ä—Ç—ã, paths, precommitRules       | **–ù–µ—Ç, –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å**                                                      |
| `ops/scripts/precommit-guardrails.cfa2.mjs`    | Pre‚Äëcommit/Husky‚Äëhook, —á–∏—Ç–∞—é—â–∏–π JSON –∏ –±–ª–æ–∫–∏—Ä—É—é—â–∏–π –º—É—Å–æ—Ä | **–ù–µ—Ç, –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å**                                                      |
| `.husky/pre-commit`                            | –í—ã–∑–æ–≤ node‚Äë—Å–∫—Ä–∏–ø—Ç–∞                                       | –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–≤–æ–µ–π Husky‚Äë–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏                                           |
| `ops/docker/cfa2/docker-compose.yml`           | compose –¥–ª—è cfa2 (back+front, –ø–æ—Ä—Ç—ã –∏–∑ JSON)             | –£–∂–µ –µ—Å—Ç—å, —Å–º–µ—â—ë–Ω –∏–∑ deploy ‚Üí ops.ÓàÄfileciteÓàÇturn2file2ÓàÇturn2file11ÓàÅ          |
| `ops/gitlab/cfa2/.env.cfa2`                    | –†–µ–∞–ª—å–Ω–æ–µ dev‚Äëenv –¥–ª—è cfa2                                | –£–∂–µ –µ—Å—Ç—å.ÓàÄfileciteÓàÇturn2file2ÓàÇturn2file11ÓàÅ                                  |
| `.gitlab-ci.yml` + `.gitlab/gitlab-ci.dev.yml` | CI –ø–æ–¥ dev-cfa2, build+deploy, –±–µ–∑ k8s –≤ dev             | –£–∂–µ –≤—ã—á–∏—â–µ–Ω–æ –æ—Ç –¥—É–±–ª–µ–π –∏ agent/k8s.ÓàÄfileciteÓàÇturn2file5ÓàÇturn2file6ÓàÅ         |
| `.gitlab/gitlab-ci.k8s.yml`                    | K8s‚Äë—à–∞–±–ª–æ–Ω –Ω–∞ –±—É–¥—É—â–µ–µ, –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω                      | –£–∂–µ –µ—Å—Ç—å, –Ω–µ include‚Äô–∏—Ç—Å—è.ÓàÄfileciteÓàÇturn2file5ÓàÅ                             |
| `docs/deploy/cfa2-dev-runbook.md`              | –ü–æ–¥—Ä–æ–±–Ω—ã–π runbook –ø–æ pipeline+deploy                     | –£–∂–µ –æ–±–Ω–æ–≤–ª—ë–Ω –ø–æ–¥ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.ÓàÄfileciteÓàÇturn2file2ÓàÇturn2file10ÓàÅ          |
| `docs/deploy/cfa2.md`                          | –ö–æ—Ä–æ—Ç–∫–∏–π how‚Äëto –ø–æ dev‚Äëpipeline/–ø—Ä–æ–≤–µ—Ä–∫–µ                 | –£–∂–µ –µ—Å—Ç—å, –Ω–æ –º–æ–∂–Ω–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ tags/category –∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É.ÓàÄfileciteÓàÇturn2file1ÓàÅ |
| `docs/deploy/CI-BUILD-MATRIX.md`               | –¢–∞–±–ª–∏—Ü–∞ jobs ‚Üî paths                                     | –£–∂–µ –µ—Å—Ç—å, –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π frontmatter.ÓàÄfileciteÓàÇturn2file10ÓàÅ                     |

---

## 8. Next actions

### –î–ª—è —Ç–µ–±—è (orchestrator)

1. **–ü—Ä–∏–Ω—è—Ç—å/–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç JSON**
   - –ï—Å–ª–∏ –æ–∫ ‚Äî —Å–æ–∑–¥–∞—ë–º `ops/agents/repo-guardrails.cfa2.json` –∏–º–µ–Ω–Ω–æ –≤ —Ç–∞–∫–æ–º –¥—É—Ö–µ.
   - –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –µ—â—ë –ø–æ–ª—è / —É–¥–∞–ª–∏—Ç—å —á—Ç–æ‚Äë—Ç–æ –ª–∏—à–Ω–µ–µ ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏, —á—Ç–æ —É–±—Ä–∞—Ç—å.

2. –†–µ—à–∏—Ç—å, **–Ω–∞ —á—ë–º –∫—Ä—É—Ç–∏—Ç—å pre‚Äëhook**:
   - –ï—Å–ª–∏ Husky —É–∂–µ –µ—Å—Ç—å –≤ –º–æ–Ω–æ—Ä–µ–ø–æ ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É —Å `node ops/scripts/precommit-guardrails.cfa2.mjs`.
   - –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –º–æ–∂–Ω–æ —Å—Ç–∞—Ä—Ç–∞–Ω—É—Ç—å —Å —á–∏—Å—Ç–æ–≥–æ `.git/hooks/pre-commit` (shell ‚Üí node‚Äë—Å–∫—Ä–∏–ø—Ç).

3. –£—Ç–≤–µ—Ä–¥–∏—Ç—å **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π contract –¥–ª—è frontmatter** (category/tags) ‚Äî –ø–æ —Ñ–∞–∫—Ç—É —ç—Ç–æ –æ–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –∑–Ω–∞—á–µ–Ω–∏–π, —Å–º. –≤—ã—à–µ.

### –î–ª—è –∞–≥–µ–Ω—Ç–∞ (–ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ—Ç–≤–µ—Ç–∞)

- –°–æ–∑–¥–∞—Ç—å `ops/agents/repo-guardrails.cfa2.json` –ø–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É.
- –°–æ–∑–¥–∞—Ç—å `ops/scripts/precommit-guardrails.cfa2.mjs`, –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤ Husky / pre‚Äëcommit.
- –ü—Ä–æ–±–µ–∂–∞—Ç—å—Å—è –ø–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º DevOps‚Äë–¥–æ–∫–∞–º (`cfa2.md`, `cfa2-dev-runbook.md`, `CI-BUILD-MATRIX.md`, `MULTI_ACCOUNT_SETUP.md`) –∏ –ø—Ä–∏–≤–µ—Å—Ç–∏ frontmatter –∫ –Ω–æ–≤–æ–º—É enum‚Äô—É.ÓàÄfileciteÓàÇturn2file1ÓàÇturn2file10ÓàÇturn2file14ÓàÅ

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –º–æ–≥—É:

- –ª–∏–±–æ –≤—ã–¥–∞—Ç—å **–≥–æ—Ç–æ–≤—ã–π AGENT\_PROMPT** –ø–æ–¥ Codex CLI, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä—è–º–æ –≥–æ–≤–æ—Ä–∏—Ç: ‚Äú–ø—Ä–æ—á–∏—Ç–∞–π `repo-guardrails.cfa2.json` –∏ —Ä–∞–±–æ—Ç–∞–π —Ç–æ–ª—å–∫–æ –≤ –µ–≥–æ —Ä–∞–º–∫–∞—Ö‚Äù;
- –ª–∏–±–æ —Å—É–∑–∏—Ç—å DevOps‚Äë—ç–ø–∏–∫ –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö 2‚Äì3 stories —Å DoD/Kickoff –≤ –∏—Ö —Ç–µ–∫—É—â–µ–º –≤–∏–¥–µ, –∞ –Ω–µ –≤ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–º.


#### You:
<time datetime="2025-11-27T05:14:35.184Z" title="27/11/2025, 08:14:35">08:14</time>

—Å–æ–∑–¥–∞–π –¥–æ–¥–µ–ª–∞–π –≤—Å–µ 

#### ChatGPT:
<time datetime="2025-11-27T05:22:36.288Z" title="27/11/2025, 08:22:36">08:22</time>

TL;DR:

- –Ø –¥–∞—é **–≥–æ—Ç–æ–≤—ã–π `.agent-guardrails.json`** –¥–ª—è —Ä–µ–ø—ã `ois-cfa` + –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π pre-commit / Husky-—Ö—É–∫, –∫–æ—Ç–æ—Ä—ã–π **–∑–∞–ø—Ä–µ—â–∞–µ—Ç –∞–≥–µ–Ω—Ç–∞–º —Å—Ä–∞—Ç—å —Ñ–∞–π–ª–∞–º–∏** (docker, .env, .gitlab-ci, K8s, —Ñ—Ä–æ–Ω—Ç–º–∞—Ç—Ç–µ—Ä –∏ —Ç.–¥.).
- –£–ø—Ä–æ—Å—Ç–∏–ª **YAML frontmatter** –¥–ª—è DevOps-—Å–ø–µ–∫: `category ‚àà {devops, backend, frontend}`, –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ `tags` (`cfa2`, `cicd`, `.net`‚Ä¶), –±–µ–∑ ¬´epic, template, specification¬ª –∏ –ø—Ä–æ—á–µ–≥–æ –º—É—Å–æ—Ä–∞; –¥–∞—é **–Ω–æ–≤—ã–π EPIC+Stories –∫–∞—Ä–∫–∞—Å** –ø–æ–¥ DevOps/CICD cfa2. ÓàÄfileciteÓàÇturn2file17ÓàÇturn1file13ÓàÅ
- –°–æ–±—Ä–∞–ª **UPDATED\_JTBD\_CONTRACT + –Ω–æ–≤—ã–π AGENT\_PROMPT –¥–ª—è Codex** –ø–æ–¥ —Ç–≤–æ–∏ —Ö–æ—Ç–µ–ª–∫–∏: –±–µ–∑ K8s, —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–µ—Ä–µ–≤–æ–º (`ops/docker/cfa2`, `ops/gitlab/cfa2`, –æ–¥–∏–Ω–æ—á–Ω—ã–π `.gitlab-ci.yml`, –ø–æ—Ä—Ç—ã –∫–∞–∫ –≤ c2p\_ois-cfa). ÓàÄfileciteÓàÇturn1file12ÓàÇturn1file2ÓàÅ

–î–∞–ª—å—à–µ –ø–æ —Ç–≤–æ–µ–º—É —Ñ–æ—Ä–º–∞—Ç—É:

1. UPDATED\_JTBD\_CONTRACT
2. AGENT\_PROMPT (–≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è Codex CLI)
3. NEXT\_STEPS\_FOR\_HUMAN\
   –ü–ª—é—Å: JSON, —Ö—É–∫, —Ñ—Ä–æ–Ω—Ç–º–∞—Ç—Ç–µ—Ä, –¥–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤ ‚Äì –≤—Å—ë –≤–Ω—É—Ç—Ä–∏.

---

## 1. UPDATED\_JTBD\_CONTRACT (DevOps / cfa2 / guardrails)

### 1.1. Jobs

```json
{
  "jobs": [
    {
      "id": "J1",
      "title": "DevOps filesystem cleanup –¥–ª—è cfa2 (docker, .env, CI-—Ñ–∞–π–ª—ã)",
      "status": "in_progress"
    },
    {
      "id": "J2",
      "title": "–ó–∞–≤–µ—Ä—à–∏—Ç—å dev-cfa2 CI/CD pipeline (backend+frontend+sdk, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π deploy-cfa2)",
      "status": "in_progress"
    },
    {
      "id": "J3",
      "title": "–í–≤–µ—Å—Ç–∏ JSON-guardrails + pre-commit/husky, —á—Ç–æ–±—ã –∞–≥–µ–Ω—Ç—ã –Ω–µ –ø–ª–æ–¥–∏–ª–∏ –º—É—Å–æ—Ä",
      "status": "planned"
    },
    {
      "id": "J4",
      "title": "–£–ø—Ä–æ—Å—Ç–∏—Ç—å SDD-—Å–ø–µ–∫–∏ DevOps (epic+stories) –∏ —Å–¥–µ–ª–∞—Ç—å –∏—Ö SSOT –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤",
      "status": "planned"
    }
  ]
}
```

### 1.2. Definition of Done (—É–∫—Ä—É–ø–Ω—ë–Ω–Ω–æ)

```json
{
  "DoD": [
    "J1: –í –¥–µ—Ä–µ–≤–µ —Å–æ–±–ª—é–¥–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞: docker-—Ñ–∞–π–ª—ã –≤ ops/docker/cfa2; .env –¥–ª—è cfa2 –≤ ops/gitlab/cfa2; –Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ .gitlab-ci –∫—Ä–æ–º–µ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö; K8s (ops/infra/helm/**) –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ read-only.",
    "J2: –í –≤–µ—Ç–∫–µ dev-cfa2 CI –∏–º–µ–µ—Ç —Å—Ç–∞–¥–∏–∏ sdk/build/deploy; build-–¥–∂–æ–±—ã –¥–ª—è –≤—Å–µ—Ö –Ω—É–∂–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Ñ—Ä–æ–Ω—Ç–æ–≤; deploy-cfa2 —Ö–æ–¥–∏—Ç –Ω–∞ cfa2 –∏ –ø–æ–¥–Ω–∏–º–∞–µ—Ç compose –≤ /srv/cfa –±–µ–∑ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤; —Å–µ—Ä–≤–∏—Å—ã –æ—Ç–≤–µ—á–∞—é—Ç –ø–æ –ø–æ—Ä—Ç–∞–º 58081‚Äì58086, 58080, 55432, 56379, 59xxx, 3001‚Äì3003 –∫–∞–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏. ÓàÄfileciteÓàÇturn1file12ÓàÅ",
    "J3: –í –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –ª–µ–∂–∏—Ç .agent-guardrails.json; –µ—Å—Ç—å pre-commit/husky-—Ö—É–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–∞—Ä—Å–∏—Ç —ç—Ç–æ—Ç JSON –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏—è; –ø—Ä–∞–≤–∏–ª–∞ –º–∏–Ω–∏–º—É–º –ø–æ–∫—Ä—ã–≤–∞—é—Ç docker/.env/.gitlab-ci/K8s/frontmatter.",
    "J4: –ï—Å—Ç—å –æ–¥–∏–Ω DevOps-—ç–ø–∏–∫ EPIC-DEVOPS-CFA2-CICD + 2‚Äì3 stories, —Å –ø—Ä–æ—Å—Ç—ã–º–∏ DoD/Kickoff; —Ñ—Ä–æ–Ω—Ç–º–∞—Ç—Ç–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç category ‚àà {devops, backend, frontend}, 3‚Äì5 –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã—Ö tags (cfa2, cicd, .net, gitlab-runner –∏ —Ç.–¥.), –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö —Ç–µ–≥–æ–≤ –≤—Ä–æ–¥–µ epic/template; K8s –Ω–µ —Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –≤ —ç—Ç–∏—Ö —Å–ø–µ–∫–∞—Ö –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–π scope."
  ],
  "constraints": [
    "–ù–µ —Ç—Ä–æ–≥–∞–µ–º K8s/Helm (ops/infra/helm/**) ‚Äì —Ç–æ–ª—å–∫–æ –∫–∞–∫ reference, –¥–æ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —ç–ø–∏–∫–∞ –ø–æ prod/k8s. ÓàÄfileciteÓàÇturn1file3ÓàÅ",
    "–°–µ–π—á–∞—Å —Ñ–æ–∫—É—Å —Ç–æ–ª—å–∫–æ –Ω–∞ dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏ cfa2 (docker-compose –Ω–∞ 92.51.38.126:58081+ –∏ —Ñ—Ä–æ–Ω—Ç—ã –Ω–∞ 3001/3002/3003). ÓàÄfileciteÓàÇturn1file12ÓàÇturn2file5ÓàÅ",
    "–ù–µ –ø–ª–æ–¥–∏–º –Ω–æ–≤—ã–µ —ç–ø–∏–∫–∏/—Ñ–∏—á–∏ –ø–æ DevOps ‚Äì –æ–¥–∏–Ω epic + –Ω–µ—Å–∫–æ–ª—å–∫–æ stories, –±–µ–∑ overengineering."
  ]
}
```

---

## 2. `.agent-guardrails.json` + pre-commit / husky

### 2.1. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π JSON (–ø–æ–ª–æ–∂–∏—Ç—å –≤ `ois-cfa/.agent-guardrails.json`)

```json
{
  "version": "1.0.0",
  "description": "Guardrails –¥–ª—è DevOps/CI/CD –≤ ois-cfa. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è pre-commit/husky –∏ –∞–≥–µ–Ω—Ç–∞–º–∏.",
  "ports": {
    "cfa2": {
      "gateway": 58081,
      "identity": 58082,
      "issuance": 58083,
      "registry": 58084,
      "settlement": 58085,
      "compliance": 58086,
      "keycloak": 58080,
      "postgres": 55432,
      "redis": 56379,
      "minio": 59000,
      "minio_console": 59001,
      "portal_issuer": 3001,
      "portal_investor": 3002,
      "backoffice": 3003
    }
  },
  "paths": {
    "docker_compose_root": "ops/docker/cfa2",
    "env_cfa2_root": "ops/gitlab/cfa2",
    "gitlab_ci_root": ".gitlab",
    "docs_deploy_root": "docs/deploy",
    "k8s_helm_root": "ops/infra/helm"
  },
  "frontmatter": {
    "allowed_categories": ["devops", "backend", "frontend"],
    "max_tags": 5,
    "disallowed_tags": ["epic", "feature", "story", "template", "specification"],
    "required_fields": ["version", "status", "type", "category", "tags"],
    "types": ["epic", "feature", "story", "index", "guide", "template"]
  },
  "rules": [
    {
      "id": "docker-files-location",
      "description": "Docker-compose/Dockerfile –Ω–µ –¥–æ–ª–∂–Ω—ã –ª–µ–∂–∞—Ç—å –≤ docs/deploy/**",
      "match": {
        "path_glob": [
          "docs/deploy/**/docker-compose.yml",
          "docs/deploy/**/docker-compose.yaml",
          "docs/deploy/**/Dockerfile",
          "docs/deploy/**/Dockerfile.*"
        ]
      },
      "action": "block",
      "severity": "error",
      "message": "Docker-—Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ ops/docker/** (–¥–ª—è cfa2: ops/docker/cfa2). –ü–µ—Ä–µ–Ω–µ—Å–∏ —Ñ–∞–π–ª."
    },
    {
      "id": "docker-files-cfa2-allowed",
      "description": "–í ops/docker/cfa2/** —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ docker-compose*, Dockerfile* –∏ .md",
      "match": {
        "path_glob": ["ops/docker/cfa2/**"]
      },
      "constraints": {
        "allowed_extensions": [".yml", ".yaml", "", ".md"],
        "allowed_filenames": [
          "docker-compose.yml",
          "docker-compose.override.yml",
          "Dockerfile",
          "README.md"
        ]
      },
      "action": "validate",
      "severity": "error",
      "message": "–í ops/docker/cfa2/** –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤. –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ compose/Dockerfile/README."
    },
    {
      "id": "env-files-location",
      "description": ".env –¥–ª—è cfa2 —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ–¥ ops/gitlab/cfa2 –∏ ops/docker/cfa2",
      "match": {
        "path_glob": ["**/.env", "**/.env.*", "**/*.env"]
      },
      "constraints": {
        "allowed_path_prefixes": [
          "ops/gitlab/cfa2",
          "ops/docker/cfa2"
        ]
      },
      "action": "validate",
      "severity": "error",
      "message": ".env-—Ñ–∞–π–ª—ã –¥–ª—è cfa2 –¥–µ—Ä–∂–∏–º —Ç–æ–ª—å–∫–æ –≤ ops/gitlab/cfa2 –∏ ops/docker/cfa2. –ù–µ —Å–æ–∑–¥–∞–≤–∞–π .env –≤ –¥—Ä—É–≥–∏—Ö –ø–∞–ø–∫–∞—Ö."
    },
    {
      "id": "gitlab-ci-files",
      "description": "–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä CI-—Ñ–∞–π–ª–æ–≤",
      "match": {
        "path_glob": ["**/.gitlab-ci.yml", ".gitlab/*.yml", ".gitlab/*.yaml"]
      },
      "constraints": {
        "allowed_paths": [
          ".gitlab-ci.yml",
          ".gitlab/gitlab-ci.dev.yml",
          ".gitlab/gitlab-ci.k8s.yml"
        ]
      },
      "action": "validate",
      "severity": "error",
      "message": "–ù–æ–≤—ã–µ CI-—Ñ–∞–π–ª—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –∫–∞–∫ .gitlab-ci.yml (root) –∏–ª–∏ .gitlab/gitlab-ci.{dev,k8s}.yml. –ù–µ –ø–ª–æ–¥–∏–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ .gitlab-ci."
    },
    {
      "id": "k8s-readonly",
      "description": "K8s/Helm —Å–µ–π—á–∞—Å read-only, –Ω–µ —Ç—Ä–æ–≥–∞–µ–º",
      "match": {
        "path_glob": ["ops/infra/helm/**"]
      },
      "action": "block",
      "severity": "error",
      "message": "K8s/Helm (ops/infra/helm/**) —Å–µ–π—á–∞—Å reference-only. –ù–µ –∏–∑–º–µ–Ω—è–π –∏ –Ω–µ –¥–æ–±–∞–≤–ª—è–π —Ñ–∞–π–ª—ã –¥–æ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ K8s-—ç–ø–∏–∫–∞."
    },
    {
      "id": "devops-frontmatter",
      "description": "–ö–æ–Ω—Ç—Ä–æ–ª—å —Ñ—Ä–æ–Ω—Ç–º–∞—Ç—Ç–µ—Ä–∞ –¥–ª—è DevOps-—Å–ø–µ–∫",
      "match": {
        "path_glob": [
          "memory-bank/devops/**.md",
          "memory-bank/Scrum/**.md"
        ]
      },
      "frontmatter_constraints": {
        "enforce_categories": true,
        "max_tags": 5,
        "disallowed_tags": ["epic", "feature", "story", "template", "specification"],
        "allowed_categories": ["devops", "backend", "frontend"]
      },
      "action": "validate",
      "severity": "warn",
      "message": "–£–ø—Ä–æ—Å—Ç–∏—Ç–µ frontmatter: category ‚àà {devops, backend, frontend}, tags –±–µ–∑ –º—É—Å–æ—Ä–∞ –≤–∏–¥–∞ [epic, template, specification]."
    }
  ]
}
```

–≠—Ç–æ **—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**, –Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è. –°–∫—Ä–∏–ø—Ç –Ω–∏–∂–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å (docker/.env/.gitlab-ci/K8s), frontmatter-–≤–∞–ª–∏–¥–∞—Ü–∏—é –º–æ–∂–Ω–æ –¥–æ–∫—Ä—É—Ç–∏—Ç—å –ø–æ–∑–∂–µ.

---

### 2.2. –ü—Ä–∏–º–µ—Ä Node-—Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è pre-commit (`ops/scripts/check-guardrails.mjs`)

```js
#!/usr/bin/env node

import { readFileSync } from "fs";
import { execSync } from "child_process";
import path from "path";

const repoRoot = process.cwd();
const configPath = path.join(repoRoot, ".agent-guardrails.json");

let config;
try {
  config = JSON.parse(readFileSync(configPath, "utf8"));
} catch (e) {
  console.error("[guardrails] .agent-guardrails.json not found or invalid:", e.message);
  process.exit(1);
}

function getStagedFiles() {
  const out = execSync("git diff --cached --name-status", { encoding: "utf8" });
  return out
    .split("\n")
    .filter(Boolean)
    .map(line => {
      const [status, ...rest] = line.trim().split(/\s+/);
      const file = rest[rest.length - 1];
      return { status, file };
    });
}

function matchGlob(glob, file) {
  // —Å—É–ø–µ—Ä-–ø—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ **/* (—Ö–≤–∞—Ç–∞–µ—Ç –¥–ª—è –Ω–∞—à–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤)
  const g = glob.replace(/\./g, "\\.").replace(/\*\*/g, ".*").replace(/\*/g, "[^/]*");
  return new RegExp("^" + g + "$").test(file);
}

function fileMatchesRule(file, rule) {
  if (!rule.match) return false;
  const { path_glob } = rule.match;
  if (path_glob && !path_glob.some(glob => matchGlob(glob, file))) return false;
  return true;
}

function validateEnvLocation(file, rule) {
  const { allowed_path_prefixes = [] } = rule.constraints || {};
  if (allowed_path_prefixes.some(prefix => file.startsWith(prefix + "/"))) return null;
  return rule.message;
}

function validateAllowedPaths(file, rule) {
  const { allowed_paths = [] } = rule.constraints || {};
  if (allowed_paths.includes(file)) return null;
  return rule.message;
}

function validateDockerCfa2(file, rule) {
  const { allowed_extensions = [], allowed_filenames = [] } = rule.constraints || {};
  const base = path.basename(file);
  const ext = path.extname(file);
  if (allowed_filenames.includes(base)) return null;
  if (allowed_extensions.includes(ext)) return null;
  return rule.message;
}

const files = getStagedFiles();
const errors = [];

for (const { status, file } of files) {
  if (!["A", "M", "R"].includes(status)) continue;

  for (const rule of config.rules || []) {
    if (!fileMatchesRule(file, rule)) continue;

    let msg = null;
    if (rule.id === "env-files-location") {
      msg = validateEnvLocation(file, rule);
    } else if (rule.id === "gitlab-ci-files") {
      msg = validateAllowedPaths(file, rule);
    } else if (rule.id === "docker-files-cfa2-allowed") {
      msg = validateDockerCfa2(file, rule);
    } else if (rule.id === "docker-files-location" || rule.id === "k8s-readonly") {
      msg = rule.message;
    }

    if (msg) {
      errors.push(`- [${rule.id}] ${file}: ${msg}`);
    }
  }
}

if (errors.length) {
  console.error("\n[guardrails] Commit blocked by rules:\n" + errors.join("\n"));
  process.exit(1);
}

process.exit(0);
```

### 2.3. Husky / pre-commit –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ø—Ä–∏–º–µ—Ä)

**`.husky/pre-commit`:**

```bash
#!/usr/bin/env bash
. "$(dirname "$0")/_/husky.sh"

node ops/scripts/check-guardrails.mjs
```

–ò–ª–∏ –¥–ª—è `pre-commit` (python-tool) ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –ø—Ä–æ—Å—Ç–æ –¥–µ—Ä–≥–∞—Ç—å —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç.

---

## 3. –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π frontmatter –¥–ª—è DevOps-—Å–ø–µ–∫

–û–ø–∏—Ä–∞–µ–º—Å—è –Ω–∞ —Ç–≤–æ–∏ —à–∞–±–ª–æ–Ω—ã SDD, –Ω–æ **—Ä–µ–∂–µ–º –∂–∏—Ä**: –º–µ–Ω—å—à–µ –ø–æ–ª–µ–π, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π `category`, –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ `tags`, –±–µ–∑ –ª–∏—à–Ω–∏—Ö ¬´epic/template/specification¬ª. ÓàÄfileciteÓàÇturn1file13ÓàÇturn2file19ÓàÅ

### 3.1. Epic (DevOps / cfa2 / CICD)

```yaml
---
version: "1.0.0"
last_edited: "2025-11-27 13:00"
created: "2025-11-27 13:00"
status: "active"               # draft|active|done|archived
type: "epic"
category: "devops"             # devops|backend|frontend
tags: ["cfa2", "cicd"]
epic_id: "EPIC-DEVOPS-CFA2-CICD"
agent_context: "devops cfa2 cicd; no k8s; keep tree clean; follow .agent-guardrails.json"
---
```

### 3.2. Story (–±–µ–∑ ¬´risk¬ª, ¬´dependencies¬ª –∏ –ø—Ä–æ—á–µ–π –±—é—Ä–æ–∫—Ä–∞—Ç–∏–∏)

```yaml
---
version: "1.0.0"
last_edited: "2025-11-27 13:05"
created: "2025-11-27 13:05"
status: "ready"                # draft|ready|in_progress|done
type: "story"
category: "devops"
tags: ["cfa2", "cicd", "guardrails"]
story_id: "STORY-DEVOPS-CFA2-GUARDRAILS"
epic_id: "EPIC-DEVOPS-CFA2-CICD"
points: 3
priority: "high"
agent_context: "focus on .agent-guardrails.json + pre-commit; keep K8s read-only; simplify YAML"
---
```

–î–∞–ª—å—à–µ –≤–Ω—É—Ç—Ä–∏ story ‚Äì **—Ç–æ–ª—å–∫–æ**:

- User Story (As a‚Ä¶ I want‚Ä¶ so that‚Ä¶)
- Acceptance Criteria (GIVEN/WHEN/THEN 2‚Äì4 —Å—Ü–µ–Ω–∞—Ä–∏—è)
- –ö–æ—Ä–æ—Ç–∫–∏–π DoD-–±–ª–æ–∫ (—Å–ø–∏—Å–æ–∫ —á–µ–∫–±–æ–∫—Å–æ–≤), –±–µ–∑ risk/dependencies/NFR.

---

## 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤, –∫–∞–∫ —Ç—ã –ø—Ä–æ—Å–∏–ª (—Ñ–∏–Ω–∞–ª–∫–∞ –¥–ª—è DevOps)

–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π **target-tree** –¥–ª—è DevOps / cfa2 / guardrails:

```txt
ois-cfa/
‚îú‚îÄ‚îÄ .agent-guardrails.json            # JSON —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ (—ç—Ç–æ—Ç, —á—Ç–æ –≤—ã—à–µ)
‚îú‚îÄ‚îÄ .gitlab-ci.yml                    # –æ—Å–Ω–æ–≤–Ω–æ–π CI (dev-cfa2, sdk/build/deploy)
‚îú‚îÄ‚îÄ .gitlab/
‚îÇ   ‚îú‚îÄ‚îÄ gitlab-ci.dev.yml             # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) include –¥–ª—è dev
‚îÇ   ‚îî‚îÄ‚îÄ gitlab-ci.k8s.yml             # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) K8s-pipeline, –Ω–æ –ø–æ–∫–∞ OFF
‚îú‚îÄ‚îÄ ops/
‚îÇ   ‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cfa2/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ docker-compose.yml
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ docker-compose.override.yml (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îú‚îÄ‚îÄ gitlab/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cfa2/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ .env.cfa2
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ .env.example
‚îÇ   ‚îî‚îÄ‚îÄ scripts/
‚îÇ       ‚îú‚îÄ‚îÄ sync-compose-cfa2.sh
‚îÇ       ‚îî‚îÄ‚îÄ check-guardrails.mjs      # —Å–∫—Ä–∏–ø—Ç –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –≤—ã—à–µ
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ deploy/
‚îÇ       ‚îú‚îÄ‚îÄ cfa2.md                   # runbook/urls/ports, –±–µ–∑ docker-compose –≤–Ω—É—Ç—Ä–∏
‚îÇ       ‚îî‚îÄ‚îÄ MULTI_ACCOUNT_SETUP.md    # –æ–±—â–∞—è —Å—Ö–µ–º–∞ env/Cloudflare/–∞–∫–∫–∞—É–Ω—Ç—ã
‚îî‚îÄ‚îÄ memory-bank/
    ‚îî‚îÄ‚îÄ devops/
        ‚îú‚îÄ‚îÄ epics/
        ‚îÇ   ‚îî‚îÄ‚îÄ EPIC-DEVOPS-CFA2-CICD.md
        ‚îî‚îÄ‚îÄ stories/
            ‚îú‚îÄ‚îÄ STORY-DEVOPS-CFA2-PIPELINE.md
            ‚îî‚îÄ‚îÄ STORY-DEVOPS-CFA2-GUARDRAILS.md
```

–ü–æ—Ä—Ç—ã –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π runtime –Ω–∞ cfa2 ‚Äî –∫–∞–∫ —É–∂–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (Swagger –Ω–∞ 58081‚Äì58086, Keycloak 58080, —Ñ—Ä–æ–Ω—Ç—ã 3001‚Äì3003 –∏ —Ç.–¥.). ÓàÄfileciteÓàÇturn1file12ÓàÇturn2file5ÓàÅ

---

## 5. AGENT\_PROMPT –¥–ª—è Codex (–≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç)

–ù–∏–∂–µ —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ **–ø—Ä—è–º–æ –∫–æ–ø–∏–ø–∞—Å—Ç–∏—Ç—å** –≤ `codex --yolo` –∫–∞–∫ ROLE-–±–ª–æ–∫ / —Å–∏—Å—Ç–µ–º–Ω—ã–π prompt.

> **AGENT\_PROMPT (DevOps / CICD / guardrails)**\
> *–∫–æ–ø–∏—Ä—É–π —Ü–µ–ª–∏–∫–æ–º –æ—Ç BEGIN –¥–æ END*

```text
BEGIN_AGENT_PROMPT
ROLE: You are a Senior DevOps Engineer and my CI/CD + Guardrails digital twin.

CONTEXT:
- Repo: /home/user/__Repositories/yury-customer/prj_Cifra-rwa-exachange-assets/repositories/customer-gitlab/ois-cfa
- Control plane: eywa1
- Build node: vds1 (GitLab runner, tag vds1)
- Dev target: cfa2 (Docker host for dev env, 92.51.38.126, /srv/cfa)
- Current branch: dev-cfa2

HARD CONSTRAINTS (MUST READ BEFORE ANY CHANGE):
1) File layout (DevOps / cfa2):
   - Docker-compose for cfa2: ops/docker/cfa2/docker-compose.yml
   - .env for cfa2: ops/gitlab/cfa2/.env.cfa2 (+ .env.example)
   - Docs about cfa2 deploy: docs/deploy/cfa2.md (ports, URLs, checks)
   - JSON guardrails: .agent-guardrails.json at repo root
   - K8s/Helm (ops/infra/helm/**) is READ-ONLY for this session (do not touch).

2) CI/CD:
   - Only one active .gitlab-ci.yml in repo root.
   - Extra CI configs live in .gitlab/gitlab-ci.dev.yml and .gitlab/gitlab-ci.k8s.yml (no other *.yml there).
   - Pipeline target branch: dev-cfa2.
   - Runner tag: vds1.
   - Deploy target: user@92.51.38.126:/srv/cfa (docker compose pull/up, no env generation).

3) Ports (cfa2, 92.51.38.126):
   - Gateway: 58081
   - Identity: 58082
   - Issuance: 58083
   - Registry: 58084
   - Settlement: 58085
   - Compliance: 58086
   - Keycloak: 58080
   - Postgres: 55432
   - Redis: 56379
   - Minio: 59000 (console 59001)
   - Frontends: 3001 (issuer), 3002 (investor), 3003 (backoffice)

4) K8s:
   - K8s/Helm manifests under ops/infra/helm/** are reference-only.
   - Do NOT modify, create, or wire any new k8s jobs in this session.
   - Prod/stage on k8s is future epic, out of scope now.

5) JSON guardrails:
   - Before you design or move files, READ .agent-guardrails.json.
   - Never create:
     - docker-compose or Dockerfile under docs/deploy/**
     - .env files outside ops/gitlab/cfa2 or ops/docker/cfa2
     - extra .gitlab-ci.yml files outside:
       - .gitlab-ci.yml
       - .gitlab/gitlab-ci.dev.yml
       - .gitlab/gitlab-ci.k8s.yml

JTBD FOR THIS SESSION:
- J1: Clean up DevOps filesystem for cfa2 (docker, .env, CI files) according to .agent-guardrails.json.
- J2: Finalize dev-cfa2 CI/CD pipeline (backend+frontend+sdk, stable deploy-cfa2 job).
- J3: Ensure JSON guardrails + pre-commit/husky are in place and enforce main rules.
- J4: Update DevOps EPIC/STORY docs as SSOT (EPIC-DEVOPS-CFA2-CICD + 2‚Äì3 stories) with simplified YAML frontmatter.

DEFINITION OF DONE:
- J1:
  - [ ] ops/docker/cfa2/docker-compose.yml exists and is the single source of truth for cfa2 compose.
  - [ ] ops/gitlab/cfa2/.env.cfa2 + .env.example exist and are used by deploy/sync scripts.
  - [ ] No docker-compose/Dockerfile under docs/deploy/**.
  - [ ] No new .env files outside ops/gitlab/cfa2 and ops/docker/cfa2.
  - [ ] .gitlab-ci.yml exists only in root; .gitlab contains at most gitlab-ci.dev.yml and gitlab-ci.k8s.yml.

- J2:
  - [ ] .gitlab-ci.yml has stages: [sdk, build, deploy].
  - [ ] Build jobs for: api-gateway, identity, issuance, registry, settlement, compliance, frontends (portal-issuer, portal-investor, backoffice).
  - [ ] SDK jobs wired (validate-specs, generate-sdks) with rules:changes on packages/contracts/** etc.
  - [ ] deploy-cfa2 job:
        - uses tag vds1,
        - logs into GitLab registry,
        - SSH into user@92.51.38.126,
        - runs `cd /srv/cfa && docker compose pull && docker compose up -d`,
        - does not generate/overwrite compose or .env on remote.

- J3:
  - [ ] .agent-guardrails.json exists and reflects current rules (docker/.env/.gitlab-ci/K8s/frontmatter).
  - [ ] Script ops/scripts/check-guardrails.<ext> exists and is executable.
  - [ ] Pre-commit/husky hook runs this script and blocks commits violating rules.

- J4:
  - [ ] memory-bank/devops/epics/EPIC-DEVOPS-CFA2-CICD.md created/updated with simplified frontmatter:
        - category: devops
        - tags: [cfa2, cicd]
        - no redundant tags like [epic, template, specification]
  - [ ] 2‚Äì3 stories under memory-bank/devops/stories/* corresponding to:
        - filesystem/guardrails,
        - CI/CD pipeline & deploy.
  - [ ] No overengineering: no risk/dependencies sections, only User Story, AC, short DoD.

AGENT_WORKFLOW_CONTRACT:
1) PLAN
   - Compare current state with JTBD/DoD above.
   - Produce mini-plan for 1‚Äì3 loops: {code-change} ‚Üí {tests} ‚Üí {docs/DoD-update} ‚Üí {commit}.
   - Explicitly mention which JTBD items you are touching in this loop.

2) EXECUTE
   - Apply focused code changes (compose, .env, .gitlab-ci.yml, scripts, docs).
   - Run relevant checks:
     - docker compose config / docker compose ps (when touching compose)
     - gitlab-ci lint (when touching CI)
   - Update docs (docs/deploy/cfa2.md, memory-bank/devops/epics/stories).

3) AUDIT SELF
   - Check against Common Agentic Problems:
     - Did you actually run checks/docker compose config?
     - Did you avoid touching K8s?
     - Did you avoid creating files outside allowed paths?
     - Did you keep changes small and coherent?
   - If something is impossible (no access, broken runner, etc.) ‚Äì state it explicitly.

4) COMMIT
   - Every meaningful change set MUST include:
     - {code-config change} + {check output or command} + {docs/DoD update}
   - Use commit messages like:
     - "chore(devops): align cfa2 compose+env with guardrails"
     - "chore(ci): stabilize dev-cfa2 pipeline for backends/frontends"
     - "chore(guardrails): add .agent-guardrails.json + pre-commit check"

FINAL SELF-CHECK (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏)
- [ ] QA: –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã (docker compose config, gitlab-ci lint, basic curl/ps –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ).
- [ ] –ù–µ —Ç—Ä–æ–Ω—É—Ç—ã K8s/Helm —Ñ–∞–π–ª—ã (ops/infra/helm/**).
- [ ] –ù–µ—Ç –Ω–æ–≤—ã—Ö docker/.env/.gitlab-ci —Ñ–∞–π–ª–æ–≤ –≤–Ω–µ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –ø—É—Ç–µ–π.
- [ ] –í—Å–µ –¥–æ–ø—É—â–µ–Ω–∏—è —è–≤–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º DevOps story (ASSUMPTIONS –±–ª–æ–∫).
- [ ] –°–¥–µ–ª–∞–Ω—ã –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã –≤–∏–¥–∞:
      {code-change} + {check output} + {docs/DoD update}

If any DoD item cannot be completed because of a hard blocker, you MUST:
- Describe what is blocked,
- Why it is blocked,
- What a human operator must do next (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã/—à–∞–≥–∏).

END_AGENT_PROMPT
```

---

## 6. –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ë–ª–æ–∫            | –ß—Ç–æ —Å–¥–µ–ª–∞–ª                                                                           | –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å                                        |
| --------------- | ------------------------------------------------------------------------------------ | ------------------------------------------------------- |
| JSON guardrails | `.agent-guardrails.json` —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –¥–ª—è docker/.env/.gitlab-ci/K8s/frontmatter      | –ü–æ–ª–æ–∂–∏—Ç—å –≤ –∫–æ—Ä–µ–Ω—å —Ä–µ–ø—ã, —á–∏—Ç–∞—Ç—å –≤ –∞–≥–µ–Ω—Ç–∞—Ö –∏ —Ö—É–∫–∞—Ö        |
| Pre-commit      | `ops/scripts/check-guardrails.mjs` + –ø—Ä–∏–º–µ—Ä Husky-—Ö—É–∫–∞                               | –ü–æ–¥–∫–ª—é—á–∏—Ç—å –≤ Husky –∏–ª–∏ pre-commit                       |
| Frontmatter     | –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π YAML –¥–ª—è Epic/Story (category, tags, –±–µ–∑ –º—É—Å–æ—Ä–∞)                          | –û–±–Ω–æ–≤–∏—Ç—å DevOps-—Å–ø–µ–∫–∏ (EPIC-DEVOPS-CFA2-CICD + stories) |
| File tree       | –û–ø—Ä–µ–¥–µ–ª—ë–Ω target layout (ops/docker/cfa2, ops/gitlab/cfa2, docs, memory-bank/devops) | –ù–∞–≤–µ—Å—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –∏ –Ω–µ –¥–∞–≤–∞—Ç—å –∞–≥–µ–Ω—Ç—É —É—Ö–æ–¥–∏—Ç—å –≤ —Å—Ç–æ—Ä–æ–Ω—É    |
| Agent Prompt    | –ñ—ë—Å—Ç–∫–∏–π CI/CD + guardrails prompt –¥–ª—è Codex                                          | –ö–æ–ø–∏–ø–∞—Å—Ç–∏—Ç—å –≤ Codex CLI –∫–∞–∫ ROLE / —Å–∏—Å—Ç–µ–º–Ω—ã–π prompt     |

---

## 7. NEXT\_STEPS\_FOR\_HUMAN

1. **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã/–¥–µ—Ä–µ–≤–æ:**
   - `.agent-guardrails.json` –≤ –∫–æ—Ä–Ω–µ (–∏–∑ —ç—Ç–æ–≥–æ –æ—Ç–≤–µ—Ç–∞, –º–æ–∂–Ω–æ –ø–æ–¥–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥ —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ).
   - `ops/scripts/check-guardrails.mjs` + `chmod +x`.
   - –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî `memory-bank/devops/epics/EPIC-DEVOPS-CFA2-CICD.md` –∏ 2‚Äì3 `memory-bank/devops/stories/*.md` –ø–æ —Ñ—Ä–æ–Ω—Ç–º–∞—Ç—Ç–µ—Ä—É –≤—ã—à–µ.

2. **–í–∫–ª—é—á–∏—Ç—å —Ö—É–∫:**
   - –ï—Å–ª–∏ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Husky ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ `node ops/scripts/check-guardrails.mjs` –≤ `pre-commit`.
   - –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–æ–¥–∫–ª—é—á–∏—Ç—å –ª—é–±–æ–π pre-commit (–¥–∞–∂–µ –ø—Ä–æ—Å—Ç–æ–π git hook –≤ `.git/hooks/pre-commit`), –∫–æ—Ç–æ—Ä—ã–π –¥–µ—Ä–≥–∞–µ—Ç —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç.

3. **–ü—Ä–æ–π—Ç–∏—Å—å —Ä—É–∫–∞–º–∏ –ø–æ –¥–µ—Ä–µ–≤—É:**
   - –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å –ª–∏—à–Ω–∏–µ docker-—Ñ–∞–π–ª—ã –∏–∑ `docs/deploy/**`, –µ—Å–ª–∏ –µ—â—ë –æ—Å—Ç–∞–ª–∏—Å—å.
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `.env` –¥–ª—è cfa2 –ª–µ–∂–∞—Ç —Ç–æ–ª—å–∫–æ –≤ `ops/gitlab/cfa2` / `ops/docker/cfa2`.
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ—Ç –Ω–æ–≤—ã—Ö `.gitlab-ci*.yml` –∫—Ä–æ–º–µ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö.

4. **–ó–∞–ø—É—Å—Ç–∏—Ç—å Codex —Å –Ω–æ–≤—ã–º AGENT\_PROMPT:**
   - –û—Ç–∫—Ä—ã—Ç—å `codex --yolo` –≤ –∫–æ—Ä–Ω–µ `ois-cfa`.
   - –í—Å—Ç–∞–≤–∏—Ç—å `AGENT_PROMPT` –∏–∑ —Å–µ–∫—Ü–∏–∏ 5.
   - –î–∞—Ç—å –µ–º—É JTBD –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É CI/CD/compose, —É–∂–µ –ø–æ–¥ —ç—Ç–∏–º–∏ guardrails.

5. **–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —Å–µ—Å—Å–∏–∏ –∞–≥–µ–Ω—Ç–∞:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `git diff` –Ω–µ –Ω–∞—Ä—É—à–∞–µ—Ç `.agent-guardrails.json`.
   - –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —á—É—Ç—å –ø–æ–¥–ø—Ä–∞–≤–∏—Ç—å JSON (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ `ops/docker/cfa2`).
   - –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ –≤ DevOps story (ASSUMPTIONS / OPEN QUESTIONS), —á—Ç–æ–±—ã –¥–∞–ª—å—à–µ –∞–≥–µ–Ω—Ç—ã –Ω–µ —Ä–∞–∑—ä–µ–∑–∂–∞–ª–∏—Å—å.

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –º–æ–≥—É **—Å–∂–∞—Ç—å —ç—Ç–æ –≤ –æ–¥–∏–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π EPIC-—Ñ–∞–π–ª (–≥–æ—Ç–æ–≤—ã–π markdown)** —Å —É–∂–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–Ω—ã–º–∏ J1‚ÄìJ4, DoD –∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ JSON/—Ö—É–∫–∏ ‚Äì —á—Ç–æ–±—ã —Ç—ã –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–ª `EPIC-DEVOPS-CFA2-CICD.md` –∫–æ–ø–∏–ø–∞—Å—Ç–æ–π.


#### You:
<time datetime="2025-11-27T06:18:23.508Z" title="27/11/2025, 09:18:23">09:18</time>

GENERALLY GOOD BUT BIG "BUT!!"
```voice
–°–ª—É—à–∞–π, —è –ø—Ä–æ—á–∏—Ç–∞–ª —Ç–≤–æ–π –æ—Ç–≤–µ—Ç, –Ω–æ, —á–µ—Å—Ç–Ω–æ –≥–æ–≤–æ—Ä—è, –≤—Å—ë –¥–µ–ª–æ –≤ –¥–µ—Ç–∞–ª—è—Ö –∏ –≤ –∞–∫—Ü–µ–Ω—Ç–∞—Ö. –¢—ã —É–ø–æ—Ä–æ–ª—Å—è –≤ —ç—Ç–æ—Ç JSON Guardians. –¢—ã –≤—ã—Å—Ç–∞–≤–∏–ª —ç—Ç—É —Ü–µ–ª—å –∫–∞–∫ –±—É–¥—Ç–æ –ø–µ—Ä–≤–∏—á–Ω–µ–µ, —á–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∞—è.

–ù—É, —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, —Ç—ã, –∫–æ–Ω–µ—á–Ω–æ, –æ–ø–∏—Å–∞–ª, —á—Ç–æ –¥–∞–≤–∞–π –≤–æ—Ç –ø–µ—Ä–≤—ã–π —Ñ–∞–π–ª: layout, CI/CD, –ø–æ—Ä—Ç—ã, K8s. –ù–∞—Ö—É–π —Ç—ã –µ–≥–æ –≤–æ–æ–±—â–µ –¥–æ–±–∞–≤–∏–ª? –û–Ω –∫—É–¥–∞ –ø–æ–π–¥—ë—Ç? –ú—ã –¥–µ–ª–∞–µ–º dev. –¢—ã –∂–µ —á–∏—Ç–∞–ª –≤—Å–µ –¥–æ–∫–∏, –ø–µ—Ä–µ—á–∏—Ç–∞–π. –í–æ—Ç —ç—Ç–∏ –¥–≤–∞ —Ñ–∞–π–ª–∞, –ø–µ—Ä–µ—á–∏—Ç–∞–π –º–æ–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø—Ä–æ–º–ø—Ç—ã –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ, –∫–∞–∂–¥—ã–π, —Å–ø–∞—Ä—Å–∏ –≤—Å—ë, –∑–∞–≥—Ä—É–∑–∏ —Å–µ–±—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç.

–¢—ã —á—Ç–æ –≤–æ–æ–±—â–µ –¥–∞—ë—à—å? –¢–æ –µ—Å—Ç—å K8s —è –Ω–∏–≥–¥–µ –Ω–µ –ø—Ä–æ—Å–∏–ª, —ç—Ç–æ –ø–æ—Ç–æ–º. –ù–∞–º —Å–µ–π—á–∞—Å –Ω—É–∂–µ–Ω —Ä–∞–±–æ—á–∏–π. –ü—É—à–Ω—É–ª–∏ –º—ã, —É –Ω–∞—Å —Å–±–∏–ª–¥–∏–ª—Å—è dev, —Å–±–∏–ª–¥–∏–ª—Å—è –ø–æ-—É–º–Ω–æ–º—É. –ë–∏–ª–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è. –ù–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∫–∞–∂–¥—ã–π —Ç–∞–º SDK –∏ –∂–¥–∞—Ç—å –ø–æ 10-40 –º–∏–Ω—É—Ç, –ø–æ–∫–∞ –±–∏–ª–¥–∏—Ç—Å—è –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ. –ù–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∫–∞–∫–∏—Ö-—Ç–æ —Ç–∞–º —Ç—É–ø—ã—Ö –≤–µ—â–µ–π.

–°–Ω–∞—á–∞–ª–∞, —á—Ç–æ–±—ã –Ω–µ –∑–∞–ø–æ—Ä–æ—Ç—å—Å—è –Ω–∞ end-to-end —Ç–µ—Å—Ç–∞—Ö, —Å–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞—Ç—å –ø–æ —à–∞–≥–∞–º –±–µ–∑ end-to-end. –ü—Ä–æ—Ö–æ–¥—è—Ç –±—ç–∫–∏, —Ç—ã –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≥–æ–≤–æ—Ä–∏–ª. –ë—ã–ª–∏ –∏–¥–µ–∏, —á—Ç–æ –Ω–µ –ø–ª–æ–¥–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏, –Ω–æ –º—ã –æ—Ç –Ω–∏—Ö –æ—Ç–∫–∞–∑–∞–ª–∏—Å—å, –Ω—É –≤–∏–¥–∏–º–æ –Ω–∏–∫–∞–∫ —Ç–∞–º –ø–æ-–¥—Ä—É–≥–æ–º—É. –ò –≤–æ–æ–±—â–µ –º–Ω–µ –≤—Å—ë —ç—Ç–æ –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ –∏–∑-–∑–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–∞–π–ª–∏–∫–æ–≤, –∏–∑-–∑–∞ –Ω–µ—Å–æ–±–ª—é–¥–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –∏–∑-–∑–∞ –∫–æ–¥–æ–≤. –í–æ–æ–±—â–µ, –≤ –¥–æ–∫–∞—Ö –ø–∏—Å–∞—Ç—å –Ω–∞–¥–æ –≤—Å—ë.

–î–∞–ª—å—à–µ –≤–æ—Ç —Ç—ã –ø—Ä–æ —ç—Ç–æ—Ç JSON —É–ø–æ—Ä–æ–ª—Å—è, –Ω—É —Ç–∞–∫–æ–µ —Å–µ–±–µ. –¢–æ –µ—Å—Ç—å –≤–æ—Ç job –ø–µ—Ä–≤–∞—è ‚Äî –Ω—É –≤ —Ü–µ–ª–æ–º –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è job –ø–µ—Ä–≤–∞—è, –≤–æ—Ç —Å–µ–π—á–∞—Å –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞—é. Job –≤—Ç–æ—Ä–∞—è ‚Äî –Ω—É –Ω–æ—Ä–º–∞–ª—å–Ω–æ. Job —Ç—Ä–µ—Ç—å—è ‚Äî –Ω—É —è –±—ã –µ—ë –≤–æ–æ–±—â–µ –¥–æ–±–∞–≤–∏–ª –ø–æ—Ç–æ–º.

Memory Bank, —ç–ø–∏–∫–∏ ‚Äî –≤–æ—Ç —ç—Ç–æ –∫–∞–∫ –±—É–¥—Ç–æ job –Ω—É–ª–µ–≤–∞—è. –Ø –∂–µ —Ç–µ–±–µ –≥–æ–≤–æ—Ä–∏–ª, —á—Ç–æ –æ–Ω –∂–µ –ø–æ—Ç–æ–º –∑–∞–±—É–¥–µ—Ç, –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ—Ç–µ—Ä—è–µ—Ç. –û–Ω –¥–æ–ª–∂–µ–Ω –≤ –ª—É–ø–µ —Ä–∞–±–æ—Ç–∞—Ç—å. Loop, –¥–∞? –ü–æ –∫–∞–∂–¥–æ–º—É —Å—Ç–æ—Ä–∏: —Å–¥–µ–ª–∞–ª, –ø–æ—à—ë–ª –¥–∞–ª—å—à–µ, –æ—Ç–º–µ—Ç–∏–ª, –∑–∞–∫–æ–º–º–∏—Ç–∏–ª. –¢–æ—á–Ω–µ–µ, —Å–¥–µ–ª–∞–ª, –∑–∞–∫–æ–º–º–∏—Ç–∏–ª, –æ—Ç–º–µ—Ç–∏–ª —Å—Ç–∞—Ç—É—Å —Ç–∞–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π, —á—Ç–æ —Ç–∞–º in progress –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å, –¥–∞? –ü–æ—à—ë–ª, –∑–∞–±–∏–ª–¥–∏–ª, –∑–∞–¥–µ–ø–ª–æ–∏–ª, –ø—Ä–æ–≤–µ—Ä–∏–ª.

–£ –Ω–µ–≥–æ –∂–µ –µ—Å—Ç—å, –∫—Å—Ç–∞—Ç–∏, —Å—É–ø–µ—Ä –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç. –¢–∞–º –∂–µ –µ—Å—Ç—å, –Ω–∞–≤–µ—Ä–Ω–æ–µ, API. –í–æ—Ç —è —á–µ—Ä–µ–∑ GitHub —Ä–∞–Ω—å—à–µ –¥–µ–ª–∞–ª. –¢–∞–º —è workflow run —Å–º–æ—Ç—Ä—é, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å—Ç–∞—Ç—É—Å. –ß—Ç–æ–±—ã –æ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–ª –ø–æ —ç—Ç–æ–π API –∏–ª–∏ —á–µ—Ä–µ–∑ CLI. –ö—Å—Ç–∞—Ç–∏, –æ–Ω –¥–µ–ª–∞–µ—Ç —á–µ—Ä–µ–∑ API –∏–ª–∏ —á–µ—Ä–µ–∑ CLI? –í –ø—Ä–∏–Ω—Ü–∏–ø–µ, –∫–∞–∫ –±—ã –Ω–µ –≤–∞–∂–Ω–æ, –Ω–æ –≤ —Ü–µ–ª–æ–º, –µ—Å–ª–∏, –º–æ–∂–µ—Ç, —Ç–∞–º GitLab CLI –Ω—É–∂–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è, –¥–∞ —è –∞–≤—Ç–æ—Ä–∏–∑–∏—Ä—É—é—Å—å. –ì–¥–µ –Ω–∞–¥–æ? –ù–∞ VPS, –Ω–∞ VDS –∏ –≤–µ–∑–¥–µ.

–ß—Ç–æ–±—ã –¥–æ–¥–µ–ª–∞–ª–∏, –∏ —á—Ç–æ–±—ã –≤–æ—Ç –æ–Ω –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª —Ä–∞–±–æ—Ç—É, –¥–∞? –ò –ø–æ—Ç–æ–º –æ—Ç–º–µ—Ç–∏–ª, —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ, –∏ –ø–æ—Ç–æ–º –ø–æ—à—ë–ª –¥–∞–ª—å—à–µ. –ò –≤–æ—Ç –¥–µ–ª–∞–ª—Å—è –ø–æ —Ñ–∞–∑–∞–º. –ò —ç—Ç–æ –≤ Markdown —Ñ–∞–π–ª–∏–∫–∞—Ö, –∞ –Ω–µ –≤–æ—Ç –∫–∞–∫ —Ç—ã –Ω–∞–ø–∏—Å–∞–ª. –ù—É —Ç–µ—Ä—è–µ—Ç—Å—è –æ–Ω, –∑–∞–±—ã–≤–∞–µ—Ç. –ù—É, —Ö–æ—Ä–æ—à–∏–π —Ç—ã –ø—Ä–æ–º–ø—Ç –ø–∏—à–µ—à—å, –Ω–æ —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å –∂–µ —Å—É—Ç—å, —á–µ–º –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?```

–Ø —Ö–æ—Ç–µ–ª –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–∂–µ –±—ã–ª–æ –∞–≥–µ–Ω—Ç—É Codex-Cli –≤ —Ç–æ–π —Å–µ—Å—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–∏–≤ –Ω–∞—à —Ä–∞–∑–≥–æ–≤–æ—Ä –º–æ–ª –æ–Ω —Ä–∞–∑–±–µ—Ä–µ—Ç—Å—è –∏ –≤—Å–µ 

```transcript
–¢—ã –æ–±—è–∑–∞–Ω –∏ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ—á–∏—Ç–∞—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ—á–µ–Ω—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ, —Å–æ–±—Ä–∞—Ç—å —Å –Ω–µ–≥–æ —Å –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –∏ —Å –∫–∞–∂–¥–æ–≥–æ outputs Job to be done –∏ Definition of done. –ü–æ —Ñ–∞–∫—Ç—É —Ç–µ–±–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å, –∫–∞–∫ —Ç–∞–º –ø—Ä–æ–ø–∏—Å–∞–Ω–æ, —Å–æ–≥–ª–∞—Å–Ω–æ –ø—É—Ç–∏, –∫–æ—Ç–æ—Ä—ã–º –º—ã —É–∂–µ –ø—Ä–æ—à–ª–∏, —ç–ø–∏–∫ –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ CFA-Tool¬ª. –ö–∞–∫–∏–µ —é–∑–µ—Ä-—Å—Ç–æ—Ä–∏ –ª—É—á—à–µ —Å–¥–µ–ª–∞—Ç—å? –ü–æ–¥—É–º–∞–π —Å–∞–º –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ.

–í –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –º—ã —É–∂–µ –ø—Ä–æ—à–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —é–∑–µ—Ä-—Å—Ç–æ—Ä–∏, –∏ —è —Å—á–∏—Ç–∞—é –∂–∏–∑–Ω–µ–Ω–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º –æ—Ç–º–µ—Ç–∏—Ç—å –¥–∞–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —é–∑–µ—Ä-—Å—Ç–æ—Ä–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç—ã –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∞–≥–µ–Ω—Ç—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞–±—ã–≤–∞—é—Ç –∫–ª—é—á–µ–≤–æ–π –ø—É—Ç—å. –í —ç—Ç–∏—Ö —é–∑–µ—Ä-—Å—Ç–æ—Ä–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø–∏—Å–∞–Ω—ã, –≤ —Ç–æ–º —á–∏—Å–ª–µ –∫–ª—é—á–µ–≤—ã–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ Definition of done, Job to be done, –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ acceptance-–∫—Ä–∏—Ç–µ—Ä–∏–∏, –∫–∞–∫–∏–µ —Ç–∞—Å–∫–∏ –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. –ò –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –≤—Å–µ –∫—Ä–æ—Å—Å-—Ä–µ—Ñ–µ—Ä–µ–Ω—Å –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Å–¥–µ–ª–∞–Ω—ã.

–≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –¥–µ–ª–∞—Ç—å —á–µ—Å—Ç–Ω—É—é, —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—É—é —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –µ—Å–ª–∏ —Ñ–∞–π–ª —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∫–æ–π-—Ç–æ, —Ç–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞, —á—Ç–æ –æ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Ç–∞–º-—Ç–æ. –≠—Ç–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ.

–î–∞–ª—å—à–µ, —á—Ç–æ –µ—â–µ —Ö–æ—á—É —è –æ—Ç–º–µ—Ç–∏—Ç—å. –Ø –Ω–∞–∫–∏–¥–∞—é –ø—Ä–æ—Å—Ç–æ –≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∫–∞–∫–∏–µ-—Ç–æ –∑–∞–¥–∞—á–∏. –ù–µ —Ñ–∞–∫—Ç, —á—Ç–æ —ç—Ç–æ –±—É–¥–µ—Ç —Ä–∞–º–∫–∞ –æ–¥–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏. –ú—ã —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É —Å–µ—Ä–≤–µ—Ä–∞ VDS –∏ CFA, —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –Ω–∞ –Ω–∏—Ö —é–∑–µ—Ä–∞, —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ VDS-—Ä–∞–Ω–Ω–µ—Ä. –ü–æ—Ç–æ–º –º—ã –ø—Ä–æ–≤–µ–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫–ª—é—á–µ–π –æ—Ç GitLab, –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ –∞–∫–∫–∞—É–Ω—Ç —Å —ç—Ç–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º, –∫–∞–∫ —Ç–∞–º –≤—Å–µ, —á—Ç–æ —Ö–æ–¥–∏—Ç, –ø–æ –∫–∞–∫–∏–º —à–∞–≥–∞–º.

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —É–∂–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —è –ø–æ–Ω–∏–º–∞—é, –µ—Å—Ç—å –∏ –ø—Ä–æ–ø–∏—Å–∞–Ω —Ç–æ–±–æ–π, —á—Ç–æ —É–∂–µ —Ö–æ—Ä–æ—à–æ. –ß—Ç–æ–±—ã —ç—Ç–æ –±—ã–ª–æ –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ —Ç–∞–π–º–ª–∞–π–Ω—É —é–∑–µ—Ä-—Å—Ç–æ—Ä–∏, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –¥–µ–ª–∞–ª–∏ –ø–æ —à–∞–≥–∞–º, –∏ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –≤—Å–µ —ç—Ç–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –¥–æ–ª–∂–Ω—ã —É–≤—è–∑–∞—Ç—å—Å—è. –í —Ç–æ–º —á–∏—Å–ª–µ –±—ã–ª–∞ —é–∑–µ—Ä-—Å—Ç–æ—Ä–∏, –≥–¥–µ —è —Ç–µ–±–µ –≥–æ–≤–æ—Ä–∏–ª –æ —Ç–æ–º, —á—Ç–æ –Ω—É–∂–Ω–æ... –Ø –Ω–µ –∑–Ω–∞—é, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–∑–≤–∞—Ç—å —ç—Ç–æ. –°–∏—Å—Ç–µ–º–Ω–∞—è —é–∑–µ—Ä-—Å—Ç–æ—Ä–∏, –∫–æ–≥–¥–∞ –∞–≥–µ–Ω—Ç –∑–∞—à–µ–ª –≤ —Ç—É–ø–∏–∫, –∫–æ–≥–¥–∞ —Ç—ã –Ω–∞–ø–ª–æ–¥–∏–ª —Å—É—â–Ω–æ—Å—Ç–∏, –Ω–µ—Å–∫–æ–ª—å–∫–æ GitLab CI —Ñ–∞–π–ª–æ–≤, –∏ –±—ã–ª –±–∞—Ä–¥–∞–∫.

–î–∞–ª—å—à–µ —é–∑–µ—Ä-—Å—Ç–æ—Ä–∏, –∫ –∫–æ—Ç–æ—Ä–æ–π —è —Å–µ–π—á–∞—Å –ø—Ä–∏—à–µ–ª –∫ –≤—ã–≤–æ–¥–∞–º –∏ –≤–Ω–µ–¥—Ä–∏–ª. –ù–æ –Ω–∞–ø–æ–º–∏–Ω–∞—é, –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî —ç—Ç–æ —á—Ç–æ–±—ã —Å–µ–π—á–∞—Å –º—ã –Ω–∞—à–∏—Ö 8 –±—ç–∫–µ–Ω–¥-—Å–µ—Ä–≤–∏—Å–æ–≤, Keycloak –∏ 3 apps, –ø–ª—é—Å gateway –∫ –±—ç–∫–µ–Ω–¥–∞–º —É –Ω–∞—Å –æ—Ç–Ω–æ—Å—è—Ç—Å—è, –∏ –≤—Å–µ –Ω—É–∂–Ω—ã–µ —Ç–∞–º –±–∞–∑—ã –∏ –ø—Ä–æ—á–µ–µ, –≤—Å–µ —ç—Ç–æ —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∏, –ø—Ä–æ–≤–µ—Ä–∏–ª–∏, —á—Ç–æ –æ–Ω–æ –ø–æ –∫–æ–º–º–∏—Ç—É –±–∏–ª–¥–∏—Ç—Å—è –∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è.

–ü—Ä–æ–±–ª–µ–º–∞ —Å SSH-–∫–ª—é—á–æ–º, —è —Ç–µ–±–µ —Å–µ–π—á–∞—Å –ø–æ–¥–∫–∏–Ω—É–ª, –Ω–æ —Ç—ã –ø—Ä–æ—Å—Ç–æ –º–æ–≥ –Ω–∞ —Å–µ—Ä–≤–∞–∫ –∑–∞–π—Ç–∏, —Å–≥–µ–Ω–µ—Ä–∏—Ç—å —Ç–∞–º —ç—Ç–æ—Ç SSH-–∫–ª—é—á, —á–µ—Ä–µ–∑ API –¥–æ–±–∞–≤–∏—Ç—å –ª–∏–±–æ —Å–∫–∞–∑–∞—Ç—å: ¬´–û–Ω –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ, —Ç—ã –¥–æ–±–∞–≤—å –µ–≥–æ –≤ GitLab —á–µ—Ä–µ–∑ UI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–æ API –∏ –ø–æ —Ç–æ–∫–µ–Ω—É —É –º–µ–Ω—è –Ω–µ—Ç –ø—Ä–∞–≤, –∏ —è –¥–æ–ª–∂–µ–Ω —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å¬ª. –í—Å–µ, —è —Å–¥–µ–ª–∞—é. –ó–∞—á–µ–º –º—ã –∑–∞–Ω–∏–º–∞–µ–º—Å—è, –∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–Ω–æ–≤–æ –∏ –∑–∞–Ω–æ–≤–æ —Ä–∞–Ω–Ω–µ—Ä –∫–∞–∫–æ–π-—Ç–æ –µ—Ä—É–Ω–¥–æ–π?

–î–∞–ª—å—à–µ, —è –¥–∞–≤–∞–ª –≤–∞–∂–Ω—ã–µ, –æ—á–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –¥–µ–ª–∞—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –≥–ª—É–ø—ã–µ –≤–µ—â–∏ —Ç–∏–ø–∞ –±–∏–ª–¥–∏—Ç—å –∑–∞–Ω–æ–≤–æ –æ–±—Ä–∞–∑—ã, –µ—Å–ª–∏ –¥–∞–∂–µ —É –Ω–∏—Ö –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –Ω–µ –º–µ–Ω—è–ª—Å—è, –∏–ª–∏ –∑–∞–Ω–æ–≤–æ, –µ—Å–ª–∏ —Ç–∞–º –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–ª–æ—Å—å. –¢–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ –Ω–∞–¥–æ –¥–µ–ª–∞—Ç—å. –Ø —Ö–æ—á—É —É–ø–æ–º—è–Ω—É—Ç—å —Ç–µ–±–µ, —á—Ç–æ —Å Docker —Ç–æ–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å.

–ò –ø–æ–ª—É—á–∞–µ—Ç—Å—è, —è –≤–æ—Ç —Ö–æ—á—É —Å–µ–π—á–∞—Å –≤—Å–µ —ç—Ç–æ —Å–æ–±—Ä–∞—Ç—å –≤ –∫—É—á—É –∏ —á—Ç–æ–±—ã –ø–æ —à–∞–≥–∞–º –∞–≥–µ–Ω—Ç —Å–¥–µ–ª–∞–ª –≤–æ—Ç —ç—Ç–æ, —á—Ç–æ–±—ã –º—ã –¥–æ–±–∏–ª–∏—Å—å, —á—Ç–æ –¥–µ–ø–ª–æ–π, –¥–∞, —Ö–æ—Ç—è –±—ã –Ω–∞ —ç—Ç–∏—Ö –≤–æ—Å—å–º–∏ —Å–µ—Ä–≤–∏—Å–∞—Ö –ø—Ä–æ—Ö–æ–¥–∏—Ç. –î–∞–ª—å—à–µ –º—ã —Ç–∞–º –¥–æ–±–∞–≤–∏–º —Å–ª–µ–¥—É—é—â–µ–µ: –¥—Ä—É–∂–∏—Ç—å –∏ Keycloak, –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ã, –Ω–æ —É–∂–µ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø.

–î–∞–ª—å—à–µ, —Ç–æ –µ—Å—Ç—å —ç—Ç–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã, –∏ —á—Ç–æ–±—ã –Ω–∏ –æ–¥–∏–Ω –∫—Ä–∏—Ç–µ—Ä–∏–π, –Ω–∏ –æ–¥–∏–Ω Definition of done, –Ω–∏ –æ–¥–∏–Ω Job to be done, –Ω–∏ –æ–¥–∏–Ω kickoff task –Ω–µ –±—ã–ª –ø—Ä–æ—Å—Ç–æ –∫–∞–∫–æ–π-—Ç–æ —Ü–∏—Ñ—Ä–æ–π –æ–¥–∏–Ω –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–µ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫. –≠—Ç–æ must be —á–µ–∫–±–æ–∫—Å. –ò –∞–≥–µ–Ω—Ç, –∫–æ–≥–¥–∞ —ç—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç, –æ–Ω –¥–æ–ª–∂–µ–Ω —ç—Ç–æ—Ç —á–µ–∫–±–æ–∫—Å –ø–æ–¥–ø–∏—Å–∞—Ç—å –∏ –æ—Ç–≤–µ—á–∞—Ç—å –∫—Ä–æ–≤—å—é –∑–∞ —ç—Ç–æ, —á—Ç–æ–±—ã —ç—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ.
```

–Ω–æ –ø–æ–Ω–∏–º–∞—é —á—Ç–æ –≤–æ—Ç –¥–∞–∂–µ —Å ssh-key –æ–Ω –¥–æ–ø—É—Å–∫–∞–µ—Ç –Ω–µ–ø—Ä–æ—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ç—É–ø—ã–µ –∏ —á—Ç–æ –æ–Ω —Ç–æ—á–Ω–æ –Ω–∞—Ç—É–ø–∏—Ç –ø–æ—ç—Ç–æ–º—É –¥–∞–≤–∞–π –∫–∞–∫ —Ç–æ —Ç—ã —Å–¥–µ–ª–∞–π —Å —É—á–µ—Ç–æ–º —á—Ç–æ —Ñ–∞–π–ª —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ –±—É–¥–µ—Ç —Ç–∞–∫–æ–π  `memory-bank/Scrum/20251126/20251126-pack/20251127-0744-correct-cicd-agent-gpt5p.oracle.json` (–Ω–µ–ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞—é –Ω–µ—Ç —Å–º—ã—Å–ª–∞)
p.s. –∫—Å—Ç–∞—Ç–∏ –ø—Ä–æ —Å—Å—à
```bash
[03:09] user@eywa-ubuntu-8gb-hel1-2 prj_Cifra-rwa-exachange-assets (main+) $ ssh cfa2
Welcome to Ubuntu 24.04.3 LTS (GNU/Linux 6.8.0-87-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Thu Nov 27 05:59:28 UTC 2025

  System load:  0.0                Processes:             142
  Usage of /:   34.3% of 28.02GB   Users logged in:       0
  Memory usage: 42%                IPv4 address for eth0: 92.51.38.126
  Swap usage:   13%                IPv6 address for eth0: 2a03:6f01:1:2::1:a1e7


Expanded Security Maintenance for Applications is not enabled.

21 updates can be applied immediately.
To see these additional updates run: apt list --upgradable

7 additional security updates can be applied with ESM Apps.
Learn more about enabling ESM Apps service at https://ubuntu.com/esm


*** System restart required ***
Last login: Wed Nov 26 16:29:22 2025 from 65.108.157.9
user@6033599-dq95453:~$ ls ~/.ssh
authorized_keys
user@6033599-dq95453:~$ cd ~/.ssh
user@6033599-dq95453:~/.ssh$ ssh-keygen
Generating public/private ed25519 key pair.
Enter file in which to save the key (/home/user/.ssh/id_ed25519):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/user/.ssh/id_ed25519
Your public key has been saved in /home/user/.ssh/id_ed25519.pub
The key fingerprint is:
SHA256:EBHF2tvVw5sokKmOmOq2fy+vF6ZtCNqV6caLkoI1D84 user@6033599-dq95453
The key's randomart image is:
+--[ED25519 256]--+
|      +=.        |
|       ..        |
|      .o o   o   |
|      ..=   . +  |
|      o.S+ . . + |
|  +. +.o. o . o  |
|.++*=o= .  .     |
|o=E.+O.+         |
|=++oooOo         |
+----[SHA256]-----+
user@6033599-dq95453:~/.ssh$ nvim id_ed25519
id_ed25519      id_ed25519.pub
user@6033599-dq95453:~/.ssh$ nvim id_ed25519
Command 'nvim' not found, but can be installed with:
sudo apt install neovim
user@6033599-dq95453:~/.ssh$ nano id_ed25519
user@6033599-dq95453:~/.ssh$
```

#### ChatGPT:
<time datetime="2025-11-27T06:30:08.361Z" title="27/11/2025, 09:30:08">09:30</time>

TL;DR

- –¢–≤–æ–∏ –≥–ª–∞–≤–Ω—ã–µ –ø—Ä–∞–≤–∫–∏: **–Ω–∏–∫–∞–∫–æ–≥–æ K8s —Å–µ–π—á–∞—Å**, JSON‚ÄëGuardians ‚Äî **Job –ø–æ–∑–∂–µ**, —Ñ–æ–∫—É—Å **–Ω–∞ dev-cfa2 pipeline**, –∫–æ—Ç–æ—Ä—ã–π –±–∏–ª–¥–∏—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–∏–≤—à–µ–µ—Å—è –∏ —Ä–µ–∞–ª—å–Ω–æ –¥–µ–ø–ª–æ–∏—Ç –Ω–∞ cfa2, —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º loop‚Äô–æ–º –∏ GitLab‚Äë–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º.
- –Ø —Å–æ–±—Ä–∞–ª –∏–∑ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è/–ø—Ä–∞–≤–∫–∏ –∏ –æ—Ñ–æ—Ä–º–∏–ª: **UPDATED\_JTBD\_CONTRACT** –¥–ª—è CI/CD‚Äë—ç–ø–∏–∫–∞ dev‚Äëcfa2 + **–Ω–æ–≤—ã–π AGENT\_PROMPT –¥–ª—è Codex‚ÄëCli** –ø–æ–¥ —ç—Ç–æ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç.
- –ü–ª—é—Å –¥–∞–ª –ø—Ä–∏–º–µ—Ä **`guardian.config.json`** –ø–æ–¥ pre‚Äëcommit/husky, —á—Ç–æ–±—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–µ–ø–æ (Docker, .env, .gitlab-ci), –Ω–æ —ç—Ç–æ **J4, –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ J1‚ÄìJ2 –±—É–¥—É—Ç –∑–∞–∫—Ä—ã—Ç—ã**.

---

## 1. –ß—Ç–æ —Ç—ã —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Ç—Ä–µ–±—É–µ—à—å (–∏–∑ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∏ —Ç–µ–∫—Å—Ç–∞)

### 1.1. Requirements / Corrections / Suggestions

**–§–æ–∫—É—Å CI/CD / –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã**

1. **–ì–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å —Å–µ–π—á–∞—Å ‚Äî dev, –Ω–µ K8s.**
   - –í—Å—ë, —á—Ç–æ –ø—Ä–æ K8s/Argo/Agent ‚Äî —É–±—Ä–∞—Ç—å –∏–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ scope. –≠—Ç–æ ‚Äú–ø–æ—Ç–æ–º‚Äù, –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–ø–∏–∫.
   - –õ—é–±—ã–µ K8s‚Äë—Ñ–∞–π–ª—ã –ø–æ–∫–∞ —Å—á–∏—Ç–∞–µ–º reference/—à–∞–±–ª–æ–Ω–∞–º–∏, –Ω–µ —Ç—Ä–æ–≥–∞–µ–º –∏ –Ω–µ –≤–∫–ª—é—á–∞–µ–º –≤ –∞–∫—Ç–∏–≤–Ω—ã–π pipeline.

2. **Dev‚Äëpipeline –¥–ª—è `dev-cfa2`:**
   - –ö–æ–º–º–∏—Ç ‚Üí GitLab pipeline ‚Üí build —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–∏–≤—à–∏—Ö—Å—è —Å–µ—Ä–≤–∏—Å–æ–≤ ‚Üí deploy –Ω–∞ `cfa2` —á–µ—Ä–µ–∑ docker‚Äëcompose.
   - –ù–æ—Ä–º–∞–ª—å–Ω—ã–π, –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã–π **build+deploy –≤—Å–µ—Ö 8 backend —Å–µ—Ä–≤–∏—Å–æ–≤ + Keycloak + 3 frontend apps + gateway + –±–∞–∑—ã**. ÓàÄfileciteÓàÇturn1file9ÓàÅ
   - Deploy —á–µ—Ä–µ–∑ `/srv/cfa` –Ω–∞ `cfa2` (–∫–∞–∫ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ —Å docker-compose –∏ `.env.cfa2`). ÓàÄfileciteÓàÇturn1file18ÓàÇturn1file19ÓàÅ

3. **‚Äú–£–º–Ω—ã–π‚Äù build, –±–µ–∑ —Ç—É–ø–æ–≥–æ –ø–µ—Ä–µ—Å–±–æ—Äa –≤—Å–µ–≥–æ:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `rules:changes` –∏/–∏–ª–∏ –∞–Ω–∞–ª–æ–≥, —á—Ç–æ–±—ã **–Ω–µ –±–∏–ª–¥–∏—Ç—å –≤—Å–µ –æ–±—Ä–∞–∑—ã**, –µ—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –Ω–µ –º–µ–Ω—è–ª–∏—Å—å. ÓàÄfileciteÓàÇturn1file5ÓàÅ
   - SDK/TS/dotnet –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ —Ç—è–∂—ë–ª—ã–µ —à—Ç—É–∫–∏ –≤—ã–∑—ã–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ contracts/SDK‚Äë–ø–∞–∫–µ—Ç–æ–≤**.

4. **–¢–µ—Å—Ç—ã –ø–æ —à–∞–≥–∞–º:**
   - –°–Ω–∞—á–∞–ª–∞ **–±–µ–∑ e2e**, —Ç–æ–ª—å–∫–æ: docker compose config, –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –º–∏–Ω–∏–º—É–º smoke (health checks, swagger –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è).
   - E2E/Playwright/k6 ‚Äî **—Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø**, –∫–æ–≥–¥–∞ dev‚Äë—Å—Ç–µ–∫ —Å—Ç–∞–±–∏–ª–µ–Ω.

---

**Loop / Memory‚ÄëBank / –∞–≥–µ–Ω—Ç**

5. **Loop –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.**\
   –î–ª—è –∫–∞–∂–¥–æ–π story/—Ç–∞—Å–∫–∏:
   - —Å–¥–µ–ª–∞–ª –∫–æ–¥ ‚Üí
   - **–∑–∞–∫–æ–º–º–∏—Ç–∏–ª** ‚Üí
   - –æ–±–Ω–æ–≤–∏–ª Markdown (—Å—Ç–∞—Ç—É—Å, —á–µ–∫–±–æ–∫—Å—ã DoD/AC) ‚Üí
   - –ø—É—à ‚Üí
   - –¥–æ–∂–¥–∞–ª—Å—è pipeline ‚Üí
   - –ø—Ä–æ–≤–µ—Ä–∏–ª –¥–µ–ø–ª–æ–π (docker compose ps, curl swagger/front) ‚Üí
   - –æ—Ç–º–µ—Ç–∏–ª story –∫–∞–∫ done/in‚Äëprogress.

6. **GitLab –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.**
   - –ê–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω **–º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å pipeline/jobs** —á–µ—Ä–µ–∑ GitLab API –∏–ª–∏ CLI (–∫–∞–∫ —Ç—ã –¥–µ–ª–∞–ª —Ä–∞–Ω—å—à–µ –≤ GitHub Actions).
   - –ì–¥–µ –Ω–∞–¥–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è (GitLab CLI/token) ‚Äî –∞–≥–µ–Ω—Ç –æ–±—è–∑–∞–Ω —è–≤–Ω–æ —Å–∫–∞–∑–∞—Ç—å: ‚Äú–ù—É–∂–µ–Ω —Ç–æ–∫–µ–Ω/–ª–æ–≥–∏–Ω —Ç—É—Ç‚Äë—Ç–æ‚Äù, —Ç—ã —Å–¥–µ–ª–∞–µ—à—å —Ä—É–∫–∞–º–∏.

7. **Markdown –∫–∞–∫ SSOT, JSON ‚Äî –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ.**
   - **–≠–ø–∏–∫–∏/—Ñ–∏—á–∏/—Å—Ç–æ—Ä–∏ –∏ DoD ‚Äî –≤ Markdown** (–ø–æ SDD‚Äë—à–∞–±–ª–æ–Ω–∞–º), –∞ –Ω–µ –≤ –≥–æ–ª–æ–≤–µ –∞–≥–µ–Ω—Ç–∞ –∏–ª–∏ –≤ —Å–ª—É—á–∞–π–Ω–æ–º JSON. ÓàÄfileciteÓàÇturn1file4ÓàÅ
   - JSON‚ÄëGuardians ‚Äî **–Ω–µ Job #1**, –∞ **Job #4** –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ pipeline —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ / —Ñ–∞–π–ª—ã**

8. **Docker‚Äë—Ñ–∞–π–ª—ã:**
   - –í—Å–µ docker‚Äërelated: **–≤ `./ops/docker/*` –∏ `deploy/docker-compose-at-vps/**`**, **–Ω–µ –≤ `docs/deploy/**`**.
   - –¢—ã —É–∂–µ –ø–µ—Ä–µ–Ω—ë—Å `docs/deploy/docker-compose-at-vps/cfa2` ‚Üí `deploy/docker-compose-at-vps/cfa2` ‚Äî —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ. ÓàÄfileciteÓàÇturn1file18ÓàÅ

9. **.env –∏ GitLab‚Äë—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞:**
   - Runtime `.env` –¥–ª—è cfa2 ‚Üí `deploy/docker-compose-at-vps/cfa2/.env.cfa2` (–∏ `.env.example`).
   - CI‚Äë—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ env (GitLab runner, tokens) ‚Üí `./ops/gitlab/cfa2/*` (–±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø–æ–¥–ø–∞–ø–æ–∫ –ø–æ–∫–∞).
   - **–ù–∏–∫–∞–∫–∏—Ö —Ä–∞–Ω–¥–æ–º–Ω—ã—Ö `.env` –≤ apps/services\`, –æ—Å–æ–±–µ–Ω–Ω–æ —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏.**

10. **.gitlab-ci –¥—É–±–ª–∏:**
    - –°–µ–π—á–∞—Å –µ—Å—Ç—å **–¥–≤–∞ `.gitlab-ci`**:
      - root: `.gitlab-ci.yml` (–∞–∫—Ç–∏–≤–Ω—ã–π, –æ–≥—Ä–æ–º–Ω—ã–π, —Å K8s/Argo –∏ —Ç.–ø.) ÓàÄfileciteÓàÇturn0file3ÓàÇturn1file6ÓàÅ
      - `.gitlab/.gitlab-ci.yml` (K8s‚Äëtemplate/agent).
    - –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: **—É–±—Ä–∞—Ç—å –±–∞—Ä–¥–∞–∫**, —è–≤–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å:
      - dev‚Äëpipeline –¥–ª—è cfa2 (active, root).
      - future K8s‚Äëpipeline (template, –≤ `.gitlab/gitlab-ci.k8s.yml` –∏–ª–∏ –ø–æ—Ö–æ–∂–µ–µ –∏–º—è, –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω).
    - –ù–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª—è—Ç—å –∏–∑ ‚Äú–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ‚Äù —Ñ–∞–π–ª–∞ –¥—Ä—É–≥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞, —Ç–æ–ª—å–∫–æ **–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å/–∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å**.

---

**SSH / deploy‚Äëkeys**

11. **SSH‚Äë–∫–ª—é—á:**
    - –ê–≥–µ–Ω—Ç —Ä–∞–Ω–µ–µ –Ω–∞–ª–∞–∂–∞–ª —Å `SSH_PRIVATE_KEY` –∏ `/tmp/ci_ssh_key` (–æ—à–∏–±–∫–∞ `error in libcrypto` –≤ GitLab job). ÓàÄfileciteÓàÇturn0file3ÓàÅ
    - –¢—ã —É–∂–µ **—Å–æ–∑–¥–∞–ª ed25519‚Äë–∫–ª—é—á –Ω–∞ `cfa2`** (`~/.ssh/id_ed25519`) –∏ –º–æ–∂–µ—à—å —Ä—É–∫–∞–º–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –≤ GitLab CI variable.
    - –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∫ –∞–≥–µ–Ω—Ç—É:
      - –ù–µ –ø–ª–æ–¥–∏—Ç—å –Ω–æ–≤—ã–µ –∫–ª—é—á–∏ –±–µ–∑ –Ω—É–∂–¥—ã.
      - –Ø—Å–Ω–æ —Å–∫–∞–∑–∞—Ç—å: ‚Äú–í–æ–∑—å–º–∏ private key –∏–∑ `cfa2:~/.ssh/id_ed25519` –∏ –ø–æ–ª–æ–∂–∏ –≤ GitLab CI/CD variable `SSH_PRIVATE_KEY_CFA2`‚Äù.
      - –í pipeline –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç variable, –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏ –Ω–∞ —Ä–∞–Ω–Ω–µ—Ä–µ.

---

**Epics / Stories / YAML‚Äë—Ç–µ–≥–∏**

12. **Epics/Stories ‚Äî –¥–∞, –Ω–æ –±–µ–∑ overengineering:**
    - –û–¥–∏–Ω –æ—Å–Ω–æ–≤–Ω–æ–π DevOps‚Äëepic: ‚Äú–ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞ dev‚Äëcfa2‚Äù.
    - –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–∏—á:
      - backend dev‚Äëpipeline,
      - frontends dev‚Äëpipeline,
      - path‚Äëbased builds+SDK,
      - guardrails (JSON + pre‚Äëcommit).
    - Story‚Äë—É—Ä–æ–≤–µ–Ω—å ‚Äî —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —É–∂–µ –¥–µ–ª–∞–ª–∏ –∏–ª–∏ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å (bootstrap cfa2, runner vds1, fix .gitlab-ci –±–∞—Ä–¥–∞–∫, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å deploy‚Äëjob –∏ —Ç.–¥.). ÓàÄfileciteÓàÇturn1file2ÓàÇturn1file9ÓàÅ

13. **YAML frontmatter ‚Äî –º–µ–Ω—å—à–µ —Ç–µ–≥–æ–≤:**
    - `category`: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä (`devops`, `backend`, `frontend`).
    - `tags`: —Ç–æ–ª—å–∫–æ —Å–º—ã—Å–ª–æ–≤—ã–µ: `devops`, `cfa2`, `cicd`, `.net`, `nextjs`, `sdk`.
    - –ù–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å: –µ—Å–ª–∏ `category: devops`, —Ç–µ–≥ `devops` –º–æ–∂–Ω–æ, –Ω–æ –Ω–µ –ø–ª–æ–¥–∏—Ç—å 5 –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã—Ö —Ç–µ–≥–æ–≤.

---

## 2. UPDATED\_JTBD\_CONTRACT (–¥–ª—è –Ω–æ–≤–æ–≥–æ CICD‚Äë—ç–ø–∏–∫–∞ dev‚Äëcfa2)

```markdown
1. UPDATED_JTBD_CONTRACT

jobs:
  - id: J0
    title: "–°–æ–±—Ä–∞—Ç—å CI/CD epic + stories + Memory-Bank –¥–ª—è dev-cfa2"
    status: in_progress
    notes:
      - –°–æ–∑–¥–∞—Ç—å –æ–¥–∏–Ω epic (devops, ci/cd, cfa2) + 2‚Äì4 feature + 5‚Äì10 –∫–ª—é—á–µ–≤—ã—Ö stories.
      - –û—Ç—Ä–∞–∑–∏—Ç—å —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏ (bootstrap cfa2, runner vds1, compose cfa2) –∏ –ø–æ–º–µ—Ç–∏—Ç—å –∏—Ö –∫–∞–∫ done.
      - –í—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –≤ markdown –ø–æ SDD-—à–∞–±–ª–æ–Ω–∞–º (epic/feature/story). ÓàÄfileciteÓàÇturn1file4ÓàÅ

  - id: J1
    title: "–°—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π dev pipeline –¥–ª—è –≤—Å–µ—Ö backend —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ cfa2"
    status: in_progress
    notes:
      - –í–µ—Ç–∫–∞ dev-cfa2.
      - –°—Ç–∞–¥–∏–∏: [build, deploy] (sdk/tests –ø–æ–∑–∂–µ).
      - Build jobs: api-gateway, identity, issuance, registry, settlement, compliance (+ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ bank-nominal).
      - deploy-cfa2 job –Ω–∞ —Ç–µ–≥–µ vds1: docker login ‚Üí ssh user@cfa2 ‚Üí docker compose pull/up –≤ /srv/cfa.
      - –ù–µ —Ç—Ä–æ–≥–∞–µ–º docker-compose.yml/.env –Ω–∞ cfa2, —Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö.

  - id: J2
    title: "–î–æ–±–∞–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç—ã (issuer, investor, backoffice) –≤ dev pipeline –∏ compose cfa2"
    status: planned
    notes:
      - Build 3 images (portal-issuer, portal-investor, backoffice).
      - –î–æ–±–∞–≤–∏—Ç—å –∏—Ö –≤ deploy/docker-compose-at-vps/cfa2/docker-compose.yml —Å –ø–æ—Ä—Ç–∞–º–∏ 3001/3002/3003.
      - –ü–æ–¥–Ω—è—Ç—å –∏—Ö —Ç–µ–º –∂–µ deploy-cfa2 job, –ø—Ä–æ–≤–µ—Ä—è—Ç—å curl http://IP:PORT.

  - id: J3
    title: "Path-based builds + SDK jobs"
    status: planned
    notes:
      - –í–≤–µ—Å—Ç–∏ rules:changes –¥–ª—è backend/ frontend jobs, —á—Ç–æ–±—ã –±–∏–ª–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–∏–≤—à–µ–µ—Å—è.
      - –î–æ–±–∞–≤–∏—Ç—å stage sdk:
        - validate-specs (OpenAPI/AsyncAPI lint). ÓàÄfileciteÓàÇturn1file17ÓàÅ
        - generate-sdks (TS + .NET) —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ contracts/sdk.
      - Build jobs –¥–æ–ª–∂–Ω—ã –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç validate-specs/generate-sdks, –µ—Å–ª–∏ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã.

  - id: J4
    title: "JSON-Guardians + pre-commit/husky –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ–ø–æ"
    status: planned
    notes:
      - –í–≤–µ—Å—Ç–∏ –æ–¥–∏–Ω JSON-–∫–æ–Ω—Ñ–∏–≥ —Å–æ —Å—Ö–µ–º–æ–π —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö/–∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö –ø—É—Ç–µ–π –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π.
      - –ü–æ–¥–∫–ª—é—á–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π —á–µ–∫–µ—Ä –≤ pre-commit / husky.
      - –ü—Ä–∞–≤–∏–ª–∞: docker —Ç–æ–ª—å–∫–æ –≤ ops/docker –∏ deploy/docker-compose-at-vps, .env –ø–æ –º–µ—Å—Ç–∞–º, –Ω–∏–∫–∞–∫–∏—Ö –ª–∏—à–Ω–∏—Ö .gitlab-ci –∏ binary –≤ memory-bank.

DoD:
  - [ ] dev-cfa2 –≤–µ—Ç–∫–∞ –∏–º–µ–µ—Ç .gitlab-ci.yml —Å:
        - stages: [sdk (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–∑–∂–µ), build, deploy]
        - build jobs –¥–ª—è –≤—Å–µ—Ö backend –∏ frontend —Å–µ—Ä–≤–∏—Å–æ–≤
        - deploy-cfa2 job –Ω–∞ vds1, –¥–µ–ø–ª–æ—è—â–∏–π –Ω–∞ cfa2 —á–µ—Ä–µ–∑ /srv/cfa
  - [ ] docker-compose –∏ .env –¥–ª—è cfa2:
        - –∂–∏–≤—É—Ç –≤ deploy/docker-compose-at-vps/cfa2/*
        - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –Ω–∞ cfa2 —á–µ—Ä–µ–∑ ops/scripts/sync-compose-cfa2.sh
  - [ ] Frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –Ω–∞ cfa2 –Ω–∞ 3001/3002/3003 –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ HTTP.
  - [ ] Path-based rules –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö build jobs, FORCE_BUILD_ALL=1 –º–æ–∂–µ—Ç —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π rebuild.
  - [ ] SDK jobs (validate-specs, generate-sdks) —Ä–∞–±–æ—Ç–∞—é—Ç –∏ —Ç—Ä–∏–≥–≥–µ—Ä—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ contracts/sdk.
  - [ ] JSON-guardians –∫–æ–Ω—Ñ–∏–≥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, pre-commit check —Ö–æ—Ç—è –±—ã –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≥—Ä—É–±—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è (docker –≤ docs, .env –≤ apps, –¥—É–±–ª–∏ .gitlab-ci).

constraints:
  - "‚ùå –ù–∏–∫–∞–∫–æ–≥–æ K8s/ArgoCD/cluster deploy –≤ —ç—Ç–æ–º —ç–ø–∏–∫–µ; –≤—Å–µ K8s —Ñ–∞–π–ª—ã —Ç–æ–ª—å–∫–æ reference."
  - "‚ùå –ù–µ —Ç—Ä–æ–≥–∞–µ–º uk1/cfa1 –ø—Ä–æ–¥-–æ–∫—Ä—É–∂–µ–Ω–∏—è."
  - "‚úÖ –§–æ–∫—É—Å: docker-compose dev –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–∞ cfa2 + GitLab runner vds1."
  - "‚úÖ Git workflow: {code-change} + {tests/smoke} + {docs/DoD-update} + {commit} –≤ –æ–¥–Ω–æ–º –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ–º –∫–æ–º–º–∏—Ç–µ."
  - "‚úÖ Agent –æ–±—è–∑–∞–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å GitLab pipelines/jobs –∏ —è–≤–Ω–æ —Ä–µ–ø–æ—Ä—Ç–∏—Ç—å —Å—Ç–∞—Ç—É—Å."
```

---

## 3. AGENT\_PROMPT (–≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è Codex‚ÄëCli)

**–í—Å—Ç–∞–≤—å –Ω–∏–∂–µ –∫–∞–∫ –µ—Å—Ç—å –≤ Codex (`codex --yolo`) –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏/role.**

````text
ROLE: –¢—ã Senior DevOps Engineer –∏ –º–æ–π "CI/CD digital twin".

CONTROL PLANE:
- eywa1 (—ç—Ç–∞ —Å–µ—Å—Å–∏—è, tmux / aliases –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã).
- –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: /home/user/__Repositories/yury-customer/prj_Cifra-rwa-exachange-assets
- –û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: repositories/customer-gitlab/ois-cfa

INFRA:
- GitLab: git.telex.global, –ø—Ä–æ–µ–∫—Ç npk/ois-cfa
- Registry: GitLab Container Registry npk/ois-cfa
- Runner: vds1 (167.235.11.150), gitlab-runner —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (tag: vds1)
- Dev target: cfa2 (92.51.38.126), user "user" —Å sudo, Docker + docker compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, /srv/cfa —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

GIT BRANCH:
- –¢–µ–∫—É—â–∞—è —Ä–∞–±–æ—á–∞—è –≤–µ—Ç–∫–∞: dev-cfa2 (–µ—Å–ª–∏ –¥—Ä—É–≥–∞—è ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—Å—å –∏ —è–≤–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π).

HARD CONSTRAINTS:
- ‚ùå –ù–ï —Ç—Ä–æ–≥–∞–µ–º uk1 –∏ cfa1 ‚Äî —Ç–æ–ª—å–∫–æ reference.
- ‚ùå –ù–ï –≤–Ω–µ–¥—Ä—è–µ–º –∏ –Ω–µ —á–∏–Ω–∏–º K8s/ArgoCD, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º K8s jobs –≤ –∞–∫—Ç–∏–≤–Ω—ã–π pipeline.
- ‚ùå –ù–ï –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º –≤–µ—Å—å .gitlab-ci.yml —Å –Ω—É–ª—è ‚Äî —Ç–æ–ª—å–∫–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ dev-cfa2.
- ‚úÖ –§–æ–∫—É—Å: docker-compose dev –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–∞ cfa2 + GitLab pipeline –Ω–∞ dev-cfa2.
- ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Äî —á–µ—Ä–µ–∑ git commit —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

MUST READ (–ü–ï–†–ï–î –õ–Æ–ë–´–ú–ò –ü–†–ê–í–ö–ê–ú–ò –í CI/DEPLOY):
- deploy/docker-compose-at-vps/cfa2/docker-compose.yml
- deploy/docker-compose-at-vps/cfa2/.env.cfa2 –∏ .env.example
- docs/deploy/MULTI_ACCOUNT_SETUP.md, cfa2-dev-runbook.md (–µ—Å–ª–∏ –µ—Å—Ç—å)
- memory-bank/Scrum/20251126/20251126-pack/20251126-2330-CICD-thread-chatgpt-gpt5p.oracle.json.json (–∫–æ–Ω—Ç–µ–∫—Å—Ç JTBD –ø–æ CI/CD)
- c2p_ops.txt, c2p_ois-cfa.txt (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ ops –∫–æ–Ω—Ç–µ–∫—Å—Ç)
- ops/gitlab-ci.md (–µ—Å–ª–∏ –µ—Å—Ç—å)

JTBD (—Å–º. UPDATED_JTBD_CONTRACT –≤ —Ç–µ–∫—É—â–µ–º oracle-—Ñ–∞–π–ª–µ):
- J0: —Å–æ–±—Ä–∞—Ç—å epic/feature/story –∏ Memory-Bank –¥–ª—è dev-cfa2 CI/CD.
- J1: —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å dev pipeline –¥–ª—è backend —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ cfa2.
- J2: –¥–æ–±–∞–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç—ã (issuer, investor, backoffice) –≤ pipeline –∏ compose cfa2.
- J3: —Å–¥–µ–ª–∞—Ç—å path-based builds + SDK jobs.
- J4: –≤–≤–µ—Å—Ç–∏ JSON-guardians + pre-commit guardrails.

### AGENT_WORKFLOW_CONTRACT (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï –ü–û–í–ï–î–ï–ù–ò–ï)

1) PLAN
   - –°–æ–ø–æ—Å—Ç–∞–≤—å —Ç–µ–∫—É—â–∏–π state (.gitlab-ci.yml, deploy/docker-compose-at-vps/cfa2, ops/scripts/*) —Å JTBD/DoD.
   - –°—Ñ–æ—Ä–º–∏—Ä—É–π –º–∏–Ω–∏-–ø–ª–∞–Ω –Ω–∞ 1‚Äì3 —Ü–∏–∫–ª–∞ –≤–∏–¥–∞:
     {code-change} ‚Üí {tests/smoke} ‚Üí {docs/DoD-update} ‚Üí {commit}.

2) EXECUTE
   - –î–µ–ª–∞–π –ú–ê–õ–ï–ù–¨–ö–ò–ï –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
   - –ö–∞–∂–¥—ã–π —Ä–∞–∑:
     - –ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞/–∫–æ–Ω—Ñ–∏–≥–æ–≤ (.gitlab-ci.yml, docker-compose, —Å–∫—Ä–∏–ø—Ç—ã),
     - –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤/–ø—Ä–æ–≤–µ—Ä–æ–∫ (docker compose config, docker compose ps, dotnet test, npm test ‚Äî –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏),
     - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ markdown (DoD/—á–µ–∫–±–æ–∫—Å—ã/stories),
     - git commit.

3) QA / CHECKS
   - –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ CI/compose –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:
     - docker compose --env-file deploy/docker-compose-at-vps/cfa2/.env.cfa2 -f deploy/docker-compose-at-vps/cfa2/docker-compose.yml config
     - ssh user@cfa2 "cd /srv/cfa && docker compose ps"
   - –î–ª—è –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
     - dotnet test –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –ò–õ–ò —Ö–æ—Ç—è –±—ã —Å–±–æ—Ä–∫–∞.
   - –î–ª—è —Ñ—Ä–æ–Ω—Ç–æ–≤ (–∫–æ–≥–¥–∞ –ø–æ–¥–∫–ª—é—á–∏—à—å):
     - npm ci + npm run build –≤ apps/portal-issuer / portal-investor / backoffice.

4) GITLAB PIPELINE MONITORING
   - –ü–æ—Å–ª–µ –ø—É—à–∞:
     - –æ—Ç–∫—Ä—ã—Ç—å pipeline –ø—Ä–æ–µ–∫—Ç–∞ npk/ois-cfa –¥–ª—è –≤–µ—Ç–∫–∏ dev-cfa2 (—á–µ—Ä–µ–∑ GitLab API –∏–ª–∏ web CLI).
     - –¥–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è build/deploy jobs.
     - —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å: –∫–∞–∫–∏–µ jobs –ø—Ä–æ—à–ª–∏/—É–ø–∞–ª–∏, –ø—Ä–∏–ª–æ–∂–∏—Ç—å —É—Ä–ª—ã –∏–ª–∏ id.
   - –ù–ï–õ–¨–ó–Ø —Å—á–∏—Ç–∞—Ç—å —Ä–∞–±–æ—Ç—É –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π, –ø–æ–∫–∞ pipeline –Ω–µ –∑–µ–ª—ë–Ω—ã–π –∏–ª–∏ –ø–æ–∫–∞ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω —è–≤–Ω—ã–π –±–ª–æ–∫–µ—Ä.

5) DOCS / MEMORY-BANK
   - –û–±–Ω–æ–≤–ª—è–π:
     - epic/feature/story —Ñ–∞–π–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, memory-bank/specs/epics/EPIC-DEVOPS-CFA2-CICD.md, features/FEAT-DEVOPS-CFA2-BACKEND-PIPELINE.md, stories/STORY-‚Ä¶),
     - —Ç–µ–∫—É—â–∏–π oracle-—Ñ–∞–π–ª —Å JTBD (–æ—Ç–º–µ—Ç—å —á–µ–∫–±–æ–∫—Å—ã, –¥–æ–±–∞–≤—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–º–º–∏—Ç—ã, pipeline, –ª–æ–≥–∏).
   - –ö–∞–∂–¥—ã–π —á–µ–∫–±–æ–∫—Å –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å commit/pipeline/–ª–æ–≥–æ–º).

6) AUTONOMY
   - –ê–≤—Ç–æ–Ω–æ–º–Ω–æ –≤—ã–ø–æ–ª–Ω—è–π –º–∏–Ω–∏–º—É–º 2 –ø–æ–ª–Ω—ã—Ö WORKFLOW LOOP –¥–ª—è J1 (backend pipeline).
   - –ê–≤—Ç–æ–Ω–æ–º–Ω–æ –≤—ã–ø–æ–ª–Ω—è–π –º–∏–Ω–∏–º—É–º 1 LOOP –¥–ª—è J2 (frontend, –µ—Å–ª–∏ —É—Å–ø–µ–µ—à—å).
   - –í–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–∞–¥–∞–≤–∞–π –¢–û–õ–¨–ö–û –ø—Ä–∏ –∂—ë—Å—Ç–∫–∏—Ö –±–ª–æ–∫–µ—Ä–∞—Ö (–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞, –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞, –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–µ–∫—Ä–µ—Ç).

### –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ó–ê–î–ê–ß–ò (–ø–æ —Ñ–∞–∑–∞–º)

#### PHASE 1 ‚Äî –ü—Ä–∏–≤–µ—Å—Ç–∏ docker-compose –∏ .env cfa2 –≤ SSOT

- –£–±–µ–¥–∏—Å—å, —á—Ç–æ:
  - deploy/docker-compose-at-vps/cfa2/docker-compose.yml ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ compose –¥–ª—è cfa2.
  - deploy/docker-compose-at-vps/cfa2/.env.cfa2 —Å–æ–¥–µ—Ä–∂–∏—Ç:
    - REGISTRY_IMAGE, TAG (–¥–ª—è dev ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π tag, –Ω–∞–ø—Ä. dev –∏–ª–∏ dev-cfa2),
    - GATEWAY_HOST_PORT, KEYCLOAK_HOST_PORT, –ø–æ—Ä—Ç—ã backend‚Äô–æ–≤ –∏ —Ñ—Ä–æ–Ω—Ç–æ–≤,
    - NEXT_PUBLIC_* –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–æ–≤ (API_BASE_URL/KEYCLOAK_URL/REALM/CLIENT_ID).
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ compose backend —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç ${REGISTRY_IMAGE}/service:${TAG} (–ù–ï CI_REGISTRY_IMAGE –Ω–∞–ø—Ä—è–º—É—é).
- –ó–∞–ø—É—Å—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:
  - docker compose --env-file deploy/docker-compose-at-vps/cfa2/.env.cfa2 -f deploy/docker-compose-at-vps/cfa2/docker-compose.yml config
- –ò—Å–ø–æ–ª—å–∑—É–π ops/scripts/sync-compose-cfa2.sh –¥–ª—è —Å–∏–Ω–∫–∞ –Ω–∞ cfa2 –∏ –ø—Ä–æ–≤–µ—Ä—å:
  - ssh user@cfa2 "cd /srv/cfa && docker compose config"

#### PHASE 2 ‚Äî –ü–æ—á–∏–Ω–∏—Ç—å .gitlab-ci.yml –ø–æ–¥ dev-cfa2

- –í .gitlab-ci.yml:
  - –°—Ç–µ–π–¥–∂–∏: sdk (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), build, deploy.
  - –î–ª—è –í–°–ï–• backend —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Ñ—Ä–æ–Ω—Ç–æ–≤:
    - build jobs –∏—Å–ø–æ–ª—å–∑—É—é—Ç docker:24 + docker:24-dind,
    - –ª–æ–≥–∏–Ω—è—Ç—Å—è –≤ $CI_REGISTRY,
    - –±–∏–ª–¥—è—Ç –∏ –ø—É—à–∞—Ç:
      - $CI_REGISTRY_IMAGE/<image>:$CI_COMMIT_SHORT_SHA
      - –¥–ª—è –≤–µ—Ç–∫–∏ dev-cfa2 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ç–µ–≥–∏—Ä—É—é—Ç –∫–∞–∫ :$DEPLOY_TAG (–Ω–∞–ø—Ä–∏–º–µ—Ä, dev-cfa2).
  - –î–ª—è frontend build jobs:
    - –ü–µ—Ä–µ–¥ docker build:
      - npm ci + npm run build –≤ apps/*.
    - –ü–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å NEXT_PUBLIC_* —á–µ—Ä–µ–∑ --build-arg –ø—Ä–∏ docker build.

- deploy-cfa2:
  - tags: [vds1]
  - image: docker:24
  - services: [docker:24-dind]
  - before_script:
    - apk add openssh-client (–µ—Å–ª–∏ Alpine)
    - eval "$(ssh-agent -s)"
    - echo "$SSH_PRIVATE_KEY_CFA2" | tr -d '\r' | ssh-add -
    - mkdir -p ~/.ssh && chmod 700 ~/.ssh
    - ssh-keyscan 92.51.38.126 >> ~/.ssh/known_hosts
    - docker login -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD" "$CI_REGISTRY"
  - script:
    - ssh user@cfa2 "cd /srv/cfa && docker compose pull && docker compose up -d"
    - ssh user@cfa2 "cd /srv/cfa && docker compose ps"

- Rules:
  - –í—Å–µ build jobs –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å:
    - rules:
      - if: '$CI_COMMIT_BRANCH == "dev-cfa2" && $FORCE_BUILD_ALL == "1"'
      - if: '$CI_COMMIT_BRANCH == "dev-cfa2"'
        changes: [...]
  - deploy-cfa2:
    - rules:
      - if: '$CI_COMMIT_BRANCH == "dev-cfa2"'

#### PHASE 3 ‚Äî Path-based rules –∏ SDK jobs

- –î–ª—è –∫–∞–∂–¥–æ–≥–æ backend build job:
  - –ü—Ä–∏–≤—è–∂–∏ changes –∫ –Ω—É–∂–Ω—ã–º –ø—É—Ç—è–º (services/<name>/**, packages/domain/**, packages/contracts/** –∏ —Ç.–¥.).
- –î–ª—è —Ñ—Ä–æ–Ω—Ç–æ–≤:
  - changes: apps/<app>/**, shared ui/libs, contracts/sdk –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- –î–æ–±–∞–≤—å:
  - validate-specs:
    - stage: sdk
    - –æ–±—Ä–∞–∑ —Å Java/Node/openapi/asyncapi CLI
    - script: make validate-specs (–∏–ª–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç) —Å –ª–æ–≥–∞–º–∏ –≤ artifacts.
  - generate-sdks:
    - stage: sdk
    - script: make generate-sdks, artifacts —Å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ SDK.

#### PHASE 4 ‚Äî JSON-Guardians (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ J1/J2 —Å—Ç–æ—è—Ç)

- –°–æ–∑–¥–∞–π —Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä: ops/guardians/guardian.config.json (—Å–º. –ø—Ä–∏–º–µ—Ä –Ω–∏–∂–µ).
- –ù–∞–ø–∏—à–∏ –ø—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç (bash/node) scripts/guardians/check-guardians.(sh|mjs), –∫–æ—Ç–æ—Ä—ã–π:
  - —á–∏—Ç–∞–µ—Ç guardian.config.json,
  - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (git diff --name-only --cached),
  - –ø–∞–¥–∞–µ—Ç, –µ—Å–ª–∏ –Ω–∞—Ä—É—à–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ (docker –≤ docs, .env –≤ apps, –ª–∏—à–Ω–∏–µ .gitlab-ci).
- –ü–æ–¥–∫–ª—é—á–∏ –≤ pre-commit –∏–ª–∏ husky (–Ω–æ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥—É—Ç –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ –±–æ–ª–∏).

### SSH / –ö–õ–Æ–ß–ò

- –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –æ–¥–∏–Ω SSH –∫–ª—é—á –¥–ª—è cfa2:
  - Private key: —Ç–æ—Ç, —á—Ç–æ –ª–µ–∂–∏—Ç –Ω–∞ cfa2 –≤ /home/user/.ssh/id_ed25519
  - –ß–µ–ª–æ–≤–µ–∫ —Ä—É–∫–∞–º–∏ –∫–æ–ø–∏—Ä—É–µ—Ç –µ–≥–æ –≤ GitLab CI/CD variable: SSH_PRIVATE_KEY_CFA2.
- –ù–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–π –Ω–æ–≤—ã–µ –∫–ª—é—á–∏ –±–µ–∑ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è.
- –í –æ—Ç—á–µ—Ç–∞—Ö –í–°–ï–ì–î–ê —É–∫–∞–∑—ã–≤–∞–π, –Ω–∞ –∫–∞–∫–æ–º –∫–ª—é—á–µ/variable –æ—Å–Ω–æ–≤–∞–Ω deploy.

### GIT WORKFLOW

- –ö–∞–∂–¥—ã–π –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π —à–∞–≥ = –æ—Ç–¥–µ–ª—å–Ω—ã–π commit:
  - {code-change} + {tests/smoke output} + {docs/DoD/story update}.
- –ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π:
  - chore(ci): stabilize backend build for dev-cfa2 + compose cfa2
  - feat(ci): add frontends build+deploy for cfa2
  - chore(guard): add guardian.config.json and pre-commit check

### FINAL SELF-CHECK (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏)

```markdown
FINAL SELF-CHECK (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏)

- [ ] QA: –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏ (unit/integration/smoke/e2e/Playwright, –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–≥–Ω–∞–Ω—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö/–ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã—Ö –∫ —Ä–µ–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü–∞–¥–µ–Ω–∏—è/—Ä–µ–≥—Ä–µ—Å—Å–∏–∏ —è–≤–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã, –Ω–µ—Ç ¬´—Ç–∏—Ö–æ–≥–æ¬ª —Ñ–æ–ª–ª–±—ç–∫–∞
- [ ] –ß–µ—Å—Ç–Ω–æ –æ–ø–∏—Å–∞–Ω—ã –±–ª–æ–∫–µ—Ä—ã ("–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ ‚Ä¶")
- [ ] Git: —Å–¥–µ–ª–∞–Ω(—ã) –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π(–µ) commit(—ã) —Ñ–æ—Ä–º–∞—Ç–∞:
      {code-change} + {code-test} + {test-artifacts/output} + {update-docs-DoD-Kickoff-checkboxes}
````

–ê–≥–µ–Ω—Ç –ù–ï –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ —Å—á–∏—Ç–∞—Ç—å —Ä–∞–±–æ—Ç—É –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π, –ø–æ–∫–∞ —ç—Ç–æ—Ç —á–µ–∫‚Äë–ª–∏—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω.

````

---

## 4. –ü—Ä–∏–º–µ—Ä `guardian.config.json` (–¥–ª—è pre‚Äëcommit / husky)

> –≠—Ç–æ **J4**, –ù–ï –∑–∞–ø—É—Å–∫–∞—Ç—å –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ J1/J2 –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –≤ –ø–æ—Ä—è–¥–æ–∫.

```json
{
  "version": "1.0.0",
  "rules": [
    {
      "id": "no-docker-in-docs",
      "description": "Dockerfiles –∏ docker-compose –Ω–µ –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –ø–æ–¥ docs/",
      "deny": [
        "docs/**/Dockerfile",
        "docs/**/Dockerfile.*",
        "docs/**/docker-compose.yml",
        "docs/**/docker-compose.*.yml"
      ]
    },
    {
      "id": "docker-location",
      "description": "Docker-—Ñ–∞–π–ª—ã –∂–∏–≤—É—Ç —Ç–æ–ª—å–∫–æ –≤ ops/docker –∏ deploy/docker-compose-at-vps",
      "allow": [
        "ops/docker/**",
        "deploy/docker-compose-at-vps/**"
      ]
    },
    {
      "id": "env-location",
      "description": ".env —Ñ–∞–π–ª—ã –¥–ª—è cfa2 —Ç–æ–ª—å–∫–æ –≤ ops/gitlab/cfa2 –∏ deploy/docker-compose-at-vps/cfa2",
      "allow": [
        "ops/gitlab/cfa2/**",
        "deploy/docker-compose-at-vps/cfa2/.env*"
      ],
      "deny": [
        "apps/**/.env*",
        "services/**/.env*",
        "docs/**/.env*"
      ]
    },
    {
      "id": "gitlab-ci-duplicates",
      "description": "–ê–∫—Ç–∏–≤–Ω—ã–π —Ç–æ–ª—å–∫–æ root .gitlab-ci.yml, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —à–∞–±–ª–æ–Ω–∞–º–∏ —Å –¥—Ä—É–≥–∏–º –∏–º–µ–Ω–µ–º",
      "deny": [
        ".gitlab/**/.gitlab-ci.yml"
      ],
      "allow": [
        ".gitlab-ci.yml",
        ".gitlab/gitlab-ci.k8s.template.yml"
      ]
    },
    {
      "id": "memory-bank-binaries",
      "description": "–í memory-bank —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã",
      "deny": [
        "memory-bank/**/*.png",
        "memory-bank/**/*.jpg",
        "memory-bank/**/*.jpeg",
        "memory-bank/**/*.pdf",
        "memory-bank/**/*.zip"
      ]
    }
  ]
}
````

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç—ã–º: –ø—Ä–æ—á–∏—Ç–∞—Ç—å `rules[]`, –ø—Ä–æ–π—Ç–∏ –ø–æ `git diff --name-only --cached` –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã –ø–æ glob‚Äô–∞–º.

---

## 5. –ö—Ä–∞—Ç–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

| –ê—Ä—Ç–µ—Ñ–∞–∫—Ç                        | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                             | –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π –ø—É—Ç—å                                      |          |            |
| ------------------------------- | -------------------------------------- | ------------------------------------------------------ | -------- | ---------- |
| UPDATED\_JTBD\_CONTRACT         | –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è CI/CD‚Äë—ç–ø–∏–∫–∞ dev‚Äëcfa2      | memory-bank/Scrum/20251126/20251127-0744-cicd-agent.md |          |            |
| AGENT\_PROMPT –¥–ª—è Codex-Cli     | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è Codex‚Äë–∞–≥–µ–Ω—Ç–∞ | —Ç–æ—Ç –∂–µ —Ñ–∞–π–ª (—Å–µ–∫—Ü–∏—è AGENT\_PROMPT)                     |          |            |
| guardian.config.json            | Guardrails –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ–ø–æ          | ops/guardians/guardian.config.json                     |          |            |
| Epic/Feature/Story markdown     | SDD‚Äë—Å–ø–µ–∫–∏ –¥–ª—è CI/CD‚Äë—ç–ø–∏–∫–∞              | memory-bank/specs/epics                                | features | stories/\* |
| sync-compose-cfa2.sh (—É–∂–µ –µ—Å—Ç—å) | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è compose/.env –Ω–∞ cfa2     | ops/scripts/sync-compose-cfa2.sh                       |          |            |
| .gitlab-ci.yml (dev-cfa2)       | –ê–∫—Ç–∏–≤–Ω—ã–π dev pipeline –¥–ª—è cfa2         | .gitlab-ci.yml                                         |          |            |

---

## 6. NEXT\_STEPS\_FOR\_HUMAN

1. **–°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å oracle‚Äë—Ñ–∞–π–ª**
   - –°–∫–æ–ø–∏—Ä—É–π –±–ª–æ–∫–∏ `UPDATED_JTBD_CONTRACT` + `AGENT_PROMPT` –≤ –Ω–æ–≤—ã–π —Ñ–∞–π–ª\
     `memory-bank/Scrum/20251126/20251127-0744-correct-cicd-agent-gpt5p.oracle.md` (–∏–ª–∏ —Ç–æ—Ç –ø—É—Ç—å, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã —É–∂–µ —Ä–µ—à–∏–ª).
   - –û–±–Ω–æ–≤–∏ frontmatter –ø–æ —Å–≤–æ–∏–º —à–∞–±–ª–æ–Ω–∞–º (category: devops, tags: \[devops, cfa2, cicd]).

2. **GitLab SSH variable**
   - –ù–∞ `cfa2`: –æ—Ç–∫—Ä–æ–π `/home/user/.ssh/id_ed25519` (—É —Ç–µ–±—è —É–∂–µ —Å–æ–∑–¥–∞–Ω).
   - –°–∫–æ–ø–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ GitLab ‚Üí Settings ‚Üí CI/CD ‚Üí Variables ‚Üí\
     `SSH_PRIVATE_KEY_CFA2` (protected/ –Ω–µ masked ‚Äî –∫–∞–∫ —Ç–µ–±–µ —É–¥–æ–±–Ω–µ–µ, –Ω–æ –±–µ–∑ CRLF).

3. **–ó–∞–ø—É—Å–∫ Codex‚Äë–∞–≥–µ–Ω—Ç–∞**
   - –ù–∞ eywa1 –≤ `prj_Cifra-rwa-exachange-assets` –∑–∞–ø—É—Å—Ç–∏:\
     `codex --yolo`
   - –í—Å—Ç–∞–≤—å `AGENT_PROMPT` –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏.
   - –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤–µ—Ç–∫–∞ `dev-cfa2` –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `ois-cfa` —á–∏—Å—Ç—ã (git status).

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–∞**
   - GitLab:
     - –£–±–µ–¥–∏—Å—å, —á—Ç–æ –¥–ª—è `dev-cfa2` pipeline –∑–µ–ª—ë–Ω—ã–π, build+deploy –∫—Ä—É—Ç—è—Ç—Å—è –∫–∞–∫ –æ–∂–∏–¥–∞–µ—à—å.
   - cfa2:
     - `ssh cfa2 "cd /srv/cfa && docker compose ps"`
     - –û—Ç–∫—Ä–æ–π backend swagger (58081..58086) –∏ —Ñ—Ä–æ–Ω—Ç—ã (3001‚Äì3003) —Ä—É–∫–∞–º–∏.
   - Memory-bank:
     - –ü–æ—Å–º–æ—Ç—Ä–∏, —á—Ç–æ —ç–ø–∏–∫/—Ñ–∏—á–∏/—Å—Ç–æ—Ä–∏ –∏ oracle —Ñ–∞–π–ª —Ä–µ–∞–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã —á–µ–∫–±–æ–∫—Å–∞–º–∏ –∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∫–æ–º–º–∏—Ç—ã/pipelines.

5. **–ü–æ–¥—Ç—è–Ω—É—Ç—å JSON‚ÄëGuardians –ø–æ–∑–∂–µ**
   - –ö–æ–≥–¥–∞ dev‚Äëpipeline —Å—Ç–∞–±–∏–ª–µ–Ω, –¥–æ–±–∞–≤—å `guardian.config.json` –∏ pre-commit hook.
   - –ü—Ä–æ–≥–æ–Ω —á–µ—Ä–µ–∑ `git commit` —Å –Ω–∞—Ä—É—à–µ–Ω–∏—è–º–∏, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ guard —Ä–µ–∞–ª—å–Ω–æ –ª–æ–≤–∏—Ç –º—É—Å–æ—Ä.

---

### Mermaid –¥–ª—è —Ü–∏–∫–ª–∞ –∞–≥–µ–Ω—Ç–∞

```mermaid
graph TD
  A[code-change] --> B[tests-or-smoke]
  B --> C[docs-and-DoD-update]
  C --> D[git-commit-and-push]
  D --> E[gitlab-pipeline-dev-cfa2]
  E --> F[deploy-to-cfa2]
  F --> G[manual-verify-swagger-and-frontends]
  G --> H[next-story-or-job]
```

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å —É–∂–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –ø–æ `.gitlab-ci.yml` dev‚Äëcfa2: —Ä–∞–∑–±–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ –∏ –≤—ã–¥–∞—á–∞ –¥–∏—Ñ—Ñ‚Äë–ø–ª–∞–Ω–∞ ‚Äú—á—Ç–æ –ø—Ä–∞–≤–∏—Ç—å, —á—Ç–æ —É–¥–∞–ª–∏—Ç—å, —á—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç—å‚Äù.
