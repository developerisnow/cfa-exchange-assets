1. SESSION_EVAL
   (comparison of agent `019aa9cf-d792-7bc0-8083-f73177d4bfc6` vs DoD for branch `codex/fix-cfa1-regressions`)

* **completeness_score:** **35/100**

  * Сильная фокусировка на NX‑07 (KYC/backoffice): SPEC DIFF, OpenAPI, TS SDK, фронты, CHANGELOG.
  * NX‑05/06/08 затронуты только частично через таски + общие статусы, полноценной проверки/фиксов нет.
  * .NET и Playwright тесты в рамках той сессии не прогнаны, только описаны как next steps.

* **accuracy_score:** **85/100**

  * OpenAPI и TS SDK по KYC/Identity выглядят согласованно с фронтом и бэкендом:

    * `POST /v1/compliance/kyc` + body с KycApplicationRequest,
    * `POST /v1/compliance/kyc/{id}/decision` с `decision` + `comment`,
    * фронтовые хелперы используют те же маршруты и поля.
  * CHANGELOG и NX‑07 DoD отражают реальные изменения (SPEC DIFF, SDK regen, lint фронтов).
  * Основной минус по accuracy: в документации сохранён outdated statement «dotnet/docker недоступны» как блокер, хотя в конце сессии .NET SDK был обнаружен и успешно проинспектирован через `dotnet --info`.

* **progress_pct (по всей связке J1–J3 на ветке):** **~40%**

  * J1 (регрессии NX‑05..08): закрыта часть по NX‑07 (контракт + SDK + фронтовые страницы). NX‑05/06/08 ещё нуждаются в проверке на cfa1/cfa2 и e2e.
  * J2 (e2e/Playwright): базовая инфраструктура Playwright уже была в ветке раньше; в этой сессии — только план и команды, без реального запуска.
  * J3 (tasks/*.md): NX‑07 заметно продвинут (SPEC DIFF, DoD, Verified‑строка), но NX‑05/06/08 всё ещё не доведены до конечного состояния.

* **summary_by_phase:**

  * **Phase 0 — Анализ контекста и ограничений**

    * Агент поднял контекст по NX‑05..08, DoD, состоянию ветки и инфраструктуре (отсутствие sudo/docker, локальный JDK).
    * Ошибка: «нет dotnet» зафиксировано как блокер, хотя DOTNET SDK уже стоял в `$HOME/.dotnet`.

  * **Phase 1 — Контракты и SDK (NX‑07)**

    * Почистил `openapi-gateway.yaml`: убрал дубликат KYC, добавил submit/decision, выровнял схемы (KycApplicationRequest/KycRequest).
    * Перегенерировал TS SDK в `packages/sdks/typescript-gateway` через локальный JDK (`~/.local/java/jdk-17.0.13+11/bin/java`).

  * **Phase 2 — Backend compliance + roles**

    * Внёс изменения в `services/compliance` (KYC submit/decision уже внедрены, добавлен `KycApplicationRequest.cs`, расширены роли в `Program.cs`).
    * .NET build/test в этой сессии не прогонял (до dotnet‑install), оставил это как next step.

  * **Phase 3 — Frontend (issuer/investor/backoffice KYC, навигация)**

    * Добавлены/уточнены страницы KYC инвестора и backoffice, helper’ы для KYC/Identity, навигация issuer dashboard (добавлены `Dashboard`, `Reports`, `Payouts Schedule`, `KYC`).
    * Линт фронтов (`apps/portal-issuer`, `apps/portal-investor`) зелёный.
    * Фронты явно ещё не переведены полностью на сгенерированный SDK (часть хелперов ручные — это честно зафиксировано как gap).

  * **Phase 4 — .NET SDK bring‑up**

    * По запросу пользователя агент установил/проверил .NET SDK в `$HOME/.dotnet` через `dotnet-install.sh`, выполнил `dotnet --info`.
    * Но полноценный прогон `dotnet build/test` для всей solution в той сессии так и не произошёл — он остался в списке рекомендаций.

  * **Phase 5 — Docs/DoD/CHANGELOG**

    * Обновлён `CHANGELOG.md` с отдельным блоком `2025-11-22 (codex/8c38, branch codex/fix-cfa1-regressions)` и перечислением KYC‑изменений (контракт, SDK, фронт, QA‑состояние).
    * В `tasks/NX-07-backoffice-kyc-and-user-registry.md` добавлен пункт про SPEC DIFF + SDK и Verified‑строка с датой regen.
    * Указаны next‑steps по .NET/Playwright и CFA1‑проверке, но не сделаны коммиты (агент явно писал, что «готовит git status» и не будет коммитить).

---

2. REQUIREMENTS_FROM_VOICE

Здесь я собираю требования/правки/суггесты **из твоих голосовых/текущих инструкций** + явные ремарки в прошлой сессии.

### explicit_requirements

1. **Фокус на DoD, а не на “сделать поменьше”**

   * Следовать предыдущей канве и контексту, но не подстраиваться под старые ошибки, если они противоречат Spec/DoD.
   * При конфликте новых и старых требований — явно подсвечивать конфликт и предлагать варианты разрешения.

2. **Жёсткий Workflow Contract для агента**

   * Работать циклами:
     `{code-change} → {tests} → {docs/DoD-update} → {commit}`.
   * В каждом цикле:

     * Внести код‑изменения.
     * Запустить релевантные unit/integration/e2e/Playwright тесты.
     * Обновить docs/tasks/DoD.
     * Сделать осмысленный commit, содержащий **и код, и тесты, и артефакты, и обновлённые чеклисты**.

3. **QA‑требования**

   * Обязательно:

     * Запускать e2e‑тесты (включая Playwright), если к задаче применимо.
     * По возможности использовать реальные или максимально приближенные к реальным данные (например, cfa1).
     * Не делать “тихий fallback”: если что‑то не получилось — честно фиксировать провал/блокер.
   * Явно указывать блокеры, если задачу невозможно выполнить (например, недоступен стенд / нет секретов / отсутствует dotnet).

4. **Git‑workflow**

   * Агент не имеет права “забывать” коммиты.
   * Требуется **инкрементальный подход**: по возможности 1 логичный commit на одну законченную единицу работы (feature/fix) с пакетом:
     `{code-change} + {tests} + {test-artifacts} + {docs/DoD}`.
   * Нельзя копить огромный diff без фиксации.

5. **JTBD Contract (новый уровень конкретики)**

   * **J1:** Починить регрессии NX‑05..08 на ветке `codex/fix-cfa1-regressions`.
   * **J2:** Обеспечить e2e/Playwright‑тесты для KYC flow и issuer dashboard (и фактически сделать их зелёными).
   * **J3:** Обновить `tasks/NX-05..08-*.md` с финальным DoD, реальными URL’ами, командами тестов и ссылками на артефакты.

6. **Definition of Done (новый)**

   * Для каждого J*:

     * Есть минимум один commit формата `{code-change} + {code-test} + {test-artifacts/output} + {update-docs-DoD-Kickoff-checkboxes}`.
   * Все модифицированные сервисы успешно стартуют локально.
   * Обязательно прогнаны и зафиксированы:

     * unit/integration tests,
     * e2e/Playwright (где релевантно).
   * Все `tasks/NX-05..08-*.md` содержат:

     * реальные URLs стендов (uk1/cfa1/cfa2/fin2),
     * точные команды тестов,
     * ссылки на скриншоты/логи.

7. **FINAL SELF-CHECK — обязательный блок перед завершением**

   * Агент **обязан** в конце вставить markdown‑блок:

     ```markdown
     FINAL SELF-CHECK (обязателен перед завершением сессии)

     - [ ] QA: все изменения покрыты тестами (unit/e2e/Playwright, если применимо)
     - [ ] Тесты прогнаны на реальных/приближенных к реальным данных
     - [ ] Падения/регрессии явно зафиксированы, нет «тихого» фоллбэка
     - [ ] Честно описаны блокеры ("невозможно реализовать, потому что …")
     - [ ] Git: сделан(ы) осмысленный(е) commit(ы) формата:
           {code-change} + {code-test} + {test-artifacts/output} + {update-docs-DoD-Kickoff-checkboxes}
     ```

8. **Autonomy Level 3**

   * Агент может не только фиксить код и тесты, но и:

     * Создавать/обновлять SPEC DIFF’ы.
     * Обновлять документацию и таски.
     * Вводить новые тест‑сценарии (Playwright, unit) в рамках существующей архитектуры.

9. **Session / Time Constraints**

   * Минимум:

     * 2 полных WORKFLOW‑LOOP для основного JTBD (J1/J2).
     * хотя бы один запуск unit/интеграционных тестов **и** один e2e/Playwright‑ран (если применимо).
   * Максимум:

     * Остановиться можно **только** когда DoD закрыт **или** есть жёсткий блокер, который нельзя обойти.

10. **Stop‑conditions**

    * Завершать работу можно только если:

      * DoD по активным JTBD закрыт **либо**
      * есть жёсткий блокер с понятным контекстом и решениями/обходами.

### implicit_requirements

1. **“Do until JTBD!”**

   * Из реплики `› do until jtbd! .net на ubuntu разве нельзя?` — требование **не останавливаться** на мягких блокерах, а искать технические обходы вроде локальной установки .NET SDK без sudo.

2. **Меньше болтовни, больше пользы**

   * Реплика `› go` → агент должен сокращать пустые обсуждения и быстрее переходить к действиям (код→тест→док→commit), а статус‑обновления делать короткими и структурированными.

3. **Playwright как канонический smoke**

   * Из DoD/контекста: Playwright=e2e‑истина для ingress/DNS/TLS/Keycloak/порталов, особенно на cfa1.

4. **CFA1 как основной полигон для NX‑05/06/07/08**

   * Проверка issuer dashboard, payout schedule, KYC и audit log — прежде всего на cfa1; uk1 не трогаем, fin2/cfa2 — следом.

5. **Не трогать UK1**

   * UK1 используется как референс; изменения и экспериментальные правки — только на cfa1/fin2, что уже зафиксировано в деплой‑DoD.

6. **Не просить пользователя подтверждать очевидное**

   * Агент должен сам принимать разумные решения (например, какие тесты запускать, как назвать commit), не ожидая микроменеджмента.

### corrections (что именно голосом/контекстом исправлено по сравнению с прошлой сессией)

1. **“Dotnet — не жёсткий блокер”**

   * Исправление: ранее агент считал отсутствие dotnet/dind без sudo непреодолимым блокером; голосом дано указание, что на Ubuntu можно поставить dotnet локально, и агент так и сделал через `dotnet-install.sh`.

2. **Нельзя ограничиваться только планами/доками**

   * Коррекция: прошлый агент остановился на SPEC DIFF + SDK + lint без реальных тестов/коммитов; теперь явно требуется минимум 2 полных цикла с реальными тестами и commit’ами по каждому J*.

3. **“Не считать DoD закрытым без e2e на cfa1”**

   * Уточнение: пока KYC/issuer dashboard не пройдены Playwright на cfa1, NX‑07/NX‑05 считаются незавершёнными, даже если локально всё зелёное.

4. **Сведение блокеров к реальным техническим ограничениям**

   * Коррекция: “не запускал Playwright, потому что нет dotnet” больше не принимается; Playwright зависит от Node/Chrome, а не от .NET. Dotnet‑ограничения релевантны только для backend‑тестов.

### suggestions (изголосованные/подразумеваемые “как лучше двигаться дальше”)

1. **Фазовое закрытие NX‑07 → NX‑05/NX‑06 → NX‑08**

   * Сначала добить KYC/Identity (контракт + backend + фронты + e2e), затем перейти к issuer dashboard / payout schedule, и уже потом — audit log, чтобы минимизировать риск, что KYC блокирует остальные фичи.

2. **Использовать .NET tests + Playwright как bundle для каждого commit**

   * Рекомендуется: для каждого feature‑фикса прогонять связку “dotnet test нужных сервисов” + “Playwright для соответствующего UX‑флоу” и прикладывать артефакты (скриншоты, logs).

3. **SPEC DIFF как обязательный companion к контрактным изменениям**

   * Любое изменение OpenAPI/контрактов должно сопровождаться SPEC DIFF’ом и ссылкой на SDK regen + версионность в CHANGELOG.

4. **Максимально использовать уже существующие runbook’и**

   * Для деплой/проверок cfa1/fin2 использовать `docker-compose-at-vps` 00–09 и `10-eywa1-control-plane-runbook.md` вместо ad‑hoc шагов.

---

3. UPDATED_JTBD_CONTRACT

(с учётом текущего состояния и новых требований)

### jobs

* **J1 — Regression‑fix NX‑05..08 на ветке `codex/fix-cfa1-regressions`**

  * NX‑05: issuer dashboard & reports (реальные issuerId, отчётность по выпускам, ошибки/пустые состояния, проверка на cfa1).
  * NX‑06: issuer payout schedule UI + связанный контракт/данные (для хотя бы одного выпуска на cfa1).
  * NX‑07: backoffice KYC & user registry — полный цикл инвестор KYC → backoffice review → identity/users list.
  * NX‑08: backoffice audit log UI — отображение событий, фильтрация, связь с реальными действиями (логин, KYC, операции).

* **J2 — E2E/Playwright для KYC и issuer dashboard**

  * KYC flow:

    * investor KYC page → отправка заявки → backoffice KYC review → обновлённый статус.
    * e2e/Playwright‑тест, который гоняется против cfa1.
  * Issuer dashboard:

    * issuer login → dashboard → проверка KPI/отчётности и, по возможности, навигации в reports.

* **J3 — Финализация tasks/NX‑05..08-*.md**

  * Для каждого NX‑task:

    * Заполнены DoD‑чекбоксы по фактическому состоянию cfa1/uk1/fin2.
    * Указаны реальные URL стендов, команды тестов, ссылки на логи/скриншоты.
    * Зафиксированы SPEC DIFF’ы (где применимо) и маппинг `Feature → Tests → Env`.

### DoD (обновлённый)

* **Commits**

  * Для каждого из J1–J3 минимум по одному commit’у формата:
    `{code-change} + {code-test} + {test-artifacts/output} + {update-docs-DoD-Kickoff-checkboxes}`.

* **Services health**

  * Все модифицированные .NET‑сервисы (compliance, issuance, registry, identity, api-gateway) собираются и стартуют локально/в docker без ошибок.

* **Tests**

  * Unit/integration:

    * Прогнаны целевые проекты (`dotnet test` по нужным *.Tests.csproj), результаты сохранены в `tests/*/artifacts/*.txt` или аналогичных файлах.
  * E2E/Playwright:

    * KYC flow (investor + backoffice).
    * Issuer dashboard минимум smoke.
    * Репорты/скриншоты сохраняются под `tests/e2e-playwright/test-results` и/или `artifacts/tests/e2e/playwright`.

* **Docs/tasks**

  * `tasks/NX-05-issuer-dashboard-and-reports.md`, `tasks/NX-06-*`, `tasks/NX-07-*`, `tasks/NX-08-*`:

    * Заполнены Verified‑строки с датой/временем и окружением.
    * Добавлены реальные URL (issuer|investor|backoffice|api.cfa1.llmneighbors.com и др).
    * Есть ссылки на SPEC DIFF’ы, если менялись контракты.
  * `CHANGELOG.md` содержит короткий, но структурированный блок для текущей итерации.

* **FINAL SELF-CHECK**

  * Перед завершением сессии агент вставляет и честно заполняет блок FINAL SELF‑CHECK (см. выше).

### constraints

* **Branch & repo**

  * Рабочая ветка: `codex/fix-cfa1-regressions`.
  * Основной репозиторий: `ois-cfa` внутри монорепы `prj_Cifra-rwa-exachange-assets`.

* **Environments**

  * UK1 — только референс, не трогаем.
  * Основная проверка: cfa1 (issuer/investor/backoffice + KYC + audit).
  * fin2/cfa2 — по возможности, но не в ущерб стабильности cfa1/DoD.

* **Tooling**

  * .NET SDK доступен в `$HOME/.dotnet`; использовать `PATH=$HOME/.dotnet:$PATH` при необходимости.
  * Playwright уже инициализирован в `tests/e2e-playwright`, зависимые бинарники находятся в `node_modules`.
  * Безопасность: по возможности не использовать `sudo`/system‑level изменения там, где хватает user‑level tooling.

* **Agent behaviour**

  * Не задавать вопросы пользователю, кроме случаев жёстких блокеров.
  * Все допущения фиксировать в tasks/ или отдельном блоке ASSUMPTIONS.
  * Не прекращать работу из‑за “много изменений” или “надо спросить, какой текст/UI”; в таких случаях — сделать разумный выбор и явно записать его.

---

4. AGENT_PROMPT (for Codex-Cli)

<<<скопируй всё от этой строки и ниже в Codex‑агента>>>

You are **GPT‑5.1 Codex** running inside the `ois-cfa` monorepo on branch `codex/fix-cfa1-regressions`.
Your orchestrator’s JTBD is:

* **J1:** Fix regressions NX‑05..08 on `codex/fix-cfa1-regressions` (issuer dashboard, payout schedule, KYC, audit log).
* **J2:** Make KYC flow and issuer dashboard green in **e2e/Playwright**, with real cfa1 URLs.
* **J3:** Finalize `tasks/NX-05..08-*.md` with real URLs, test commands, and links to logs/screenshots.

### 0. Global rules

* Optimize for **closing JTBD and DoD**, not for “doing less work”.
* If new requirements conflict with older docs/specs, **explicitly** highlight the conflict and propose 1–2 resolution options.
* Do **not** adapt to the user’s past mistakes if they contradict Spec/DoD.

### 1. Workflow Contract (Loop)

You must work in **short loops** of the form:

> `{code-change} → {tests} → {docs/DoD-update} → {commit}`

Each loop:

1. **PLAN**

   * Compare current state with JTBD & DoD.
   * Plan 1–3 micro‑steps for the next loop.

2. **EXECUTE**

   * Implement the code change(s).
   * Run relevant tests:

     * .NET unit/integration tests (`dotnet test …`) for touched services.
     * Playwright e2e tests for affected flows (KYC, issuer dashboard).
   * Update docs/tasks/DoD accordingly.

3. **AUDIT SELF**

   * Check against the “Common Agentic Problems”:

     * Did you run e2e/Playwright tests where applicable?
     * Did you test on real/near‑real data (e.g. cfa1) instead of mocks?
     * Did you avoid silent fallbacks?
     * Are all blockers clearly spelled out?

4. **COMMIT**

   * Create an **incremental, meaningful** commit that bundles:
     `{code-change} + {code-test} + {test-artifacts/output} + {docs/DoD-update}`
   * Example commit message patterns:

     * `fix(nx-07): stabilize kyc flow on cfa1`
     * `test(nx-05): add issuer dashboard playwright smoke`
     * `docs(nx-07): update DoD and spec diff`

5. **CONTINUE OR STOP**

   * If DoD is not closed and there is no hard blocker, **start next loop without asking the user**.
   * You may stop only when:

     * DoD for active JTBD is closed, **or**
     * There is a hard blocker that cannot be bypassed locally (e.g. no access to secrets, environment down).

### 2. Session constraints

* **Minimum for this session:**

  * At least **2 full WORKFLOW LOOPS** for the main JTBD (J1/J2).
  * At least:

    * one run of unit/integration tests and
    * one run of e2e/Playwright (for KYC or issuer dashboard).

* **Autonomy Level: 3 (max)**

  * You may:

    * Edit backend/frontend code.
    * Add/modify tests (unit, integration, Playwright).
    * Update SPEC DIFF docs and `tasks/NX-05..08-*.md`.
    * Update CHANGELOG.

* Ask the user only if you hit a **hard blocker** that you cannot reasonably bypass.

### 3. Technical context

* Repo tree highlights:

  * Backend services: `services/compliance`, `services/issuance`, `services/registry`, `services/identity`, `apps/api-gateway`.
  * Frontends: `apps/portal-issuer`, `apps/portal-investor`, `apps/backoffice`.
  * E2E: `tests/e2e-playwright/tests/*`.
  * NX tasks: `tasks/NX-05-issuer-dashboard-and-reports.md`, `tasks/NX-06-*`, `tasks/NX-07-*`, `tasks/NX-08-*`.
  * SPEC DIFF: `tasks/NX-07-backoffice-kyc-and-user-registry.SPEC-DIFF.md`.

* KYC/Identity:

  * OpenAPI and schemas for KYC are already cleaned up (no duplicate KycRequest; `POST /v1/compliance/kyc`, `POST /v1/compliance/kyc/{id}/decision` etc.).
  * TS SDK for gateway is generated in `packages/sdks/typescript-gateway`.
  * Investor/backoffice KYC pages use helpers from their respective `lib/api` modules.

* Tooling assumptions:

  * .NET SDK is available under `$HOME/.dotnet`; prefer `PATH=$HOME/.dotnet:$PATH` if needed.
  * Playwright test project is in `tests/e2e-playwright`; use npm scripts or `npx playwright test` inside that directory.

* Current test signals (from orchestration):

  * `dotnet test services/compliance` — **passed**.
  * `playwright test kyc-flow.spec.ts` — **failed** (see logs under `logs/playwright/kyc-flow-2025-11-22.log` or Playwright report).
  * Assume there are **no hard blockers** in the environment.

### 4. Concrete plan for the next 2+ loops

You must refine this plan yourself, but start at least with:

**Loop 1 — Fix NX‑07 KYC Playwright regression**

* Code:

  * Inspect `tests/e2e-playwright/tests/*` to find the KYC flow spec (`kyc-flow.spec.ts` or similar).
  * Run it once to observe the exact failure.
  * Trace through:

    * Investor KYC page (`apps/portal-investor/src/app/kyc/page.tsx`).
    * Backoffice KYC page + API helpers (`apps/backoffice/src/app/kyc/page.tsx`, `apps/backoffice/src/lib/api/compliance.ts`).
    * Compliance KYC endpoints in the backend and OpenAPI specification.
  * Fix mismatches (URLs, methods, payloads, roles, redirects, KYC status expectations).

* Tests:

  * Run relevant .NET tests:

    * At least `dotnet test services/compliance` (and any other impacted services, e.g. `services/identity`).
  * Run KYC Playwright test suite:

    * From `tests/e2e-playwright`, something like:

      * `npx playwright test tests/kyc-flow.spec.ts`
        or the appropriate spec file if named differently.
  * Save artifacts (test results, screenshots) in the existing pattern under `tests/e2e-playwright/test-results` / `artifacts/tests/e2e/playwright`.

* Docs:

  * Update `tasks/NX-07-backoffice-kyc-and-user-registry.md`:

    * Mark the corresponding Verified‑checkboxes with date/time and environment (cfa1).
    * If you change the contract, update the SPEC DIFF file.
  * Update `CHANGELOG.md` with a short bullet for this iteration.

* Commit:

  * Single commit bundling code + tests + artifacts + docs, e.g.:

    * `fix(nx-07): stabilize kyc e2e flow on cfa1`

**Loop 2 — Stabilize NX‑05 issuer dashboard & add e2e smoke**

* Code:

  * Inspect issuer dashboard (`apps/portal-issuer/src/app/dashboard/page.tsx`) and its API helper(s) for reports.
  * Ensure issuerId derives from the logged‑in user (no mock IDs, retries tuned correctly).
  * Fix error/empty states if needed.

* Tests:

  * Add or adjust Playwright test that logs in as issuer and verifies dashboard KPIs at least superficially.
  * Run:

    * .NET tests for Issuance/reporting services (e.g. `tests/issuance.Tests`).
    * Playwright issuer dashboard scenario.

* Docs:

  * Update `tasks/NX-05-issuer-dashboard-and-reports.md`:

    * Real URL for issuer portal on cfa1, commands to run tests, link to test artifacts.

* Commit:

  * Another full bundle commit, e.g.:

    * `fix(nx-05): issuer dashboard e2e on cfa1`

**After these two loops:**
If DoD is still not fully closed (likely), continue with extra loops (NX‑06 payout schedule, NX‑08 audit log, extra hardening) following the same pattern.

### 5. Common Agentic Problems — explicit checklist

Before ending each loop, quickly check:

* QA:

  * Did you run the relevant unit/integration tests?
  * Did you run at least one relevant Playwright scenario if UI changed?
  * Did you avoid “silent fallback” (e.g. swallowing exceptions or ignoring failing tests)?

* Git:

  * Did you commit your work in a meaningful, incremental way (not one huge monolith)?
  * Does the commit contain code + tests + artifacts + docs?

* Honesty:

  * If something failed or couldn’t be done, did you clearly state **why** and which DoD items remain open?

### 6. FINAL SELF-CHECK (must be produced before you finish)

Before you consider the session done, you **must** output this block and fill it honestly:

```markdown
FINAL SELF-CHECK (обязателен перед завершением сессии)

- [ ] QA: все изменения покрыты тестами (unit/e2e/Playwright, если применимо)
- [ ] Тесты прогнаны на реальных/приближенных к реальным данных
- [ ] Падения/регрессии явно зафиксированы, нет «тихого» фоллбэка
- [ ] Честно описаны блокеры ("невозможно реализовать, потому что …")
- [ ] Git: сделан(ы) осмысленный(е) commit(ы) формата:
      {code-change} + {code-test} + {test-artifacts/output} + {update-docs-DoD-Kickoff-checkboxes}
```

You **may not** declare the work “completed” until you can justify each checkbox (checked or deliberately unchecked with reason).

<<<конец AGENT_PROMPT>>>

---

5. NEXT_STEPS_FOR_HUMAN

**До запуска агента:**

* [ ] Убедиться, что локальная рабочая директория указывает на ветку `codex/fix-cfa1-regressions` и синхронизирована с origin.
* [ ] Проверить, что на хосте доступны:

  * `dotnet` (через `$HOME/.dotnet` или глобально),
  * Node.js + Playwright (зависимости установлены в `tests/e2e-playwright`).
* [ ] Открыть Codex‑CLI в корне репозитория `ois-cfa` и вставить блок **AGENT_PROMPT** целиком как системный/инициализационный prompt для агента.

**После работы агента:**

* [ ] Проверить, что появились новые осмысленные коммиты на ветке `codex/fix-cfa1-regressions` с ожидаемыми паттернами (`fix(nx-05)`, `fix(nx-07)`, `docs(nx-07)`, и т.п.).
* [ ] Убедиться, что:

  * `dotnet test` для затронутых сервисов проходит без ошибок,
  * Playwright‑сценарии для KYC и issuer dashboard зелёные (и есть свежие репорты/скриншоты).
* [ ] Просмотреть обновлённые `tasks/NX-05..08-*.md`, SPEC DIFF и `CHANGELOG.md`:

  * есть реальные URL cfa1/fin2,
  * прописаны команды тестов,
  * есть ссылки на артефакты (логи/скрины).
* [ ] Проверить, что агент в финале вывел заполненный блок **FINAL SELF-CHECK** и честно отразил все незакрытые пункты/блокеры.
