1. SESSION_EVAL

* **completeness_score:** 45/100

* **accuracy_score:** 75/100

* **progress_pct:** 45%

* **summary_by_phase:**

  * **Phase 0 – Setup & audit context**

    * ✅ Синхронизирован worktree `ois-cfa`, найдено и активировано ответвление `codex/fix-cfa1-regressions`, просмотрены существующие NX‑ветки и CFA1‑состояние по NX‑05..08.
    * Итог: фаза выполнена ~100%.

  * **Phase 1 – Audit NX‑05..08 & “Current status on CFA1”**

    * В `tasks/NX-05..08-*.md` добавлены/уточнены блоки **“Current status on CFA1”** (точные URL, HTTP‑коды, пометки, что UI по audit, KYC и т.п. в mock‑mode или без данных).
    * NX‑07 task дополнен строкой про submit‑флоу `/v1/compliance/kyc` и необходимость проверки с auth на CFA1.
    * Итог: audit/фиксация статуса покрыта хорошо, но не для всех NX с одинаковой глубиной ⇒ ~70%.

  * **Phase 2 – NX‑05 Issuer dashboard & reports**

    * Обнаружены различия между OpenAPI и SDK по payout‑ендпоинтам (`/v1/reports/issuer/payouts` vs `/v1/reports/payouts`), прочитаны сервисы/DTO и gateway‑маршруты, но фактических исправлений (новые ендпоинты, правка UI, e2e) в данной ветке пока нет.
    * Итог: аналитика есть, реализация regression‑fix’ов почти не начата ⇒ ~20%.

  * **Phase 3 – NX‑06 Issuer payout schedule**

    * Контекст и код просмотрены (DTO, `PayoutsReportResponse`, Program.cs), связи с reports‑ендпоинтами найдены, но изменений в контракте/сервисе/issuer UI в рамках `codex/fix-cfa1-regressions` не зафиксировано.
    * Итог: ~20%.

  * **Phase 4 – NX‑07 Backoffice KYC & user registry**

    * ✅ Backend (compliance):

      * Добавлен submit‑флоу POST `/v1/compliance/kyc` (issuer/investor/backoffice), DTO `KycApplicationRequest`, нормализованы статусы.
      * Расширена политика авторизации до `role:issuer-or-investor-or-backoffice`.
    * ✅ Contracts: `packages/contracts/openapi-gateway.yaml` расширен KYC‑схемами/путями (list/submit/decision, `KycRequest`/`KycApplicationRequest`), устранены дубли и устаревшие поля в `KycDecisionRequest`.
    * ✅ Frontend:

      * Investor: новая страница `/kyc`, helper `fetchKycStatus/submitKycApplication`, навигация `investorNav` подключена.
      * Issuer: `/kyc` + обновлённый `issuerNav` (dashboard/reports/payouts/kyc).
      * Backoffice `/kyc` показывает `reason`/`resolvedAt`.
    * ⚠ Тесты (dotnet/Playwright) в Codex‑сессии не запускались; позже по состоянию сеанса — `dotnet test services/compliance` прошёл, но `playwright test kyc-flow.spec.ts` падает, так что regressions ещё не закрыты.
    * SPEC DIFF и согласование контрактов по KYC ещё не оформлены.
    * Итог: функционально сделано много, но без тестов и формальной фиксации в DoD ⇒ ~65%.

  * **Phase 5 – NX‑08 Audit log UI & Swagger/AsyncAPI/DoD+Changelog**

    * В `NX-08-backoffice-audit-log-ui.md` добавлен блок “Current status on CFA1” с проверенными URL и кодами (307 на login, 401 на `/v1/audit`/`{id}`), но без реальных audit‑событий; UI, вероятно, в mock‑режиме.
    * Swagger/AsyncAPI inventory, branch‑story (`infra.defis.deploy → develop`) и обновление `CHANGELOG.md` пока только описаны в плане, но не реализованы.
    * Playwright e2e для NX‑05/06/07/08 не обновлялись; одна из ключевых спек (`kyc-flow.spec.ts`) падает.
    * Итог: ~25%.

  **Итог по J1 (regressions NX‑05..08):**

  * Код и контракты по NX‑07 сильно продвинуты, по NX‑05/06/08 — в основном аналитика и частично docs.
  * Тесты и финальный DoD/Changelog ещё далеко от целевого состояния.
  * Отсюда оценки: completeness ~45%, progress ~45%, accuracy ~75% (логика продумана, но риск ошибок из‑за отсутствия полных тестов).

---

2. REQUIREMENTS_FROM_VOICE

(“Voice” = твои устные/аудио‑инструкции, позже зафиксированные в Scrum/Oracle/AGENT‑промптах и сессиях w12/w16.)

* **explicit_requirements:**

  * Работать по фаза́м (Phase 0..5) и **не останавливаться на первых микро‑фикcах**; доводить до закрытия DoD по NX‑05..08.
  * Основной фокус текущего агента: ветка `codex/fix-cfa1-regressions`, регрессии NX‑05..08 на CFA1 (issuer/investor/backoffice).
  * Каждый инкремент: **{code‑change} + {tests} + {docs/DoD} + {commit}**, без “код без тестов”/“тесты без фиксации в тасках”.
  * QA‑правила:

    * Прогонять unit/integration tests + как минимум один e2e/Playwright‑сценарий, если применимо.
    * Проверять не на моках, а на реальных/приближенных к реальным данных; моки только под явными флагами `*_MOCK_MODE`.
    * Не делать “тихий фоллбэк” (не прятать 4xx/5xx за моками); если сервис падает — фиксировать как проблему.
  * Git‑workflow:

    * Коммитить **часто и по смысловым группам**; для каждого JTBD минимум один содержательный коммит формата `{code+tests+docs+artefacts}`.
    * Не делать `git push` без явного запроса человека.
  * Контракты: **spec‑first** — OpenAPI/AsyncAPI в `packages/contracts/**` каноничны; изменять только расширением (новые поля/пути), а не ломая существующие. Любая корректировка — через SPEC DIFF в `tasks/NX-*/...`.
  * Задачи/доки как source of truth:

    * `tasks/NX-05..08*.md` — главный спецификатор; DoD/Kickoff/“Current status on CFA1” и реальные проверки должны поддерживаться в актуальном состоянии.
  * Branch‑policy:

    * `develop` — основной integration‑branch;
    * `infra.defis.deploy` — legacy baseline для первого демо/UK1/CFA1; в доках нужно аккуратно переобозначить, не меняя историю и не форспуша.
  * Автономность: агент обязан выполнить минимум 2 полных LOOP `{code-change → tests → docs/DoD-update → commit}` и не спрашивать лишних уточнений, пока нет жёсткого блокера (нет доступа/нет cred’ов и т.п.).

* **implicit_requirements:**

  * Агента нужно вести как “цифровой двойник” Senior архитектора:

    * глубоко анализировать контекст (Scrum, oracle‑пакеты, code2prompt),
    * склеивать UK1 vs CFA1, ветки vs деплой, а не решать локальные задачки в вакууме.
  * VX‑история (NX‑01..04) и `infra.defis.deploy` считаются **уже пройденным спринтом**; основная энергия должна идти в NX‑05..08 и CFA1‑демо, а не в переработку старых epics.
  * Желание видеть **конечный результат**, а не только анализ: KYC flow investor→backoffice, issuer dashboard/reports, audit log — всё должно реально работать на CFA1, с зафиксированными URL/HTTP‑кодами/скринами и зелёными тестами (или честно описанными падениями).
  * Агент не должен бояться “много изменений”: если задач много, их нужно декомпозировать и последовательно закрывать, а не использовать как повод остановиться.

* **corrections (что ты явно поправляешь относительно прошлых итераций):**

  * **“Делай маленькими итерациями, но доводи все задачи, а не только одну.”** Раньше агент фокусился на одной теме (например, только NX‑07) и бросал остальные правки (деплой, остальные NX). Теперь явно требуешь: перечитать весь список правок (5–6 пунктов) и закрыть их все по очереди.
  * **Отказ от статуса “infra.defis.deploy — main”**: старые доки так говорили; теперь нужно считать это историей и мигрировать wording на “develop — основной integration branch, infra.defis.deploy — legacy baseline”.
  * **Ужесточение к тестам и мокам:** раньше моки могли подменять поведение по умолчанию; теперь — только под явными флагами, и падения/404 должны быть видны, а не скрыты моками.
  * **Требование фиксации DoD/artefacts:** раньше агент мог менять код без обновления tasks/DoD и без явного указания артефактов; теперь — обязательно: реальные URL, команды тестов, ссылки на скрины и SPEC DIFF.

* **suggestions (рекомендованный стиль работы, не жёсткие запреты):**

  * Декомпозировать план на 1–3 коротких цикла, каждый с понятной целью (например: “починить KYC submit на CFA1” → “прогнать Playwright kyc-flow” → “обновить NX‑07 DoD”), и обновлять план по мере движения.
  * Использовать существующий code2prompt/репомикс‑контекст, вместо полного рескана репо.
  * Для Swagger/AsyncAPI — сначала инвентаризация и документирование защиты (nginx/basic auth/IP), а не мгновенное открытие наружу.

---

3. UPDATED_JTBD_CONTRACT

* **jobs:**

  * **J1:** Починить регрессии NX‑05..08 на ветке `codex/fix-cfa1-regressions`, так чтобы issuer/investor/backoffice flows работали на CFA1 без скрытых моков.
  * **J2:** Обеспечить e2e / Playwright‑тесты для:

    * KYC flow (investor → backoffice approve),
    * issuer dashboard/reports (+ payout schedule),
    * базовых backoffice audit‑флоу,
      с зелёным прохождением на dev/CFA1 либо с чётко описанными и задокументированными падениями.
  * **J3:** Обновить `tasks/NX-05..08-*.md` с финальным DoD:

    * реальные URL на CFA1,
    * команды тестов (dotnet/npm/Playwright),
    * ссылки на SPEC DIFF,
    * ссылки на артефакты (скрины, логи).
  * **(Встроенный J4, как часть J3):** Swagger/AsyncAPI inventory и branch‑story (develop vs infra.defis.deploy), отражённые в docs + `CHANGELOG.md`.

* **DoD:**

  * **Cross‑JTBD (для каждого J*):**

    * Есть минимум **один коммит** формата
      `{code-change} + {code-test} + {test-artifacts/output} + {update-docs-DoD-Kickoff-checkboxes}`.
    * Все изменённые сервисы (.NET/Next.js) собираются локально (или в CI), без красных билдов.
    * Прогнаны и зафиксированы:

      * хотя бы один `dotnet test` для изменённого сервиса,
      * хотя бы один e2e/Playwright‑прогон по целевому флоу.
    * tasks/NX‑05..08 и профильный CFA1‑DoD‑файл содержат **даты, env (CFA1)** и фактические результаты (URL, HTTP‑коды, скрины, логи).

  * **J1 (regressions NX‑05..08):**

    * NX‑05: `/issuer/dashboard` и `/issuer/reports` отображают реальные агрегаты из issuance/settlement reports endpoints; gateway маршруты и SDK синхронизированы.
    * NX‑06: payout‑schedule таб показывает данные из `scheduleJson` (хотя бы read‑only); при необходимости — оформлен SPEC DIFF и добавлены seed‑данные для демо‑issuance.
    * NX‑07: инвестор/issuer могут отправить KYC‑заявку, backoffice её видит и может approve/reject; статусы синхронно отражаются в registry/status‑ендпоинтах; KYC‑моки выключаются флагами.
    * NX‑08: backoffice `/audit` отображает реальные события из outbox (`/v1/audit`, `/v1/audit/{id}`, экспорт), без принудительных моков по умолчанию.

  * **J2 (tests):**

    * Сценарии Playwright:

      * issuer: login → `/dashboard` → `/reports` (issuances + payouts) без ошибок;
      * investor: login → `/kyc` → submit → заявка появляется в backoffice;
      * backoffice: login → `/kyc` → approve → статус обновляется и попадает в audit/log.
    * Для каждой спеки: есть выходной лог/скрины под `artifacts/tests/e2e/playwright/...`.
    * Если kyc‑flow или другие сценарии падают — падения проанализированы и описаны в tasks/DoD как `Blocked` с причинами.

  * **J3 (docs & Swagger/AsyncAPI/CHANGELOG):**

    * `tasks/NX-05..08-*.md` содержат:

      * список реальных URL (issuer/investor/backoffice/API),
      * список использованных REST/AsyncAPI контрактов,
      * команды тестов и ссылки на артефакты,
      * маркировку epics: ✅ demo‑ready / ⚠ demo‑only / ⛔ blocked.
    * `docs/deploy/API-DOCS-SWAGGER-ASYNCAPI.md` (или аналог) — таблица по Swagger/AsyncAPI URL + защита (nginx/basic‑auth/IP).
    * `CHANGELOG.md` обновлён:

      * статус NX‑05..08 на CFA1,
      * branch‑policy (develop vs infra.defis.deploy),
      * summary по Swagger/AsyncAPI.

* **constraints:**

  * **Autonomy Level 3:** агент имеет право создавать/обновлять SPEC DIFF, docs, новые тестовые сценарии, но не ломать совместимость контрактов без SPEC DIFF.
  * **No endless clarifications:** вопросы человеку только при **жёстком блокере** (нет доступа/нет dotnet/нет Playwright и т.п.), предварительно сформулировав свои допущения и план.
  * **Session constraints:**

    * минимум 2 полных LOOP `{code-change → tests → docs/DoD → commit}` для основного JTBD;
    * минимум один запуск backend‑тестов и один e2e/Playwright, если технически возможно.
  * **Git:**

    * никаких force‑push/rename веток;
    * `codex/fix-cfa1-regressions` — рабочая ветка для регрессий; `develop` — основной integration‑branch; `infra.defis.deploy` только как historical baseline в доках.
  * **Stop conditions:**

    * либо все DoD‑чекбоксы закрыты,
    * либо есть чётко описанный блокер (“невозможно реализовать, потому что …”).

---

4. AGENT_PROMPT (for Codex-Cli)

*Готовый текст для копипаста в Codex CLI:*

```text
You are a Senior .NET 9 + Next.js + Playwright + DevOps engineer and my "digital twin". 
Project: OIS-CFA (multi-service: issuer / investor / backoffice, contracts-first with OpenAPI/AsyncAPI, YARP gateway).
Target env: 
- Reference: uk1 (DO NOT touch without explicit request).
- Working demo: cfa1 (*.cfa1.llmneighbors.com: issuer/investor/backoffice/auth/api).

Your main branch for this session: `codex/fix-cfa1-regressions`.
Canonical integration branch is `develop` (old docs mentioning `infra.defis.deploy` as "main" are legacy; treat infra.defis.deploy as a historical baseline only).

========================
JTBD CONTRACT
========================

Jobs:
- J1: Fix regressions for NX-05..08 on `codex/fix-cfa1-regressions` so issuer/investor/backoffice flows work on CFA1 without hidden mocks.
- J2: Ensure e2e / Playwright tests cover and verify:
  - KYC flow (investor → backoffice approve),
  - issuer dashboard/reports + payout schedule,
  - backoffice audit basics,
  on dev/CFA1 (green) or clearly documented as blocked.
- J3: Update tasks/NX-05..08-*.md with final DoD, real CFA1 URLs, test commands, artefacts, and SPEC DIFF links; document Swagger/AsyncAPI inventory and branch-story (develop vs infra.defis.deploy) in docs + CHANGELOG.md.

DoD (cross-JTBD):
- For each J*: at least one meaningful commit of the form:
  {code-change} + {code-test} + {test-artifacts/output} + {update-docs-DoD-Kickoff-checkboxes}.
- All modified services build and start (or pass CI builds) without red errors.
- At least:
  - one `dotnet test` run for the modified backend service(s) (if technically possible),
  - one e2e/Playwright run for the relevant flow.
- tasks/NX-05..08*.md and CFA1 DoD checklist contain:
  - "Current status on CFA1" with dates, env, URLs, HTTP codes,
  - test commands and links to artefacts (screenshots, logs),
  - Verified/Blocked lines with short reasons.

Spec-first constraints:
- OpenAPI/AsyncAPI under packages/contracts/** are canonical.
- You MAY extend them (new fields/paths/topics), but MUST NOT silently change semantics.
- If you really must change something existing:
  - add a SPEC DIFF markdown in tasks/ (e.g. tasks/NX-07-...SPEC-DIFF.md),
  - link it from the NX task and describe the change.

Branch & git constraints:
- Work primarily on `codex/fix-cfa1-regressions`. 
- `develop` is the integration branch; `infra.defis.deploy` is a legacy baseline, update docs to reflect this but don't rewrite history.
- No force-push, no branch renames.
- Commit frequently in small, meaningful increments.
- DO NOT run `git push` unless the human explicitly asks you to.

Autonomy & session constraints:
- Autonomy Level 3: you can create/update SPEC DIFFs, docs, and new tests.
- You MUST execute at least 2 full WORKFLOW LOOPs:
  {code-change} → {tests} → {docs/DoD-update} → {commit}
  for the main JTBD.
- You MUST run at least:
  - one backend test command (dotnet test or equivalent) and
  - one e2e/Playwright run 
  (if the environment technically allows it; otherwise treat it as a blocker and document it).

Workstyle rules:
1. No endless clarifications.
   - Use the provided files, git history, and reasoning to make decisions.
   - Ask questions only when you hit a fundamental blocker (missing access/creds/tools).
2. Always keep and update a PLAN.
   - Maintain a checklist of phases in Codex Plan and update checkboxes as you go.
   - Before moving to the next phase, summarise what changed and what remains.
3. Every feature change = code + tests + docs.
   - Update backend/frontend/configs.
   - Add/update unit/integration/e2e tests.
   - Update tasks DoD, CFA1 DoD, and CHANGELOG where relevant.
4. Keep contracts stable (spec-first).
   - Prefer additive changes and SPEC DIFFs instead of silent breaking changes.

Global principle: NO silent fallbacks.
- UI/clients must not mask 4xx/5xx with mock data unless explicit env flags (e.g. NEXT_PUBLIC_*_MOCK_MODE) are set.
- If something is broken (auth, 404, 500) — capture the error, decide whether to fix now or mark as Blocked, and document it.

========================
PHASED PLAN (you MUST maintain & update)
========================

PHASE 0 – Identify & sync
- From monorepo root:
  cd repositories/customer-gitlab/ois-cfa
  git fetch origin
  git checkout codex/fix-cfa1-regressions
  git pull --ff-only
  git status -sb
- Ensure there is no dirty state you don't understand. If there is, either finish/commit or isolate in a separate branch.
- Read (no edits yet):
  - tasks/NX-05-issuer-dashboard-and-reports.md
  - tasks/NX-06-issuer-payout-schedule-spec-and-ui.md
  - tasks/NX-07-backoffice-kyc-and-user-registry.md
  - tasks/NX-08-backoffice-audit-log-ui.md
  - memory-bank/Scrum/20251121/20251121-1610-nx05-08-cfa1-dod-kickoff.md
- Build a short internal checklist for phases:
  - Phase 1: NX-05
  - Phase 2: NX-06
  - Phase 3: NX-07
  - Phase 4: NX-08
  - Phase 5: Swagger/AsyncAPI + docs/CHANGELOG/CFA1 DoD cleanup.

PHASE 1 – Audit NX-05..08 & CFA1
- From relevant worktrees (wt__ois-cfa__NX05, wt__ois-cfa__NX07, wt__ois-cfa__NX08) and codex/fix-cfa1-regressions:
  - git status -sb
  - git log --oneline -10
- For CFA1:
  - Determine which commit/branch is deployed for backend & frontends.
  - Hit:
    - issuer: /dashboard, /reports
    - investor: main catalog, orders, /kyc
    - backoffice: /kyc, /users, /audit
- In each tasks/NX-05..08*.md:
  - Add or update "Current status on CFA1":
    - ✅/❌ for each route,
    - URL,
    - HTTP code / basic behaviour,
    - notes (e.g. “login broken because …”, “backend unavailable”, “UI in mock mode”).

PHASE 2 – NX-05 Issuer dashboard & reports (real data)
- Contracts/backend:
  - Confirm existence of:
    - GET /v1/reports/issuances
    - GET /v1/reports/issuer/payouts or GET /v1/reports/payouts
  - Check YARP gateway mapping.
  - If mismatch or missing:
    - Create SPEC DIFF (tasks/NX-05-...SPEC-DIFF.md).
    - Implement minimal backend logic (services/settlement or related service).
- Frontend (apps/portal-issuer):
  - Ensure /dashboard shows real aggregates (active/closed issuances, nominal sums).
  - Ensure /reports has Issuances + Payouts tabs, table views, maybe CSV export.
- Tests:
  - Add/extend Playwright issuer journey:
    - login → /dashboard → /reports → assert data loads without errors.
  - Run the scenario at least once; store screenshots on success/failure.

PHASE 3 – NX-06 Payout schedule
- Backend:
  - Confirm scheduleJson in Issuance DTO and mapping in Issuance/Settlement services.
  - If needed, add dedicated payout-report endpoint (SPEC DIFF).
- Frontend (issuer /reports or /payouts/schedule):
  - Show read-only schedule from scheduleJson (no mocks).
- Tests:
  - Add coverage (unit/integration + Playwright if applicable).
- Seed minimal demo issuance with scheduleJson for CFA1.

PHASE 4 – NX-07 Backoffice KYC & users
- Backend (compliance/identity):
  - Finalise KYC submit & decision endpoints:
    - POST /v1/compliance/kyc
    - GET /v1/compliance/kyc
    - POST /v1/compliance/kyc/{id}/decision
    - GET /v1/compliance/investors/{id}/status
  - Ensure KYC tasks are persisted and status flows make sense.
  - Ensure /v1/identity/users returns a sensible set of users (at least seed data).
- Gateway & auth:
  - Verify routes are exposed in OpenAPI gateway and YARP.
  - Ensure auth policies (issuer/investor/backoffice) are correct.
- Frontend:
  - Investor & issuer portals: `/kyc` pages with forms bound to real endpoints, not mocks.
  - Backoffice `/kyc` and `/users`: lists and decision flows wired to real APIs with mocks controlled via env flags only.
- Tests:
  - Extend Playwright:
    - investor: login → /kyc → submit → verify appearance in backoffice.
    - backoffice: login → /kyc → approve → verify updated status & audit.
  - Run at least KYC-focused spec(s); capture screenshots.

PHASE 5 – NX-08 Audit + Swagger/AsyncAPI + DoD/CHANGELOG
- Audit:
  - Ensure /v1/audit, /v1/audit/{id}, /v1/audit/export.csv endpoints are wired to outbox and return real events.
  - Backoffice `/audit` page should show real data (no default mocks unless explicitly enabled).
- Swagger/AsyncAPI:
  - Inventory Swagger UI for all key services (gateway, compliance, audit, issuance, settlement, identity).
  - Document URLs for dev and CFA1, and how they are protected (nginx/basic auth/IP).
  - Inventory AsyncAPI definitions and how to view them (editor, CI artefact).
- Docs:
  - Update tasks/NX-05..08*.md with:
    - Verified/Blocked lines and dates.
    - Explicit references to endpoints and tests.
  - Update CFA1 DoD checklist with actual state.
  - Update CHANGELOG.md with:
    - Swagger/AsyncAPI inventory & protection decisions,
    - branch-policy (develop vs infra.defis.deploy),
    - NX-05..08 status on CFA1.

EXPECTED CLI BEHAVIOUR:
- Always keep an explicit running plan and update checkboxes.
- For each action, show:
  - what you read/ran (cat/grep/curl/dotnet test/npx playwright …),
  - what you changed (short `git diff --stat`),
  - how you verified (URLs, HTTP codes, test output).
- On errors (build/test/deploy):
  - capture the error,
  - either fix now or document as a blocking issue,
  - NEVER silently comment out important code without a clear `// TODO: FIX BUILD (reason)` and mentioning it in the task.
- You may ask ONE clarifying question at a time, but only after:
  - listing your assumptions,
  - proposing your preferred plan.

At the end of the session, produce:
- A list of steps completed per phase.
- A list of demo URLs on *.cfa1.llmneighbors.com.
- A list of commands to run tests locally (dotnet/npm/playwright).
- A short list of changed files per NX.

IMPORTANT: Do NOT stop after just reading and planning. Implement as much as possible towards DoD for NX-05..08 within this branch, respecting constraints.

Now start with PHASE 0, then continue with PHASE 1 and so on, updating your PLAN as you go.
```

И ОБЯЗАТЕЛЬНО включи в этот же промпт (как есть) блок:

```markdown
FINAL SELF-CHECK (обязателен перед завершением сессии)

- [ ] QA: все изменения покрыты тестами (unit/e2e/Playwright, если применимо)
- [ ] Тесты прогнаны на реальных/приближенных к реальным данным
- [ ] Падения/регрессии явно зафиксированы, нет «тихого» фоллбэка
- [ ] Честно описаны блокеры ("невозможно реализовать, потому что …")
- [ ] Git: сделан(ы) осмысленный(е) commit(ы) формата:
      {code-change} + {code-test} + {test-artifacts/output} + {update-docs-DoD-Kickoff-checkboxes}
```

Агент **не имеет права** считать работу завершённой, пока явно не пройдёт этот чек‑лист в Codex summary.

---

5. NEXT_STEPS_FOR_HUMAN

* [ ] **До запуска агента:**

  * Убедиться, что ветка `codex/fix-cfa1-regressions` существует и актуальна относительно `develop` (без незапланированных локальных изменений).
  * Проверить, что на машине Codex доступны:

    * `node`, `npm`, `npx playwright`,
    * `dotnet` (или хотя бы есть CI место, где агент может запускать dotnet командой, если локально нельзя).
  * Подготовить доступ к CFA1 (auth/api/issuer/investor/backoffice) и, по возможности, заранее проверить, что домены *.cfa1.llmneighbors.com резолвятся и открываются.
  * Сложить в один промпт‑файл для агента:

    * AGENT_PROMPT из пункта 4,
    * ссылки на ключевые контекстные файлы (Scrum DoD kickoff, NX‑таски, code2prompt).
  * Решить, где хранить артефакты Playwright (папка `artifacts/tests/e2e/playwright/**`) и убедиться, что она не игнорируется `.gitignore`.

* [ ] **Что проверить после работы агента:**

  * В `codex/fix-cfa1-regressions`:

    * появились ли новые коммиты по J1–J3 с ожидаемым форматом (code+tests+docs+artefacts),
    * нет ли мусора/непонятных незакоммиченных файлов.
  * Запустить (или пересмотреть вывод агента) для ключевых команд:

    * `dotnet test` для compliance/issuance/settlement (по списку изменений),
    * `npx playwright test` для KYC‑флоу и issuer/backoffice сценариев.
  * Открыть руками ключевые CFA1‑URL:

    * `/issuer/dashboard`, `/issuer/reports`, `/issuer/payouts/schedule`,
    * `/investor/kyc`,
    * `/backoffice/kyc`, `/backoffice/users`, `/backoffice/audit`,
      и убедиться, что поведение совпадает с тем, что описано в обновлённых NX‑тасках.
  * Просмотреть `tasks/NX-05..08-*.md` и убедиться, что:

    * есть свежие “Current status on CFA1” с датами и HTTP‑кодами,
    * DoD‑чекбоксы и блоки `Verified/Blocked` выглядят честными и полными.
  * Проверить `CHANGELOG.md` и Swagger/AsyncAPI docs-файл: отражены ли:

    * branch‑policy (develop vs infra.defis.deploy),
    * текущее покрытие Swagger/AsyncAPI и решения по защите,
    * финальный статус NX‑05..08 на CFA1.

Если что‑то из этого не выполнено — это сигнал для следующей Oracle‑итерации или ручной доработки.
