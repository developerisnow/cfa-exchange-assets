# Prompt
````prompt
# Oracle Evaluator Prompt Â· OIS-CFA Readiness Review

**Role:** Senior Oracle/Evaluator (GPT-5 Pro / Gemini). You have no filesystem access; rely on `context.txt` only.

## Objective
1. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð²ÐµÑ‚ÐºÐ¸ NX-01/03/05/06/08 ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð² `infra.defis.deploy`, Ð° Ð°Ñ€Ñ…Ð¸Ð²Ñ‹ `zip/*` Ð¿Ð¾ÐºÑ€Ñ‹Ð²Ð°ÑŽÑ‚ Ð²ÑÐµ ÑÐ´ÐµÐ»Ð°Ð½Ð½Ñ‹Ðµ mergeâ€™Ð¸.
2. ÐžÑ†ÐµÐ½Ð¸Ñ‚ÑŒ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚ÑŒ Ð´ÐµÐ¿Ð»Ð¾Ñ Ð½Ð° Ð½Ð¾Ð²Ñ‹Ð¹ VPS/Ð´Ð¾Ð¼ÐµÐ½ (Ð¾Ñ‚Ð»Ð¸Ñ‡Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ UK1): runbooks, scripts, DNS/Cloudflare, secrets.
3. Ð’Ñ‹ÑÐ²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð±ÐµÐ»Ñ‹, Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÑŽÑ‰Ð¸Ðµ NX-07 (Backoffice KYC/User Registry) Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¿Ð¾ÑÐ»Ðµ Ñ€ÐµÐ»Ð¸Ð·Ð° NX-05/06/08.
4. ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ñ‚ÑŒ actionable feedback (issues + next steps) Ð´Ð»Ñ CLI-Ð°Ð³ÐµÐ½Ñ‚Ð¾Ð².

## Checklist
- ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°/ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚: Ð½ÐµÑ‚ Ð»Ð¸ Ñ€Ð°ÑÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð° Ð¼ÐµÐ¶Ð´Ñƒ docs/context, docs/architecture Ð¸ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¼ ÐºÐ¾Ð´Ð¾Ð¼?
- Backend/services: Issuance, Registry, Settlement, ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ scripts (Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ Ð¿Ð¾ÑÐ»Ðµ fix NX-03).
- Frontends: apps/backoffice, portal-issuer, portal-investor, shared-ui â€” Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð½Ð¾Ð²Ñ‹Ðµ API Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾.
- Ops: runbook `10-eywa1-control-plane`, `provision-node.sh`, `deploy-node.sh`, `cloudflare-dns-upsert.sh` â€” Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð»Ð¸ ÑˆÐ°Ð³Ð¾Ð² Ð´Ð»Ñ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°/Ð·Ð¾Ð½Ñ‹?
- Zip workflow: ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚ Ð»Ð¸ Ñ‚ÐµÐ³Ð¸ ÑÐ¿Ð¸ÑÐºÑƒ merged branches? Ð½ÐµÑ‚ Ð»Ð¸ worktree, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð·Ð°Ð±Ñ‹Ð»Ð¸ Ð¿Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ?
- NX-07 status: Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð»Ð¸ API/ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð², Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ? ÐºÐ°ÐºÐ¸Ðµ Ð±Ð»Ð¾ÐºÐµÑ€Ñ‹ Ð²Ð¸Ð´Ð½Ñ‹.

## Expected Output Format
Please return Markdown with four sections:
1. **Findings (severity order)** â€” ÐºÐ°Ð¶Ð´Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ = `[Severity] Summary (reference)` + Ð´ÐµÑ‚Ð°Ð»Ð¸/Ð¿Ð¾ÑÐ»ÐµÐ´ÑÑ‚Ð²Ð¸Ñ.
2. **Deployment Checklist for New VPS** â€” Ñ‚Ð°Ð±Ð»Ð¸Ñ‡ÐºÐ° `Phase | Steps | Required Inputs/Secrets`.
3. **NX-07 Readiness** â€” Ñ‡Ñ‚Ð¾ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾, Ñ‡Ñ‚Ð¾ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚, Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ.
4. **Open Questions** â€” Ñ‡Ñ‚Ð¾ Ð½ÑƒÐ¶Ð½Ð¾ ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚ÑŒ Ñƒ Ð¸Ð½Ð¶ÐµÐ½ÐµÑ€Ð¾Ð² Ð¿ÐµÑ€ÐµÐ´ rollout.


````
# Output 
# Oracle Evaluator Report â€” OIS-CFA Readiness

Based on the analysis of the provided `context.txt` (containing git snapshots, task reports, runbooks, and script content), here is the readiness assessment.

## 1. Findings

| Severity | Summary | Details & Consequences |
| :--- | :--- | :--- |
| **High** | **NX-07 Backend Implementation Missing** | The frontend for Backoffice KYC (`feature/NX-07-backoffice-kyc`) implements UI and API clients (`apps/backoffice/src/lib/api/compliance.ts`) but relies on **mocks**. The corresponding endpoints in `ComplianceService` (`GET /v1/compliance/kyc`) and `IdentityService` (`GET /v1/identity/users`) are not confirmed as implemented in the merged code. **Consequence:** The KYC/User Registry features will not work on real data after deployment. |
| **Medium** | **Manual Permission Step in Deploy** | The `deploy-node.sh` script outputs a *hint* (`>>> NOTE: ... you may need to fix permissions`), but does not automatically fix ownership (`chown -R user:user`). **Consequence:** If the operator misses this hint, `npm install` (PM2 setup) will fail with `EACCES` on the target node, interrupting the runbook flow. |
| **Low** | **Memory Database Configuration Risk** | The fix for NX-03 introduced `UseInMemoryDatabase` toggled by config. While it defaults to `false`, verify that production `appsettings.json` or ENV variables on `uk1`/`cfa1` do not accidentally enable this, which would cause data loss on restart. |
| **Info** | **Zip Archive Consistency** | Tags `zip/tasks/NX-01...`, `zip/fix/NX-03...`, `zip/tasks/NX-05...`, `zip/feature/NX-06...`, `zip/feature/NX-08...` are present. This indicates a healthy cleanup process. Ensure `feature/NX-07-backoffice-kyc` is zipped **only after** backend implementation is merged. |

## 2. Deployment Checklist for New VPS (cfa2/fin2)

To deploy on a new node with a custom domain/account, follow this sequence based on `MULTI_ACCOUNT_SETUP.md`:

| Phase | Steps | Required Inputs / Secrets |
| :--- | :--- | :--- |
| **1. Prep** | 1. Define `.env.cfa2` on `eywa1` (repo `cloudflare__developerisnow`).<br>2. Ensure SSH access (`root`) to target IP. | `CF_ZONE_ID`, `CF_API_TOKEN`, `Target IP`, `SSH Key` |
| **2. Provision** | Run `ops/scripts/deploy/provision-node.sh <host>`.<br>*(Creates user, docker, nginx, postfix)*. | None (Uses defaults or env vars) |
| **3. DNS** | Run `ops/scripts/cloudflare-dns-upsert.sh .env.cfa2 <ip>`.<br>*(Creates A-records)*. | `.env.cfa2` path |
| **4. Deploy** | Run `ops/scripts/deploy/deploy-node.sh <host>`.<br>*(Clones repo, starts backend containers)*. | `OIS_CFA_BRANCH` (default: `infra.defis.deploy`) |
| **5. Config** | 1. SSH to node (`user`).<br>2. Fix permissions: `sudo chown -R user:user /srv/cfa`.<br>3. Create `.env` for backend (DB creds, etc).<br>4. Create `.env.local` for frontends (Public URLs). | DB Secrets, Keycloak Secrets, Public URLs |
| **6. Ingress** | 1. Generate Nginx config (from `nginx-cfa-portals.conf` template).<br>2. Run Certbot (DNS/HTTP challenge) for SSL.<br>3. Restart Nginx. | `CERTBOT_EMAIL`, Domain Names |
| **7. Verify** | Run `curl https://api.<domain>/health`.<br>Check Keycloak Login Flow. | None |

## 3. NX-07 Readiness (Backoffice KYC)

*   **Status:** ðŸš§ **Blocked by Backend**
*   **Ready:**
    *   **Specs:** Kickoff checklist and Mermaid flows defined in `docs/enrich-nx-tasks`.
    *   **Frontend:** UI pages `/kyc` and `/users` created; API client structure defined.
*   **Missing:**
    *   Real implementation of `ComplianceController` endpoints.
    *   Integration with `IdentityService` for user listing.
    *   Database migrations for KYC requests (if not already present).
*   **Action Plan:**
    1.  Switch focus to `services/compliance` and `services/identity`.
    2.  Implement controllers matching the mocked API client in `apps/backoffice`.
    3.  Verify integration locally before merging to `infra.defis.deploy`.

## 4. Open Questions

1.  **Cloudflare Account Access:** Do we have the valid `CF_ZONE_ID` and `CF_API_TOKEN` for the *new* domain intended for `fin2`? The scripts require these to be ready in `.env.cfa2`.
2.  **Persistence Strategy:** Does `fin2` require data migration (restore from backup) or does it start with an empty database? The current runbook assumes a fresh start.
3.  **NX-07 Scope:** Should NX-07 be completed *before* the full rollout to `cfa2`, or is `cfa2` intended to test NX-05/06/08 first? (Recommendation: Rollout NX-05/06/08 first to validate stability).