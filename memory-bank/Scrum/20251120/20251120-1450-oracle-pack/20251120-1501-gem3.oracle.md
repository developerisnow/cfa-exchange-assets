# Prompt
"./20251120-1457-prompt1.oracle.md"
# Output 
# Oracle Evaluator Report â€” OIS-CFA Readiness

Based on the analysis of the provided `context.txt` (containing git snapshots, task reports, runbooks, and script content), here is the readiness assessment.

## 1. Findings

| Severity | Summary | Details & Consequences |
| :--- | :--- | :--- |
| **High** | **NX-07 Backend Implementation Missing** | The frontend for Backoffice KYC (`feature/NX-07-backoffice-kyc`) implements UI and API clients (`apps/backoffice/src/lib/api/compliance.ts`) but relies on **mocks**. The corresponding endpoints in `ComplianceService` (`GET /v1/compliance/kyc`) and `IdentityService` (`GET /v1/identity/users`) are not confirmed as implemented in the merged code. **Consequence:** The KYC/User Registry features will not work on real data after deployment. |
| **Medium** | **Manual Permission Step in Deploy** | The `deploy-node.sh` script outputs a *hint* (`>>> NOTE: ... you may need to fix permissions`), but does not automatically fix ownership (`chown -R user:user`). **Consequence:** If the operator misses this hint, `npm install` (PM2 setup) will fail with `EACCES` on the target node, interrupting the runbook flow. |
| **Low** | **Memory Database Configuration Risk** | The fix for NX-03 introduced `UseInMemoryDatabase` toggled by config. While it defaults to `false`, verify that production `appsettings.json` or ENV variables on `uk1`/`cfa1` do not accidentally enable this, which would cause data loss on restart. |
| **Info** | **Zip Archive Consistency** | Tags `zip/tasks/NX-01...`, `zip/fix/NX-03...`, `zip/tasks/NX-05...`, `zip/feature/NX-06...`, `zip/feature/NX-08...` are present. This indicates a healthy cleanup process. Ensure `feature/NX-07-backoffice-kyc` is zipped **only after** backend implementation is merged. |

## 2. Deployment Checklist for New VPS (cfa2/fin2)

To deploy on a new node with a custom domain/account, follow this sequence based on `MULTI_ACCOUNT_SETUP.md`:

| Phase | Steps | Required Inputs / Secrets |
| :--- | :--- | :--- |
| **1. Prep** | 1. Define `.env.cfa2` on `eywa1` (repo `cloudflare__developerisnow`).<br>2. Ensure SSH access (`root`) to target IP. | `CF_ZONE_ID`, `CF_API_TOKEN`, `Target IP`, `SSH Key` |
| **2. Provision** | Run `ops/scripts/deploy/provision-node.sh <host>`.<br>*(Creates user, docker, nginx, postfix)*. | None (Uses defaults or env vars) |
| **3. DNS** | Run `ops/scripts/cloudflare-dns-upsert.sh .env.cfa2 <ip>`.<br>*(Creates A-records)*. | `.env.cfa2` path |
| **4. Deploy** | Run `ops/scripts/deploy/deploy-node.sh <host>`.<br>*(Clones repo, starts backend containers)*. | `OIS_CFA_BRANCH` (default: `infra.defis.deploy`) |
| **5. Config** | 1. SSH to node (`user`).<br>2. Fix permissions: `sudo chown -R user:user /srv/cfa`.<br>3. Create `.env` for backend (DB creds, etc).<br>4. Create `.env.local` for frontends (Public URLs). | DB Secrets, Keycloak Secrets, Public URLs |
| **6. Ingress** | 1. Generate Nginx config (from `nginx-cfa-portals.conf` template).<br>2. Run Certbot (DNS/HTTP challenge) for SSL.<br>3. Restart Nginx. | `CERTBOT_EMAIL`, Domain Names |
| **7. Verify** | Run `curl https://api.<domain>/health`.<br>Check Keycloak Login Flow. | None |

## 3. NX-07 Readiness (Backoffice KYC)

*   **Status:** ðŸš§ **Blocked by Backend**
*   **Ready:**
    *   **Specs:** Kickoff checklist and Mermaid flows defined in `docs/enrich-nx-tasks`.
    *   **Frontend:** UI pages `/kyc` and `/users` created; API client structure defined.
*   **Missing:**
    *   Real implementation of `ComplianceController` endpoints.
    *   Integration with `IdentityService` for user listing.
    *   Database migrations for KYC requests (if not already present).
*   **Action Plan:**
    1.  Switch focus to `services/compliance` and `services/identity`.
    2.  Implement controllers matching the mocked API client in `apps/backoffice`.
    3.  Verify integration locally before merging to `infra.defis.deploy`.

## 4. Open Questions

1.  **Cloudflare Account Access:** Do we have the valid `CF_ZONE_ID` and `CF_API_TOKEN` for the *new* domain intended for `fin2`? The scripts require these to be ready in `.env.cfa2`.
2.  **Persistence Strategy:** Does `fin2` require data migration (restore from backup) or does it start with an empty database? The current runbook assumes a fresh start.
3.  **NX-07 Scope:** Should NX-07 be completed *before* the full rollout to `cfa2`, or is `cfa2` intended to test NX-05/06/08 first? (Recommendation: Rollout NX-05/06/08 first to validate stability).