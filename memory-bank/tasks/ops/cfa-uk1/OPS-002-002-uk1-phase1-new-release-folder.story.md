---
created: 2025-11-27 12:35
updated: 2025-11-27 12:35
type: story
sphere: [devops]
topic: [uk1, deploy, filesystem]
author: alex
agentID: fdfe6b1e-e4ee-4505-a723-e892922472f9
partAgentID: [co-76ca]
version: 0.1.0
tags: [uk1, cfa, release, clone, rollback]
epic_id: OPS-002-UK1-DEPLOY
story_id: OPS-002-002
status: planned
priority: high
points: 3
---

# OPS-002-002: PHASE1 ¬∑ Prepare new git-based release folder on UK1

## üëî JTBD

–°–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–∞ UK1 –ø–æ—è–≤–∏–ª—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π release‚Äë–∫–∞—Ç–∞–ª–æ–≥ —Å —á–∏—Å—Ç—ã–º git‚Äë–∫–æ–Ω–æ–º (`release/uk1-develop-*`), –≤ –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–∞—Å–∫–∞—Ç—ã–≤–∞—Ç—å `develop`, –∫–æ–ø–∏—Ä—É—è —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ `/opt/ois-cfa`, –Ω–µ –ª–æ–º–∞—è —Ç–µ–∫—É—â–∏–π —Ä–∞–±–æ—á–∏–π —Å—Ç–µ–∫.

## ‚úÖ Definition of Done

- [ ] –ù–∞ UK1 —Å–æ–∑–¥–∞–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤:
  - [ ] —Å—É—â–µ—Å—Ç–≤—É–µ—Ç `/opt/ois-cfa_releases`;
  - [ ] –≤ –Ω—ë–º –µ—Å—Ç—å –ø–∞–ø–∫–∞ –≤–∏–¥–∞ `/opt/ois-cfa_releases/ois-cfa_YYYYMMDD` (–¥–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–ª–æ—è `develop`).
- [ ] –í release‚Äë–ø–∞–ø–∫–µ:
  - [ ] –≤—ã–ø–æ–ª–Ω–µ–Ω `git clone` —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è `npk/ois-cfa` –ø–æ SSH;
  - [ ] checkout release‚Äë–≤–µ—Ç–∫–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π story (`release/uk1-develop-YYYYMMDD`);
  - [ ] `git status -sb` —á–∏—Å—Ç—ã–π (–Ω–µ—Ç untracked/modified —Ñ–∞–π–ª–æ–≤).
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ `/opt/ois-cfa`:
  - [ ] `.env` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π env‚Äë—Ñ–∞–π–ª) —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ develop‚Äë–≤–µ—Ç–∫—É;
  - [ ] `docker-compose*.yml` –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã (–∏–ª–∏ –≤—ã–±—Ä–∞–Ω –æ–¥–∏–Ω canonical compose –¥–ª—è UK1);
  - [ ] `apps/*/.env.local` –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –¥–ª—è Issuer/Investor/Backoffice —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏ `*.cfa.llmneighbors.com`;
  - [ ] nginx/systemd –∫–æ–Ω—Ñ–∏–≥–∏ *–Ω–µ* –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —Ç–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—Ç—Å—è, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å.
- [ ] –í release‚Äë–ø–∞–ø–∫–µ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–≥–æ–Ω—è–µ—Ç—Å—è:
  - [ ] `docker compose config` –±–µ–∑ –æ—à–∏–±–æ–∫;
  - [ ] –ø–æ –∂–µ–ª–∞–Ω–∏—é ‚Äî `docker compose pull` (–±–µ–∑ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ `up`).
- [ ] –í `memory-bank` –µ—Å—Ç—å –æ—Ç—á—ë—Ç —Å:
  - [ ] –∫–æ–º–∞–Ω–¥–∞–º–∏ `git clone`, `git checkout`, `docker compose config`;
  - [ ] –ø—É—Ç—è–º–∏ —Å—Ç–∞—Ä–æ–≥–æ –∏ –Ω–æ–≤–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–æ–≤;
  - [ ] —è–≤–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ–º, —á—Ç–æ ‚Äú–±–æ–µ–≤—ã–º‚Äù –≤—Å—ë –µ—â—ë –æ—Å—Ç–∞—ë—Ç—Å—è —Å—Ç–∞—Ä—ã–π `/opt/ois-cfa`.

## üîé Verification Matrix

| Check type   | Required | How exactly                                                                                   | Evidence                                      |
|-------------|----------|------------------------------------------------------------------------------------------------|-----------------------------------------------|
| Release dir | ‚úÖ       | `ssh uk1 "ls -d /opt/ois-cfa_releases/ois-cfa_*"`                                              | –°–ø–∏—Å–æ–∫ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ —Å –¥–∞—Ç–∞–º–∏                     |
| Git clone   | ‚úÖ       | `ssh uk1 "cd /opt/ois-cfa_releases/ois-cfa_YYYYMMDD && git status -sb && git branch --show-current"` | –í—ã–≤–æ–¥ git‚Äë–≤–µ—Ç–∫–∏ –∏ clean status            |
| Config copy | ‚úÖ       | `ls`/`cat` `.env`, `docker-compose*.yml`, `apps/*/.env.local` –≤ release‚Äë–ø–∞–ø–∫–µ                  | –§—Ä–∞–≥–º–µ–Ω—Ç—ã –∫–æ–Ω—Ñ–∏–≥–æ–≤ –≤ –æ—Ç—á—ë—Ç–µ                   |
| Compose cfg | ‚úÖ       | `docker compose config`                                                                        | Exit code 0, –Ω–µ—Ç warn/error                   |

## üöÄ Kickoff / Plan (–¥–ª—è –∞–≥–µ–Ω—Ç–∞)

1. –ò—Å–ø–æ–ª—å–∑—É—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã OPS-002-001, –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–º—è release‚Äë–≤–µ—Ç–∫–∏ –∏ –¥–∞—Ç—É (`YYYYMMDD`).  
2. –ù–∞ UK1 —Å–æ–∑–¥–∞—Ç—å `/opt/ois-cfa_releases` –∏ –Ω–æ–≤—ã–π –∫–∞—Ç–∞–ª–æ–≥ `ois-cfa_YYYYMMDD`.  
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å `git clone` –∏ checkout release‚Äë–≤–µ—Ç–∫–∏ –≤ –Ω–æ–≤—ã–π –∫–∞—Ç–∞–ª–æ–≥.  
4. –ê–∫–∫—É—Ä–∞—Ç–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å env/compose/portal‚Äëenv.local —Ñ–∞–π–ª—ã –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ `/opt/ois-cfa`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ª–∏—á–∏—è.  
5. –ü—Ä–æ–≥–Ω–∞—Ç—å `docker compose config` –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞.  
6. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë –≤ `memory-bank` (–∫–æ–º–∞–Ω–¥—ã, –≤—ã–≤–æ–¥—ã, –∑–∞–º–µ—á–∞–Ω–∏—è), –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å story.

## üîÅ Loop trace

> Loop 1: —Å–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ release‚Äë–∫–∞—Ç–∞–ª–æ–≥–∞.  
> Loop N: —Å–æ–∑–¥–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–µ–ª–∏–∑–æ–≤ (–º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É story –∫–∞–∫ —à–∞–±–ª–æ–Ω).

